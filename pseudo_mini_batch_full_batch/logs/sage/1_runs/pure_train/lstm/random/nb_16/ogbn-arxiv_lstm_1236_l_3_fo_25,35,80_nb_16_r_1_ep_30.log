Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1647785982.7056384
ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.027546405792236328
random selection method range initialization spend 0.006383419036865234
time for parepare:  0.018894433975219727
local_output_nid generation:  0.0021829605102539062
local_in_edges_tensor generation:  0.0052645206451416016
mini_batch_src_global generation:  0.002057313919067383
r_  generation:  0.020867109298706055
local_output_nid generation:  0.0025663375854492188
local_in_edges_tensor generation:  0.0017406940460205078
mini_batch_src_global generation:  0.002360820770263672
r_  generation:  0.019306421279907227
local_output_nid generation:  0.002814769744873047
local_in_edges_tensor generation:  0.0016372203826904297
mini_batch_src_global generation:  0.001581430435180664
r_  generation:  0.01975703239440918
local_output_nid generation:  0.002870798110961914
local_in_edges_tensor generation:  0.001667022705078125
mini_batch_src_global generation:  0.0016415119171142578
r_  generation:  0.020372390747070312
local_output_nid generation:  0.0028426647186279297
local_in_edges_tensor generation:  0.0016562938690185547
mini_batch_src_global generation:  0.0015957355499267578
r_  generation:  0.020211219787597656
local_output_nid generation:  0.002826690673828125
local_in_edges_tensor generation:  0.0016121864318847656
mini_batch_src_global generation:  0.001653432846069336
r_  generation:  0.021084070205688477
local_output_nid generation:  0.0029304027557373047
local_in_edges_tensor generation:  0.001596689224243164
mini_batch_src_global generation:  0.0016107559204101562
r_  generation:  0.020729541778564453
local_output_nid generation:  0.0029044151306152344
local_in_edges_tensor generation:  0.0015494823455810547
mini_batch_src_global generation:  0.0016026496887207031
r_  generation:  0.020738840103149414
local_output_nid generation:  0.0028553009033203125
local_in_edges_tensor generation:  0.0015370845794677734
mini_batch_src_global generation:  0.0017390251159667969
r_  generation:  0.021536827087402344
local_output_nid generation:  0.0028922557830810547
local_in_edges_tensor generation:  0.0015273094177246094
mini_batch_src_global generation:  0.0017445087432861328
r_  generation:  0.021234989166259766
local_output_nid generation:  0.0028562545776367188
local_in_edges_tensor generation:  0.0015835762023925781
mini_batch_src_global generation:  0.0017275810241699219
r_  generation:  0.021526098251342773
local_output_nid generation:  0.002917766571044922
local_in_edges_tensor generation:  0.0015821456909179688
mini_batch_src_global generation:  0.0017859935760498047
r_  generation:  0.021932125091552734
local_output_nid generation:  0.002859830856323242
local_in_edges_tensor generation:  0.001575469970703125
mini_batch_src_global generation:  0.0017902851104736328
r_  generation:  0.02198481559753418
local_output_nid generation:  0.0028781890869140625
local_in_edges_tensor generation:  0.0015990734100341797
mini_batch_src_global generation:  0.0017926692962646484
r_  generation:  0.021391868591308594
local_output_nid generation:  0.0028886795043945312
local_in_edges_tensor generation:  0.001589059829711914
mini_batch_src_global generation:  0.001796722412109375
r_  generation:  0.02193903923034668
local_output_nid generation:  0.002875804901123047
local_in_edges_tensor generation:  0.0015566349029541016
mini_batch_src_global generation:  0.0017850399017333984
r_  generation:  0.0210115909576416
----------------------check_connections_block total spend ----------------------------- 0.5430681705474854
generate_one_block  0.03191113471984863
generate_one_block  0.03011918067932129
generate_one_block  0.034250736236572266
generate_one_block  0.03184938430786133
generate_one_block  0.030862808227539062
generate_one_block  0.0314633846282959
generate_one_block  0.030655622482299805
generate_one_block  0.030233383178710938
generate_one_block  0.03140997886657715
generate_one_block  0.03105449676513672
generate_one_block  0.031193017959594727
generate_one_block  0.032808780670166016
generate_one_block  0.032087087631225586
generate_one_block  0.031302690505981445
generate_one_block  0.032038211822509766
generate_one_block  0.030390024185180664
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04058957099914551
gen group dst list time:  0.0206449031829834
time for parepare:  0.01902484893798828
local_output_nid generation:  0.009289026260375977
local_in_edges_tensor generation:  0.02149820327758789
mini_batch_src_global generation:  0.02383136749267578
r_  generation:  0.22149991989135742
local_output_nid generation:  0.013044118881225586
local_in_edges_tensor generation:  0.02112555503845215
mini_batch_src_global generation:  0.027058839797973633
r_  generation:  0.21744322776794434
local_output_nid generation:  0.01302027702331543
local_in_edges_tensor generation:  0.017842531204223633
mini_batch_src_global generation:  0.030071020126342773
r_  generation:  0.23203206062316895
local_output_nid generation:  0.013202428817749023
local_in_edges_tensor generation:  0.022951841354370117
mini_batch_src_global generation:  0.027637004852294922
r_  generation:  0.24118852615356445
local_output_nid generation:  0.013057708740234375
local_in_edges_tensor generation:  0.018194198608398438
mini_batch_src_global generation:  0.027842283248901367
r_  generation:  0.2430882453918457
local_output_nid generation:  0.014154911041259766
local_in_edges_tensor generation:  0.01850724220275879
mini_batch_src_global generation:  0.030443906784057617
r_  generation:  0.25281810760498047
local_output_nid generation:  0.0169525146484375
local_in_edges_tensor generation:  0.027975797653198242
mini_batch_src_global generation:  0.03101491928100586
r_  generation:  0.23226165771484375
local_output_nid generation:  0.013058900833129883
local_in_edges_tensor generation:  0.017060279846191406
mini_batch_src_global generation:  0.029169321060180664
r_  generation:  0.22596240043640137
local_output_nid generation:  0.013382434844970703
local_in_edges_tensor generation:  0.020930051803588867
mini_batch_src_global generation:  0.029256343841552734
r_  generation:  0.23467326164245605
local_output_nid generation:  0.013516902923583984
local_in_edges_tensor generation:  0.014789342880249023
mini_batch_src_global generation:  0.029661893844604492
r_  generation:  0.23392271995544434
local_output_nid generation:  0.013309478759765625
local_in_edges_tensor generation:  0.014706611633300781
mini_batch_src_global generation:  0.029269695281982422
r_  generation:  0.2366013526916504
local_output_nid generation:  0.013437271118164062
local_in_edges_tensor generation:  0.019283294677734375
mini_batch_src_global generation:  0.029564619064331055
r_  generation:  0.2383735179901123
local_output_nid generation:  0.013636112213134766
local_in_edges_tensor generation:  0.0150909423828125
mini_batch_src_global generation:  0.030112504959106445
r_  generation:  0.23880624771118164
local_output_nid generation:  0.013473272323608398
local_in_edges_tensor generation:  0.013333559036254883
mini_batch_src_global generation:  0.029645204544067383
r_  generation:  0.23227357864379883
local_output_nid generation:  0.013484001159667969
local_in_edges_tensor generation:  0.01271677017211914
mini_batch_src_global generation:  0.030111312866210938
r_  generation:  0.23766446113586426
local_output_nid generation:  0.01325678825378418
local_in_edges_tensor generation:  0.015201091766357422
mini_batch_src_global generation:  0.02955484390258789
r_  generation:  0.23338937759399414
----------------------check_connections_block total spend ----------------------------- 5.575736045837402
generate_one_block  0.32648706436157227
generate_one_block  0.3168623447418213
generate_one_block  0.3231344223022461
generate_one_block  0.30933094024658203
generate_one_block  0.3269064426422119
generate_one_block  0.31379246711730957
generate_one_block  0.3007385730743408
generate_one_block  0.2959580421447754
generate_one_block  0.3077089786529541
generate_one_block  0.311267614364624
generate_one_block  0.3067200183868408
generate_one_block  0.31465649604797363
generate_one_block  0.31533050537109375
generate_one_block  0.29895639419555664
generate_one_block  0.3168761730194092
generate_one_block  0.3394649028778076
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.0407559871673584
gen group dst list time:  0.06208324432373047
time for parepare:  0.019164085388183594
local_output_nid generation:  0.02673625946044922
local_in_edges_tensor generation:  0.06051898002624512
mini_batch_src_global generation:  0.045920610427856445
r_  generation:  0.4673740863800049
local_output_nid generation:  0.033852577209472656
local_in_edges_tensor generation:  0.05331754684448242
mini_batch_src_global generation:  0.055123090744018555
r_  generation:  0.44954919815063477
local_output_nid generation:  0.03316497802734375
local_in_edges_tensor generation:  0.04092907905578613
mini_batch_src_global generation:  0.054720163345336914
r_  generation:  0.4579477310180664
local_output_nid generation:  0.03247690200805664
local_in_edges_tensor generation:  0.043764591217041016
mini_batch_src_global generation:  0.05224323272705078
r_  generation:  0.45935797691345215
local_output_nid generation:  0.03268766403198242
local_in_edges_tensor generation:  0.03202652931213379
mini_batch_src_global generation:  0.05231928825378418
r_  generation:  0.4639122486114502
local_output_nid generation:  0.033513784408569336
local_in_edges_tensor generation:  0.042624711990356445
mini_batch_src_global generation:  0.05485987663269043
r_  generation:  0.4758117198944092
local_output_nid generation:  0.03217506408691406
local_in_edges_tensor generation:  0.038773536682128906
mini_batch_src_global generation:  0.0564882755279541
r_  generation:  0.4760463237762451
local_output_nid generation:  0.03367471694946289
local_in_edges_tensor generation:  0.03583717346191406
mini_batch_src_global generation:  0.05881023406982422
r_  generation:  0.4581563472747803
local_output_nid generation:  0.03275346755981445
local_in_edges_tensor generation:  0.03333616256713867
mini_batch_src_global generation:  0.05546832084655762
r_  generation:  0.4676225185394287
local_output_nid generation:  0.032712459564208984
local_in_edges_tensor generation:  0.033860206604003906
mini_batch_src_global generation:  0.06748199462890625
r_  generation:  0.4600071907043457
local_output_nid generation:  0.032618045806884766
local_in_edges_tensor generation:  0.03724050521850586
mini_batch_src_global generation:  0.0526423454284668
r_  generation:  0.46985602378845215
local_output_nid generation:  0.032547712326049805
local_in_edges_tensor generation:  0.03401756286621094
mini_batch_src_global generation:  0.05695819854736328
r_  generation:  0.46878576278686523
local_output_nid generation:  0.03373098373413086
local_in_edges_tensor generation:  0.045131683349609375
mini_batch_src_global generation:  0.05362248420715332
r_  generation:  0.4860994815826416
local_output_nid generation:  0.03251028060913086
local_in_edges_tensor generation:  0.03813529014587402
mini_batch_src_global generation:  0.05514788627624512
r_  generation:  0.46344494819641113
local_output_nid generation:  0.03477120399475098
local_in_edges_tensor generation:  0.038321733474731445
mini_batch_src_global generation:  0.05371427536010742
r_  generation:  0.47033238410949707
local_output_nid generation:  0.03254389762878418
local_in_edges_tensor generation:  0.02972126007080078
mini_batch_src_global generation:  0.054665327072143555
r_  generation:  0.4601004123687744
----------------------check_connections_block total spend ----------------------------- 11.159664630889893
generate_one_block  0.594599723815918
generate_one_block  0.5842206478118896
generate_one_block  0.588951826095581
generate_one_block  0.5899794101715088
generate_one_block  0.5834779739379883
generate_one_block  0.5885372161865234
generate_one_block  0.6486177444458008
generate_one_block  0.5822515487670898
generate_one_block  0.5825052261352539
generate_one_block  0.5947842597961426
generate_one_block  0.5896177291870117
generate_one_block  0.5891129970550537
generate_one_block  0.5911998748779297
generate_one_block  0.5861217975616455
generate_one_block  0.5934572219848633
generate_one_block  0.5806362628936768
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  16.735400676727295
block generation total time  14.492262840270996
average batch blocks generation time:  0.9057664275169373
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1795654296875 GB
    Memory Allocated: 0.09618520736694336  GigaBytes
Max Memory Allocated: 0.09618520736694336  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 433, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 429, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 53, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 30.00 MiB (GPU 0; 23.62 GiB total capacity; 22.08 GiB already allocated; 12.44 MiB free; 22.41 GiB reserved in total by PyTorch)
