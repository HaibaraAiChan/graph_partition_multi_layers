Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1647792462.2434893
ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.027317285537719727
random selection method range initialization spend 0.0063953399658203125
time for parepare:  0.018648147583007812
local_output_nid generation:  0.002153158187866211
local_in_edges_tensor generation:  0.00521540641784668
mini_batch_src_global generation:  0.002022981643676758
r_  generation:  0.020772218704223633
local_output_nid generation:  0.0025246143341064453
local_in_edges_tensor generation:  0.0017342567443847656
mini_batch_src_global generation:  0.002363443374633789
r_  generation:  0.019147396087646484
local_output_nid generation:  0.002782583236694336
local_in_edges_tensor generation:  0.0016219615936279297
mini_batch_src_global generation:  0.0015304088592529297
r_  generation:  0.019646167755126953
local_output_nid generation:  0.0027818679809570312
local_in_edges_tensor generation:  0.0015950202941894531
mini_batch_src_global generation:  0.001573324203491211
r_  generation:  0.020213603973388672
local_output_nid generation:  0.0028226375579833984
local_in_edges_tensor generation:  0.0015339851379394531
mini_batch_src_global generation:  0.0015337467193603516
r_  generation:  0.020267009735107422
local_output_nid generation:  0.002839326858520508
local_in_edges_tensor generation:  0.0015549659729003906
mini_batch_src_global generation:  0.0016374588012695312
r_  generation:  0.020493745803833008
local_output_nid generation:  0.002803802490234375
local_in_edges_tensor generation:  0.0015063285827636719
mini_batch_src_global generation:  0.0016384124755859375
r_  generation:  0.020362138748168945
local_output_nid generation:  0.0027837753295898438
local_in_edges_tensor generation:  0.0014781951904296875
mini_batch_src_global generation:  0.001672506332397461
r_  generation:  0.020387649536132812
local_output_nid generation:  0.0028219223022460938
local_in_edges_tensor generation:  0.0014700889587402344
mini_batch_src_global generation:  0.001661539077758789
r_  generation:  0.021281957626342773
local_output_nid generation:  0.0028324127197265625
local_in_edges_tensor generation:  0.0014951229095458984
mini_batch_src_global generation:  0.001687765121459961
r_  generation:  0.020969629287719727
local_output_nid generation:  0.0028493404388427734
local_in_edges_tensor generation:  0.0014643669128417969
mini_batch_src_global generation:  0.001714468002319336
r_  generation:  0.020884275436401367
local_output_nid generation:  0.0028295516967773438
local_in_edges_tensor generation:  0.001447916030883789
mini_batch_src_global generation:  0.001802682876586914
r_  generation:  0.021748781204223633
local_output_nid generation:  0.0028486251831054688
local_in_edges_tensor generation:  0.0014972686767578125
mini_batch_src_global generation:  0.0018014907836914062
r_  generation:  0.022084951400756836
local_output_nid generation:  0.002837657928466797
local_in_edges_tensor generation:  0.0014801025390625
mini_batch_src_global generation:  0.0017597675323486328
r_  generation:  0.02169942855834961
local_output_nid generation:  0.002844572067260742
local_in_edges_tensor generation:  0.001474142074584961
mini_batch_src_global generation:  0.0018181800842285156
r_  generation:  0.021852731704711914
local_output_nid generation:  0.002835988998413086
local_in_edges_tensor generation:  0.0014719963073730469
mini_batch_src_global generation:  0.0018167495727539062
r_  generation:  0.020948410034179688
----------------------check_connections_block total spend ----------------------------- 0.5368645191192627
generate_one_block  0.031920671463012695
generate_one_block  0.030128002166748047
generate_one_block  0.03419899940490723
generate_one_block  0.03138589859008789
generate_one_block  0.030523061752319336
generate_one_block  0.031333208084106445
generate_one_block  0.030361413955688477
generate_one_block  0.029923439025878906
generate_one_block  0.030889034271240234
generate_one_block  0.0305325984954834
generate_one_block  0.03069782257080078
generate_one_block  0.03157806396484375
generate_one_block  0.030992507934570312
generate_one_block  0.030425310134887695
generate_one_block  0.0314784049987793
generate_one_block  0.030054807662963867
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04236602783203125
gen group dst list time:  0.02047133445739746
time for parepare:  0.01952052116394043
local_output_nid generation:  0.009314298629760742
local_in_edges_tensor generation:  0.0216064453125
mini_batch_src_global generation:  0.027974605560302734
r_  generation:  0.2551999092102051
local_output_nid generation:  0.015369415283203125
local_in_edges_tensor generation:  0.02356863021850586
mini_batch_src_global generation:  0.03141188621520996
r_  generation:  0.24632954597473145
local_output_nid generation:  0.015891075134277344
local_in_edges_tensor generation:  0.019259214401245117
mini_batch_src_global generation:  0.0311124324798584
r_  generation:  0.26100730895996094
local_output_nid generation:  0.015923500061035156
local_in_edges_tensor generation:  0.015295028686523438
mini_batch_src_global generation:  0.033651113510131836
r_  generation:  0.2627832889556885
local_output_nid generation:  0.016005992889404297
local_in_edges_tensor generation:  0.02207803726196289
mini_batch_src_global generation:  0.03388524055480957
r_  generation:  0.26568055152893066
local_output_nid generation:  0.016097068786621094
local_in_edges_tensor generation:  0.01989579200744629
mini_batch_src_global generation:  0.03455781936645508
r_  generation:  0.26985740661621094
local_output_nid generation:  0.01569509506225586
local_in_edges_tensor generation:  0.019600868225097656
mini_batch_src_global generation:  0.03367424011230469
r_  generation:  0.2637789249420166
local_output_nid generation:  0.015714168548583984
local_in_edges_tensor generation:  0.0144805908203125
mini_batch_src_global generation:  0.03377985954284668
r_  generation:  0.26029109954833984
local_output_nid generation:  0.01594257354736328
local_in_edges_tensor generation:  0.01710963249206543
mini_batch_src_global generation:  0.03395867347717285
r_  generation:  0.26777195930480957
local_output_nid generation:  0.016025066375732422
local_in_edges_tensor generation:  0.01784658432006836
mini_batch_src_global generation:  0.034917593002319336
r_  generation:  0.26906704902648926
local_output_nid generation:  0.01583719253540039
local_in_edges_tensor generation:  0.01722860336303711
mini_batch_src_global generation:  0.03429985046386719
r_  generation:  0.27091264724731445
local_output_nid generation:  0.016064882278442383
local_in_edges_tensor generation:  0.019720077514648438
mini_batch_src_global generation:  0.034769296646118164
r_  generation:  0.27060413360595703
local_output_nid generation:  0.016019821166992188
local_in_edges_tensor generation:  0.02298760414123535
mini_batch_src_global generation:  0.03488874435424805
r_  generation:  0.272754430770874
local_output_nid generation:  0.015640974044799805
local_in_edges_tensor generation:  0.014998435974121094
mini_batch_src_global generation:  0.034575700759887695
r_  generation:  0.2637026309967041
local_output_nid generation:  0.015976667404174805
local_in_edges_tensor generation:  0.01476430892944336
mini_batch_src_global generation:  0.036368608474731445
r_  generation:  0.271514892578125
local_output_nid generation:  0.015728235244750977
local_in_edges_tensor generation:  0.017365217208862305
mini_batch_src_global generation:  0.03449058532714844
r_  generation:  0.26558899879455566
----------------------check_connections_block total spend ----------------------------- 6.249349594116211
generate_one_block  0.3723487854003906
generate_one_block  0.3415491580963135
generate_one_block  0.35297536849975586
generate_one_block  0.35599231719970703
generate_one_block  0.3657407760620117
generate_one_block  0.35792970657348633
generate_one_block  0.35015869140625
generate_one_block  0.34412670135498047
generate_one_block  0.35187435150146484
generate_one_block  0.35622358322143555
generate_one_block  0.35294628143310547
generate_one_block  0.35941147804260254
generate_one_block  0.36538076400756836
generate_one_block  0.3405632972717285
generate_one_block  0.3589630126953125
generate_one_block  0.344501256942749
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.042224884033203125
gen group dst list time:  0.06323909759521484
time for parepare:  0.019693851470947266
local_output_nid generation:  0.02811408042907715
local_in_edges_tensor generation:  0.04487919807434082
mini_batch_src_global generation:  0.051200151443481445
r_  generation:  0.5170018672943115
local_output_nid generation:  0.03291010856628418
local_in_edges_tensor generation:  0.054444074630737305
mini_batch_src_global generation:  0.06258368492126465
r_  generation:  0.5166599750518799
local_output_nid generation:  0.032797813415527344
local_in_edges_tensor generation:  0.04008746147155762
mini_batch_src_global generation:  0.06204724311828613
r_  generation:  0.5276656150817871
local_output_nid generation:  0.032584428787231445
local_in_edges_tensor generation:  0.04520273208618164
mini_batch_src_global generation:  0.06074070930480957
r_  generation:  0.5310523509979248
local_output_nid generation:  0.03369545936584473
local_in_edges_tensor generation:  0.05491995811462402
mini_batch_src_global generation:  0.09998917579650879
r_  generation:  0.5648677349090576
local_output_nid generation:  0.038704633712768555
local_in_edges_tensor generation:  0.046932220458984375
mini_batch_src_global generation:  0.06652355194091797
r_  generation:  0.5484530925750732
local_output_nid generation:  0.03521871566772461
local_in_edges_tensor generation:  0.0412747859954834
mini_batch_src_global generation:  0.06990408897399902
r_  generation:  0.5671887397766113
local_output_nid generation:  0.03583955764770508
local_in_edges_tensor generation:  0.04410552978515625
mini_batch_src_global generation:  0.06622910499572754
r_  generation:  0.534003734588623
local_output_nid generation:  0.03391671180725098
local_in_edges_tensor generation:  0.04320549964904785
mini_batch_src_global generation:  0.060599327087402344
r_  generation:  0.5472908020019531
local_output_nid generation:  0.03387880325317383
local_in_edges_tensor generation:  0.046692609786987305
mini_batch_src_global generation:  0.06200361251831055
r_  generation:  0.5410616397857666
local_output_nid generation:  0.03483462333679199
local_in_edges_tensor generation:  0.04408693313598633
mini_batch_src_global generation:  0.06271219253540039
r_  generation:  0.5680367946624756
local_output_nid generation:  0.03337597846984863
local_in_edges_tensor generation:  0.042143821716308594
mini_batch_src_global generation:  0.06782293319702148
r_  generation:  0.5361347198486328
local_output_nid generation:  0.0340425968170166
local_in_edges_tensor generation:  0.035219669342041016
mini_batch_src_global generation:  0.06237316131591797
r_  generation:  0.5409219264984131
local_output_nid generation:  0.03314685821533203
local_in_edges_tensor generation:  0.03248476982116699
mini_batch_src_global generation:  0.06643795967102051
r_  generation:  0.5448424816131592
local_output_nid generation:  0.03327035903930664
local_in_edges_tensor generation:  0.036850929260253906
mini_batch_src_global generation:  0.06549477577209473
r_  generation:  0.5394253730773926
local_output_nid generation:  0.03325843811035156
local_in_edges_tensor generation:  0.03265833854675293
mini_batch_src_global generation:  0.06172060966491699
r_  generation:  0.5357236862182617
----------------------check_connections_block total spend ----------------------------- 12.957612752914429
generate_one_block  0.7063009738922119
generate_one_block  0.6760897636413574
generate_one_block  0.6753215789794922
generate_one_block  0.6892633438110352
generate_one_block  0.749281644821167
generate_one_block  0.716433048248291
generate_one_block  0.7406210899353027
generate_one_block  0.6723110675811768
generate_one_block  0.701648473739624
generate_one_block  0.7199289798736572
generate_one_block  0.7306585311889648
generate_one_block  0.6933808326721191
generate_one_block  0.675255537033081
generate_one_block  0.6836099624633789
generate_one_block  0.6918027400970459
generate_one_block  0.6863234043121338
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  19.20696234703064
block generation total time  16.8789165019989
average batch blocks generation time:  1.0549322813749313
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1815185546875 GB
    Memory Allocated: 0.10045385360717773  GigaBytes
Max Memory Allocated: 0.10045385360717773  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 433, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 429, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 53, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 23.62 GiB total capacity; 22.34 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
