Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1647783377.8582258
ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.024825572967529297
random selection method range initialization spend 0.005916118621826172
time for parepare:  0.0180661678314209
local_output_nid generation:  0.004155158996582031
local_in_edges_tensor generation:  0.006363391876220703
mini_batch_src_global generation:  0.0032689571380615234
r_  generation:  0.0366971492767334
local_output_nid generation:  0.005511760711669922
local_in_edges_tensor generation:  0.0032732486724853516
mini_batch_src_global generation:  0.004147768020629883
r_  generation:  0.039014339447021484
local_output_nid generation:  0.005870819091796875
local_in_edges_tensor generation:  0.003240823745727539
mini_batch_src_global generation:  0.0028471946716308594
r_  generation:  0.03867006301879883
local_output_nid generation:  0.005911827087402344
local_in_edges_tensor generation:  0.0031795501708984375
mini_batch_src_global generation:  0.0028524398803710938
r_  generation:  0.039080142974853516
local_output_nid generation:  0.0059239864349365234
local_in_edges_tensor generation:  0.003124713897705078
mini_batch_src_global generation:  0.002943277359008789
r_  generation:  0.040076494216918945
local_output_nid generation:  0.005913972854614258
local_in_edges_tensor generation:  0.003145933151245117
mini_batch_src_global generation:  0.003219127655029297
r_  generation:  0.0411076545715332
local_output_nid generation:  0.0059435367584228516
local_in_edges_tensor generation:  0.0031774044036865234
mini_batch_src_global generation:  0.003263711929321289
r_  generation:  0.04036998748779297
local_output_nid generation:  0.005957841873168945
local_in_edges_tensor generation:  0.0031766891479492188
mini_batch_src_global generation:  0.003221750259399414
r_  generation:  0.04032135009765625
----------------------check_connections_block total spend ----------------------------- 0.5083470344543457
generate_one_block  0.0543210506439209
generate_one_block  0.05525374412536621
generate_one_block  0.05538439750671387
generate_one_block  0.05391073226928711
generate_one_block  0.057706594467163086
generate_one_block  0.055036067962646484
generate_one_block  0.054306745529174805
generate_one_block  0.05484199523925781
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.040247440338134766
gen group dst list time:  0.01515507698059082
time for parepare:  0.01910543441772461
local_output_nid generation:  0.013400554656982422
local_in_edges_tensor generation:  0.03260231018066406
mini_batch_src_global generation:  0.02712702751159668
r_  generation:  0.2864072322845459
local_output_nid generation:  0.018535614013671875
local_in_edges_tensor generation:  0.029870271682739258
mini_batch_src_global generation:  0.035138845443725586
r_  generation:  0.29836606979370117
local_output_nid generation:  0.018143653869628906
local_in_edges_tensor generation:  0.024464130401611328
mini_batch_src_global generation:  0.03473854064941406
r_  generation:  0.30798959732055664
local_output_nid generation:  0.017945051193237305
local_in_edges_tensor generation:  0.018939971923828125
mini_batch_src_global generation:  0.03633427619934082
r_  generation:  0.3012661933898926
local_output_nid generation:  0.018310070037841797
local_in_edges_tensor generation:  0.02149677276611328
mini_batch_src_global generation:  0.038701772689819336
r_  generation:  0.3137834072113037
local_output_nid generation:  0.018288373947143555
local_in_edges_tensor generation:  0.025064468383789062
mini_batch_src_global generation:  0.03694009780883789
r_  generation:  0.3064892292022705
local_output_nid generation:  0.018316030502319336
local_in_edges_tensor generation:  0.019119977951049805
mini_batch_src_global generation:  0.037323713302612305
r_  generation:  0.31069254875183105
local_output_nid generation:  0.01823568344116211
local_in_edges_tensor generation:  0.021788597106933594
mini_batch_src_global generation:  0.03737378120422363
r_  generation:  0.30629634857177734
----------------------check_connections_block total spend ----------------------------- 3.592270851135254
generate_one_block  0.40307092666625977
generate_one_block  0.4025557041168213
generate_one_block  0.40140485763549805
generate_one_block  0.3831768035888672
generate_one_block  0.39157700538635254
generate_one_block  0.41388893127441406
generate_one_block  0.3976294994354248
generate_one_block  0.39295387268066406
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03307199478149414
gen group dst list time:  0.03552842140197754
time for parepare:  0.018825054168701172
local_output_nid generation:  0.031186342239379883
local_in_edges_tensor generation:  0.04436922073364258
mini_batch_src_global generation:  0.04770064353942871
r_  generation:  0.4669027328491211
local_output_nid generation:  0.034723758697509766
local_in_edges_tensor generation:  0.04980301856994629
mini_batch_src_global generation:  0.06453633308410645
r_  generation:  0.47387146949768066
local_output_nid generation:  0.034780263900756836
local_in_edges_tensor generation:  0.03387188911437988
mini_batch_src_global generation:  0.0519101619720459
r_  generation:  0.48920702934265137
local_output_nid generation:  0.034613609313964844
local_in_edges_tensor generation:  0.03700590133666992
mini_batch_src_global generation:  0.055834054946899414
r_  generation:  0.4859907627105713
local_output_nid generation:  0.03577613830566406
local_in_edges_tensor generation:  0.057518959045410156
mini_batch_src_global generation:  0.055701494216918945
r_  generation:  0.49619555473327637
local_output_nid generation:  0.0352168083190918
local_in_edges_tensor generation:  0.041930198669433594
mini_batch_src_global generation:  0.054659128189086914
r_  generation:  0.5014123916625977
local_output_nid generation:  0.0353848934173584
local_in_edges_tensor generation:  0.04002022743225098
mini_batch_src_global generation:  0.06371784210205078
r_  generation:  0.49557065963745117
local_output_nid generation:  0.03508734703063965
local_in_edges_tensor generation:  0.03861546516418457
mini_batch_src_global generation:  0.05519247055053711
r_  generation:  0.4849081039428711
----------------------check_connections_block total spend ----------------------------- 5.850574016571045
generate_one_block  0.6370460987091064
generate_one_block  0.6256718635559082
generate_one_block  0.6081581115722656
generate_one_block  0.614717960357666
generate_one_block  0.624497652053833
generate_one_block  0.6187155246734619
generate_one_block  0.6600608825683594
generate_one_block  0.6172425746917725
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  9.442844867706299
block generation total time  8.192368268966675
average batch blocks generation time:  1.0240460336208344
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1854248046875 GB
    Memory Allocated: 0.1008138656616211  GigaBytes
Max Memory Allocated: 0.1008138656616211  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 433, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 429, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 53, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.33 GiB already allocated; 16.44 MiB free; 22.41 GiB reserved in total by PyTorch)
