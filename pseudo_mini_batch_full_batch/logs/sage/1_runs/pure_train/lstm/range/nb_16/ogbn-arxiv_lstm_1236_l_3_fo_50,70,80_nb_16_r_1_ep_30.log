Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1647806632.702357
ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.026735544204711914
range selection method range initialization spend 0.01384735107421875
time for parepare:  0.01795053482055664
local_output_nid generation:  0.0013227462768554688
local_in_edges_tensor generation:  0.0031044483184814453
mini_batch_src_global generation:  0.0019991397857666016
r_  generation:  0.021434545516967773
local_output_nid generation:  0.0015118122100830078
local_in_edges_tensor generation:  0.0009372234344482422
mini_batch_src_global generation:  0.002367734909057617
r_  generation:  0.020555973052978516
local_output_nid generation:  0.0015518665313720703
local_in_edges_tensor generation:  0.0008876323699951172
mini_batch_src_global generation:  0.001529693603515625
r_  generation:  0.020512104034423828
local_output_nid generation:  0.0015265941619873047
local_in_edges_tensor generation:  0.0008859634399414062
mini_batch_src_global generation:  0.001516580581665039
r_  generation:  0.020785808563232422
local_output_nid generation:  0.0015213489532470703
local_in_edges_tensor generation:  0.0008885860443115234
mini_batch_src_global generation:  0.0015306472778320312
r_  generation:  0.020863056182861328
local_output_nid generation:  0.0015282630920410156
local_in_edges_tensor generation:  0.0008854866027832031
mini_batch_src_global generation:  0.00162506103515625
r_  generation:  0.02155900001525879
local_output_nid generation:  0.0015218257904052734
local_in_edges_tensor generation:  0.0009062290191650391
mini_batch_src_global generation:  0.0016837120056152344
r_  generation:  0.022130966186523438
local_output_nid generation:  0.0015337467193603516
local_in_edges_tensor generation:  0.0008742809295654297
mini_batch_src_global generation:  0.0016970634460449219
r_  generation:  0.021832704544067383
local_output_nid generation:  0.0015270709991455078
local_in_edges_tensor generation:  0.0008716583251953125
mini_batch_src_global generation:  0.00162506103515625
r_  generation:  0.02183055877685547
local_output_nid generation:  0.001519918441772461
local_in_edges_tensor generation:  0.0008718967437744141
mini_batch_src_global generation:  0.0016243457794189453
r_  generation:  0.02143120765686035
local_output_nid generation:  0.0015149116516113281
local_in_edges_tensor generation:  0.0008912086486816406
mini_batch_src_global generation:  0.001661539077758789
r_  generation:  0.02196359634399414
local_output_nid generation:  0.0015215873718261719
local_in_edges_tensor generation:  0.0008673667907714844
mini_batch_src_global generation:  0.001631021499633789
r_  generation:  0.02129817008972168
local_output_nid generation:  0.0015535354614257812
local_in_edges_tensor generation:  0.0008614063262939453
mini_batch_src_global generation:  0.0016791820526123047
r_  generation:  0.022271394729614258
local_output_nid generation:  0.0015254020690917969
local_in_edges_tensor generation:  0.0008690357208251953
mini_batch_src_global generation:  0.0017232894897460938
r_  generation:  0.021627426147460938
local_output_nid generation:  0.0015225410461425781
local_in_edges_tensor generation:  0.0008599758148193359
mini_batch_src_global generation:  0.0016672611236572266
r_  generation:  0.021623611450195312
local_output_nid generation:  0.0015184879302978516
local_in_edges_tensor generation:  0.0008654594421386719
mini_batch_src_global generation:  0.0016756057739257812
r_  generation:  0.02175617218017578
----------------------check_connections_block total spend ----------------------------- 0.5044443607330322
generate_one_block  0.030862808227539062
generate_one_block  0.031056880950927734
generate_one_block  0.03243374824523926
generate_one_block  0.031832218170166016
generate_one_block  0.03135991096496582
generate_one_block  0.032073259353637695
generate_one_block  0.03224802017211914
generate_one_block  0.031549692153930664
generate_one_block  0.03158426284790039
generate_one_block  0.030982017517089844
generate_one_block  0.031785011291503906
generate_one_block  0.030461549758911133
generate_one_block  0.03164815902709961
generate_one_block  0.03143644332885742
generate_one_block  0.03081679344177246
generate_one_block  0.031039714813232422
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04245400428771973
gen group dst list time:  0.02107071876525879
time for parepare:  0.01907944679260254
local_output_nid generation:  0.007308244705200195
local_in_edges_tensor generation:  0.01961684226989746
mini_batch_src_global generation:  0.027610063552856445
r_  generation:  0.24849891662597656
local_output_nid generation:  0.01096653938293457
local_in_edges_tensor generation:  0.021592378616333008
mini_batch_src_global generation:  0.03140735626220703
r_  generation:  0.249467134475708
local_output_nid generation:  0.011312723159790039
local_in_edges_tensor generation:  0.01782822608947754
mini_batch_src_global generation:  0.030820131301879883
r_  generation:  0.25820302963256836
local_output_nid generation:  0.011834383010864258
local_in_edges_tensor generation:  0.018227100372314453
mini_batch_src_global generation:  0.035358428955078125
r_  generation:  0.2649881839752197
local_output_nid generation:  0.012022256851196289
local_in_edges_tensor generation:  0.018194198608398438
mini_batch_src_global generation:  0.03316855430603027
r_  generation:  0.267702579498291
local_output_nid generation:  0.012260675430297852
local_in_edges_tensor generation:  0.01848316192626953
mini_batch_src_global generation:  0.03442239761352539
r_  generation:  0.282315731048584
local_output_nid generation:  0.0123748779296875
local_in_edges_tensor generation:  0.016494035720825195
mini_batch_src_global generation:  0.03529763221740723
r_  generation:  0.27172160148620605
local_output_nid generation:  0.012407779693603516
local_in_edges_tensor generation:  0.014185905456542969
mini_batch_src_global generation:  0.03472900390625
r_  generation:  0.27283215522766113
local_output_nid generation:  0.012283563613891602
local_in_edges_tensor generation:  0.015976905822753906
mini_batch_src_global generation:  0.033780813217163086
r_  generation:  0.2686607837677002
local_output_nid generation:  0.012300491333007812
local_in_edges_tensor generation:  0.016015052795410156
mini_batch_src_global generation:  0.03545236587524414
r_  generation:  0.26970958709716797
local_output_nid generation:  0.01263737678527832
local_in_edges_tensor generation:  0.016728878021240234
mini_batch_src_global generation:  0.034119367599487305
r_  generation:  0.27449989318847656
local_output_nid generation:  0.01225137710571289
local_in_edges_tensor generation:  0.015659093856811523
mini_batch_src_global generation:  0.03336524963378906
r_  generation:  0.2657167911529541
local_output_nid generation:  0.012526988983154297
local_in_edges_tensor generation:  0.016286611557006836
mini_batch_src_global generation:  0.0343477725982666
r_  generation:  0.2736797332763672
local_output_nid generation:  0.01264047622680664
local_in_edges_tensor generation:  0.021055936813354492
mini_batch_src_global generation:  0.034073591232299805
r_  generation:  0.27330732345581055
local_output_nid generation:  0.012294530868530273
local_in_edges_tensor generation:  0.01356363296508789
mini_batch_src_global generation:  0.034061431884765625
r_  generation:  0.2674117088317871
local_output_nid generation:  0.012485742568969727
local_in_edges_tensor generation:  0.0161592960357666
mini_batch_src_global generation:  0.03389239311218262
r_  generation:  0.2713336944580078
----------------------check_connections_block total spend ----------------------------- 6.226424694061279
generate_one_block  0.3488953113555908
generate_one_block  0.3467986583709717
generate_one_block  0.3514699935913086
generate_one_block  0.35857701301574707
generate_one_block  0.36446714401245117
generate_one_block  0.36274266242980957
generate_one_block  0.3605356216430664
generate_one_block  0.35631275177001953
generate_one_block  0.3539097309112549
generate_one_block  0.35587453842163086
generate_one_block  0.3757131099700928
generate_one_block  0.3566107749938965
generate_one_block  0.3695380687713623
generate_one_block  0.3698611259460449
generate_one_block  0.35817408561706543
generate_one_block  0.3564610481262207
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.06474471092224121
gen group dst list time:  0.07158064842224121
time for parepare:  0.0206606388092041
local_output_nid generation:  0.025543212890625
local_in_edges_tensor generation:  0.06408190727233887
mini_batch_src_global generation:  0.05191302299499512
r_  generation:  0.5143399238586426
local_output_nid generation:  0.03074026107788086
local_in_edges_tensor generation:  0.052768707275390625
mini_batch_src_global generation:  0.06218838691711426
r_  generation:  0.5373110771179199
local_output_nid generation:  0.031641483306884766
local_in_edges_tensor generation:  0.044576168060302734
mini_batch_src_global generation:  0.06642937660217285
r_  generation:  0.5626027584075928
local_output_nid generation:  0.04682135581970215
local_in_edges_tensor generation:  0.057253360748291016
mini_batch_src_global generation:  0.07209610939025879
r_  generation:  0.5609195232391357
local_output_nid generation:  0.03669929504394531
local_in_edges_tensor generation:  0.05926108360290527
mini_batch_src_global generation:  0.06994795799255371
r_  generation:  0.5500893592834473
local_output_nid generation:  0.034772634506225586
local_in_edges_tensor generation:  0.04472160339355469
mini_batch_src_global generation:  0.06199169158935547
r_  generation:  0.5718564987182617
local_output_nid generation:  0.03507876396179199
local_in_edges_tensor generation:  0.06606650352478027
mini_batch_src_global generation:  0.06764960289001465
r_  generation:  0.5465617179870605
local_output_nid generation:  0.03659200668334961
local_in_edges_tensor generation:  0.050240278244018555
mini_batch_src_global generation:  0.06818723678588867
r_  generation:  0.5586740970611572
local_output_nid generation:  0.03684186935424805
local_in_edges_tensor generation:  0.043950796127319336
mini_batch_src_global generation:  0.0631246566772461
r_  generation:  0.5603902339935303
local_output_nid generation:  0.03291821479797363
local_in_edges_tensor generation:  0.03609013557434082
mini_batch_src_global generation:  0.0625004768371582
r_  generation:  0.548987865447998
local_output_nid generation:  0.0342409610748291
local_in_edges_tensor generation:  0.05494093894958496
mini_batch_src_global generation:  0.08324241638183594
r_  generation:  0.5481436252593994
local_output_nid generation:  0.03498029708862305
local_in_edges_tensor generation:  0.03665876388549805
mini_batch_src_global generation:  0.06285619735717773
r_  generation:  0.5506031513214111
local_output_nid generation:  0.03707146644592285
local_in_edges_tensor generation:  0.03504443168640137
mini_batch_src_global generation:  0.06636953353881836
r_  generation:  0.554835319519043
local_output_nid generation:  0.033872365951538086
local_in_edges_tensor generation:  0.05476713180541992
mini_batch_src_global generation:  0.06645059585571289
r_  generation:  0.5681393146514893
local_output_nid generation:  0.03488278388977051
local_in_edges_tensor generation:  0.04177403450012207
mini_batch_src_global generation:  0.06904911994934082
r_  generation:  0.5420427322387695
local_output_nid generation:  0.035097360610961914
local_in_edges_tensor generation:  0.04166412353515625
mini_batch_src_global generation:  0.06304311752319336
r_  generation:  0.5546855926513672
----------------------check_connections_block total spend ----------------------------- 13.228773832321167
generate_one_block  0.6941373348236084
generate_one_block  0.7008202075958252
generate_one_block  0.71848464012146
generate_one_block  0.7029657363891602
generate_one_block  0.6838593482971191
generate_one_block  0.7216897010803223
generate_one_block  0.7586009502410889
generate_one_block  0.6945245265960693
generate_one_block  0.7124152183532715
generate_one_block  0.6886436939239502
generate_one_block  0.7083251476287842
generate_one_block  0.6812534332275391
generate_one_block  0.6731340885162354
generate_one_block  0.7122416496276855
generate_one_block  0.6738202571868896
generate_one_block  0.6787009239196777
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  19.455198526382446
block generation total time  16.94955849647522
average batch blocks generation time:  1.0593474060297012
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1815185546875 GB
    Memory Allocated: 0.10037708282470703  GigaBytes
Max Memory Allocated: 0.10037708282470703  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 433, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 429, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 53, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.31 GiB already allocated; 18.44 MiB free; 22.40 GiB reserved in total by PyTorch)
