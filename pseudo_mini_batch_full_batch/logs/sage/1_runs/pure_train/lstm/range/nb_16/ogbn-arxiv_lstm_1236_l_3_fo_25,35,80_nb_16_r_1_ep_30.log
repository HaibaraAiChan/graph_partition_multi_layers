Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1647800158.43171
ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.02782464027404785
range selection method range initialization spend 0.013158798217773438
time for parepare:  0.0180971622467041
local_output_nid generation:  0.0013463497161865234
local_in_edges_tensor generation:  0.0041921138763427734
mini_batch_src_global generation:  0.0019795894622802734
r_  generation:  0.02045273780822754
local_output_nid generation:  0.0015196800231933594
local_in_edges_tensor generation:  0.0009355545043945312
mini_batch_src_global generation:  0.002366781234741211
r_  generation:  0.01917290687561035
local_output_nid generation:  0.0014317035675048828
local_in_edges_tensor generation:  0.0008935928344726562
mini_batch_src_global generation:  0.0014674663543701172
r_  generation:  0.019166231155395508
local_output_nid generation:  0.0014653205871582031
local_in_edges_tensor generation:  0.0008907318115234375
mini_batch_src_global generation:  0.0013353824615478516
r_  generation:  0.02007746696472168
local_output_nid generation:  0.00148773193359375
local_in_edges_tensor generation:  0.0008904933929443359
mini_batch_src_global generation:  0.0014584064483642578
r_  generation:  0.01991105079650879
local_output_nid generation:  0.0014872550964355469
local_in_edges_tensor generation:  0.0008516311645507812
mini_batch_src_global generation:  0.0016179084777832031
r_  generation:  0.02100229263305664
local_output_nid generation:  0.0015330314636230469
local_in_edges_tensor generation:  0.0009047985076904297
mini_batch_src_global generation:  0.0016379356384277344
r_  generation:  0.02152085304260254
local_output_nid generation:  0.0014946460723876953
local_in_edges_tensor generation:  0.0009653568267822266
mini_batch_src_global generation:  0.0016508102416992188
r_  generation:  0.021105527877807617
local_output_nid generation:  0.0014858245849609375
local_in_edges_tensor generation:  0.0009047985076904297
mini_batch_src_global generation:  0.0016243457794189453
r_  generation:  0.021111011505126953
local_output_nid generation:  0.001485586166381836
local_in_edges_tensor generation:  0.0008935928344726562
mini_batch_src_global generation:  0.0016355514526367188
r_  generation:  0.02073359489440918
local_output_nid generation:  0.0014843940734863281
local_in_edges_tensor generation:  0.0008902549743652344
mini_batch_src_global generation:  0.0016803741455078125
r_  generation:  0.021395206451416016
local_output_nid generation:  0.001485586166381836
local_in_edges_tensor generation:  0.0008609294891357422
mini_batch_src_global generation:  0.0016529560089111328
r_  generation:  0.020407676696777344
local_output_nid generation:  0.0015151500701904297
local_in_edges_tensor generation:  0.0008492469787597656
mini_batch_src_global generation:  0.0017011165618896484
r_  generation:  0.02111983299255371
local_output_nid generation:  0.0015370845794677734
local_in_edges_tensor generation:  0.0008730888366699219
mini_batch_src_global generation:  0.0016720294952392578
r_  generation:  0.020908355712890625
local_output_nid generation:  0.0015044212341308594
local_in_edges_tensor generation:  0.0008828639984130859
mini_batch_src_global generation:  0.0017156600952148438
r_  generation:  0.02133917808532715
local_output_nid generation:  0.0015392303466796875
local_in_edges_tensor generation:  0.0008597373962402344
mini_batch_src_global generation:  0.0017514228820800781
r_  generation:  0.021202802658081055
----------------------check_connections_block total spend ----------------------------- 0.4899568557739258
generate_one_block  0.03085947036743164
generate_one_block  0.029711008071899414
generate_one_block  0.03207874298095703
generate_one_block  0.031094789505004883
generate_one_block  0.03136754035949707
generate_one_block  0.031671762466430664
generate_one_block  0.0317082405090332
generate_one_block  0.03122234344482422
generate_one_block  0.031503915786743164
generate_one_block  0.030887603759765625
generate_one_block  0.031279563903808594
generate_one_block  0.02985525131225586
generate_one_block  0.031389713287353516
generate_one_block  0.031019926071166992
generate_one_block  0.030686616897583008
generate_one_block  0.031146526336669922
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.03921103477478027
gen group dst list time:  0.020542144775390625
time for parepare:  0.019958972930908203
local_output_nid generation:  0.0074939727783203125
local_in_edges_tensor generation:  0.018889665603637695
mini_batch_src_global generation:  0.023028135299682617
r_  generation:  0.21934294700622559
local_output_nid generation:  0.013132572174072266
local_in_edges_tensor generation:  0.01983928680419922
mini_batch_src_global generation:  0.026546955108642578
r_  generation:  0.21579766273498535
local_output_nid generation:  0.013918399810791016
local_in_edges_tensor generation:  0.01636528968811035
mini_batch_src_global generation:  0.025780677795410156
r_  generation:  0.2304401397705078
local_output_nid generation:  0.014611244201660156
local_in_edges_tensor generation:  0.013187885284423828
mini_batch_src_global generation:  0.03908085823059082
r_  generation:  0.23135662078857422
local_output_nid generation:  0.014728069305419922
local_in_edges_tensor generation:  0.01955723762512207
mini_batch_src_global generation:  0.02813720703125
r_  generation:  0.23183870315551758
local_output_nid generation:  0.015228986740112305
local_in_edges_tensor generation:  0.017145156860351562
mini_batch_src_global generation:  0.03365898132324219
r_  generation:  0.24292302131652832
local_output_nid generation:  0.015122652053833008
local_in_edges_tensor generation:  0.01767110824584961
mini_batch_src_global generation:  0.02886199951171875
r_  generation:  0.23867225646972656
local_output_nid generation:  0.015570402145385742
local_in_edges_tensor generation:  0.015322208404541016
mini_batch_src_global generation:  0.029223203659057617
r_  generation:  0.23897171020507812
local_output_nid generation:  0.015334367752075195
local_in_edges_tensor generation:  0.013360023498535156
mini_batch_src_global generation:  0.029457569122314453
r_  generation:  0.23932480812072754
local_output_nid generation:  0.015309810638427734
local_in_edges_tensor generation:  0.015411376953125
mini_batch_src_global generation:  0.031067609786987305
r_  generation:  0.23659586906433105
local_output_nid generation:  0.015429496765136719
local_in_edges_tensor generation:  0.017253398895263672
mini_batch_src_global generation:  0.029306888580322266
r_  generation:  0.24476313591003418
local_output_nid generation:  0.015096664428710938
local_in_edges_tensor generation:  0.01312875747680664
mini_batch_src_global generation:  0.029599428176879883
r_  generation:  0.23126840591430664
local_output_nid generation:  0.015541315078735352
local_in_edges_tensor generation:  0.013490915298461914
mini_batch_src_global generation:  0.029582738876342773
r_  generation:  0.240281343460083
local_output_nid generation:  0.015450239181518555
local_in_edges_tensor generation:  0.019521236419677734
mini_batch_src_global generation:  0.03018784523010254
r_  generation:  0.24025368690490723
local_output_nid generation:  0.01519775390625
local_in_edges_tensor generation:  0.013613700866699219
mini_batch_src_global generation:  0.02949810028076172
r_  generation:  0.23493099212646484
local_output_nid generation:  0.015294790267944336
local_in_edges_tensor generation:  0.015470743179321289
mini_batch_src_global generation:  0.031177282333374023
r_  generation:  0.23443055152893066
----------------------check_connections_block total spend ----------------------------- 5.562636137008667
generate_one_block  0.3127322196960449
generate_one_block  0.3023717403411865
generate_one_block  0.31040239334106445
generate_one_block  0.31097888946533203
generate_one_block  0.32318615913391113
generate_one_block  0.31990623474121094
generate_one_block  0.31582212448120117
generate_one_block  0.3113443851470947
generate_one_block  0.3081328868865967
generate_one_block  0.30644702911376953
generate_one_block  0.31368184089660645
generate_one_block  0.30270886421203613
generate_one_block  0.3088345527648926
generate_one_block  0.310685396194458
generate_one_block  0.3147726058959961
generate_one_block  0.30819010734558105
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.055968284606933594
gen group dst list time:  0.07055926322937012
time for parepare:  0.021265506744384766
local_output_nid generation:  0.024266481399536133
local_in_edges_tensor generation:  0.06978058815002441
mini_batch_src_global generation:  0.04560708999633789
r_  generation:  0.45171332359313965
local_output_nid generation:  0.029597997665405273
local_in_edges_tensor generation:  0.04546236991882324
mini_batch_src_global generation:  0.05123758316040039
r_  generation:  0.4501762390136719
local_output_nid generation:  0.029218673706054688
local_in_edges_tensor generation:  0.038285255432128906
mini_batch_src_global generation:  0.050220489501953125
r_  generation:  0.4537813663482666
local_output_nid generation:  0.029679536819458008
local_in_edges_tensor generation:  0.03475689888000488
mini_batch_src_global generation:  0.05563187599182129
r_  generation:  0.4562718868255615
local_output_nid generation:  0.02965855598449707
local_in_edges_tensor generation:  0.030573606491088867
mini_batch_src_global generation:  0.0545964241027832
r_  generation:  0.45859217643737793
local_output_nid generation:  0.0321965217590332
local_in_edges_tensor generation:  0.03473997116088867
mini_batch_src_global generation:  0.05399036407470703
r_  generation:  0.4579582214355469
local_output_nid generation:  0.0312349796295166
local_in_edges_tensor generation:  0.03830552101135254
mini_batch_src_global generation:  0.05178022384643555
r_  generation:  0.46313047409057617
local_output_nid generation:  0.03142976760864258
local_in_edges_tensor generation:  0.03052830696105957
mini_batch_src_global generation:  0.059000492095947266
r_  generation:  0.46077466011047363
local_output_nid generation:  0.031211376190185547
local_in_edges_tensor generation:  0.03499960899353027
mini_batch_src_global generation:  0.05272340774536133
r_  generation:  0.4764435291290283
local_output_nid generation:  0.03149676322937012
local_in_edges_tensor generation:  0.03010416030883789
mini_batch_src_global generation:  0.05452418327331543
r_  generation:  0.46296143531799316
local_output_nid generation:  0.031871795654296875
local_in_edges_tensor generation:  0.03885388374328613
mini_batch_src_global generation:  0.05529618263244629
r_  generation:  0.4703254699707031
local_output_nid generation:  0.03231048583984375
local_in_edges_tensor generation:  0.030312299728393555
mini_batch_src_global generation:  0.05360007286071777
r_  generation:  0.4580423831939697
local_output_nid generation:  0.03161025047302246
local_in_edges_tensor generation:  0.03419780731201172
mini_batch_src_global generation:  0.05236196517944336
r_  generation:  0.46277809143066406
local_output_nid generation:  0.03195619583129883
local_in_edges_tensor generation:  0.038898468017578125
mini_batch_src_global generation:  0.05308413505554199
r_  generation:  0.46817803382873535
local_output_nid generation:  0.03200387954711914
local_in_edges_tensor generation:  0.034477949142456055
mini_batch_src_global generation:  0.05331277847290039
r_  generation:  0.4628317356109619
local_output_nid generation:  0.03151297569274902
local_in_edges_tensor generation:  0.034122467041015625
mini_batch_src_global generation:  0.053156375885009766
r_  generation:  0.45825982093811035
----------------------check_connections_block total spend ----------------------------- 10.925376415252686
generate_one_block  0.5871446132659912
generate_one_block  0.5867383480072021
generate_one_block  0.5903887748718262
generate_one_block  0.600602388381958
generate_one_block  0.574469804763794
generate_one_block  0.5934929847717285
generate_one_block  0.6692135334014893
generate_one_block  0.6181657314300537
generate_one_block  0.6041414737701416
generate_one_block  0.6039621829986572
generate_one_block  0.5958542823791504
generate_one_block  0.5844194889068604
generate_one_block  0.5814087390899658
generate_one_block  0.6175804138183594
generate_one_block  0.5786478519439697
generate_one_block  0.5942120552062988
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  16.488012552261353
block generation total time  14.560640096664429
average batch blocks generation time:  0.9100400060415268
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1795654296875 GB
    Memory Allocated: 0.09591054916381836  GigaBytes
Max Memory Allocated: 0.09591054916381836  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 433, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 429, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 53, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 28.00 MiB (GPU 0; 23.62 GiB total capacity; 22.15 GiB already allocated; 10.44 MiB free; 22.41 GiB reserved in total by PyTorch)
