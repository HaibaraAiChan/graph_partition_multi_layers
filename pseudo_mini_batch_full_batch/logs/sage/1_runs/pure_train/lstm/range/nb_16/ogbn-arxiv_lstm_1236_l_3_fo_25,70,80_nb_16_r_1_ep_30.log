Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1647803106.7576377
ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.02541637420654297
range selection method range initialization spend 0.013903141021728516
time for parepare:  0.017728805541992188
local_output_nid generation:  0.0014164447784423828
local_in_edges_tensor generation:  0.0033409595489501953
mini_batch_src_global generation:  0.0019991397857666016
r_  generation:  0.021621227264404297
local_output_nid generation:  0.0016162395477294922
local_in_edges_tensor generation:  0.0010080337524414062
mini_batch_src_global generation:  0.002311229705810547
r_  generation:  0.020169734954833984
local_output_nid generation:  0.0015721321105957031
local_in_edges_tensor generation:  0.0009713172912597656
mini_batch_src_global generation:  0.001474618911743164
r_  generation:  0.020307064056396484
local_output_nid generation:  0.001600027084350586
local_in_edges_tensor generation:  0.0009148120880126953
mini_batch_src_global generation:  0.0015683174133300781
r_  generation:  0.02081441879272461
local_output_nid generation:  0.0015707015991210938
local_in_edges_tensor generation:  0.0009257793426513672
mini_batch_src_global generation:  0.0014758110046386719
r_  generation:  0.021884918212890625
local_output_nid generation:  0.0015621185302734375
local_in_edges_tensor generation:  0.0009262561798095703
mini_batch_src_global generation:  0.001964569091796875
r_  generation:  0.02373194694519043
local_output_nid generation:  0.0015761852264404297
local_in_edges_tensor generation:  0.0009064674377441406
mini_batch_src_global generation:  0.001998424530029297
r_  generation:  0.024416446685791016
local_output_nid generation:  0.0015990734100341797
local_in_edges_tensor generation:  0.0009586811065673828
mini_batch_src_global generation:  0.0020208358764648438
r_  generation:  0.02220630645751953
local_output_nid generation:  0.001577615737915039
local_in_edges_tensor generation:  0.0009152889251708984
mini_batch_src_global generation:  0.0016586780548095703
r_  generation:  0.021726369857788086
local_output_nid generation:  0.0015769004821777344
local_in_edges_tensor generation:  0.0009074211120605469
mini_batch_src_global generation:  0.001661062240600586
r_  generation:  0.021414756774902344
local_output_nid generation:  0.001585245132446289
local_in_edges_tensor generation:  0.0009272098541259766
mini_batch_src_global generation:  0.0017194747924804688
r_  generation:  0.02373504638671875
local_output_nid generation:  0.0015993118286132812
local_in_edges_tensor generation:  0.0009453296661376953
mini_batch_src_global generation:  0.0020008087158203125
r_  generation:  0.02303767204284668
local_output_nid generation:  0.0015788078308105469
local_in_edges_tensor generation:  0.0009169578552246094
mini_batch_src_global generation:  0.0020520687103271484
r_  generation:  0.02398538589477539
local_output_nid generation:  0.0015969276428222656
local_in_edges_tensor generation:  0.0009372234344482422
mini_batch_src_global generation:  0.0020470619201660156
r_  generation:  0.021982431411743164
local_output_nid generation:  0.001575469970703125
local_in_edges_tensor generation:  0.0009200572967529297
mini_batch_src_global generation:  0.0017004013061523438
r_  generation:  0.021395444869995117
local_output_nid generation:  0.001573801040649414
local_in_edges_tensor generation:  0.0009388923645019531
mini_batch_src_global generation:  0.0016722679138183594
r_  generation:  0.021733760833740234
----------------------check_connections_block total spend ----------------------------- 0.5250849723815918
generate_one_block  0.031102657318115234
generate_one_block  0.030695199966430664
generate_one_block  0.03265643119812012
generate_one_block  0.031920671463012695
generate_one_block  0.031589508056640625
generate_one_block  0.031687259674072266
generate_one_block  0.032074689865112305
generate_one_block  0.03166079521179199
generate_one_block  0.03173208236694336
generate_one_block  0.03130602836608887
generate_one_block  0.031600236892700195
generate_one_block  0.02993178367614746
generate_one_block  0.03174996376037598
generate_one_block  0.031131744384765625
generate_one_block  0.03131270408630371
generate_one_block  0.03137040138244629
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04010486602783203
gen group dst list time:  0.02070927619934082
time for parepare:  0.01891326904296875
local_output_nid generation:  0.007479667663574219
local_in_edges_tensor generation:  0.018538475036621094
mini_batch_src_global generation:  0.027292490005493164
r_  generation:  0.2516300678253174
local_output_nid generation:  0.011172294616699219
local_in_edges_tensor generation:  0.021089553833007812
mini_batch_src_global generation:  0.031861305236816406
r_  generation:  0.2560904026031494
local_output_nid generation:  0.01133871078491211
local_in_edges_tensor generation:  0.019628286361694336
mini_batch_src_global generation:  0.030777931213378906
r_  generation:  0.26977062225341797
local_output_nid generation:  0.011932134628295898
local_in_edges_tensor generation:  0.020292997360229492
mini_batch_src_global generation:  0.03557133674621582
r_  generation:  0.27309417724609375
local_output_nid generation:  0.011870384216308594
local_in_edges_tensor generation:  0.015438318252563477
mini_batch_src_global generation:  0.03311419486999512
r_  generation:  0.2761096954345703
local_output_nid generation:  0.01226806640625
local_in_edges_tensor generation:  0.016453981399536133
mini_batch_src_global generation:  0.03627324104309082
r_  generation:  0.28501081466674805
local_output_nid generation:  0.013304471969604492
local_in_edges_tensor generation:  0.024521350860595703
mini_batch_src_global generation:  0.05043387413024902
r_  generation:  0.2846651077270508
local_output_nid generation:  0.014499664306640625
local_in_edges_tensor generation:  0.018126249313354492
mini_batch_src_global generation:  0.037925004959106445
r_  generation:  0.2734360694885254
local_output_nid generation:  0.012837886810302734
local_in_edges_tensor generation:  0.0159454345703125
mini_batch_src_global generation:  0.03455853462219238
r_  generation:  0.2717106342315674
local_output_nid generation:  0.012797355651855469
local_in_edges_tensor generation:  0.01591968536376953
mini_batch_src_global generation:  0.03443717956542969
r_  generation:  0.26819539070129395
local_output_nid generation:  0.012883901596069336
local_in_edges_tensor generation:  0.018968582153320312
mini_batch_src_global generation:  0.03472638130187988
r_  generation:  0.27925920486450195
local_output_nid generation:  0.012549877166748047
local_in_edges_tensor generation:  0.01342320442199707
mini_batch_src_global generation:  0.0342867374420166
r_  generation:  0.2665061950683594
local_output_nid generation:  0.012931108474731445
local_in_edges_tensor generation:  0.016340017318725586
mini_batch_src_global generation:  0.034833431243896484
r_  generation:  0.27466440200805664
local_output_nid generation:  0.012888669967651367
local_in_edges_tensor generation:  0.018424034118652344
mini_batch_src_global generation:  0.03490781784057617
r_  generation:  0.27002573013305664
local_output_nid generation:  0.012798547744750977
local_in_edges_tensor generation:  0.016169071197509766
mini_batch_src_global generation:  0.034258127212524414
r_  generation:  0.2685251235961914
local_output_nid generation:  0.01277017593383789
local_in_edges_tensor generation:  0.01583409309387207
mini_batch_src_global generation:  0.03638315200805664
r_  generation:  0.2676055431365967
----------------------check_connections_block total spend ----------------------------- 6.328992128372192
generate_one_block  0.3678739070892334
generate_one_block  0.3439145088195801
generate_one_block  0.34689807891845703
generate_one_block  0.3526577949523926
generate_one_block  0.3678441047668457
generate_one_block  0.36335015296936035
generate_one_block  0.35695600509643555
generate_one_block  0.35547590255737305
generate_one_block  0.36360740661621094
generate_one_block  0.36362409591674805
generate_one_block  0.3673255443572998
generate_one_block  0.34647321701049805
generate_one_block  0.3796994686126709
generate_one_block  0.3640627861022949
generate_one_block  0.3629770278930664
generate_one_block  0.356997013092041
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03959918022155762
gen group dst list time:  0.07241606712341309
time for parepare:  0.020470380783081055
local_output_nid generation:  0.039087772369384766
local_in_edges_tensor generation:  0.048656463623046875
mini_batch_src_global generation:  0.06121659278869629
r_  generation:  0.48354458808898926
local_output_nid generation:  0.035065650939941406
local_in_edges_tensor generation:  0.04996132850646973
mini_batch_src_global generation:  0.06541585922241211
r_  generation:  0.46114611625671387
local_output_nid generation:  0.03255915641784668
local_in_edges_tensor generation:  0.04021811485290527
mini_batch_src_global generation:  0.05110931396484375
r_  generation:  0.472231388092041
local_output_nid generation:  0.03312373161315918
local_in_edges_tensor generation:  0.03435873985290527
mini_batch_src_global generation:  0.052408695220947266
r_  generation:  0.47571349143981934
local_output_nid generation:  0.03251385688781738
local_in_edges_tensor generation:  0.03184390068054199
mini_batch_src_global generation:  0.052700042724609375
r_  generation:  0.475233793258667
local_output_nid generation:  0.035428524017333984
local_in_edges_tensor generation:  0.03009510040283203
mini_batch_src_global generation:  0.05342888832092285
r_  generation:  0.48062872886657715
local_output_nid generation:  0.034052133560180664
local_in_edges_tensor generation:  0.044120073318481445
mini_batch_src_global generation:  0.056433916091918945
r_  generation:  0.5061886310577393
local_output_nid generation:  0.03472328186035156
local_in_edges_tensor generation:  0.04133486747741699
mini_batch_src_global generation:  0.057968854904174805
r_  generation:  0.4746253490447998
local_output_nid generation:  0.03291678428649902
local_in_edges_tensor generation:  0.03415393829345703
mini_batch_src_global generation:  0.05404233932495117
r_  generation:  0.47693705558776855
local_output_nid generation:  0.03294968605041504
local_in_edges_tensor generation:  0.03391313552856445
mini_batch_src_global generation:  0.05414009094238281
r_  generation:  0.47359180450439453
local_output_nid generation:  0.03296375274658203
local_in_edges_tensor generation:  0.03818678855895996
mini_batch_src_global generation:  0.05360102653503418
r_  generation:  0.4785945415496826
local_output_nid generation:  0.03257870674133301
local_in_edges_tensor generation:  0.0323488712310791
mini_batch_src_global generation:  0.05380868911743164
r_  generation:  0.476351261138916
local_output_nid generation:  0.032761335372924805
local_in_edges_tensor generation:  0.02979874610900879
mini_batch_src_global generation:  0.06300020217895508
r_  generation:  0.4820702075958252
local_output_nid generation:  0.03301405906677246
local_in_edges_tensor generation:  0.04599118232727051
mini_batch_src_global generation:  0.053624629974365234
r_  generation:  0.48032498359680176
local_output_nid generation:  0.03384566307067871
local_in_edges_tensor generation:  0.03271198272705078
mini_batch_src_global generation:  0.05440950393676758
r_  generation:  0.49393200874328613
local_output_nid generation:  0.03318333625793457
local_in_edges_tensor generation:  0.04306507110595703
mini_batch_src_global generation:  0.062297821044921875
r_  generation:  0.47808265686035156
----------------------check_connections_block total spend ----------------------------- 11.478899240493774
generate_one_block  0.5984110832214355
generate_one_block  0.5987539291381836
generate_one_block  0.6022219657897949
generate_one_block  0.6025047302246094
generate_one_block  0.5866885185241699
generate_one_block  0.5964229106903076
generate_one_block  0.665358304977417
generate_one_block  0.6137123107910156
generate_one_block  0.6014652252197266
generate_one_block  0.5887696743011475
generate_one_block  0.605726957321167
generate_one_block  0.5967154502868652
generate_one_block  0.5853681564331055
generate_one_block  0.6138772964477539
generate_one_block  0.5977461338043213
generate_one_block  0.6108028888702393
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  17.807891368865967
block generation total time  15.424282550811768
average batch blocks generation time:  0.9640176594257355
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1815185546875 GB
    Memory Allocated: 0.09771442413330078  GigaBytes
Max Memory Allocated: 0.09771442413330078  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 433, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 429, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 53, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 138, in invoke_udf_reduce
    for k, msg in msgdata_bkt.items():
  File "/usr/lib/python3.6/_collections_abc.py", line 744, in __iter__
    yield (key, self._mapping[key])
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/frame.py", line 393, in __getitem__
    return self._columns[name].data
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/frame.py", line 122, in data
    self.storage = F.gather_row(self.storage, self.index)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/backend/pytorch/tensor.py", line 186, in gather_row
    return th.index_select(data, 0, row_index.long())
RuntimeError: CUDA out of memory. Tried to allocate 170.00 MiB (GPU 0; 23.62 GiB total capacity; 22.21 GiB already allocated; 162.44 MiB free; 22.27 GiB reserved in total by PyTorch)
