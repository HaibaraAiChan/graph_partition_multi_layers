Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1647800129.4157877
ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.027298927307128906
range selection method range initialization spend 0.013183116912841797
time for parepare:  0.018076658248901367
local_output_nid generation:  0.0026597976684570312
local_in_edges_tensor generation:  0.00491023063659668
mini_batch_src_global generation:  0.003695964813232422
r_  generation:  0.041113853454589844
local_output_nid generation:  0.0028884410858154297
local_in_edges_tensor generation:  0.0017218589782714844
mini_batch_src_global generation:  0.004660367965698242
r_  generation:  0.043112754821777344
local_output_nid generation:  0.0030541419982910156
local_in_edges_tensor generation:  0.0016973018646240234
mini_batch_src_global generation:  0.003225564956665039
r_  generation:  0.043852806091308594
local_output_nid generation:  0.0030803680419921875
local_in_edges_tensor generation:  0.0017936229705810547
mini_batch_src_global generation:  0.0034570693969726562
r_  generation:  0.045935630798339844
local_output_nid generation:  0.0030634403228759766
local_in_edges_tensor generation:  0.001813650131225586
mini_batch_src_global generation:  0.003396272659301758
r_  generation:  0.045729875564575195
local_output_nid generation:  0.0031867027282714844
local_in_edges_tensor generation:  0.0016818046569824219
mini_batch_src_global generation:  0.0036230087280273438
r_  generation:  0.04542374610900879
local_output_nid generation:  0.0030755996704101562
local_in_edges_tensor generation:  0.0017096996307373047
mini_batch_src_global generation:  0.0035500526428222656
r_  generation:  0.04671311378479004
local_output_nid generation:  0.003118276596069336
local_in_edges_tensor generation:  0.0017027854919433594
mini_batch_src_global generation:  0.0037491321563720703
r_  generation:  0.04625272750854492
----------------------check_connections_block total spend ----------------------------- 0.5220968723297119
generate_one_block  0.06086134910583496
generate_one_block  0.06134653091430664
generate_one_block  0.062039852142333984
generate_one_block  0.06300139427185059
generate_one_block  0.06426072120666504
generate_one_block  0.06164240837097168
generate_one_block  0.062442779541015625
generate_one_block  0.06171536445617676
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04026937484741211
gen group dst list time:  0.016494274139404297
time for parepare:  0.019486427307128906
local_output_nid generation:  0.010933637619018555
local_in_edges_tensor generation:  0.029632568359375
mini_batch_src_global generation:  0.02997589111328125
r_  generation:  0.3110053539276123
local_output_nid generation:  0.01825094223022461
local_in_edges_tensor generation:  0.03137350082397461
mini_batch_src_global generation:  0.04115653038024902
r_  generation:  0.3292090892791748
local_output_nid generation:  0.019009113311767578
local_in_edges_tensor generation:  0.022955656051635742
mini_batch_src_global generation:  0.041010141372680664
r_  generation:  0.3330576419830322
local_output_nid generation:  0.019278287887573242
local_in_edges_tensor generation:  0.026520967483520508
mini_batch_src_global generation:  0.039818525314331055
r_  generation:  0.3365311622619629
local_output_nid generation:  0.019504785537719727
local_in_edges_tensor generation:  0.024196147918701172
mini_batch_src_global generation:  0.04154396057128906
r_  generation:  0.3365962505340576
local_output_nid generation:  0.019278764724731445
local_in_edges_tensor generation:  0.0200192928314209
mini_batch_src_global generation:  0.04094290733337402
r_  generation:  0.33336567878723145
local_output_nid generation:  0.019830942153930664
local_in_edges_tensor generation:  0.02458786964416504
mini_batch_src_global generation:  0.043456315994262695
r_  generation:  0.3402392864227295
local_output_nid generation:  0.019608736038208008
local_in_edges_tensor generation:  0.020533323287963867
mini_batch_src_global generation:  0.04167580604553223
r_  generation:  0.33455920219421387
----------------------check_connections_block total spend ----------------------------- 3.917276620864868
generate_one_block  0.43523526191711426
generate_one_block  0.44254040718078613
generate_one_block  0.44650793075561523
generate_one_block  0.4475882053375244
generate_one_block  0.43084001541137695
generate_one_block  0.44022464752197266
generate_one_block  0.4498460292816162
generate_one_block  0.43233704566955566
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03730130195617676
gen group dst list time:  0.03967618942260742
time for parepare:  0.019432783126831055
local_output_nid generation:  0.024756908416748047
local_in_edges_tensor generation:  0.036612749099731445
mini_batch_src_global generation:  0.047060489654541016
r_  generation:  0.47047972679138184
local_output_nid generation:  0.031973838806152344
local_in_edges_tensor generation:  0.04711723327636719
mini_batch_src_global generation:  0.05501079559326172
r_  generation:  0.47839999198913574
local_output_nid generation:  0.03279852867126465
local_in_edges_tensor generation:  0.0442657470703125
mini_batch_src_global generation:  0.0517270565032959
r_  generation:  0.4944121837615967
local_output_nid generation:  0.03293609619140625
local_in_edges_tensor generation:  0.03138566017150879
mini_batch_src_global generation:  0.057604074478149414
r_  generation:  0.48412013053894043
local_output_nid generation:  0.03324437141418457
local_in_edges_tensor generation:  0.04435539245605469
mini_batch_src_global generation:  0.05304574966430664
r_  generation:  0.49801182746887207
local_output_nid generation:  0.03326892852783203
local_in_edges_tensor generation:  0.033910274505615234
mini_batch_src_global generation:  0.055432796478271484
r_  generation:  0.4887683391571045
local_output_nid generation:  0.03335118293762207
local_in_edges_tensor generation:  0.031188488006591797
mini_batch_src_global generation:  0.054169654846191406
r_  generation:  0.4949607849121094
local_output_nid generation:  0.03345680236816406
local_in_edges_tensor generation:  0.031667470932006836
mini_batch_src_global generation:  0.05559086799621582
r_  generation:  0.48906922340393066
----------------------check_connections_block total spend ----------------------------- 5.760139226913452
generate_one_block  0.6126823425292969
generate_one_block  0.6182622909545898
generate_one_block  0.6139695644378662
generate_one_block  0.628849983215332
generate_one_block  0.6227467060089111
generate_one_block  0.6091349124908447
generate_one_block  0.6457669734954834
generate_one_block  0.6326401233673096
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  9.67741584777832
block generation total time  8.509172439575195
average batch blocks generation time:  1.0636465549468994
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1854248046875 GB
    Memory Allocated: 0.10243082046508789  GigaBytes
Max Memory Allocated: 0.10243082046508789  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 433, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 429, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 53, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.25 GiB already allocated; 10.44 MiB free; 22.41 GiB reserved in total by PyTorch)
