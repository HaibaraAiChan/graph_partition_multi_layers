Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1647803076.5774245
ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.027309179306030273
range selection method range initialization spend 0.01361846923828125
time for parepare:  0.018277406692504883
local_output_nid generation:  0.002645730972290039
local_in_edges_tensor generation:  0.0050656795501708984
mini_batch_src_global generation:  0.0037713050842285156
r_  generation:  0.04134058952331543
local_output_nid generation:  0.0029768943786621094
local_in_edges_tensor generation:  0.0017402172088623047
mini_batch_src_global generation:  0.004700899124145508
r_  generation:  0.0435183048248291
local_output_nid generation:  0.0030524730682373047
local_in_edges_tensor generation:  0.0016989707946777344
mini_batch_src_global generation:  0.003101825714111328
r_  generation:  0.04399371147155762
local_output_nid generation:  0.0031375885009765625
local_in_edges_tensor generation:  0.0017631053924560547
mini_batch_src_global generation:  0.003346681594848633
r_  generation:  0.046402931213378906
local_output_nid generation:  0.0030939579010009766
local_in_edges_tensor generation:  0.0017120838165283203
mini_batch_src_global generation:  0.00354766845703125
r_  generation:  0.04561114311218262
local_output_nid generation:  0.0030701160430908203
local_in_edges_tensor generation:  0.001699209213256836
mini_batch_src_global generation:  0.0035619735717773438
r_  generation:  0.04614734649658203
local_output_nid generation:  0.0030927658081054688
local_in_edges_tensor generation:  0.0017113685607910156
mini_batch_src_global generation:  0.0036089420318603516
r_  generation:  0.046083927154541016
local_output_nid generation:  0.0030655860900878906
local_in_edges_tensor generation:  0.0017390251159667969
mini_batch_src_global generation:  0.0036706924438476562
r_  generation:  0.046276092529296875
----------------------check_connections_block total spend ----------------------------- 0.5241372585296631
generate_one_block  0.060801029205322266
generate_one_block  0.06149458885192871
generate_one_block  0.06266975402832031
generate_one_block  0.06362676620483398
generate_one_block  0.06493902206420898
generate_one_block  0.0626363754272461
generate_one_block  0.06305050849914551
generate_one_block  0.06220746040344238
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.046051025390625
gen group dst list time:  0.01705622673034668
time for parepare:  0.0197141170501709
local_output_nid generation:  0.011200904846191406
local_in_edges_tensor generation:  0.03341031074523926
mini_batch_src_global generation:  0.03477048873901367
r_  generation:  0.351611852645874
local_output_nid generation:  0.019327878952026367
local_in_edges_tensor generation:  0.03352189064025879
mini_batch_src_global generation:  0.04564642906188965
r_  generation:  0.36837196350097656
local_output_nid generation:  0.020250797271728516
local_in_edges_tensor generation:  0.028205156326293945
mini_batch_src_global generation:  0.04756450653076172
r_  generation:  0.37709903717041016
local_output_nid generation:  0.021179914474487305
local_in_edges_tensor generation:  0.027757644653320312
mini_batch_src_global generation:  0.046213388442993164
r_  generation:  0.3833177089691162
local_output_nid generation:  0.021332740783691406
local_in_edges_tensor generation:  0.0218503475189209
mini_batch_src_global generation:  0.04754900932312012
r_  generation:  0.3818848133087158
local_output_nid generation:  0.02121281623840332
local_in_edges_tensor generation:  0.024439573287963867
mini_batch_src_global generation:  0.04679560661315918
r_  generation:  0.38374924659729004
local_output_nid generation:  0.0215761661529541
local_in_edges_tensor generation:  0.025251388549804688
mini_batch_src_global generation:  0.04987311363220215
r_  generation:  0.38675785064697266
local_output_nid generation:  0.021547555923461914
local_in_edges_tensor generation:  0.02811288833618164
mini_batch_src_global generation:  0.04757380485534668
r_  generation:  0.3815491199493408
----------------------check_connections_block total spend ----------------------------- 4.416869401931763
generate_one_block  0.496431827545166
generate_one_block  0.4993937015533447
generate_one_block  0.5154533386230469
generate_one_block  0.5077154636383057
generate_one_block  0.49326181411743164
generate_one_block  0.505516767501831
generate_one_block  0.5213494300842285
generate_one_block  0.4976785182952881
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03341984748840332
gen group dst list time:  0.03806662559509277
time for parepare:  0.019969940185546875
local_output_nid generation:  0.026312828063964844
local_in_edges_tensor generation:  0.041903018951416016
mini_batch_src_global generation:  0.04616951942443848
r_  generation:  0.49257946014404297
local_output_nid generation:  0.033374786376953125
local_in_edges_tensor generation:  0.05030488967895508
mini_batch_src_global generation:  0.055207252502441406
r_  generation:  0.48853492736816406
local_output_nid generation:  0.03363990783691406
local_in_edges_tensor generation:  0.04332160949707031
mini_batch_src_global generation:  0.05519676208496094
r_  generation:  0.48465967178344727
local_output_nid generation:  0.03425431251525879
local_in_edges_tensor generation:  0.038960933685302734
mini_batch_src_global generation:  0.057417869567871094
r_  generation:  0.4903132915496826
local_output_nid generation:  0.03461313247680664
local_in_edges_tensor generation:  0.03827667236328125
mini_batch_src_global generation:  0.057238101959228516
r_  generation:  0.49781060218811035
local_output_nid generation:  0.034479618072509766
local_in_edges_tensor generation:  0.033748626708984375
mini_batch_src_global generation:  0.0548853874206543
r_  generation:  0.5002260208129883
local_output_nid generation:  0.03494143486022949
local_in_edges_tensor generation:  0.03809213638305664
mini_batch_src_global generation:  0.05421257019042969
r_  generation:  0.507178544998169
local_output_nid generation:  0.035363197326660156
local_in_edges_tensor generation:  0.047223567962646484
mini_batch_src_global generation:  0.054825782775878906
r_  generation:  0.503023624420166
----------------------check_connections_block total spend ----------------------------- 5.8971476554870605
generate_one_block  0.6190629005432129
generate_one_block  0.6305820941925049
generate_one_block  0.617274284362793
generate_one_block  0.6260471343994141
generate_one_block  0.6289169788360596
generate_one_block  0.6155815124511719
generate_one_block  0.6458187103271484
generate_one_block  0.6381938457489014
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  10.314017057418823
block generation total time  9.058278322219849
average batch blocks generation time:  1.132284790277481
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2049560546875 GB
    Memory Allocated: 0.10463809967041016  GigaBytes
Max Memory Allocated: 0.10463809967041016  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 433, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 429, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 53, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.20 GiB already allocated; 4.44 MiB free; 22.42 GiB reserved in total by PyTorch)
