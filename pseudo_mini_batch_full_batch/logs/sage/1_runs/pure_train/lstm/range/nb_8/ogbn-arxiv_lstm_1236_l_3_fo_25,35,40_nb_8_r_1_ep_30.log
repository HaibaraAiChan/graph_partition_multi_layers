Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1647796371.5360305
ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.024805307388305664
range selection method range initialization spend 0.013643503189086914
time for parepare:  0.017657041549682617
local_output_nid generation:  0.0026276111602783203
local_in_edges_tensor generation:  0.004744291305541992
mini_batch_src_global generation:  0.003276824951171875
r_  generation:  0.03671622276306152
local_output_nid generation:  0.0030579566955566406
local_in_edges_tensor generation:  0.0016200542449951172
mini_batch_src_global generation:  0.004076957702636719
r_  generation:  0.03773617744445801
local_output_nid generation:  0.0030312538146972656
local_in_edges_tensor generation:  0.00159454345703125
mini_batch_src_global generation:  0.002730846405029297
r_  generation:  0.0390474796295166
local_output_nid generation:  0.003064393997192383
local_in_edges_tensor generation:  0.0016515254974365234
mini_batch_src_global generation:  0.0029137134552001953
r_  generation:  0.04034280776977539
local_output_nid generation:  0.003074169158935547
local_in_edges_tensor generation:  0.0016360282897949219
mini_batch_src_global generation:  0.003047943115234375
r_  generation:  0.0398709774017334
local_output_nid generation:  0.003030061721801758
local_in_edges_tensor generation:  0.0015897750854492188
mini_batch_src_global generation:  0.003158092498779297
r_  generation:  0.040160417556762695
local_output_nid generation:  0.0030891895294189453
local_in_edges_tensor generation:  0.001622915267944336
mini_batch_src_global generation:  0.003035306930541992
r_  generation:  0.04061532020568848
local_output_nid generation:  0.003041505813598633
local_in_edges_tensor generation:  0.0015988349914550781
mini_batch_src_global generation:  0.003036022186279297
r_  generation:  0.040059566497802734
----------------------check_connections_block total spend ----------------------------- 0.4640238285064697
generate_one_block  0.05345416069030762
generate_one_block  0.054099321365356445
generate_one_block  0.05453896522521973
generate_one_block  0.055245161056518555
generate_one_block  0.05715227127075195
generate_one_block  0.05425071716308594
generate_one_block  0.05586600303649902
generate_one_block  0.05516338348388672
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.039630889892578125
gen group dst list time:  0.015381336212158203
time for parepare:  0.01914501190185547
local_output_nid generation:  0.010212898254394531
local_in_edges_tensor generation:  0.027039051055908203
mini_batch_src_global generation:  0.02934551239013672
r_  generation:  0.28050732612609863
local_output_nid generation:  0.015290260314941406
local_in_edges_tensor generation:  0.026729583740234375
mini_batch_src_global generation:  0.03519797325134277
r_  generation:  0.2963993549346924
local_output_nid generation:  0.015836000442504883
local_in_edges_tensor generation:  0.02212667465209961
mini_batch_src_global generation:  0.03857231140136719
r_  generation:  0.30391430854797363
local_output_nid generation:  0.016254425048828125
local_in_edges_tensor generation:  0.02204585075378418
mini_batch_src_global generation:  0.03682231903076172
r_  generation:  0.3099217414855957
local_output_nid generation:  0.01631331443786621
local_in_edges_tensor generation:  0.016908645629882812
mini_batch_src_global generation:  0.03690052032470703
r_  generation:  0.3066086769104004
local_output_nid generation:  0.016215801239013672
local_in_edges_tensor generation:  0.02095484733581543
mini_batch_src_global generation:  0.037709712982177734
r_  generation:  0.3027315139770508
local_output_nid generation:  0.016447782516479492
local_in_edges_tensor generation:  0.022812843322753906
mini_batch_src_global generation:  0.037917375564575195
r_  generation:  0.3083913326263428
local_output_nid generation:  0.016469478607177734
local_in_edges_tensor generation:  0.02230381965637207
mini_batch_src_global generation:  0.037333011627197266
r_  generation:  0.3053703308105469
----------------------check_connections_block total spend ----------------------------- 3.549086332321167
generate_one_block  0.39392566680908203
generate_one_block  0.3957972526550293
generate_one_block  0.4050278663635254
generate_one_block  0.4046132564544678
generate_one_block  0.3868374824523926
generate_one_block  0.40157413482666016
generate_one_block  0.39657115936279297
generate_one_block  0.3897054195404053
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03288626670837402
gen group dst list time:  0.0360407829284668
time for parepare:  0.019089221954345703
local_output_nid generation:  0.024732351303100586
local_in_edges_tensor generation:  0.04040813446044922
mini_batch_src_global generation:  0.04469466209411621
r_  generation:  0.4707643985748291
local_output_nid generation:  0.03178715705871582
local_in_edges_tensor generation:  0.05024099349975586
mini_batch_src_global generation:  0.053841590881347656
r_  generation:  0.4758167266845703
local_output_nid generation:  0.03261446952819824
local_in_edges_tensor generation:  0.04676365852355957
mini_batch_src_global generation:  0.051175594329833984
r_  generation:  0.48757410049438477
local_output_nid generation:  0.03255033493041992
local_in_edges_tensor generation:  0.03802013397216797
mini_batch_src_global generation:  0.0553896427154541
r_  generation:  0.4824807643890381
local_output_nid generation:  0.035924673080444336
local_in_edges_tensor generation:  0.03836679458618164
mini_batch_src_global generation:  0.05354762077331543
r_  generation:  0.49531006813049316
local_output_nid generation:  0.03290820121765137
local_in_edges_tensor generation:  0.03526878356933594
mini_batch_src_global generation:  0.055737972259521484
r_  generation:  0.4835491180419922
local_output_nid generation:  0.03268146514892578
local_in_edges_tensor generation:  0.03413105010986328
mini_batch_src_global generation:  0.05290341377258301
r_  generation:  0.49852752685546875
local_output_nid generation:  0.03321957588195801
local_in_edges_tensor generation:  0.047154903411865234
mini_batch_src_global generation:  0.05504608154296875
r_  generation:  0.48445749282836914
----------------------check_connections_block total spend ----------------------------- 5.754587650299072
generate_one_block  0.6013531684875488
generate_one_block  0.6207902431488037
generate_one_block  0.6097347736358643
generate_one_block  0.6105811595916748
generate_one_block  0.6036767959594727
generate_one_block  0.6029770374298096
generate_one_block  0.6304888725280762
generate_one_block  0.6169469356536865
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  9.30367398262024
block generation total time  8.070601224899292
average batch blocks generation time:  1.0088251531124115
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1854248046875 GB
    Memory Allocated: 0.10061883926391602  GigaBytes
Max Memory Allocated: 0.10061883926391602  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 433, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 429, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 53, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 138, in invoke_udf_reduce
    for k, msg in msgdata_bkt.items():
  File "/usr/lib/python3.6/_collections_abc.py", line 744, in __iter__
    yield (key, self._mapping[key])
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/frame.py", line 393, in __getitem__
    return self._columns[name].data
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/frame.py", line 122, in data
    self.storage = F.gather_row(self.storage, self.index)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/backend/pytorch/tensor.py", line 186, in gather_row
    return th.index_select(data, 0, row_index.long())
RuntimeError: CUDA out of memory. Tried to allocate 276.00 MiB (GPU 0; 23.62 GiB total capacity; 22.16 GiB already allocated; 162.44 MiB free; 22.27 GiB reserved in total by PyTorch)
