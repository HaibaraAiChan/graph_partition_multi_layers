Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648488791.6911318
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0010123252868652344  GigaBytes
Max Memory Allocated: 0.0010123252868652344  GigaBytes

The real block id is  3
get_global_graph_edges_ids_block function  spend 0.0245358943939209
range selection method range initialization spend 0.013870716094970703
time for parepare:  0.017906665802001953
local_output_nid generation:  0.005313396453857422
local_in_edges_tensor generation:  0.005941152572631836
mini_batch_src_global generation:  0.006628513336181641
r_  generation:  0.08309674263000488
local_output_nid generation:  0.006114959716796875
local_in_edges_tensor generation:  0.0030219554901123047
mini_batch_src_global generation:  0.008831262588500977
r_  generation:  0.08940601348876953
local_output_nid generation:  0.0060443878173828125
local_in_edges_tensor generation:  0.0030052661895751953
mini_batch_src_global generation:  0.00648951530456543
r_  generation:  0.0913400650024414
local_output_nid generation:  0.0060291290283203125
local_in_edges_tensor generation:  0.003052234649658203
mini_batch_src_global generation:  0.006997823715209961
r_  generation:  0.09348344802856445
----------------------check_connections_block total spend ----------------------------- 0.5143721103668213
generate_one_block  0.10175347328186035
generate_one_block  0.10405325889587402
generate_one_block  0.10387182235717773
generate_one_block  0.1028130054473877
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.04071402549743652
gen group dst list time:  0.011431217193603516
time for parepare:  0.019652128219604492
local_output_nid generation:  0.015000343322753906
local_in_edges_tensor generation:  0.03630518913269043
mini_batch_src_global generation:  0.04140043258666992
r_  generation:  0.40449953079223633
local_output_nid generation:  0.02330493927001953
local_in_edges_tensor generation:  0.036536216735839844
mini_batch_src_global generation:  0.04816007614135742
r_  generation:  0.42986154556274414
local_output_nid generation:  0.024970054626464844
local_in_edges_tensor generation:  0.03062605857849121
mini_batch_src_global generation:  0.05215764045715332
r_  generation:  0.43968963623046875
local_output_nid generation:  0.024014949798583984
local_in_edges_tensor generation:  0.03791975975036621
mini_batch_src_global generation:  0.08089804649353027
r_  generation:  0.4248173236846924
----------------------check_connections_block total spend ----------------------------- 2.5432209968566895
generate_one_block  0.5739972591400146
generate_one_block  0.5557405948638916
generate_one_block  0.5489089488983154
generate_one_block  0.558626651763916
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.0377354621887207
gen group dst list time:  0.028665542602539062
time for parepare:  0.020519256591796875
local_output_nid generation:  0.026453733444213867
local_in_edges_tensor generation:  0.06368136405944824
mini_batch_src_global generation:  0.05961251258850098
r_  generation:  0.5430371761322021
local_output_nid generation:  0.03313732147216797
local_in_edges_tensor generation:  0.05749011039733887
mini_batch_src_global generation:  0.06147003173828125
r_  generation:  0.5675280094146729
local_output_nid generation:  0.03761458396911621
local_in_edges_tensor generation:  0.057840824127197266
mini_batch_src_global generation:  0.07053446769714355
r_  generation:  0.5508193969726562
local_output_nid generation:  0.03536534309387207
local_in_edges_tensor generation:  0.05272269248962402
mini_batch_src_global generation:  0.05641365051269531
r_  generation:  0.5649268627166748
----------------------check_connections_block total spend ----------------------------- 3.332920789718628
generate_one_block  0.707643985748291
generate_one_block  0.7161839008331299
generate_one_block  0.6995010375976562
generate_one_block  0.6849210262298584
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.039492130279541016
gen group dst list time:  0.028644561767578125
time for parepare:  0.0190279483795166
local_output_nid generation:  0.02831411361694336
local_in_edges_tensor generation:  0.04630136489868164
mini_batch_src_global generation:  0.04566454887390137
r_  generation:  0.5067684650421143
local_output_nid generation:  0.03508162498474121
local_in_edges_tensor generation:  0.04546713829040527
mini_batch_src_global generation:  0.057421207427978516
r_  generation:  0.5266788005828857
local_output_nid generation:  0.03582453727722168
local_in_edges_tensor generation:  0.037502288818359375
mini_batch_src_global generation:  0.057788848876953125
r_  generation:  0.5227737426757812
local_output_nid generation:  0.03597450256347656
local_in_edges_tensor generation:  0.046063899993896484
mini_batch_src_global generation:  0.05705070495605469
r_  generation:  0.5199542045593262
----------------------check_connections_block total spend ----------------------------- 3.0844359397888184
generate_one_block  0.6972777843475342
generate_one_block  0.6480026245117188
generate_one_block  0.6503982543945312
generate_one_block  0.6482994556427002
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0010123252868652344  GigaBytes
Max Memory Allocated: 0.0010123252868652344  GigaBytes

connection checking time:  8.960577726364136
block generation total time  7.689501523971558
average batch blocks generation time:  1.9223753809928894
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2030029296875 GB
    Memory Allocated: 0.11687707901000977  GigaBytes
Max Memory Allocated: 0.11687707901000977  GigaBytes

torch.Size([166706, 128])
torch.Size([164803, 64])
torch.Size([155117, 64])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 23.62 GiB total capacity; 22.38 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
