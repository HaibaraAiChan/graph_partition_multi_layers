Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648525241.5511134
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007319450378417969  GigaBytes
Max Memory Allocated: 0.0007319450378417969  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.024533987045288086
range selection method range initialization spend 0.013514041900634766
time for parepare:  0.017688274383544922
local_output_nid generation:  0.0026857852935791016
local_in_edges_tensor generation:  0.004537820816040039
mini_batch_src_global generation:  0.0032508373260498047
r_  generation:  0.036659955978393555
local_output_nid generation:  0.0029714107513427734
local_in_edges_tensor generation:  0.0015861988067626953
mini_batch_src_global generation:  0.004024028778076172
r_  generation:  0.03779482841491699
local_output_nid generation:  0.0031135082244873047
local_in_edges_tensor generation:  0.0016300678253173828
mini_batch_src_global generation:  0.0027904510498046875
r_  generation:  0.03853869438171387
local_output_nid generation:  0.00316619873046875
local_in_edges_tensor generation:  0.0016336441040039062
mini_batch_src_global generation:  0.0028204917907714844
r_  generation:  0.03924679756164551
local_output_nid generation:  0.0031397342681884766
local_in_edges_tensor generation:  0.0015895366668701172
mini_batch_src_global generation:  0.0029337406158447266
r_  generation:  0.04031229019165039
local_output_nid generation:  0.003211498260498047
local_in_edges_tensor generation:  0.0016279220581054688
mini_batch_src_global generation:  0.003040790557861328
r_  generation:  0.04050040245056152
local_output_nid generation:  0.003182649612426758
local_in_edges_tensor generation:  0.0016222000122070312
mini_batch_src_global generation:  0.003139972686767578
r_  generation:  0.04062962532043457
local_output_nid generation:  0.0031790733337402344
local_in_edges_tensor generation:  0.0016293525695800781
mini_batch_src_global generation:  0.0037245750427246094
r_  generation:  0.04149818420410156
----------------------check_connections_block total spend ----------------------------- 0.4660203456878662
generate_one_block  0.05336189270019531
generate_one_block  0.0539402961730957
generate_one_block  0.05443453788757324
generate_one_block  0.05441927909851074
generate_one_block  0.05710244178771973
generate_one_block  0.05506777763366699
generate_one_block  0.05511212348937988
generate_one_block  0.05562639236450195
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.040816545486450195
gen group dst list time:  0.015388011932373047
time for parepare:  0.019222497940063477
local_output_nid generation:  0.010419607162475586
local_in_edges_tensor generation:  0.02826690673828125
mini_batch_src_global generation:  0.030839920043945312
r_  generation:  0.2973315715789795
local_output_nid generation:  0.015560626983642578
local_in_edges_tensor generation:  0.027109861373901367
mini_batch_src_global generation:  0.03580331802368164
r_  generation:  0.3047025203704834
local_output_nid generation:  0.015970706939697266
local_in_edges_tensor generation:  0.022664308547973633
mini_batch_src_global generation:  0.03573179244995117
r_  generation:  0.309429407119751
local_output_nid generation:  0.016421794891357422
local_in_edges_tensor generation:  0.020789146423339844
mini_batch_src_global generation:  0.03757023811340332
r_  generation:  0.3178679943084717
local_output_nid generation:  0.016668081283569336
local_in_edges_tensor generation:  0.01755833625793457
mini_batch_src_global generation:  0.038208723068237305
r_  generation:  0.318314790725708
local_output_nid generation:  0.01668262481689453
local_in_edges_tensor generation:  0.02357172966003418
mini_batch_src_global generation:  0.038671255111694336
r_  generation:  0.3168647289276123
local_output_nid generation:  0.016959190368652344
local_in_edges_tensor generation:  0.020576000213623047
mini_batch_src_global generation:  0.03860807418823242
r_  generation:  0.3206760883331299
local_output_nid generation:  0.016855955123901367
local_in_edges_tensor generation:  0.02439260482788086
mini_batch_src_global generation:  0.03872370719909668
r_  generation:  0.32413244247436523
----------------------check_connections_block total spend ----------------------------- 3.6808090209960938
generate_one_block  0.41580724716186523
generate_one_block  0.41916322708129883
generate_one_block  0.423297643661499
generate_one_block  0.41230058670043945
generate_one_block  0.4098055362701416
generate_one_block  0.4274885654449463
generate_one_block  0.4067413806915283
generate_one_block  0.4111778736114502
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.03539562225341797
gen group dst list time:  0.03599977493286133
time for parepare:  0.018798112869262695
local_output_nid generation:  0.02492237091064453
local_in_edges_tensor generation:  0.04011988639831543
mini_batch_src_global generation:  0.05267620086669922
r_  generation:  0.5574331283569336
local_output_nid generation:  0.03206658363342285
local_in_edges_tensor generation:  0.05063819885253906
mini_batch_src_global generation:  0.061261892318725586
r_  generation:  0.5309629440307617
local_output_nid generation:  0.03168916702270508
local_in_edges_tensor generation:  0.03649497032165527
mini_batch_src_global generation:  0.056586265563964844
r_  generation:  0.5456500053405762
local_output_nid generation:  0.0321660041809082
local_in_edges_tensor generation:  0.03600478172302246
mini_batch_src_global generation:  0.06485319137573242
r_  generation:  0.5325322151184082
local_output_nid generation:  0.032492637634277344
local_in_edges_tensor generation:  0.03243565559387207
mini_batch_src_global generation:  0.059204816818237305
r_  generation:  0.5501971244812012
local_output_nid generation:  0.03292703628540039
local_in_edges_tensor generation:  0.03613924980163574
mini_batch_src_global generation:  0.06197786331176758
r_  generation:  0.572211742401123
local_output_nid generation:  0.03324627876281738
local_in_edges_tensor generation:  0.04317736625671387
mini_batch_src_global generation:  0.0599217414855957
r_  generation:  0.5500068664550781
local_output_nid generation:  0.0328066349029541
local_in_edges_tensor generation:  0.03679490089416504
mini_batch_src_global generation:  0.06184577941894531
r_  generation:  0.5440146923065186
----------------------check_connections_block total spend ----------------------------- 6.372891426086426
generate_one_block  0.6929380893707275
generate_one_block  0.6855840682983398
generate_one_block  0.6824805736541748
generate_one_block  0.6741535663604736
generate_one_block  0.6734504699707031
generate_one_block  0.6779265403747559
generate_one_block  0.7004027366638184
generate_one_block  0.6800374984741211
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.029528379440307617
gen group dst list time:  0.04421877861022949
time for parepare:  0.018543243408203125
local_output_nid generation:  0.029770851135253906
local_in_edges_tensor generation:  0.04406023025512695
mini_batch_src_global generation:  0.05561518669128418
r_  generation:  0.5440092086791992
local_output_nid generation:  0.03590035438537598
local_in_edges_tensor generation:  0.05239105224609375
mini_batch_src_global generation:  0.06377768516540527
r_  generation:  0.5477595329284668
local_output_nid generation:  0.0362856388092041
local_in_edges_tensor generation:  0.039156436920166016
mini_batch_src_global generation:  0.0640556812286377
r_  generation:  0.5545988082885742
local_output_nid generation:  0.03717994689941406
local_in_edges_tensor generation:  0.044536590576171875
mini_batch_src_global generation:  0.059493303298950195
r_  generation:  0.5615684986114502
local_output_nid generation:  0.03670620918273926
local_in_edges_tensor generation:  0.044263362884521484
mini_batch_src_global generation:  0.05997276306152344
r_  generation:  0.557297945022583
local_output_nid generation:  0.03714323043823242
local_in_edges_tensor generation:  0.034308433532714844
mini_batch_src_global generation:  0.05955338478088379
r_  generation:  0.5676424503326416
local_output_nid generation:  0.037760019302368164
local_in_edges_tensor generation:  0.037303924560546875
mini_batch_src_global generation:  0.06174182891845703
r_  generation:  0.5717582702636719
local_output_nid generation:  0.03659224510192871
local_in_edges_tensor generation:  0.04639720916748047
mini_batch_src_global generation:  0.06066083908081055
r_  generation:  0.578582763671875
----------------------check_connections_block total spend ----------------------------- 6.6253368854522705
generate_one_block  0.692359209060669
generate_one_block  0.69645094871521
generate_one_block  0.7123513221740723
generate_one_block  0.7030360698699951
generate_one_block  0.7064321041107178
generate_one_block  0.7066423892974854
generate_one_block  0.7475218772888184
generate_one_block  0.7077689170837402
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.06536436080932617
gen group dst list time:  0.04869961738586426
time for parepare:  0.018839359283447266
local_output_nid generation:  0.03251242637634277
local_in_edges_tensor generation:  0.04204750061035156
mini_batch_src_global generation:  0.04949045181274414
r_  generation:  0.5373156070709229
local_output_nid generation:  0.03716850280761719
local_in_edges_tensor generation:  0.04307365417480469
mini_batch_src_global generation:  0.07994818687438965
r_  generation:  0.5429399013519287
local_output_nid generation:  0.036919593811035156
local_in_edges_tensor generation:  0.036177873611450195
mini_batch_src_global generation:  0.06330657005310059
r_  generation:  0.5418286323547363
local_output_nid generation:  0.037572622299194336
local_in_edges_tensor generation:  0.040682077407836914
mini_batch_src_global generation:  0.06705331802368164
r_  generation:  0.5433883666992188
local_output_nid generation:  0.03745746612548828
local_in_edges_tensor generation:  0.04558849334716797
mini_batch_src_global generation:  0.0631246566772461
r_  generation:  0.5660860538482666
local_output_nid generation:  0.04101157188415527
local_in_edges_tensor generation:  0.047495365142822266
mini_batch_src_global generation:  0.06389927864074707
r_  generation:  0.5495762825012207
local_output_nid generation:  0.03929781913757324
local_in_edges_tensor generation:  0.0365290641784668
mini_batch_src_global generation:  0.061925649642944336
r_  generation:  0.547600269317627
local_output_nid generation:  0.03927206993103027
local_in_edges_tensor generation:  0.04117584228515625
mini_batch_src_global generation:  0.06177353858947754
r_  generation:  0.5499544143676758
----------------------check_connections_block total spend ----------------------------- 6.555842399597168
generate_one_block  0.6801528930664062
generate_one_block  0.6899006366729736
generate_one_block  0.6860980987548828
generate_one_block  0.6859269142150879
generate_one_block  0.6915645599365234
generate_one_block  0.6933670043945312
generate_one_block  0.6792278289794922
generate_one_block  0.7344930171966553
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03800535202026367
gen group dst list time:  0.04830813407897949
time for parepare:  0.019071102142333984
local_output_nid generation:  0.03229856491088867
local_in_edges_tensor generation:  0.05162763595581055
mini_batch_src_global generation:  0.04961705207824707
r_  generation:  0.5051555633544922
local_output_nid generation:  0.03861379623413086
local_in_edges_tensor generation:  0.05340147018432617
mini_batch_src_global generation:  0.05855679512023926
r_  generation:  0.5140974521636963
local_output_nid generation:  0.037450313568115234
local_in_edges_tensor generation:  0.05329537391662598
mini_batch_src_global generation:  0.05860137939453125
r_  generation:  0.50980544090271
local_output_nid generation:  0.03781557083129883
local_in_edges_tensor generation:  0.044153690338134766
mini_batch_src_global generation:  0.05884075164794922
r_  generation:  0.5185322761535645
local_output_nid generation:  0.037993431091308594
local_in_edges_tensor generation:  0.035436391830444336
mini_batch_src_global generation:  0.05904674530029297
r_  generation:  0.5245916843414307
local_output_nid generation:  0.03819417953491211
local_in_edges_tensor generation:  0.04089784622192383
mini_batch_src_global generation:  0.05862545967102051
r_  generation:  0.5164518356323242
local_output_nid generation:  0.038399457931518555
local_in_edges_tensor generation:  0.0362703800201416
mini_batch_src_global generation:  0.05914640426635742
r_  generation:  0.5153002738952637
local_output_nid generation:  0.03842306137084961
local_in_edges_tensor generation:  0.0362088680267334
mini_batch_src_global generation:  0.057852745056152344
r_  generation:  0.5157561302185059
----------------------check_connections_block total spend ----------------------------- 6.205117225646973
generate_one_block  0.6350483894348145
generate_one_block  0.644169807434082
generate_one_block  0.6474990844726562
generate_one_block  0.6414456367492676
generate_one_block  0.639427900314331
generate_one_block  0.6578323841094971
generate_one_block  0.6293501853942871
generate_one_block  0.6308600902557373
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007319450378417969  GigaBytes
Max Memory Allocated: 0.0007319450378417969  GigaBytes

connection checking time:  29.43999695777893
block generation total time  25.131682872772217
average batch blocks generation time:  3.141460359096527
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2401123046875 GB
    Memory Allocated: 0.13923311233520508  GigaBytes
Max Memory Allocated: 0.13923311233520508  GigaBytes

torch.Size([167524, 128])
torch.Size([167077, 32])
torch.Size([165833, 32])
torch.Size([161573, 32])
torch.Size([142652, 32])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 438, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 434, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 253, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 23.62 GiB total capacity; 22.38 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
