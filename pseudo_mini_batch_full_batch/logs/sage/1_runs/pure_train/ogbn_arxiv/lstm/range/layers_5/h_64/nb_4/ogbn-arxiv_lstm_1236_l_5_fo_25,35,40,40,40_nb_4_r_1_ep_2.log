Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648505787.7940469
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0011692047119140625  GigaBytes
Max Memory Allocated: 0.0011692047119140625  GigaBytes

The real block id is  4
get_global_graph_edges_ids_block function  spend 0.023611783981323242
range selection method range initialization spend 0.013941526412963867
time for parepare:  0.017852783203125
local_output_nid generation:  0.005621910095214844
local_in_edges_tensor generation:  0.005189657211303711
mini_batch_src_global generation:  0.006589651107788086
r_  generation:  0.08193469047546387
local_output_nid generation:  0.006146669387817383
local_in_edges_tensor generation:  0.0030412673950195312
mini_batch_src_global generation:  0.008672952651977539
r_  generation:  0.08943462371826172
local_output_nid generation:  0.006170988082885742
local_in_edges_tensor generation:  0.0030646324157714844
mini_batch_src_global generation:  0.0065441131591796875
r_  generation:  0.09040021896362305
local_output_nid generation:  0.0061719417572021484
local_in_edges_tensor generation:  0.003087282180786133
mini_batch_src_global generation:  0.0069580078125
r_  generation:  0.09292006492614746
----------------------check_connections_block total spend ----------------------------- 0.5112476348876953
generate_one_block  0.10159683227539062
generate_one_block  0.1033334732055664
generate_one_block  0.10432243347167969
generate_one_block  0.10361552238464355
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.038355112075805664
gen group dst list time:  0.011527299880981445
time for parepare:  0.019587039947509766
local_output_nid generation:  0.014573335647583008
local_in_edges_tensor generation:  0.03603339195251465
mini_batch_src_global generation:  0.038333892822265625
r_  generation:  0.41301536560058594
local_output_nid generation:  0.022533893585205078
local_in_edges_tensor generation:  0.04090762138366699
mini_batch_src_global generation:  0.04807305335998535
r_  generation:  0.4301128387451172
local_output_nid generation:  0.024200439453125
local_in_edges_tensor generation:  0.03778886795043945
mini_batch_src_global generation:  0.04838275909423828
r_  generation:  0.4429440498352051
local_output_nid generation:  0.025699853897094727
local_in_edges_tensor generation:  0.03575444221496582
mini_batch_src_global generation:  0.06617856025695801
r_  generation:  0.42607808113098145
----------------------check_connections_block total spend ----------------------------- 2.5443053245544434
generate_one_block  0.585526704788208
generate_one_block  0.5413312911987305
generate_one_block  0.5487246513366699
generate_one_block  0.5677821636199951
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.04993104934692383
gen group dst list time:  0.027741432189941406
time for parepare:  0.021537303924560547
local_output_nid generation:  0.025220394134521484
local_in_edges_tensor generation:  0.05716276168823242
mini_batch_src_global generation:  0.05014824867248535
r_  generation:  0.5676672458648682
local_output_nid generation:  0.03644680976867676
local_in_edges_tensor generation:  0.05749869346618652
mini_batch_src_global generation:  0.06501555442810059
r_  generation:  0.5569233894348145
local_output_nid generation:  0.03466391563415527
local_in_edges_tensor generation:  0.04262256622314453
mini_batch_src_global generation:  0.05720686912536621
r_  generation:  0.5813484191894531
local_output_nid generation:  0.037019968032836914
local_in_edges_tensor generation:  0.04330182075500488
mini_batch_src_global generation:  0.05914592742919922
r_  generation:  0.5681912899017334
----------------------check_connections_block total spend ----------------------------- 3.3477649688720703
generate_one_block  0.7370412349700928
generate_one_block  0.7084915637969971
generate_one_block  0.6940391063690186
generate_one_block  0.7248725891113281
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04262375831604004
gen group dst list time:  0.028385400772094727
time for parepare:  0.018892765045166016
local_output_nid generation:  0.027569293975830078
local_in_edges_tensor generation:  0.07292723655700684
mini_batch_src_global generation:  0.0639796257019043
r_  generation:  0.5423555374145508
local_output_nid generation:  0.03487038612365723
local_in_edges_tensor generation:  0.037091970443725586
mini_batch_src_global generation:  0.06740570068359375
r_  generation:  0.5553796291351318
local_output_nid generation:  0.03678154945373535
local_in_edges_tensor generation:  0.03919792175292969
mini_batch_src_global generation:  0.07132554054260254
r_  generation:  0.5627081394195557
local_output_nid generation:  0.03627967834472656
local_in_edges_tensor generation:  0.04715776443481445
mini_batch_src_global generation:  0.06864595413208008
r_  generation:  0.5551071166992188
----------------------check_connections_block total spend ----------------------------- 3.3325412273406982
generate_one_block  0.6972873210906982
generate_one_block  0.7157835960388184
generate_one_block  0.6936731338500977
generate_one_block  0.6891369819641113
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03701162338256836
gen group dst list time:  0.025004148483276367
time for parepare:  0.018955707550048828
local_output_nid generation:  0.028087854385375977
local_in_edges_tensor generation:  0.055727481842041016
mini_batch_src_global generation:  0.045911312103271484
r_  generation:  0.5571451187133789
local_output_nid generation:  0.03547048568725586
local_in_edges_tensor generation:  0.0467066764831543
mini_batch_src_global generation:  0.05810713768005371
r_  generation:  0.5163521766662598
local_output_nid generation:  0.03613638877868652
local_in_edges_tensor generation:  0.03799700736999512
mini_batch_src_global generation:  0.058943986892700195
r_  generation:  0.5199079513549805
local_output_nid generation:  0.03674483299255371
local_in_edges_tensor generation:  0.04289436340332031
mini_batch_src_global generation:  0.06183791160583496
r_  generation:  0.5170555114746094
----------------------check_connections_block total spend ----------------------------- 3.145277738571167
generate_one_block  0.664975643157959
generate_one_block  0.6507687568664551
generate_one_block  0.642585277557373
generate_one_block  0.65071702003479
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0011692047119140625  GigaBytes
Max Memory Allocated: 0.0011692047119140625  GigaBytes

connection checking time:  12.369889259338379
block generation total time  10.512737035751343
average batch blocks generation time:  2.6281842589378357
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2225341796875 GB
    Memory Allocated: 0.1304612159729004  GigaBytes
Max Memory Allocated: 0.1304612159729004  GigaBytes

torch.Size([167456, 128])
torch.Size([166873, 64])
torch.Size([164797, 64])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.27 GiB already allocated; 16.44 MiB free; 22.40 GiB reserved in total by PyTorch)
