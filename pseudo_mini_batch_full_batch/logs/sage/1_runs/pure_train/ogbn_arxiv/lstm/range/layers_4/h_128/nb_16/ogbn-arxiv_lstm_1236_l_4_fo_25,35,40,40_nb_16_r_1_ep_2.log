Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648489840.7069926
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.002379894256591797  GigaBytes
Max Memory Allocated: 0.002379894256591797  GigaBytes

The real block id is  3
get_global_graph_edges_ids_block function  spend 0.023941516876220703
range selection method range initialization spend 0.013857126235961914
time for parepare:  0.017842769622802734
local_output_nid generation:  0.0013203620910644531
local_in_edges_tensor generation:  0.00302886962890625
mini_batch_src_global generation:  0.0017426013946533203
r_  generation:  0.018944263458251953
local_output_nid generation:  0.001531362533569336
local_in_edges_tensor generation:  0.0009565353393554688
mini_batch_src_global generation:  0.0021011829376220703
r_  generation:  0.01806044578552246
local_output_nid generation:  0.0015232563018798828
local_in_edges_tensor generation:  0.0008981227874755859
mini_batch_src_global generation:  0.0013713836669921875
r_  generation:  0.01837325096130371
local_output_nid generation:  0.0015616416931152344
local_in_edges_tensor generation:  0.0008840560913085938
mini_batch_src_global generation:  0.0013427734375
r_  generation:  0.01844310760498047
local_output_nid generation:  0.0015249252319335938
local_in_edges_tensor generation:  0.0008678436279296875
mini_batch_src_global generation:  0.0013818740844726562
r_  generation:  0.018848657608032227
local_output_nid generation:  0.0015342235565185547
local_in_edges_tensor generation:  0.0008642673492431641
mini_batch_src_global generation:  0.0014026165008544922
r_  generation:  0.019160032272338867
local_output_nid generation:  0.0015408992767333984
local_in_edges_tensor generation:  0.0008678436279296875
mini_batch_src_global generation:  0.0013866424560546875
r_  generation:  0.01833057403564453
local_output_nid generation:  0.0015327930450439453
local_in_edges_tensor generation:  0.0008485317230224609
mini_batch_src_global generation:  0.0014033317565917969
r_  generation:  0.01889491081237793
local_output_nid generation:  0.001512765884399414
local_in_edges_tensor generation:  0.00084686279296875
mini_batch_src_global generation:  0.0014011859893798828
r_  generation:  0.018826723098754883
local_output_nid generation:  0.0015077590942382812
local_in_edges_tensor generation:  0.0009090900421142578
mini_batch_src_global generation:  0.0014233589172363281
r_  generation:  0.01904916763305664
local_output_nid generation:  0.0015239715576171875
local_in_edges_tensor generation:  0.0008740425109863281
mini_batch_src_global generation:  0.0014772415161132812
r_  generation:  0.019351720809936523
local_output_nid generation:  0.00153350830078125
local_in_edges_tensor generation:  0.0008604526519775391
mini_batch_src_global generation:  0.0014574527740478516
r_  generation:  0.01890110969543457
local_output_nid generation:  0.0015633106231689453
local_in_edges_tensor generation:  0.0008728504180908203
mini_batch_src_global generation:  0.0015044212341308594
r_  generation:  0.019366979598999023
local_output_nid generation:  0.0015392303466796875
local_in_edges_tensor generation:  0.0009028911590576172
mini_batch_src_global generation:  0.0014510154724121094
r_  generation:  0.019092798233032227
local_output_nid generation:  0.0015156269073486328
local_in_edges_tensor generation:  0.0008490085601806641
mini_batch_src_global generation:  0.0014882087707519531
r_  generation:  0.01953744888305664
local_output_nid generation:  0.001519918441772461
local_in_edges_tensor generation:  0.0008461475372314453
mini_batch_src_global generation:  0.0014677047729492188
r_  generation:  0.01864171028137207
----------------------check_connections_block total spend ----------------------------- 0.45082807540893555
generate_one_block  0.026728391647338867
generate_one_block  0.02821660041809082
generate_one_block  0.028163433074951172
generate_one_block  0.029774188995361328
generate_one_block  0.02830672264099121
generate_one_block  0.02793097496032715
generate_one_block  0.02688741683959961
generate_one_block  0.027544498443603516
generate_one_block  0.02819371223449707
generate_one_block  0.0281374454498291
generate_one_block  0.028143644332885742
generate_one_block  0.02764749526977539
generate_one_block  0.027930736541748047
generate_one_block  0.028316497802734375
generate_one_block  0.028321027755737305
generate_one_block  0.027096986770629883
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.035758256912231445
gen group dst list time:  0.018834352493286133
time for parepare:  0.01885247230529785
local_output_nid generation:  0.006513118743896484
local_in_edges_tensor generation:  0.016643762588500977
mini_batch_src_global generation:  0.021245241165161133
r_  generation:  0.19863080978393555
local_output_nid generation:  0.010506391525268555
local_in_edges_tensor generation:  0.017981290817260742
mini_batch_src_global generation:  0.024562835693359375
r_  generation:  0.20128440856933594
local_output_nid generation:  0.011014699935913086
local_in_edges_tensor generation:  0.015227556228637695
mini_batch_src_global generation:  0.027565956115722656
r_  generation:  0.21010112762451172
local_output_nid generation:  0.011446952819824219
local_in_edges_tensor generation:  0.019222736358642578
mini_batch_src_global generation:  0.02539372444152832
r_  generation:  0.21949410438537598
local_output_nid generation:  0.011689901351928711
local_in_edges_tensor generation:  0.015888690948486328
mini_batch_src_global generation:  0.026312828063964844
r_  generation:  0.2146470546722412
local_output_nid generation:  0.01176309585571289
local_in_edges_tensor generation:  0.01214599609375
mini_batch_src_global generation:  0.02689385414123535
r_  generation:  0.21499943733215332
local_output_nid generation:  0.011717081069946289
local_in_edges_tensor generation:  0.011837482452392578
mini_batch_src_global generation:  0.026457548141479492
r_  generation:  0.21557021141052246
local_output_nid generation:  0.011980056762695312
local_in_edges_tensor generation:  0.012041091918945312
mini_batch_src_global generation:  0.028186798095703125
r_  generation:  0.21434378623962402
local_output_nid generation:  0.011980772018432617
local_in_edges_tensor generation:  0.015810012817382812
mini_batch_src_global generation:  0.026743173599243164
r_  generation:  0.2147068977355957
local_output_nid generation:  0.012366056442260742
local_in_edges_tensor generation:  0.016127586364746094
mini_batch_src_global generation:  0.026993513107299805
r_  generation:  0.22164320945739746
local_output_nid generation:  0.012294769287109375
local_in_edges_tensor generation:  0.014222383499145508
mini_batch_src_global generation:  0.026882171630859375
r_  generation:  0.21434950828552246
local_output_nid generation:  0.01228189468383789
local_in_edges_tensor generation:  0.01630377769470215
mini_batch_src_global generation:  0.02894282341003418
r_  generation:  0.21874141693115234
local_output_nid generation:  0.012506484985351562
local_in_edges_tensor generation:  0.012469768524169922
mini_batch_src_global generation:  0.027682065963745117
r_  generation:  0.22085237503051758
local_output_nid generation:  0.01227259635925293
local_in_edges_tensor generation:  0.012562990188598633
mini_batch_src_global generation:  0.02770829200744629
r_  generation:  0.21727561950683594
local_output_nid generation:  0.012460947036743164
local_in_edges_tensor generation:  0.01836705207824707
mini_batch_src_global generation:  0.029644012451171875
r_  generation:  0.2243955135345459
local_output_nid generation:  0.015239715576171875
local_in_edges_tensor generation:  0.01235342025756836
mini_batch_src_global generation:  0.027399778366088867
r_  generation:  0.21362090110778809
----------------------check_connections_block total spend ----------------------------- 5.058589458465576
generate_one_block  0.27722978591918945
generate_one_block  0.2753915786743164
generate_one_block  0.2805976867675781
generate_one_block  0.28560566902160645
generate_one_block  0.30412745475769043
generate_one_block  0.28056931495666504
generate_one_block  0.2690727710723877
generate_one_block  0.2763965129852295
generate_one_block  0.28051161766052246
generate_one_block  0.28176045417785645
generate_one_block  0.27576637268066406
generate_one_block  0.2900576591491699
generate_one_block  0.28521108627319336
generate_one_block  0.2738339900970459
generate_one_block  0.30155491828918457
generate_one_block  0.27326393127441406
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.0493466854095459
gen group dst list time:  0.06309294700622559
time for parepare:  0.018896818161010742
local_output_nid generation:  0.023685932159423828
local_in_edges_tensor generation:  0.053516387939453125
mini_batch_src_global generation:  0.04880261421203613
r_  generation:  0.481905460357666
local_output_nid generation:  0.030261516571044922
local_in_edges_tensor generation:  0.04987621307373047
mini_batch_src_global generation:  0.05599856376647949
r_  generation:  0.4886355400085449
local_output_nid generation:  0.02910614013671875
local_in_edges_tensor generation:  0.039180755615234375
mini_batch_src_global generation:  0.059537410736083984
r_  generation:  0.4884154796600342
local_output_nid generation:  0.029668092727661133
local_in_edges_tensor generation:  0.04135942459106445
mini_batch_src_global generation:  0.05999565124511719
r_  generation:  0.4875328540802002
local_output_nid generation:  0.029548168182373047
local_in_edges_tensor generation:  0.04280829429626465
mini_batch_src_global generation:  0.056519269943237305
r_  generation:  0.49325060844421387
local_output_nid generation:  0.029974937438964844
local_in_edges_tensor generation:  0.030217409133911133
mini_batch_src_global generation:  0.06841826438903809
r_  generation:  0.48709774017333984
local_output_nid generation:  0.031888484954833984
local_in_edges_tensor generation:  0.030494213104248047
mini_batch_src_global generation:  0.056349754333496094
r_  generation:  0.4924125671386719
local_output_nid generation:  0.03102564811706543
local_in_edges_tensor generation:  0.04335427284240723
mini_batch_src_global generation:  0.0572352409362793
r_  generation:  0.4892466068267822
local_output_nid generation:  0.030728816986083984
local_in_edges_tensor generation:  0.03255891799926758
mini_batch_src_global generation:  0.07212018966674805
r_  generation:  0.5076730251312256
local_output_nid generation:  0.03119826316833496
local_in_edges_tensor generation:  0.03461050987243652
mini_batch_src_global generation:  0.05976271629333496
r_  generation:  0.4966239929199219
local_output_nid generation:  0.031450510025024414
local_in_edges_tensor generation:  0.0389866828918457
mini_batch_src_global generation:  0.05671262741088867
r_  generation:  0.5274105072021484
local_output_nid generation:  0.031586408615112305
local_in_edges_tensor generation:  0.047025203704833984
mini_batch_src_global generation:  0.05849814414978027
r_  generation:  0.5303387641906738
local_output_nid generation:  0.034735918045043945
local_in_edges_tensor generation:  0.04002857208251953
mini_batch_src_global generation:  0.07269573211669922
r_  generation:  0.5133061408996582
local_output_nid generation:  0.03322339057922363
local_in_edges_tensor generation:  0.047417402267456055
mini_batch_src_global generation:  0.05785870552062988
r_  generation:  0.530163049697876
local_output_nid generation:  0.03445148468017578
local_in_edges_tensor generation:  0.04559206962585449
mini_batch_src_global generation:  0.0596621036529541
r_  generation:  0.5050077438354492
local_output_nid generation:  0.03155350685119629
local_in_edges_tensor generation:  0.035933732986450195
mini_batch_src_global generation:  0.07772493362426758
r_  generation:  0.4924168586730957
----------------------check_connections_block total spend ----------------------------- 11.86565637588501
generate_one_block  0.6443943977355957
generate_one_block  0.6525886058807373
generate_one_block  0.637775182723999
generate_one_block  0.6506969928741455
generate_one_block  0.6607639789581299
generate_one_block  0.645017147064209
generate_one_block  0.6778342723846436
generate_one_block  0.6278538703918457
generate_one_block  0.6344611644744873
generate_one_block  0.6375374794006348
generate_one_block  0.6412370204925537
generate_one_block  0.6484761238098145
generate_one_block  0.6291582584381104
generate_one_block  0.6410753726959229
generate_one_block  0.6405684947967529
generate_one_block  0.6331193447113037
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04061150550842285
gen group dst list time:  0.10097098350524902
time for parepare:  0.0197293758392334
local_output_nid generation:  0.031612396240234375
local_in_edges_tensor generation:  0.05247640609741211
mini_batch_src_global generation:  0.0449833869934082
r_  generation:  0.48834776878356934
local_output_nid generation:  0.037070274353027344
local_in_edges_tensor generation:  0.03363227844238281
mini_batch_src_global generation:  0.05856609344482422
r_  generation:  0.49440813064575195
local_output_nid generation:  0.03613877296447754
local_in_edges_tensor generation:  0.03932476043701172
mini_batch_src_global generation:  0.05408215522766113
r_  generation:  0.5003201961517334
local_output_nid generation:  0.036893367767333984
local_in_edges_tensor generation:  0.0348505973815918
mini_batch_src_global generation:  0.053304195404052734
r_  generation:  0.513608455657959
local_output_nid generation:  0.03714275360107422
local_in_edges_tensor generation:  0.03931617736816406
mini_batch_src_global generation:  0.05411362648010254
r_  generation:  0.5070414543151855
local_output_nid generation:  0.03707742691040039
local_in_edges_tensor generation:  0.043618202209472656
mini_batch_src_global generation:  0.057131052017211914
r_  generation:  0.5091774463653564
local_output_nid generation:  0.03749847412109375
local_in_edges_tensor generation:  0.04312920570373535
mini_batch_src_global generation:  0.05386638641357422
r_  generation:  0.5154085159301758
local_output_nid generation:  0.037155866622924805
local_in_edges_tensor generation:  0.043364763259887695
mini_batch_src_global generation:  0.054901123046875
r_  generation:  0.5160732269287109
local_output_nid generation:  0.04013347625732422
local_in_edges_tensor generation:  0.04268693923950195
mini_batch_src_global generation:  0.05607271194458008
r_  generation:  0.5323641300201416
local_output_nid generation:  0.037474870681762695
local_in_edges_tensor generation:  0.03606367111206055
mini_batch_src_global generation:  0.055857181549072266
r_  generation:  0.5166754722595215
local_output_nid generation:  0.037941694259643555
local_in_edges_tensor generation:  0.04106926918029785
mini_batch_src_global generation:  0.058928728103637695
r_  generation:  0.5333826541900635
local_output_nid generation:  0.0387425422668457
local_in_edges_tensor generation:  0.039186954498291016
mini_batch_src_global generation:  0.05579781532287598
r_  generation:  0.5189805030822754
local_output_nid generation:  0.037534236907958984
local_in_edges_tensor generation:  0.03469109535217285
mini_batch_src_global generation:  0.057628631591796875
r_  generation:  0.5237514972686768
local_output_nid generation:  0.03786802291870117
local_in_edges_tensor generation:  0.0392003059387207
mini_batch_src_global generation:  0.05878329277038574
r_  generation:  0.5219764709472656
local_output_nid generation:  0.038721561431884766
local_in_edges_tensor generation:  0.04819989204406738
mini_batch_src_global generation:  0.05560040473937988
r_  generation:  0.5241725444793701
local_output_nid generation:  0.03812003135681152
local_in_edges_tensor generation:  0.039292097091674805
mini_batch_src_global generation:  0.0563814640045166
r_  generation:  0.5204989910125732
----------------------check_connections_block total spend ----------------------------- 12.290312767028809
generate_one_block  0.6272318363189697
generate_one_block  0.7020750045776367
generate_one_block  0.646106481552124
generate_one_block  0.638221263885498
generate_one_block  0.6242127418518066
generate_one_block  0.6464111804962158
generate_one_block  0.6394410133361816
generate_one_block  0.6460278034210205
generate_one_block  0.6408901214599609
generate_one_block  0.6241729259490967
generate_one_block  0.6388986110687256
generate_one_block  0.6371161937713623
generate_one_block  0.6209361553192139
generate_one_block  0.6413178443908691
generate_one_block  0.6833250522613525
generate_one_block  0.6369783878326416
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.002379894256591797  GigaBytes
Max Memory Allocated: 0.002379894256591797  GigaBytes

connection checking time:  29.214558601379395
block generation total time  25.106871128082275
average batch blocks generation time:  1.5691794455051422
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2010498046875 GB
    Memory Allocated: 0.10899829864501953  GigaBytes
Max Memory Allocated: 0.10899829864501953  GigaBytes

torch.Size([163388, 128])
torch.Size([155157, 128])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 22.00 MiB (GPU 0; 23.62 GiB total capacity; 22.31 GiB already allocated; 18.44 MiB free; 22.40 GiB reserved in total by PyTorch)
