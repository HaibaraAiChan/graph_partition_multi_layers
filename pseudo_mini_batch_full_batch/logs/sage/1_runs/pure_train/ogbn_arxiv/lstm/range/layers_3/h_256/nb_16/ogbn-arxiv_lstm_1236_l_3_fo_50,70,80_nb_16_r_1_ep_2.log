Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648477112.2648003
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.026428937911987305
range selection method range initialization spend 0.013722658157348633
time for parepare:  0.0179593563079834
local_output_nid generation:  0.0013377666473388672
local_in_edges_tensor generation:  0.0033926963806152344
mini_batch_src_global generation:  0.001995563507080078
r_  generation:  0.021494150161743164
local_output_nid generation:  0.0016129016876220703
local_in_edges_tensor generation:  0.0009627342224121094
mini_batch_src_global generation:  0.0023610591888427734
r_  generation:  0.02032923698425293
local_output_nid generation:  0.0015554428100585938
local_in_edges_tensor generation:  0.000904083251953125
mini_batch_src_global generation:  0.0015056133270263672
r_  generation:  0.020267963409423828
local_output_nid generation:  0.001569986343383789
local_in_edges_tensor generation:  0.0008742809295654297
mini_batch_src_global generation:  0.0015153884887695312
r_  generation:  0.020917177200317383
local_output_nid generation:  0.0015711784362792969
local_in_edges_tensor generation:  0.0009105205535888672
mini_batch_src_global generation:  0.0015149116516113281
r_  generation:  0.020896196365356445
local_output_nid generation:  0.001558542251586914
local_in_edges_tensor generation:  0.0008702278137207031
mini_batch_src_global generation:  0.0016529560089111328
r_  generation:  0.02193927764892578
local_output_nid generation:  0.0015611648559570312
local_in_edges_tensor generation:  0.0009043216705322266
mini_batch_src_global generation:  0.0016717910766601562
r_  generation:  0.02206254005432129
local_output_nid generation:  0.0015802383422851562
local_in_edges_tensor generation:  0.0008842945098876953
mini_batch_src_global generation:  0.0017254352569580078
r_  generation:  0.021834611892700195
local_output_nid generation:  0.0015566349029541016
local_in_edges_tensor generation:  0.0009150505065917969
mini_batch_src_global generation:  0.0016510486602783203
r_  generation:  0.02189922332763672
local_output_nid generation:  0.0015764236450195312
local_in_edges_tensor generation:  0.0008642673492431641
mini_batch_src_global generation:  0.0016624927520751953
r_  generation:  0.021532773971557617
local_output_nid generation:  0.001588582992553711
local_in_edges_tensor generation:  0.0008828639984130859
mini_batch_src_global generation:  0.0017058849334716797
r_  generation:  0.022091388702392578
local_output_nid generation:  0.0015871524810791016
local_in_edges_tensor generation:  0.0008854866027832031
mini_batch_src_global generation:  0.0016388893127441406
r_  generation:  0.021261215209960938
local_output_nid generation:  0.0015544891357421875
local_in_edges_tensor generation:  0.0008914470672607422
mini_batch_src_global generation:  0.0017032623291015625
r_  generation:  0.02240300178527832
local_output_nid generation:  0.0015840530395507812
local_in_edges_tensor generation:  0.0008854866027832031
mini_batch_src_global generation:  0.0016911029815673828
r_  generation:  0.02173018455505371
local_output_nid generation:  0.001544952392578125
local_in_edges_tensor generation:  0.0008511543273925781
mini_batch_src_global generation:  0.0016994476318359375
r_  generation:  0.021839618682861328
local_output_nid generation:  0.0015587806701660156
local_in_edges_tensor generation:  0.0008878707885742188
mini_batch_src_global generation:  0.001779794692993164
r_  generation:  0.02206277847290039
----------------------check_connections_block total spend ----------------------------- 0.5071043968200684
generate_one_block  0.030376672744750977
generate_one_block  0.030838727951049805
generate_one_block  0.03227353096008301
generate_one_block  0.03156852722167969
generate_one_block  0.03104686737060547
generate_one_block  0.03181290626525879
generate_one_block  0.032120466232299805
generate_one_block  0.031717777252197266
generate_one_block  0.03130602836608887
generate_one_block  0.031246662139892578
generate_one_block  0.031706809997558594
generate_one_block  0.030439376831054688
generate_one_block  0.03200840950012207
generate_one_block  0.031080007553100586
generate_one_block  0.031002283096313477
generate_one_block  0.030876874923706055
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04039120674133301
gen group dst list time:  0.020637035369873047
time for parepare:  0.019042491912841797
local_output_nid generation:  0.007274627685546875
local_in_edges_tensor generation:  0.017554044723510742
mini_batch_src_global generation:  0.025043249130249023
r_  generation:  0.24651122093200684
local_output_nid generation:  0.011193990707397461
local_in_edges_tensor generation:  0.021323442459106445
mini_batch_src_global generation:  0.03130459785461426
r_  generation:  0.24860429763793945
local_output_nid generation:  0.01162409782409668
local_in_edges_tensor generation:  0.02051568031311035
mini_batch_src_global generation:  0.030631303787231445
r_  generation:  0.25818419456481934
local_output_nid generation:  0.012026786804199219
local_in_edges_tensor generation:  0.015586137771606445
mini_batch_src_global generation:  0.03614211082458496
r_  generation:  0.2626950740814209
local_output_nid generation:  0.012250185012817383
local_in_edges_tensor generation:  0.020310401916503906
mini_batch_src_global generation:  0.03295302391052246
r_  generation:  0.2756221294403076
local_output_nid generation:  0.012648820877075195
local_in_edges_tensor generation:  0.01647162437438965
mini_batch_src_global generation:  0.034751176834106445
r_  generation:  0.27447080612182617
local_output_nid generation:  0.012450456619262695
local_in_edges_tensor generation:  0.02141857147216797
mini_batch_src_global generation:  0.034149169921875
r_  generation:  0.27114176750183105
local_output_nid generation:  0.012777328491210938
local_in_edges_tensor generation:  0.014245748519897461
mini_batch_src_global generation:  0.03456282615661621
r_  generation:  0.26996684074401855
local_output_nid generation:  0.01276707649230957
local_in_edges_tensor generation:  0.013855218887329102
mini_batch_src_global generation:  0.034044504165649414
r_  generation:  0.2716212272644043
local_output_nid generation:  0.01253652572631836
local_in_edges_tensor generation:  0.013822078704833984
mini_batch_src_global generation:  0.033762216567993164
r_  generation:  0.26865363121032715
local_output_nid generation:  0.01280069351196289
local_in_edges_tensor generation:  0.018986940383911133
mini_batch_src_global generation:  0.03618192672729492
r_  generation:  0.27121734619140625
local_output_nid generation:  0.012535572052001953
local_in_edges_tensor generation:  0.013941049575805664
mini_batch_src_global generation:  0.03340888023376465
r_  generation:  0.2608788013458252
local_output_nid generation:  0.012856006622314453
local_in_edges_tensor generation:  0.01932048797607422
mini_batch_src_global generation:  0.033864736557006836
r_  generation:  0.2697563171386719
local_output_nid generation:  0.012982368469238281
local_in_edges_tensor generation:  0.02118086814880371
mini_batch_src_global generation:  0.034676551818847656
r_  generation:  0.26883959770202637
local_output_nid generation:  0.012794017791748047
local_in_edges_tensor generation:  0.016571998596191406
mini_batch_src_global generation:  0.03400421142578125
r_  generation:  0.2703430652618408
local_output_nid generation:  0.01280069351196289
local_in_edges_tensor generation:  0.01656818389892578
mini_batch_src_global generation:  0.03620290756225586
r_  generation:  0.26796746253967285
----------------------check_connections_block total spend ----------------------------- 6.194509983062744
generate_one_block  0.3509485721588135
generate_one_block  0.3409712314605713
generate_one_block  0.3487997055053711
generate_one_block  0.3552083969116211
generate_one_block  0.3626058101654053
generate_one_block  0.36731600761413574
generate_one_block  0.3558354377746582
generate_one_block  0.3554866313934326
generate_one_block  0.3449428081512451
generate_one_block  0.35156893730163574
generate_one_block  0.35742735862731934
generate_one_block  0.33690690994262695
generate_one_block  0.3537478446960449
generate_one_block  0.35689735412597656
generate_one_block  0.34977102279663086
generate_one_block  0.3500182628631592
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03967618942260742
gen group dst list time:  0.06258273124694824
time for parepare:  0.018900632858276367
local_output_nid generation:  0.024569988250732422
local_in_edges_tensor generation:  0.04030919075012207
mini_batch_src_global generation:  0.0533139705657959
r_  generation:  0.5109853744506836
local_output_nid generation:  0.03128504753112793
local_in_edges_tensor generation:  0.05062675476074219
mini_batch_src_global generation:  0.06157684326171875
r_  generation:  0.5165178775787354
local_output_nid generation:  0.031084299087524414
local_in_edges_tensor generation:  0.042066335678100586
mini_batch_src_global generation:  0.06097579002380371
r_  generation:  0.5259532928466797
local_output_nid generation:  0.03155398368835449
local_in_edges_tensor generation:  0.042905569076538086
mini_batch_src_global generation:  0.058704376220703125
r_  generation:  0.5312457084655762
local_output_nid generation:  0.03129935264587402
local_in_edges_tensor generation:  0.03290510177612305
mini_batch_src_global generation:  0.060357093811035156
r_  generation:  0.5313587188720703
local_output_nid generation:  0.031441450119018555
local_in_edges_tensor generation:  0.0372161865234375
mini_batch_src_global generation:  0.06453728675842285
r_  generation:  0.5373637676239014
local_output_nid generation:  0.03154730796813965
local_in_edges_tensor generation:  0.04235982894897461
mini_batch_src_global generation:  0.060144901275634766
r_  generation:  0.5362551212310791
local_output_nid generation:  0.03142571449279785
local_in_edges_tensor generation:  0.032456398010253906
mini_batch_src_global generation:  0.061766624450683594
r_  generation:  0.532156229019165
local_output_nid generation:  0.03169107437133789
local_in_edges_tensor generation:  0.03293466567993164
mini_batch_src_global generation:  0.06599211692810059
r_  generation:  0.5383462905883789
local_output_nid generation:  0.031881093978881836
local_in_edges_tensor generation:  0.04829549789428711
mini_batch_src_global generation:  0.06424069404602051
r_  generation:  0.5673859119415283
local_output_nid generation:  0.03318190574645996
local_in_edges_tensor generation:  0.04642820358276367
mini_batch_src_global generation:  0.0639810562133789
r_  generation:  0.5370137691497803
local_output_nid generation:  0.03237152099609375
local_in_edges_tensor generation:  0.038906097412109375
mini_batch_src_global generation:  0.06132340431213379
r_  generation:  0.5387065410614014
local_output_nid generation:  0.03255438804626465
local_in_edges_tensor generation:  0.031397342681884766
mini_batch_src_global generation:  0.06156802177429199
r_  generation:  0.5401937961578369
local_output_nid generation:  0.03490614891052246
local_in_edges_tensor generation:  0.035780906677246094
mini_batch_src_global generation:  0.06292366981506348
r_  generation:  0.5407421588897705
local_output_nid generation:  0.03287005424499512
local_in_edges_tensor generation:  0.03654289245605469
mini_batch_src_global generation:  0.061864376068115234
r_  generation:  0.5425276756286621
local_output_nid generation:  0.033307552337646484
local_in_edges_tensor generation:  0.04124879837036133
mini_batch_src_global generation:  0.0614466667175293
r_  generation:  0.5450701713562012
----------------------check_connections_block total spend ----------------------------- 12.597711563110352
generate_one_block  0.6787879467010498
generate_one_block  0.6853744983673096
generate_one_block  0.6951999664306641
generate_one_block  0.7457075119018555
generate_one_block  0.7118780612945557
generate_one_block  0.7182471752166748
generate_one_block  0.7552266120910645
generate_one_block  0.710925817489624
generate_one_block  0.689018726348877
generate_one_block  0.6872508525848389
generate_one_block  0.6983208656311035
generate_one_block  0.683844804763794
generate_one_block  0.7018003463745117
generate_one_block  0.7091572284698486
generate_one_block  0.6996488571166992
generate_one_block  0.6964139938354492
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  18.792221546173096
block generation total time  16.905255556106567
average batch blocks generation time:  1.0565784722566605
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1815185546875 GB
    Memory Allocated: 0.10039758682250977  GigaBytes
Max Memory Allocated: 0.10039758682250977  GigaBytes

torch.Size([157560, 128])
torch.Size([129942, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 23.62 GiB total capacity; 22.28 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
