Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648527474.7416759
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.003612995147705078  GigaBytes
Max Memory Allocated: 0.003612995147705078  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.024721384048461914
range selection method range initialization spend 0.013175487518310547
time for parepare:  0.0175931453704834
local_output_nid generation:  0.005268573760986328
local_in_edges_tensor generation:  0.0059261322021484375
mini_batch_src_global generation:  0.006449460983276367
r_  generation:  0.08394432067871094
local_output_nid generation:  0.005999326705932617
local_in_edges_tensor generation:  0.003010988235473633
mini_batch_src_global generation:  0.00877237319946289
r_  generation:  0.08799099922180176
local_output_nid generation:  0.006061077117919922
local_in_edges_tensor generation:  0.0029859542846679688
mini_batch_src_global generation:  0.006387948989868164
r_  generation:  0.08925056457519531
local_output_nid generation:  0.006101369857788086
local_in_edges_tensor generation:  0.002984285354614258
mini_batch_src_global generation:  0.0067670345306396484
r_  generation:  0.09372735023498535
----------------------check_connections_block total spend ----------------------------- 0.5123183727264404
generate_one_block  0.10239624977111816
generate_one_block  0.1036076545715332
generate_one_block  0.10180425643920898
generate_one_block  0.10120224952697754
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.04060220718383789
gen group dst list time:  0.011105775833129883
time for parepare:  0.019617080688476562
local_output_nid generation:  0.014871835708618164
local_in_edges_tensor generation:  0.03903698921203613
mini_batch_src_global generation:  0.03835105895996094
r_  generation:  0.40846920013427734
local_output_nid generation:  0.024708986282348633
local_in_edges_tensor generation:  0.03705143928527832
mini_batch_src_global generation:  0.04785776138305664
r_  generation:  0.41453123092651367
local_output_nid generation:  0.026264667510986328
local_in_edges_tensor generation:  0.030347108840942383
mini_batch_src_global generation:  0.048125267028808594
r_  generation:  0.4190976619720459
local_output_nid generation:  0.026987314224243164
local_in_edges_tensor generation:  0.027178525924682617
mini_batch_src_global generation:  0.0490264892578125
r_  generation:  0.423602819442749
----------------------check_connections_block total spend ----------------------------- 2.4535810947418213
generate_one_block  0.5647745132446289
generate_one_block  0.5510962009429932
generate_one_block  0.542050838470459
generate_one_block  0.5445775985717773
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.03767561912536621
gen group dst list time:  0.0207521915435791
time for parepare:  0.019591808319091797
local_output_nid generation:  0.02485179901123047
local_in_edges_tensor generation:  0.04688405990600586
mini_batch_src_global generation:  0.05456089973449707
r_  generation:  0.540640115737915
local_output_nid generation:  0.036583900451660156
local_in_edges_tensor generation:  0.05496525764465332
mini_batch_src_global generation:  0.06265687942504883
r_  generation:  0.5525825023651123
local_output_nid generation:  0.03837442398071289
local_in_edges_tensor generation:  0.04648280143737793
mini_batch_src_global generation:  0.056962013244628906
r_  generation:  0.5594959259033203
local_output_nid generation:  0.03887295722961426
local_in_edges_tensor generation:  0.04116392135620117
mini_batch_src_global generation:  0.059906959533691406
r_  generation:  0.555288553237915
----------------------check_connections_block total spend ----------------------------- 3.2630913257598877
generate_one_block  0.6941986083984375
generate_one_block  0.707261323928833
generate_one_block  0.701387882232666
generate_one_block  0.7042069435119629
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.036707401275634766
gen group dst list time:  0.023442506790161133
time for parepare:  0.01937127113342285
local_output_nid generation:  0.02734208106994629
local_in_edges_tensor generation:  0.03879427909851074
mini_batch_src_global generation:  0.05449247360229492
r_  generation:  0.5487873554229736
local_output_nid generation:  0.0361943244934082
local_in_edges_tensor generation:  0.05212736129760742
mini_batch_src_global generation:  0.06503129005432129
r_  generation:  0.5647461414337158
local_output_nid generation:  0.037435054779052734
local_in_edges_tensor generation:  0.045191287994384766
mini_batch_src_global generation:  0.06490349769592285
r_  generation:  0.5666224956512451
local_output_nid generation:  0.03721022605895996
local_in_edges_tensor generation:  0.0390317440032959
mini_batch_src_global generation:  0.06453084945678711
r_  generation:  0.5659821033477783
----------------------check_connections_block total spend ----------------------------- 3.3263373374938965
generate_one_block  0.7088515758514404
generate_one_block  0.7294116020202637
generate_one_block  0.7210803031921387
generate_one_block  0.7065300941467285
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.030262231826782227
gen group dst list time:  0.024327993392944336
time for parepare:  0.019711017608642578
local_output_nid generation:  0.028204679489135742
local_in_edges_tensor generation:  0.039571285247802734
mini_batch_src_global generation:  0.049584388732910156
r_  generation:  0.5468368530273438
local_output_nid generation:  0.03695559501647949
local_in_edges_tensor generation:  0.037542104721069336
mini_batch_src_global generation:  0.06299138069152832
r_  generation:  0.557811975479126
local_output_nid generation:  0.038164377212524414
local_in_edges_tensor generation:  0.04407215118408203
mini_batch_src_global generation:  0.06722640991210938
r_  generation:  0.5498056411743164
local_output_nid generation:  0.03806877136230469
local_in_edges_tensor generation:  0.03666114807128906
mini_batch_src_global generation:  0.0628809928894043
r_  generation:  0.5600345134735107
----------------------check_connections_block total spend ----------------------------- 3.2798709869384766
generate_one_block  0.690467357635498
generate_one_block  0.7100274562835693
generate_one_block  0.7067317962646484
generate_one_block  0.6844537258148193
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.029547929763793945
gen group dst list time:  0.025222301483154297
time for parepare:  0.019513368606567383
local_output_nid generation:  0.029893875122070312
local_in_edges_tensor generation:  0.03831958770751953
mini_batch_src_global generation:  0.045728206634521484
r_  generation:  0.515347957611084
local_output_nid generation:  0.037267208099365234
local_in_edges_tensor generation:  0.04209542274475098
mini_batch_src_global generation:  0.059142351150512695
r_  generation:  0.5189688205718994
local_output_nid generation:  0.03835153579711914
local_in_edges_tensor generation:  0.04309868812561035
mini_batch_src_global generation:  0.06056022644042969
r_  generation:  0.5112113952636719
local_output_nid generation:  0.038307905197143555
local_in_edges_tensor generation:  0.03308892250061035
mini_batch_src_global generation:  0.05845069885253906
r_  generation:  0.5161459445953369
----------------------check_connections_block total spend ----------------------------- 3.100231885910034
generate_one_block  0.645317554473877
generate_one_block  0.6920661926269531
generate_one_block  0.6426737308502197
generate_one_block  0.6298501491546631
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.003612995147705078  GigaBytes
Max Memory Allocated: 0.003612995147705078  GigaBytes

connection checking time:  15.423112630844116
block generation total time  13.277015447616577
average batch blocks generation time:  3.3192538619041443
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2440185546875 GB
    Memory Allocated: 0.14587020874023438  GigaBytes
Max Memory Allocated: 0.14587020874023438  GigaBytes

torch.Size([167777, 128])
torch.Size([167564, 128])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 438, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 434, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 253, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 23.62 GiB total capacity; 22.35 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
