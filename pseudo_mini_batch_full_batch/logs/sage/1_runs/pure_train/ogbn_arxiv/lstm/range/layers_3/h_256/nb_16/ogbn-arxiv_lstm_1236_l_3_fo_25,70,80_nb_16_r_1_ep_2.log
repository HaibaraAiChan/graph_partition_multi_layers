Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648476374.8421018
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.02690577507019043
range selection method range initialization spend 0.013161420822143555
time for parepare:  0.018083810806274414
local_output_nid generation:  0.0013556480407714844
local_in_edges_tensor generation:  0.004178524017333984
mini_batch_src_global generation:  0.001965045928955078
r_  generation:  0.020389080047607422
local_output_nid generation:  0.0014827251434326172
local_in_edges_tensor generation:  0.00096893310546875
mini_batch_src_global generation:  0.0023415088653564453
r_  generation:  0.019197702407836914
local_output_nid generation:  0.0014617443084716797
local_in_edges_tensor generation:  0.0008683204650878906
mini_batch_src_global generation:  0.0015497207641601562
r_  generation:  0.01969742774963379
local_output_nid generation:  0.0014834403991699219
local_in_edges_tensor generation:  0.0009028911590576172
mini_batch_src_global generation:  0.0015735626220703125
r_  generation:  0.019984722137451172
local_output_nid generation:  0.001478433609008789
local_in_edges_tensor generation:  0.0009083747863769531
mini_batch_src_global generation:  0.0014636516571044922
r_  generation:  0.019852161407470703
local_output_nid generation:  0.0015478134155273438
local_in_edges_tensor generation:  0.0008544921875
mini_batch_src_global generation:  0.0016515254974365234
r_  generation:  0.020564556121826172
local_output_nid generation:  0.0014848709106445312
local_in_edges_tensor generation:  0.0009365081787109375
mini_batch_src_global generation:  0.0016548633575439453
r_  generation:  0.021196365356445312
local_output_nid generation:  0.0015087127685546875
local_in_edges_tensor generation:  0.0009446144104003906
mini_batch_src_global generation:  0.0017294883728027344
r_  generation:  0.021112918853759766
local_output_nid generation:  0.001493692398071289
local_in_edges_tensor generation:  0.000881195068359375
mini_batch_src_global generation:  0.0016937255859375
r_  generation:  0.021373271942138672
local_output_nid generation:  0.0015044212341308594
local_in_edges_tensor generation:  0.0008955001831054688
mini_batch_src_global generation:  0.00168609619140625
r_  generation:  0.02086925506591797
local_output_nid generation:  0.0014955997467041016
local_in_edges_tensor generation:  0.0008609294891357422
mini_batch_src_global generation:  0.0016810894012451172
r_  generation:  0.021522045135498047
local_output_nid generation:  0.0015311241149902344
local_in_edges_tensor generation:  0.0008442401885986328
mini_batch_src_global generation:  0.0015387535095214844
r_  generation:  0.020762205123901367
local_output_nid generation:  0.0015149116516113281
local_in_edges_tensor generation:  0.0008580684661865234
mini_batch_src_global generation:  0.0016639232635498047
r_  generation:  0.02169322967529297
local_output_nid generation:  0.001508951187133789
local_in_edges_tensor generation:  0.0008950233459472656
mini_batch_src_global generation:  0.0017087459564208984
r_  generation:  0.021449804306030273
local_output_nid generation:  0.0015082359313964844
local_in_edges_tensor generation:  0.0008614063262939453
mini_batch_src_global generation:  0.0016460418701171875
r_  generation:  0.020865678787231445
local_output_nid generation:  0.0014925003051757812
local_in_edges_tensor generation:  0.0008611679077148438
mini_batch_src_global generation:  0.001718282699584961
r_  generation:  0.02118229866027832
----------------------check_connections_block total spend ----------------------------- 0.4916856288909912
generate_one_block  0.031034231185913086
generate_one_block  0.030217885971069336
generate_one_block  0.03200221061706543
generate_one_block  0.030985116958618164
generate_one_block  0.030875205993652344
generate_one_block  0.03127241134643555
generate_one_block  0.031697750091552734
generate_one_block  0.031087636947631836
generate_one_block  0.03066110610961914
generate_one_block  0.030550479888916016
generate_one_block  0.031164884567260742
generate_one_block  0.029702425003051758
generate_one_block  0.03141140937805176
generate_one_block  0.030777931213378906
generate_one_block  0.030693769454956055
generate_one_block  0.03041386604309082
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04381728172302246
gen group dst list time:  0.020639419555664062
time for parepare:  0.019630908966064453
local_output_nid generation:  0.007449150085449219
local_in_edges_tensor generation:  0.019817352294921875
mini_batch_src_global generation:  0.02521204948425293
r_  generation:  0.24663329124450684
local_output_nid generation:  0.013201236724853516
local_in_edges_tensor generation:  0.02199244499206543
mini_batch_src_global generation:  0.03160738945007324
r_  generation:  0.25091028213500977
local_output_nid generation:  0.013722658157348633
local_in_edges_tensor generation:  0.02016758918762207
mini_batch_src_global generation:  0.030536174774169922
r_  generation:  0.25662946701049805
local_output_nid generation:  0.014513015747070312
local_in_edges_tensor generation:  0.016243457794189453
mini_batch_src_global generation:  0.03185582160949707
r_  generation:  0.2628495693206787
local_output_nid generation:  0.018726348876953125
local_in_edges_tensor generation:  0.0207521915435791
mini_batch_src_global generation:  0.03328990936279297
r_  generation:  0.26479125022888184
local_output_nid generation:  0.015238523483276367
local_in_edges_tensor generation:  0.017282724380493164
mini_batch_src_global generation:  0.03640890121459961
r_  generation:  0.27259159088134766
local_output_nid generation:  0.015027046203613281
local_in_edges_tensor generation:  0.018776893615722656
mini_batch_src_global generation:  0.03373217582702637
r_  generation:  0.2714707851409912
local_output_nid generation:  0.015162229537963867
local_in_edges_tensor generation:  0.017005205154418945
mini_batch_src_global generation:  0.03441309928894043
r_  generation:  0.2686636447906494
local_output_nid generation:  0.015234947204589844
local_in_edges_tensor generation:  0.014687538146972656
mini_batch_src_global generation:  0.03404641151428223
r_  generation:  0.2658827304840088
local_output_nid generation:  0.015090465545654297
local_in_edges_tensor generation:  0.014045238494873047
mini_batch_src_global generation:  0.03765535354614258
r_  generation:  0.2659921646118164
local_output_nid generation:  0.015194416046142578
local_in_edges_tensor generation:  0.01887345314025879
mini_batch_src_global generation:  0.03602266311645508
r_  generation:  0.2722761631011963
local_output_nid generation:  0.015065670013427734
local_in_edges_tensor generation:  0.014145612716674805
mini_batch_src_global generation:  0.03389143943786621
r_  generation:  0.2615664005279541
local_output_nid generation:  0.015529632568359375
local_in_edges_tensor generation:  0.016393184661865234
mini_batch_src_global generation:  0.03409528732299805
r_  generation:  0.2685563564300537
local_output_nid generation:  0.01549839973449707
local_in_edges_tensor generation:  0.019365549087524414
mini_batch_src_global generation:  0.034310102462768555
r_  generation:  0.2702758312225342
local_output_nid generation:  0.015289306640625
local_in_edges_tensor generation:  0.014396429061889648
mini_batch_src_global generation:  0.03452157974243164
r_  generation:  0.26581883430480957
local_output_nid generation:  0.015277624130249023
local_in_edges_tensor generation:  0.016875743865966797
mini_batch_src_global generation:  0.033743858337402344
r_  generation:  0.268268346786499
----------------------check_connections_block total spend ----------------------------- 6.2239909172058105
generate_one_block  0.3572425842285156
generate_one_block  0.34549498558044434
generate_one_block  0.3531961441040039
generate_one_block  0.36388492584228516
generate_one_block  0.3685929775238037
generate_one_block  0.3710167407989502
generate_one_block  0.36332178115844727
generate_one_block  0.3591485023498535
generate_one_block  0.3484058380126953
generate_one_block  0.34982776641845703
generate_one_block  0.36609768867492676
generate_one_block  0.3434145450592041
generate_one_block  0.3545832633972168
generate_one_block  0.3628392219543457
generate_one_block  0.35958194732666016
generate_one_block  0.35589170455932617
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03622031211853027
gen group dst list time:  0.06317520141601562
time for parepare:  0.01908588409423828
local_output_nid generation:  0.02543020248413086
local_in_edges_tensor generation:  0.04004788398742676
mini_batch_src_global generation:  0.04345297813415527
r_  generation:  0.45366477966308594
local_output_nid generation:  0.03087782859802246
local_in_edges_tensor generation:  0.04656481742858887
mini_batch_src_global generation:  0.052408456802368164
r_  generation:  0.4524073600769043
local_output_nid generation:  0.03470802307128906
local_in_edges_tensor generation:  0.04324746131896973
mini_batch_src_global generation:  0.05379772186279297
r_  generation:  0.46550750732421875
local_output_nid generation:  0.03175640106201172
local_in_edges_tensor generation:  0.04064464569091797
mini_batch_src_global generation:  0.051534414291381836
r_  generation:  0.46791505813598633
local_output_nid generation:  0.031146526336669922
local_in_edges_tensor generation:  0.03167295455932617
mini_batch_src_global generation:  0.05259084701538086
r_  generation:  0.4731180667877197
local_output_nid generation:  0.032085418701171875
local_in_edges_tensor generation:  0.03826713562011719
mini_batch_src_global generation:  0.055216312408447266
r_  generation:  0.4686095714569092
local_output_nid generation:  0.03145337104797363
local_in_edges_tensor generation:  0.04134869575500488
mini_batch_src_global generation:  0.05234408378601074
r_  generation:  0.4756336212158203
local_output_nid generation:  0.03225851058959961
local_in_edges_tensor generation:  0.03377866744995117
mini_batch_src_global generation:  0.05659914016723633
r_  generation:  0.47201991081237793
local_output_nid generation:  0.0339810848236084
local_in_edges_tensor generation:  0.03086376190185547
mini_batch_src_global generation:  0.052904605865478516
r_  generation:  0.472240686416626
local_output_nid generation:  0.03269171714782715
local_in_edges_tensor generation:  0.03330039978027344
mini_batch_src_global generation:  0.05425381660461426
r_  generation:  0.4766077995300293
local_output_nid generation:  0.03275346755981445
local_in_edges_tensor generation:  0.04131054878234863
mini_batch_src_global generation:  0.053731679916381836
r_  generation:  0.4790167808532715
local_output_nid generation:  0.0317835807800293
local_in_edges_tensor generation:  0.04984426498413086
mini_batch_src_global generation:  0.0550844669342041
r_  generation:  0.47150397300720215
local_output_nid generation:  0.03236198425292969
local_in_edges_tensor generation:  0.03350996971130371
mini_batch_src_global generation:  0.05353903770446777
r_  generation:  0.477222204208374
local_output_nid generation:  0.032750606536865234
local_in_edges_tensor generation:  0.03302717208862305
mini_batch_src_global generation:  0.05366969108581543
r_  generation:  0.4893989562988281
local_output_nid generation:  0.03217625617980957
local_in_edges_tensor generation:  0.0361173152923584
mini_batch_src_global generation:  0.056680917739868164
r_  generation:  0.47451233863830566
local_output_nid generation:  0.03273916244506836
local_in_edges_tensor generation:  0.03631472587585449
mini_batch_src_global generation:  0.05365777015686035
r_  generation:  0.47694873809814453
----------------------check_connections_block total spend ----------------------------- 11.214197635650635
generate_one_block  0.6013672351837158
generate_one_block  0.602363109588623
generate_one_block  0.596865177154541
generate_one_block  0.5997202396392822
generate_one_block  0.5863704681396484
generate_one_block  0.6175591945648193
generate_one_block  0.6493442058563232
generate_one_block  0.5944046974182129
generate_one_block  0.5939152240753174
generate_one_block  0.5832197666168213
generate_one_block  0.6022820472717285
generate_one_block  0.5892543792724609
generate_one_block  0.5980875492095947
generate_one_block  0.607952356338501
generate_one_block  0.5874929428100586
generate_one_block  0.5928318500518799
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  17.438188552856445
block generation total time  15.325571060180664
average batch blocks generation time:  0.9578481912612915
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1815185546875 GB
    Memory Allocated: 0.0977182388305664  GigaBytes
Max Memory Allocated: 0.0977182388305664  GigaBytes

torch.Size([156755, 128])
torch.Size([129905, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.37 GiB already allocated; 8.44 MiB free; 22.42 GiB reserved in total by PyTorch)
