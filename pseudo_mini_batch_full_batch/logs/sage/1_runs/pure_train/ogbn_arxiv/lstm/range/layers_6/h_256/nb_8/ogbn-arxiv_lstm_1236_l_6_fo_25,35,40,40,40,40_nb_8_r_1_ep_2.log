Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648528359.7843692
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0291748046875 GB
    Memory Allocated: 0.012590885162353516  GigaBytes
Max Memory Allocated: 0.012590885162353516  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.024686813354492188
range selection method range initialization spend 0.013822317123413086
time for parepare:  0.018198728561401367
local_output_nid generation:  0.002668619155883789
local_in_edges_tensor generation:  0.004704713821411133
mini_batch_src_global generation:  0.003393888473510742
r_  generation:  0.038175344467163086
local_output_nid generation:  0.003048419952392578
local_in_edges_tensor generation:  0.0016121864318847656
mini_batch_src_global generation:  0.004165172576904297
r_  generation:  0.03912234306335449
local_output_nid generation:  0.0031549930572509766
local_in_edges_tensor generation:  0.0016350746154785156
mini_batch_src_global generation:  0.002827882766723633
r_  generation:  0.043546438217163086
local_output_nid generation:  0.003204345703125
local_in_edges_tensor generation:  0.001682281494140625
mini_batch_src_global generation:  0.003010272979736328
r_  generation:  0.041017770767211914
local_output_nid generation:  0.003148794174194336
local_in_edges_tensor generation:  0.0016112327575683594
mini_batch_src_global generation:  0.0031054019927978516
r_  generation:  0.040808916091918945
local_output_nid generation:  0.003191709518432617
local_in_edges_tensor generation:  0.0016436576843261719
mini_batch_src_global generation:  0.003175497055053711
r_  generation:  0.04087376594543457
local_output_nid generation:  0.0031995773315429688
local_in_edges_tensor generation:  0.0016398429870605469
mini_batch_src_global generation:  0.0032231807708740234
r_  generation:  0.041060686111450195
local_output_nid generation:  0.0031011104583740234
local_in_edges_tensor generation:  0.0017120838165283203
mini_batch_src_global generation:  0.0031404495239257812
r_  generation:  0.040291547775268555
----------------------check_connections_block total spend ----------------------------- 0.47823357582092285
generate_one_block  0.054639339447021484
generate_one_block  0.05467557907104492
generate_one_block  0.05529165267944336
generate_one_block  0.05589914321899414
generate_one_block  0.057599544525146484
generate_one_block  0.05414581298828125
generate_one_block  0.055217742919921875
generate_one_block  0.05379509925842285
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.04105257987976074
gen group dst list time:  0.015361547470092773
time for parepare:  0.01952648162841797
local_output_nid generation:  0.01062917709350586
local_in_edges_tensor generation:  0.029816150665283203
mini_batch_src_global generation:  0.03122878074645996
r_  generation:  0.2994711399078369
local_output_nid generation:  0.017603397369384766
local_in_edges_tensor generation:  0.02701282501220703
mini_batch_src_global generation:  0.03675389289855957
r_  generation:  0.3098127841949463
local_output_nid generation:  0.01851820945739746
local_in_edges_tensor generation:  0.025444984436035156
mini_batch_src_global generation:  0.04895496368408203
r_  generation:  0.31758809089660645
local_output_nid generation:  0.02273845672607422
local_in_edges_tensor generation:  0.02071666717529297
mini_batch_src_global generation:  0.040659427642822266
r_  generation:  0.325453519821167
local_output_nid generation:  0.019317626953125
local_in_edges_tensor generation:  0.018185853958129883
mini_batch_src_global generation:  0.03795337677001953
r_  generation:  0.31824803352355957
local_output_nid generation:  0.019309520721435547
local_in_edges_tensor generation:  0.0180511474609375
mini_batch_src_global generation:  0.038900136947631836
r_  generation:  0.31315183639526367
local_output_nid generation:  0.01958632469177246
local_in_edges_tensor generation:  0.023278474807739258
mini_batch_src_global generation:  0.04080343246459961
r_  generation:  0.32269859313964844
local_output_nid generation:  0.01955437660217285
local_in_edges_tensor generation:  0.020163297653198242
mini_batch_src_global generation:  0.03920269012451172
r_  generation:  0.3250157833099365
----------------------check_connections_block total spend ----------------------------- 3.7314114570617676
generate_one_block  0.4145345687866211
generate_one_block  0.4011106491088867
generate_one_block  0.41933512687683105
generate_one_block  0.4186270236968994
generate_one_block  0.4012918472290039
generate_one_block  0.4156067371368408
generate_one_block  0.4119420051574707
generate_one_block  0.39934778213500977
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.04052138328552246
gen group dst list time:  0.036191463470458984
time for parepare:  0.01919841766357422
local_output_nid generation:  0.02523040771484375
local_in_edges_tensor generation:  0.04220318794250488
mini_batch_src_global generation:  0.054523468017578125
r_  generation:  0.522209644317627
local_output_nid generation:  0.03180527687072754
local_in_edges_tensor generation:  0.04989957809448242
mini_batch_src_global generation:  0.060599565505981445
r_  generation:  0.5395650863647461
local_output_nid generation:  0.032413482666015625
local_in_edges_tensor generation:  0.03689885139465332
mini_batch_src_global generation:  0.06109762191772461
r_  generation:  0.5448768138885498
local_output_nid generation:  0.03283238410949707
local_in_edges_tensor generation:  0.037172794342041016
mini_batch_src_global generation:  0.06408834457397461
r_  generation:  0.5337252616882324
local_output_nid generation:  0.033118486404418945
local_in_edges_tensor generation:  0.03274965286254883
mini_batch_src_global generation:  0.05970883369445801
r_  generation:  0.546900749206543
local_output_nid generation:  0.03312945365905762
local_in_edges_tensor generation:  0.03194618225097656
mini_batch_src_global generation:  0.06262445449829102
r_  generation:  0.5395209789276123
local_output_nid generation:  0.03323936462402344
local_in_edges_tensor generation:  0.04688549041748047
mini_batch_src_global generation:  0.05945730209350586
r_  generation:  0.5524640083312988
local_output_nid generation:  0.03336834907531738
local_in_edges_tensor generation:  0.03847837448120117
mini_batch_src_global generation:  0.06229734420776367
r_  generation:  0.5387187004089355
----------------------check_connections_block total spend ----------------------------- 6.326083421707153
generate_one_block  0.6713428497314453
generate_one_block  0.6901183128356934
generate_one_block  0.6899163722991943
generate_one_block  0.687110424041748
generate_one_block  0.6668598651885986
generate_one_block  0.6683390140533447
generate_one_block  0.7226822376251221
generate_one_block  0.6908829212188721
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.035401105880737305
gen group dst list time:  0.044765472412109375
time for parepare:  0.019295454025268555
local_output_nid generation:  0.03119373321533203
local_in_edges_tensor generation:  0.04099440574645996
mini_batch_src_global generation:  0.055538177490234375
r_  generation:  0.5599238872528076
local_output_nid generation:  0.036507368087768555
local_in_edges_tensor generation:  0.05603981018066406
mini_batch_src_global generation:  0.06470775604248047
r_  generation:  0.5545539855957031
local_output_nid generation:  0.03640317916870117
local_in_edges_tensor generation:  0.04179811477661133
mini_batch_src_global generation:  0.06372976303100586
r_  generation:  0.5581133365631104
local_output_nid generation:  0.03680157661437988
local_in_edges_tensor generation:  0.042241811752319336
mini_batch_src_global generation:  0.06438350677490234
r_  generation:  0.5602850914001465
local_output_nid generation:  0.037023067474365234
local_in_edges_tensor generation:  0.04250645637512207
mini_batch_src_global generation:  0.06066751480102539
r_  generation:  0.5616869926452637
local_output_nid generation:  0.03724169731140137
local_in_edges_tensor generation:  0.03779125213623047
mini_batch_src_global generation:  0.060898780822753906
r_  generation:  0.5650348663330078
local_output_nid generation:  0.03693747520446777
local_in_edges_tensor generation:  0.04565286636352539
mini_batch_src_global generation:  0.062040090560913086
r_  generation:  0.5782146453857422
local_output_nid generation:  0.03783416748046875
local_in_edges_tensor generation:  0.053331851959228516
mini_batch_src_global generation:  0.06171846389770508
r_  generation:  0.57747483253479
----------------------check_connections_block total spend ----------------------------- 6.698620080947876
generate_one_block  0.7174327373504639
generate_one_block  0.715195894241333
generate_one_block  0.6981916427612305
generate_one_block  0.7032608985900879
generate_one_block  0.7642195224761963
generate_one_block  0.7093489170074463
generate_one_block  0.7661712169647217
generate_one_block  0.7687685489654541
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.07451725006103516
gen group dst list time:  0.05772113800048828
time for parepare:  0.019570589065551758
local_output_nid generation:  0.032622575759887695
local_in_edges_tensor generation:  0.0706641674041748
mini_batch_src_global generation:  0.05324816703796387
r_  generation:  0.5590605735778809
local_output_nid generation:  0.04123115539550781
local_in_edges_tensor generation:  0.05803346633911133
mini_batch_src_global generation:  0.0627293586730957
r_  generation:  0.5604462623596191
local_output_nid generation:  0.039691925048828125
local_in_edges_tensor generation:  0.04223275184631348
mini_batch_src_global generation:  0.06713223457336426
r_  generation:  0.574810266494751
local_output_nid generation:  0.04208540916442871
local_in_edges_tensor generation:  0.04825949668884277
mini_batch_src_global generation:  0.06558418273925781
r_  generation:  0.5525503158569336
local_output_nid generation:  0.0402979850769043
local_in_edges_tensor generation:  0.04499411582946777
mini_batch_src_global generation:  0.06408977508544922
r_  generation:  0.57637619972229
local_output_nid generation:  0.04013657569885254
local_in_edges_tensor generation:  0.04201698303222656
mini_batch_src_global generation:  0.06233382225036621
r_  generation:  0.5735151767730713
local_output_nid generation:  0.03998899459838867
local_in_edges_tensor generation:  0.04851984977722168
mini_batch_src_global generation:  0.06371498107910156
r_  generation:  0.5705866813659668
local_output_nid generation:  0.0417933464050293
local_in_edges_tensor generation:  0.03968930244445801
mini_batch_src_global generation:  0.0621795654296875
r_  generation:  0.5658929347991943
----------------------check_connections_block total spend ----------------------------- 6.813637018203735
generate_one_block  0.7151041030883789
generate_one_block  0.7112987041473389
generate_one_block  0.7103831768035889
generate_one_block  0.6971323490142822
generate_one_block  0.7116024494171143
generate_one_block  0.7091071605682373
generate_one_block  0.6949648857116699
generate_one_block  0.7515664100646973
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04446578025817871
gen group dst list time:  0.05125784873962402
time for parepare:  0.019666194915771484
local_output_nid generation:  0.03395557403564453
local_in_edges_tensor generation:  0.049208879470825195
mini_batch_src_global generation:  0.04659104347229004
r_  generation:  0.5129144191741943
local_output_nid generation:  0.040578365325927734
local_in_edges_tensor generation:  0.03385305404663086
mini_batch_src_global generation:  0.058911800384521484
r_  generation:  0.5193302631378174
local_output_nid generation:  0.03816986083984375
local_in_edges_tensor generation:  0.04107189178466797
mini_batch_src_global generation:  0.05996417999267578
r_  generation:  0.517690896987915
local_output_nid generation:  0.03849673271179199
local_in_edges_tensor generation:  0.042591094970703125
mini_batch_src_global generation:  0.05981326103210449
r_  generation:  0.5185365676879883
local_output_nid generation:  0.03879094123840332
local_in_edges_tensor generation:  0.04517388343811035
mini_batch_src_global generation:  0.06023716926574707
r_  generation:  0.5222601890563965
local_output_nid generation:  0.03975939750671387
local_in_edges_tensor generation:  0.050339698791503906
mini_batch_src_global generation:  0.0600285530090332
r_  generation:  0.5388543605804443
local_output_nid generation:  0.044064998626708984
local_in_edges_tensor generation:  0.04285907745361328
mini_batch_src_global generation:  0.06433939933776855
r_  generation:  0.5196006298065186
local_output_nid generation:  0.04029655456542969
local_in_edges_tensor generation:  0.042189836502075195
mini_batch_src_global generation:  0.05907416343688965
r_  generation:  0.5157365798950195
----------------------check_connections_block total spend ----------------------------- 6.2870283126831055
generate_one_block  0.6592772006988525
generate_one_block  0.6552681922912598
generate_one_block  0.651418924331665
generate_one_block  0.6408138275146484
generate_one_block  0.6571826934814453
generate_one_block  0.6502242088317871
generate_one_block  0.6544201374053955
generate_one_block  0.6304540634155273
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0291748046875 GB
    Memory Allocated: 0.012590885162353516  GigaBytes
Max Memory Allocated: 0.012590885162353516  GigaBytes

connection checking time:  29.856780290603638
block generation total time  25.511855602264404
average batch blocks generation time:  3.1889819502830505
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2518310546875 GB
    Memory Allocated: 0.15113449096679688  GigaBytes
Max Memory Allocated: 0.15113449096679688  GigaBytes

torch.Size([167529, 128])
torch.Size([167089, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 438, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 434, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 253, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 18.00 MiB (GPU 0; 23.62 GiB total capacity; 21.93 GiB already allocated; 16.44 MiB free; 22.41 GiB reserved in total by PyTorch)
