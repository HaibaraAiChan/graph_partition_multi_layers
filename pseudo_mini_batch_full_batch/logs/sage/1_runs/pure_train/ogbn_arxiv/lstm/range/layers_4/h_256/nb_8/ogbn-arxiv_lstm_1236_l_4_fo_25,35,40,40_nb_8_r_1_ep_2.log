Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648490257.5501473
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0233154296875 GB
    Memory Allocated: 0.007684230804443359  GigaBytes
Max Memory Allocated: 0.007684230804443359  GigaBytes

The real block id is  3
get_global_graph_edges_ids_block function  spend 0.025466203689575195
range selection method range initialization spend 0.013363361358642578
time for parepare:  0.018035888671875
local_output_nid generation:  0.0026502609252929688
local_in_edges_tensor generation:  0.004617214202880859
mini_batch_src_global generation:  0.0033164024353027344
r_  generation:  0.03793644905090332
local_output_nid generation:  0.0030667781829833984
local_in_edges_tensor generation:  0.0015902519226074219
mini_batch_src_global generation:  0.004006862640380859
r_  generation:  0.03791308403015137
local_output_nid generation:  0.003160715103149414
local_in_edges_tensor generation:  0.0016732215881347656
mini_batch_src_global generation:  0.002811908721923828
r_  generation:  0.03949785232543945
local_output_nid generation:  0.003126382827758789
local_in_edges_tensor generation:  0.0016570091247558594
mini_batch_src_global generation:  0.002768993377685547
r_  generation:  0.040400028228759766
local_output_nid generation:  0.003173828125
local_in_edges_tensor generation:  0.0016283988952636719
mini_batch_src_global generation:  0.0027968883514404297
r_  generation:  0.040413856506347656
local_output_nid generation:  0.003187417984008789
local_in_edges_tensor generation:  0.0017592906951904297
mini_batch_src_global generation:  0.003072500228881836
r_  generation:  0.040952205657958984
local_output_nid generation:  0.0031347274780273438
local_in_edges_tensor generation:  0.0016291141510009766
mini_batch_src_global generation:  0.003153085708618164
r_  generation:  0.04184985160827637
local_output_nid generation:  0.0032227039337158203
local_in_edges_tensor generation:  0.0016083717346191406
mini_batch_src_global generation:  0.003097057342529297
r_  generation:  0.041101932525634766
----------------------check_connections_block total spend ----------------------------- 0.47089457511901855
generate_one_block  0.054956912994384766
generate_one_block  0.05450892448425293
generate_one_block  0.055416107177734375
generate_one_block  0.0548858642578125
generate_one_block  0.056795358657836914
generate_one_block  0.055437326431274414
generate_one_block  0.05473804473876953
generate_one_block  0.055130720138549805
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.04245257377624512
gen group dst list time:  0.01517033576965332
time for parepare:  0.019628286361694336
local_output_nid generation:  0.010585784912109375
local_in_edges_tensor generation:  0.027644634246826172
mini_batch_src_global generation:  0.02816009521484375
r_  generation:  0.29955077171325684
local_output_nid generation:  0.018170833587646484
local_in_edges_tensor generation:  0.02889847755432129
mini_batch_src_global generation:  0.036136627197265625
r_  generation:  0.30889892578125
local_output_nid generation:  0.01886606216430664
local_in_edges_tensor generation:  0.02116560935974121
mini_batch_src_global generation:  0.0493016242980957
r_  generation:  0.3097536563873291
local_output_nid generation:  0.0194852352142334
local_in_edges_tensor generation:  0.02432703971862793
mini_batch_src_global generation:  0.03710675239562988
r_  generation:  0.32329583168029785
local_output_nid generation:  0.01979207992553711
local_in_edges_tensor generation:  0.02408289909362793
mini_batch_src_global generation:  0.03779292106628418
r_  generation:  0.31763172149658203
local_output_nid generation:  0.020177125930786133
local_in_edges_tensor generation:  0.024396896362304688
mini_batch_src_global generation:  0.038177490234375
r_  generation:  0.32062625885009766
local_output_nid generation:  0.020338058471679688
local_in_edges_tensor generation:  0.018802881240844727
mini_batch_src_global generation:  0.038556814193725586
r_  generation:  0.31676268577575684
local_output_nid generation:  0.020581722259521484
local_in_edges_tensor generation:  0.021661758422851562
mini_batch_src_global generation:  0.04069828987121582
r_  generation:  0.32814764976501465
----------------------check_connections_block total spend ----------------------------- 3.7389206886291504
generate_one_block  0.4195556640625
generate_one_block  0.4089789390563965
generate_one_block  0.40987157821655273
generate_one_block  0.42189884185791016
generate_one_block  0.418010950088501
generate_one_block  0.4347519874572754
generate_one_block  0.4003469944000244
generate_one_block  0.41434359550476074
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.03608417510986328
gen group dst list time:  0.03583860397338867
time for parepare:  0.019474029541015625
local_output_nid generation:  0.025922536849975586
local_in_edges_tensor generation:  0.04199576377868652
mini_batch_src_global generation:  0.051834821701049805
r_  generation:  0.5157132148742676
local_output_nid generation:  0.03207254409790039
local_in_edges_tensor generation:  0.04866766929626465
mini_batch_src_global generation:  0.05904960632324219
r_  generation:  0.5187914371490479
local_output_nid generation:  0.03254127502441406
local_in_edges_tensor generation:  0.03607606887817383
mini_batch_src_global generation:  0.055934906005859375
r_  generation:  0.5287256240844727
local_output_nid generation:  0.03291940689086914
local_in_edges_tensor generation:  0.04154801368713379
mini_batch_src_global generation:  0.06333565711975098
r_  generation:  0.5265698432922363
local_output_nid generation:  0.03305983543395996
local_in_edges_tensor generation:  0.03668403625488281
mini_batch_src_global generation:  0.05683398246765137
r_  generation:  0.5362679958343506
local_output_nid generation:  0.03349447250366211
local_in_edges_tensor generation:  0.0371549129486084
mini_batch_src_global generation:  0.06359696388244629
r_  generation:  0.5347399711608887
local_output_nid generation:  0.03365921974182129
local_in_edges_tensor generation:  0.04185009002685547
mini_batch_src_global generation:  0.05890989303588867
r_  generation:  0.5418434143066406
local_output_nid generation:  0.03412771224975586
local_in_edges_tensor generation:  0.0314784049987793
mini_batch_src_global generation:  0.060585975646972656
r_  generation:  0.5300643444061279
----------------------check_connections_block total spend ----------------------------- 6.209233283996582
generate_one_block  0.6795330047607422
generate_one_block  0.6725809574127197
generate_one_block  0.6649472713470459
generate_one_block  0.668710470199585
generate_one_block  0.6749236583709717
generate_one_block  0.7090067863464355
generate_one_block  0.6828017234802246
generate_one_block  0.6772077083587646
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.02776622772216797
gen group dst list time:  0.044428348541259766
time for parepare:  0.019070863723754883
local_output_nid generation:  0.030890703201293945
local_in_edges_tensor generation:  0.03898048400878906
mini_batch_src_global generation:  0.04521584510803223
r_  generation:  0.5025069713592529
local_output_nid generation:  0.03667473793029785
local_in_edges_tensor generation:  0.03228759765625
mini_batch_src_global generation:  0.05632472038269043
r_  generation:  0.5060145854949951
local_output_nid generation:  0.036712646484375
local_in_edges_tensor generation:  0.032347679138183594
mini_batch_src_global generation:  0.05707907676696777
r_  generation:  0.5070819854736328
local_output_nid generation:  0.03731346130371094
local_in_edges_tensor generation:  0.03456568717956543
mini_batch_src_global generation:  0.05453991889953613
r_  generation:  0.5254347324371338
local_output_nid generation:  0.03883695602416992
local_in_edges_tensor generation:  0.0455930233001709
mini_batch_src_global generation:  0.05707597732543945
r_  generation:  0.5185191631317139
local_output_nid generation:  0.038460493087768555
local_in_edges_tensor generation:  0.03609871864318848
mini_batch_src_global generation:  0.05498313903808594
r_  generation:  0.5239994525909424
local_output_nid generation:  0.03769278526306152
local_in_edges_tensor generation:  0.04332280158996582
mini_batch_src_global generation:  0.06577038764953613
r_  generation:  0.5242583751678467
local_output_nid generation:  0.0388484001159668
local_in_edges_tensor generation:  0.04421114921569824
mini_batch_src_global generation:  0.05519223213195801
r_  generation:  0.5263211727142334
----------------------check_connections_block total spend ----------------------------- 6.139856576919556
generate_one_block  0.6360902786254883
generate_one_block  0.6294300556182861
generate_one_block  0.634505033493042
generate_one_block  0.6565704345703125
generate_one_block  0.6348586082458496
generate_one_block  0.6531546115875244
generate_one_block  0.7082257270812988
generate_one_block  0.6471045017242432
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0233154296875 GB
    Memory Allocated: 0.007684230804443359  GigaBytes
Max Memory Allocated: 0.007684230804443359  GigaBytes

connection checking time:  16.088010549545288
block generation total time  13.957409381866455
average batch blocks generation time:  1.7446761727333069
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2088623046875 GB
    Memory Allocated: 0.1187286376953125  GigaBytes
Max Memory Allocated: 0.1187286376953125  GigaBytes

torch.Size([165451, 128])
torch.Size([161174, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 16.00 MiB (GPU 0; 23.62 GiB total capacity; 22.05 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
