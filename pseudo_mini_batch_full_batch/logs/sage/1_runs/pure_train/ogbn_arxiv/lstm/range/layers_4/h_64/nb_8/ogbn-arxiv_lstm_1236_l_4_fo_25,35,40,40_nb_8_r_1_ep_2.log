Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648488819.841489
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0010123252868652344  GigaBytes
Max Memory Allocated: 0.0010123252868652344  GigaBytes

The real block id is  3
get_global_graph_edges_ids_block function  spend 0.024463653564453125
range selection method range initialization spend 0.013094425201416016
time for parepare:  0.017819881439208984
local_output_nid generation:  0.002618551254272461
local_in_edges_tensor generation:  0.00461268424987793
mini_batch_src_global generation:  0.0031516551971435547
r_  generation:  0.03662586212158203
local_output_nid generation:  0.003013134002685547
local_in_edges_tensor generation:  0.0016498565673828125
mini_batch_src_global generation:  0.003915071487426758
r_  generation:  0.0370793342590332
local_output_nid generation:  0.003087282180786133
local_in_edges_tensor generation:  0.0016379356384277344
mini_batch_src_global generation:  0.0026819705963134766
r_  generation:  0.03870368003845215
local_output_nid generation:  0.0031125545501708984
local_in_edges_tensor generation:  0.0017213821411132812
mini_batch_src_global generation:  0.002769947052001953
r_  generation:  0.03893399238586426
local_output_nid generation:  0.0031363964080810547
local_in_edges_tensor generation:  0.0016939640045166016
mini_batch_src_global generation:  0.0029866695404052734
r_  generation:  0.044612884521484375
local_output_nid generation:  0.003326416015625
local_in_edges_tensor generation:  0.0017473697662353516
mini_batch_src_global generation:  0.0031507015228271484
r_  generation:  0.04047560691833496
local_output_nid generation:  0.0031211376190185547
local_in_edges_tensor generation:  0.0016825199127197266
mini_batch_src_global generation:  0.0031256675720214844
r_  generation:  0.04105687141418457
local_output_nid generation:  0.0032367706298828125
local_in_edges_tensor generation:  0.0016460418701171875
mini_batch_src_global generation:  0.0030052661895751953
r_  generation:  0.039818763732910156
----------------------check_connections_block total spend ----------------------------- 0.4670274257659912
generate_one_block  0.05474138259887695
generate_one_block  0.053872108459472656
generate_one_block  0.056023597717285156
generate_one_block  0.054173946380615234
generate_one_block  0.056885719299316406
generate_one_block  0.054259300231933594
generate_one_block  0.054436445236206055
generate_one_block  0.05439472198486328
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.04232954978942871
gen group dst list time:  0.015035629272460938
time for parepare:  0.019242286682128906
local_output_nid generation:  0.010301351547241211
local_in_edges_tensor generation:  0.028475046157836914
mini_batch_src_global generation:  0.030757665634155273
r_  generation:  0.297168493270874
local_output_nid generation:  0.015671253204345703
local_in_edges_tensor generation:  0.027509450912475586
mini_batch_src_global generation:  0.035724639892578125
r_  generation:  0.3027939796447754
local_output_nid generation:  0.016124725341796875
local_in_edges_tensor generation:  0.02582406997680664
mini_batch_src_global generation:  0.03635883331298828
r_  generation:  0.316450834274292
local_output_nid generation:  0.015987157821655273
local_in_edges_tensor generation:  0.02051401138305664
mini_batch_src_global generation:  0.036812782287597656
r_  generation:  0.3169693946838379
local_output_nid generation:  0.0166018009185791
local_in_edges_tensor generation:  0.020215988159179688
mini_batch_src_global generation:  0.0386662483215332
r_  generation:  0.3186769485473633
local_output_nid generation:  0.016591787338256836
local_in_edges_tensor generation:  0.017835140228271484
mini_batch_src_global generation:  0.03808259963989258
r_  generation:  0.3148341178894043
local_output_nid generation:  0.016716718673706055
local_in_edges_tensor generation:  0.02327704429626465
mini_batch_src_global generation:  0.04029417037963867
r_  generation:  0.3167853355407715
local_output_nid generation:  0.01682138442993164
local_in_edges_tensor generation:  0.020940542221069336
mini_batch_src_global generation:  0.038030385971069336
r_  generation:  0.31862950325012207
----------------------check_connections_block total spend ----------------------------- 3.6609044075012207
generate_one_block  0.40480995178222656
generate_one_block  0.4028491973876953
generate_one_block  0.4165456295013428
generate_one_block  0.405759334564209
generate_one_block  0.41301703453063965
generate_one_block  0.4142458438873291
generate_one_block  0.4044313430786133
generate_one_block  0.39931631088256836
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.03668975830078125
gen group dst list time:  0.03565526008605957
time for parepare:  0.01904916763305664
local_output_nid generation:  0.02527022361755371
local_in_edges_tensor generation:  0.041941165924072266
mini_batch_src_global generation:  0.04869866371154785
r_  generation:  0.5088613033294678
local_output_nid generation:  0.032381296157836914
local_in_edges_tensor generation:  0.050958871841430664
mini_batch_src_global generation:  0.05982232093811035
r_  generation:  0.5159263610839844
local_output_nid generation:  0.03245210647583008
local_in_edges_tensor generation:  0.043875932693481445
mini_batch_src_global generation:  0.05543351173400879
r_  generation:  0.5269224643707275
local_output_nid generation:  0.03291153907775879
local_in_edges_tensor generation:  0.03436112403869629
mini_batch_src_global generation:  0.05918312072753906
r_  generation:  0.5199098587036133
local_output_nid generation:  0.03329825401306152
local_in_edges_tensor generation:  0.03820371627807617
mini_batch_src_global generation:  0.061240196228027344
r_  generation:  0.5320332050323486
local_output_nid generation:  0.033089399337768555
local_in_edges_tensor generation:  0.03520774841308594
mini_batch_src_global generation:  0.059862613677978516
r_  generation:  0.5218925476074219
local_output_nid generation:  0.03338885307312012
local_in_edges_tensor generation:  0.038283586502075195
mini_batch_src_global generation:  0.062188148498535156
r_  generation:  0.5312614440917969
local_output_nid generation:  0.03380227088928223
local_in_edges_tensor generation:  0.0445096492767334
mini_batch_src_global generation:  0.059485435485839844
r_  generation:  0.5246560573577881
----------------------check_connections_block total spend ----------------------------- 6.159493923187256
generate_one_block  0.6592626571655273
generate_one_block  0.6645183563232422
generate_one_block  0.675262451171875
generate_one_block  0.6611807346343994
generate_one_block  0.6637349128723145
generate_one_block  0.6883885860443115
generate_one_block  0.6572909355163574
generate_one_block  0.6825418472290039
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.028308391571044922
gen group dst list time:  0.04403829574584961
time for parepare:  0.01896834373474121
local_output_nid generation:  0.030225753784179688
local_in_edges_tensor generation:  0.03992891311645508
mini_batch_src_global generation:  0.0459132194519043
r_  generation:  0.499053955078125
local_output_nid generation:  0.03604841232299805
local_in_edges_tensor generation:  0.03652548789978027
mini_batch_src_global generation:  0.05954909324645996
r_  generation:  0.5055122375488281
local_output_nid generation:  0.03690195083618164
local_in_edges_tensor generation:  0.0438075065612793
mini_batch_src_global generation:  0.05658841133117676
r_  generation:  0.5181589126586914
local_output_nid generation:  0.03725910186767578
local_in_edges_tensor generation:  0.04300212860107422
mini_batch_src_global generation:  0.05495595932006836
r_  generation:  0.5168137550354004
local_output_nid generation:  0.03691720962524414
local_in_edges_tensor generation:  0.04203343391418457
mini_batch_src_global generation:  0.053966522216796875
r_  generation:  0.5147416591644287
local_output_nid generation:  0.037307024002075195
local_in_edges_tensor generation:  0.034993886947631836
mini_batch_src_global generation:  0.05485105514526367
r_  generation:  0.5136144161224365
local_output_nid generation:  0.037439584732055664
local_in_edges_tensor generation:  0.032984018325805664
mini_batch_src_global generation:  0.055274009704589844
r_  generation:  0.5215611457824707
local_output_nid generation:  0.037695884704589844
local_in_edges_tensor generation:  0.03844141960144043
mini_batch_src_global generation:  0.06146049499511719
r_  generation:  0.5252399444580078
----------------------check_connections_block total spend ----------------------------- 6.107484817504883
generate_one_block  0.6257243156433105
generate_one_block  0.6391847133636475
generate_one_block  0.6328141689300537
generate_one_block  0.6463127136230469
generate_one_block  0.6436150074005127
generate_one_block  0.6396868228912354
generate_one_block  0.6811308860778809
generate_one_block  0.64998459815979
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0010123252868652344  GigaBytes
Max Memory Allocated: 0.0010123252868652344  GigaBytes

connection checking time:  15.92788314819336
block generation total time  13.771608352661133
average batch blocks generation time:  1.7214510440826416
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2010498046875 GB
    Memory Allocated: 0.11202001571655273  GigaBytes
Max Memory Allocated: 0.11202001571655273  GigaBytes

torch.Size([165542, 128])
torch.Size([161280, 64])
torch.Size([142030, 64])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 203, in forward
    x = self.layers[-1](blocks[-1], x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 23.62 GiB total capacity; 22.23 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
