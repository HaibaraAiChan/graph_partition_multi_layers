Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648526668.0593429
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0013260841369628906  GigaBytes
Max Memory Allocated: 0.0013260841369628906  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.02459239959716797
range selection method range initialization spend 0.013210058212280273
time for parepare:  0.017738819122314453
local_output_nid generation:  0.0026521682739257812
local_in_edges_tensor generation:  0.004691123962402344
mini_batch_src_global generation:  0.003250598907470703
r_  generation:  0.03842449188232422
local_output_nid generation:  0.003079652786254883
local_in_edges_tensor generation:  0.0016560554504394531
mini_batch_src_global generation:  0.004105329513549805
r_  generation:  0.038063764572143555
local_output_nid generation:  0.0031027793884277344
local_in_edges_tensor generation:  0.001683950424194336
mini_batch_src_global generation:  0.0027904510498046875
r_  generation:  0.039434194564819336
local_output_nid generation:  0.0031232833862304688
local_in_edges_tensor generation:  0.0016183853149414062
mini_batch_src_global generation:  0.0029573440551757812
r_  generation:  0.04007887840270996
local_output_nid generation:  0.003123044967651367
local_in_edges_tensor generation:  0.0016908645629882812
mini_batch_src_global generation:  0.0028908252716064453
r_  generation:  0.04111599922180176
local_output_nid generation:  0.0031425952911376953
local_in_edges_tensor generation:  0.0016522407531738281
mini_batch_src_global generation:  0.003392934799194336
r_  generation:  0.04198741912841797
local_output_nid generation:  0.0031442642211914062
local_in_edges_tensor generation:  0.0016646385192871094
mini_batch_src_global generation:  0.003041982650756836
r_  generation:  0.04120683670043945
local_output_nid generation:  0.0031745433807373047
local_in_edges_tensor generation:  0.0016393661499023438
mini_batch_src_global generation:  0.0030748844146728516
r_  generation:  0.04096698760986328
----------------------check_connections_block total spend ----------------------------- 0.4723646640777588
generate_one_block  0.05532431602478027
generate_one_block  0.05492377281188965
generate_one_block  0.05552864074707031
generate_one_block  0.05938982963562012
generate_one_block  0.05879616737365723
generate_one_block  0.054648399353027344
generate_one_block  0.05532097816467285
generate_one_block  0.05385422706604004
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.042426347732543945
gen group dst list time:  0.015136003494262695
time for parepare:  0.018956422805786133
local_output_nid generation:  0.010883092880249023
local_in_edges_tensor generation:  0.030390262603759766
mini_batch_src_global generation:  0.03116154670715332
r_  generation:  0.2997267246246338
local_output_nid generation:  0.015742778778076172
local_in_edges_tensor generation:  0.027988433837890625
mini_batch_src_global generation:  0.0402989387512207
r_  generation:  0.3181591033935547
local_output_nid generation:  0.016492843627929688
local_in_edges_tensor generation:  0.0240781307220459
mini_batch_src_global generation:  0.03936052322387695
r_  generation:  0.3239710330963135
local_output_nid generation:  0.01656937599182129
local_in_edges_tensor generation:  0.02112412452697754
mini_batch_src_global generation:  0.04036879539489746
r_  generation:  0.3244481086730957
local_output_nid generation:  0.01679062843322754
local_in_edges_tensor generation:  0.024156808853149414
mini_batch_src_global generation:  0.03828001022338867
r_  generation:  0.3269045352935791
local_output_nid generation:  0.02192974090576172
local_in_edges_tensor generation:  0.041013240814208984
mini_batch_src_global generation:  0.05287528038024902
r_  generation:  0.32629942893981934
local_output_nid generation:  0.01854991912841797
local_in_edges_tensor generation:  0.02364039421081543
mini_batch_src_global generation:  0.03897881507873535
r_  generation:  0.3227660655975342
local_output_nid generation:  0.017601728439331055
local_in_edges_tensor generation:  0.018831968307495117
mini_batch_src_global generation:  0.03933978080749512
r_  generation:  0.31691789627075195
----------------------check_connections_block total spend ----------------------------- 3.7997307777404785
generate_one_block  0.4226522445678711
generate_one_block  0.41399312019348145
generate_one_block  0.41518735885620117
generate_one_block  0.4139535427093506
generate_one_block  0.40987086296081543
generate_one_block  0.4395298957824707
generate_one_block  0.4127078056335449
generate_one_block  0.399857759475708
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.05727505683898926
gen group dst list time:  0.03633427619934082
time for parepare:  0.019169330596923828
local_output_nid generation:  0.025772809982299805
local_in_edges_tensor generation:  0.06193089485168457
mini_batch_src_global generation:  0.0498659610748291
r_  generation:  0.5246891975402832
local_output_nid generation:  0.03215336799621582
local_in_edges_tensor generation:  0.05144906044006348
mini_batch_src_global generation:  0.07431793212890625
r_  generation:  0.5475764274597168
local_output_nid generation:  0.036629676818847656
local_in_edges_tensor generation:  0.04036760330200195
mini_batch_src_global generation:  0.06410026550292969
r_  generation:  0.5757465362548828
local_output_nid generation:  0.037741899490356445
local_in_edges_tensor generation:  0.050691843032836914
mini_batch_src_global generation:  0.06708502769470215
r_  generation:  0.5389003753662109
local_output_nid generation:  0.034236907958984375
local_in_edges_tensor generation:  0.04628753662109375
mini_batch_src_global generation:  0.05920767784118652
r_  generation:  0.5530855655670166
local_output_nid generation:  0.03505563735961914
local_in_edges_tensor generation:  0.03836417198181152
mini_batch_src_global generation:  0.06333518028259277
r_  generation:  0.548687219619751
local_output_nid generation:  0.0377805233001709
local_in_edges_tensor generation:  0.054369449615478516
mini_batch_src_global generation:  0.07063722610473633
r_  generation:  0.573143720626831
local_output_nid generation:  0.036516666412353516
local_in_edges_tensor generation:  0.041961669921875
mini_batch_src_global generation:  0.06302881240844727
r_  generation:  0.5406002998352051
----------------------check_connections_block total spend ----------------------------- 6.588079929351807
generate_one_block  0.6935653686523438
generate_one_block  0.7211902141571045
generate_one_block  0.6997449398040771
generate_one_block  0.6908600330352783
generate_one_block  0.6825194358825684
generate_one_block  0.6890413761138916
generate_one_block  0.713681697845459
generate_one_block  0.6890339851379395
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.048859357833862305
gen group dst list time:  0.04679298400878906
time for parepare:  0.019123554229736328
local_output_nid generation:  0.031571149826049805
local_in_edges_tensor generation:  0.06396603584289551
mini_batch_src_global generation:  0.055830955505371094
r_  generation:  0.5433032512664795
local_output_nid generation:  0.03648948669433594
local_in_edges_tensor generation:  0.055214643478393555
mini_batch_src_global generation:  0.06361007690429688
r_  generation:  0.5718660354614258
local_output_nid generation:  0.03686070442199707
local_in_edges_tensor generation:  0.04766488075256348
mini_batch_src_global generation:  0.0647432804107666
r_  generation:  0.5576457977294922
local_output_nid generation:  0.03937673568725586
local_in_edges_tensor generation:  0.04323744773864746
mini_batch_src_global generation:  0.06148099899291992
r_  generation:  0.5636835098266602
local_output_nid generation:  0.03797459602355957
local_in_edges_tensor generation:  0.03718924522399902
mini_batch_src_global generation:  0.061138153076171875
r_  generation:  0.5650711059570312
local_output_nid generation:  0.038332462310791016
local_in_edges_tensor generation:  0.044145822525024414
mini_batch_src_global generation:  0.060629844665527344
r_  generation:  0.5708198547363281
local_output_nid generation:  0.038472890853881836
local_in_edges_tensor generation:  0.05207681655883789
mini_batch_src_global generation:  0.06054186820983887
r_  generation:  0.5815248489379883
local_output_nid generation:  0.03846454620361328
local_in_edges_tensor generation:  0.0420076847076416
mini_batch_src_global generation:  0.06166672706604004
r_  generation:  0.5758030414581299
----------------------check_connections_block total spend ----------------------------- 6.779937028884888
generate_one_block  0.7129542827606201
generate_one_block  0.7146298885345459
generate_one_block  0.7184202671051025
generate_one_block  0.6996011734008789
generate_one_block  0.7109441757202148
generate_one_block  0.6997902393341064
generate_one_block  0.7588186264038086
generate_one_block  0.7122368812561035
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04019808769226074
gen group dst list time:  0.04886221885681152
time for parepare:  0.019736528396606445
local_output_nid generation:  0.033208608627319336
local_in_edges_tensor generation:  0.05356884002685547
mini_batch_src_global generation:  0.05263805389404297
r_  generation:  0.5392601490020752
local_output_nid generation:  0.03747844696044922
local_in_edges_tensor generation:  0.04373741149902344
mini_batch_src_global generation:  0.06287384033203125
r_  generation:  0.5437099933624268
local_output_nid generation:  0.03806734085083008
local_in_edges_tensor generation:  0.0484471321105957
mini_batch_src_global generation:  0.06341719627380371
r_  generation:  0.5453035831451416
local_output_nid generation:  0.03801536560058594
local_in_edges_tensor generation:  0.0421142578125
mini_batch_src_global generation:  0.06313681602478027
r_  generation:  0.5512523651123047
local_output_nid generation:  0.03807783126831055
local_in_edges_tensor generation:  0.044249773025512695
mini_batch_src_global generation:  0.06413006782531738
r_  generation:  0.5504112243652344
local_output_nid generation:  0.03827261924743652
local_in_edges_tensor generation:  0.04902029037475586
mini_batch_src_global generation:  0.06958866119384766
r_  generation:  0.5565540790557861
local_output_nid generation:  0.03863382339477539
local_in_edges_tensor generation:  0.04608893394470215
mini_batch_src_global generation:  0.06602716445922852
r_  generation:  0.5496890544891357
local_output_nid generation:  0.03877687454223633
local_in_edges_tensor generation:  0.039290666580200195
mini_batch_src_global generation:  0.06566953659057617
r_  generation:  0.5678033828735352
----------------------check_connections_block total spend ----------------------------- 6.64013147354126
generate_one_block  0.6990664005279541
generate_one_block  0.703385591506958
generate_one_block  0.6964025497436523
generate_one_block  0.6846446990966797
generate_one_block  0.6962032318115234
generate_one_block  0.6999201774597168
generate_one_block  0.6948542594909668
generate_one_block  0.7330350875854492
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.037567138671875
gen group dst list time:  0.04756021499633789
time for parepare:  0.019362688064575195
local_output_nid generation:  0.03229022026062012
local_in_edges_tensor generation:  0.04852795600891113
mini_batch_src_global generation:  0.04740142822265625
r_  generation:  0.508312463760376
local_output_nid generation:  0.0392155647277832
local_in_edges_tensor generation:  0.0333256721496582
mini_batch_src_global generation:  0.058084964752197266
r_  generation:  0.5127160549163818
local_output_nid generation:  0.03792762756347656
local_in_edges_tensor generation:  0.038129329681396484
mini_batch_src_global generation:  0.05827665328979492
r_  generation:  0.526639461517334
local_output_nid generation:  0.03843188285827637
local_in_edges_tensor generation:  0.03397512435913086
mini_batch_src_global generation:  0.05865216255187988
r_  generation:  0.5141136646270752
local_output_nid generation:  0.0386195182800293
local_in_edges_tensor generation:  0.03921103477478027
mini_batch_src_global generation:  0.06264781951904297
r_  generation:  0.5132062435150146
local_output_nid generation:  0.03862714767456055
local_in_edges_tensor generation:  0.04700875282287598
mini_batch_src_global generation:  0.05796456336975098
r_  generation:  0.5172269344329834
local_output_nid generation:  0.03880810737609863
local_in_edges_tensor generation:  0.044844865798950195
mini_batch_src_global generation:  0.058377742767333984
r_  generation:  0.5185091495513916
local_output_nid generation:  0.03892874717712402
local_in_edges_tensor generation:  0.03571438789367676
mini_batch_src_global generation:  0.05838942527770996
r_  generation:  0.5190913677215576
----------------------check_connections_block total spend ----------------------------- 6.201113700866699
generate_one_block  0.6343033313751221
generate_one_block  0.6473443508148193
generate_one_block  0.6459131240844727
generate_one_block  0.6274034976959229
generate_one_block  0.6440856456756592
generate_one_block  0.6520318984985352
generate_one_block  0.6535418033599854
generate_one_block  0.6277382373809814
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0013260841369628906  GigaBytes
Max Memory Allocated: 0.0013260841369628906  GigaBytes

connection checking time:  30.008992910385132
block generation total time  25.374659061431885
average batch blocks generation time:  3.1718323826789856
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2420654296875 GB
    Memory Allocated: 0.13992023468017578  GigaBytes
Max Memory Allocated: 0.13992023468017578  GigaBytes

torch.Size([167574, 128])
torch.Size([167112, 64])
torch.Size([165817, 64])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 438, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 434, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 253, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.25 GiB already allocated; 12.44 MiB free; 22.41 GiB reserved in total by PyTorch)
