Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648528319.4811618
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0291748046875 GB
    Memory Allocated: 0.012590885162353516  GigaBytes
Max Memory Allocated: 0.012590885162353516  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.024744033813476562
range selection method range initialization spend 0.012969732284545898
time for parepare:  0.01809549331665039
local_output_nid generation:  0.005339860916137695
local_in_edges_tensor generation:  0.005982160568237305
mini_batch_src_global generation:  0.006429433822631836
r_  generation:  0.08171606063842773
local_output_nid generation:  0.0059947967529296875
local_in_edges_tensor generation:  0.0030133724212646484
mini_batch_src_global generation:  0.008417129516601562
r_  generation:  0.08831214904785156
local_output_nid generation:  0.006153106689453125
local_in_edges_tensor generation:  0.0031020641326904297
mini_batch_src_global generation:  0.00658106803894043
r_  generation:  0.0879964828491211
local_output_nid generation:  0.006105899810791016
local_in_edges_tensor generation:  0.0030608177185058594
mini_batch_src_global generation:  0.006681680679321289
r_  generation:  0.09094429016113281
----------------------check_connections_block total spend ----------------------------- 0.5022993087768555
generate_one_block  0.10152029991149902
generate_one_block  0.10283994674682617
generate_one_block  0.1015317440032959
generate_one_block  0.10139703750610352
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.041060686111450195
gen group dst list time:  0.010797739028930664
time for parepare:  0.018897533416748047
local_output_nid generation:  0.014695405960083008
local_in_edges_tensor generation:  0.03889608383178711
mini_batch_src_global generation:  0.0388646125793457
r_  generation:  0.4051797389984131
local_output_nid generation:  0.021067380905151367
local_in_edges_tensor generation:  0.03797507286071777
mini_batch_src_global generation:  0.049362897872924805
r_  generation:  0.42129969596862793
local_output_nid generation:  0.021986961364746094
local_in_edges_tensor generation:  0.03186225891113281
mini_batch_src_global generation:  0.04883456230163574
r_  generation:  0.42117834091186523
local_output_nid generation:  0.02256941795349121
local_in_edges_tensor generation:  0.02780461311340332
mini_batch_src_global generation:  0.05306291580200195
r_  generation:  0.4178450107574463
----------------------check_connections_block total spend ----------------------------- 2.454195737838745
generate_one_block  0.5676901340484619
generate_one_block  0.5506405830383301
generate_one_block  0.5411088466644287
generate_one_block  0.5526621341705322
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.03715109825134277
gen group dst list time:  0.020923376083374023
time for parepare:  0.019912242889404297
local_output_nid generation:  0.025232791900634766
local_in_edges_tensor generation:  0.04721474647521973
mini_batch_src_global generation:  0.05116605758666992
r_  generation:  0.5384697914123535
local_output_nid generation:  0.03625130653381348
local_in_edges_tensor generation:  0.0505528450012207
mini_batch_src_global generation:  0.0627450942993164
r_  generation:  0.5491523742675781
local_output_nid generation:  0.037397146224975586
local_in_edges_tensor generation:  0.03695178031921387
mini_batch_src_global generation:  0.05849027633666992
r_  generation:  0.5630669593811035
local_output_nid generation:  0.03890633583068848
local_in_edges_tensor generation:  0.03756523132324219
mini_batch_src_global generation:  0.06365776062011719
r_  generation:  0.5618100166320801
----------------------check_connections_block total spend ----------------------------- 3.2637791633605957
generate_one_block  0.6955201625823975
generate_one_block  0.7166128158569336
generate_one_block  0.6947226524353027
generate_one_block  0.7120189666748047
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.06011176109313965
gen group dst list time:  0.02557539939880371
time for parepare:  0.01900935173034668
local_output_nid generation:  0.028355836868286133
local_in_edges_tensor generation:  0.07147741317749023
mini_batch_src_global generation:  0.05710244178771973
r_  generation:  0.5591049194335938
local_output_nid generation:  0.034483909606933594
local_in_edges_tensor generation:  0.0584869384765625
mini_batch_src_global generation:  0.06556820869445801
r_  generation:  0.5747823715209961
local_output_nid generation:  0.035218000411987305
local_in_edges_tensor generation:  0.04700040817260742
mini_batch_src_global generation:  0.0694112777709961
r_  generation:  0.5553815364837646
local_output_nid generation:  0.035721540451049805
local_in_edges_tensor generation:  0.05020308494567871
mini_batch_src_global generation:  0.06490349769592285
r_  generation:  0.5645747184753418
----------------------check_connections_block total spend ----------------------------- 3.409855604171753
generate_one_block  0.7260429859161377
generate_one_block  0.7356719970703125
generate_one_block  0.7123546600341797
generate_one_block  0.7213547229766846
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.07660126686096191
gen group dst list time:  0.0244140625
time for parepare:  0.019056320190429688
local_output_nid generation:  0.02808856964111328
local_in_edges_tensor generation:  0.05691647529602051
mini_batch_src_global generation:  0.05202007293701172
r_  generation:  0.5461564064025879
local_output_nid generation:  0.035167694091796875
local_in_edges_tensor generation:  0.038492441177368164
mini_batch_src_global generation:  0.06441211700439453
r_  generation:  0.5466399192810059
local_output_nid generation:  0.03598308563232422
local_in_edges_tensor generation:  0.03424882888793945
mini_batch_src_global generation:  0.06638479232788086
r_  generation:  0.5572447776794434
local_output_nid generation:  0.03718113899230957
local_in_edges_tensor generation:  0.035259246826171875
mini_batch_src_global generation:  0.06445002555847168
r_  generation:  0.5697178840637207
----------------------check_connections_block total spend ----------------------------- 3.2945077419281006
generate_one_block  0.6971251964569092
generate_one_block  0.7006499767303467
generate_one_block  0.6959598064422607
generate_one_block  0.7371678352355957
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.0387880802154541
gen group dst list time:  0.02566671371459961
time for parepare:  0.0200803279876709
local_output_nid generation:  0.03023529052734375
local_in_edges_tensor generation:  0.041757822036743164
mini_batch_src_global generation:  0.04900360107421875
r_  generation:  0.5252060890197754
local_output_nid generation:  0.03639626502990723
local_in_edges_tensor generation:  0.04192090034484863
mini_batch_src_global generation:  0.061011552810668945
r_  generation:  0.5216042995452881
local_output_nid generation:  0.03798937797546387
local_in_edges_tensor generation:  0.04290366172790527
mini_batch_src_global generation:  0.06328463554382324
r_  generation:  0.5163805484771729
local_output_nid generation:  0.03708767890930176
local_in_edges_tensor generation:  0.04154324531555176
mini_batch_src_global generation:  0.06006884574890137
r_  generation:  0.5358917713165283
----------------------check_connections_block total spend ----------------------------- 3.1507952213287354
generate_one_block  0.6635191440582275
generate_one_block  0.6766417026519775
generate_one_block  0.6562027931213379
generate_one_block  0.6592397689819336
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0291748046875 GB
    Memory Allocated: 0.012590885162353516  GigaBytes
Max Memory Allocated: 0.012590885162353516  GigaBytes

connection checking time:  15.57313346862793
block generation total time  13.412906885147095
average batch blocks generation time:  3.3532267212867737
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2537841796875 GB
    Memory Allocated: 0.15478849411010742  GigaBytes
Max Memory Allocated: 0.15478849411010742  GigaBytes

torch.Size([167842, 128])
torch.Size([167618, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 438, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 434, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 253, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 50.00 MiB (GPU 0; 23.62 GiB total capacity; 21.91 GiB already allocated; 36.44 MiB free; 22.39 GiB reserved in total by PyTorch)
