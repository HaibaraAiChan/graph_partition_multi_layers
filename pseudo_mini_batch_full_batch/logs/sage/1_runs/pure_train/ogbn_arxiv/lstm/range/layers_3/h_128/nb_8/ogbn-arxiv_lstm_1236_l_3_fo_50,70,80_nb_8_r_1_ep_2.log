Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648474242.8194473
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0017633438110351562  GigaBytes
Max Memory Allocated: 0.0017633438110351562  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.026026487350463867
range selection method range initialization spend 0.014250755310058594
time for parepare:  0.017824172973632812
local_output_nid generation:  0.0026400089263916016
local_in_edges_tensor generation:  0.004220485687255859
mini_batch_src_global generation:  0.003731250762939453
r_  generation:  0.041940927505493164
local_output_nid generation:  0.003190279006958008
local_in_edges_tensor generation:  0.0017244815826416016
mini_batch_src_global generation:  0.0048694610595703125
r_  generation:  0.04510855674743652
local_output_nid generation:  0.0031909942626953125
local_in_edges_tensor generation:  0.0016949176788330078
mini_batch_src_global generation:  0.0032308101654052734
r_  generation:  0.044382572174072266
local_output_nid generation:  0.0032761096954345703
local_in_edges_tensor generation:  0.0016818046569824219
mini_batch_src_global generation:  0.0033473968505859375
r_  generation:  0.04611539840698242
local_output_nid generation:  0.0032341480255126953
local_in_edges_tensor generation:  0.0016834735870361328
mini_batch_src_global generation:  0.0035223960876464844
r_  generation:  0.046674489974975586
local_output_nid generation:  0.0032448768615722656
local_in_edges_tensor generation:  0.0017008781433105469
mini_batch_src_global generation:  0.003744840621948242
r_  generation:  0.04835104942321777
local_output_nid generation:  0.003231048583984375
local_in_edges_tensor generation:  0.0016903877258300781
mini_batch_src_global generation:  0.003729581832885742
r_  generation:  0.04632735252380371
local_output_nid generation:  0.0031921863555908203
local_in_edges_tensor generation:  0.001708984375
mini_batch_src_global generation:  0.0037293434143066406
r_  generation:  0.04677844047546387
----------------------check_connections_block total spend ----------------------------- 0.531442403793335
generate_one_block  0.05960440635681152
generate_one_block  0.06318902969360352
generate_one_block  0.06145024299621582
generate_one_block  0.061539411544799805
generate_one_block  0.06381487846374512
generate_one_block  0.06302475929260254
generate_one_block  0.06139540672302246
generate_one_block  0.06122112274169922
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04204249382019043
gen group dst list time:  0.016472578048706055
time for parepare:  0.018927574157714844
local_output_nid generation:  0.01123499870300293
local_in_edges_tensor generation:  0.03226470947265625
mini_batch_src_global generation:  0.03741002082824707
r_  generation:  0.3596930503845215
local_output_nid generation:  0.017249584197998047
local_in_edges_tensor generation:  0.03198385238647461
mini_batch_src_global generation:  0.04503893852233887
r_  generation:  0.37761378288269043
local_output_nid generation:  0.017346858978271484
local_in_edges_tensor generation:  0.029746532440185547
mini_batch_src_global generation:  0.050022125244140625
r_  generation:  0.37761783599853516
local_output_nid generation:  0.01772451400756836
local_in_edges_tensor generation:  0.019318580627441406
mini_batch_src_global generation:  0.04490041732788086
r_  generation:  0.3764309883117676
local_output_nid generation:  0.017969131469726562
local_in_edges_tensor generation:  0.022246599197387695
mini_batch_src_global generation:  0.04610395431518555
r_  generation:  0.3826131820678711
local_output_nid generation:  0.0183560848236084
local_in_edges_tensor generation:  0.022760391235351562
mini_batch_src_global generation:  0.04730510711669922
r_  generation:  0.38271641731262207
local_output_nid generation:  0.018006324768066406
local_in_edges_tensor generation:  0.019348859786987305
mini_batch_src_global generation:  0.04626941680908203
r_  generation:  0.38153934478759766
local_output_nid generation:  0.018102407455444336
local_in_edges_tensor generation:  0.022533893585205078
mini_batch_src_global generation:  0.046178340911865234
r_  generation:  0.37298583984375
----------------------check_connections_block total spend ----------------------------- 4.355229139328003
generate_one_block  0.482816219329834
generate_one_block  0.5041847229003906
generate_one_block  0.48554420471191406
generate_one_block  0.48696231842041016
generate_one_block  0.4868326187133789
generate_one_block  0.5135397911071777
generate_one_block  0.48378515243530273
generate_one_block  0.4762399196624756
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.034833431243896484
gen group dst list time:  0.03682112693786621
time for parepare:  0.018869638442993164
local_output_nid generation:  0.025434494018554688
local_in_edges_tensor generation:  0.04077792167663574
mini_batch_src_global generation:  0.051161766052246094
r_  generation:  0.5361168384552002
local_output_nid generation:  0.03284025192260742
local_in_edges_tensor generation:  0.05114316940307617
mini_batch_src_global generation:  0.06367635726928711
r_  generation:  0.5511610507965088
local_output_nid generation:  0.03350567817687988
local_in_edges_tensor generation:  0.04744863510131836
mini_batch_src_global generation:  0.061254262924194336
r_  generation:  0.5530276298522949
local_output_nid generation:  0.03386950492858887
local_in_edges_tensor generation:  0.032549142837524414
mini_batch_src_global generation:  0.0602869987487793
r_  generation:  0.5602941513061523
local_output_nid generation:  0.034182071685791016
local_in_edges_tensor generation:  0.04684615135192871
mini_batch_src_global generation:  0.06110239028930664
r_  generation:  0.5623366832733154
local_output_nid generation:  0.03436422348022461
local_in_edges_tensor generation:  0.0378575325012207
mini_batch_src_global generation:  0.06603217124938965
r_  generation:  0.5610332489013672
local_output_nid generation:  0.03405165672302246
local_in_edges_tensor generation:  0.03256797790527344
mini_batch_src_global generation:  0.06208634376525879
r_  generation:  0.5659544467926025
local_output_nid generation:  0.03422856330871582
local_in_edges_tensor generation:  0.0376734733581543
mini_batch_src_global generation:  0.063018798828125
r_  generation:  0.5652308464050293
----------------------check_connections_block total spend ----------------------------- 6.527635812759399
generate_one_block  0.6953480243682861
generate_one_block  0.7104175090789795
generate_one_block  0.7130835056304932
generate_one_block  0.7073085308074951
generate_one_block  0.6957066059112549
generate_one_block  0.7082641124725342
generate_one_block  0.7178223133087158
generate_one_block  0.7171919345855713
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0017633438110351562  GigaBytes
Max Memory Allocated: 0.0017633438110351562  GigaBytes

connection checking time:  10.882864952087402
block generation total time  9.585047483444214
average batch blocks generation time:  1.1981309354305267
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2010498046875 GB
    Memory Allocated: 0.10317134857177734  GigaBytes
Max Memory Allocated: 0.10317134857177734  GigaBytes

torch.Size([162695, 128])
torch.Size([145852, 128])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.29 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
