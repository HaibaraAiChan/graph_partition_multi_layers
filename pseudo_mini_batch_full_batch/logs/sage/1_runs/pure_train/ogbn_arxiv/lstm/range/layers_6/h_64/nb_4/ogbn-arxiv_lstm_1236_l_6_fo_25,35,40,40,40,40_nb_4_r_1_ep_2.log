Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648526627.3783457
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0013260841369628906  GigaBytes
Max Memory Allocated: 0.0013260841369628906  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.025061845779418945
range selection method range initialization spend 0.013232231140136719
time for parepare:  0.017858028411865234
local_output_nid generation:  0.005173921585083008
local_in_edges_tensor generation:  0.0060880184173583984
mini_batch_src_global generation:  0.006415128707885742
r_  generation:  0.08250665664672852
local_output_nid generation:  0.00588679313659668
local_in_edges_tensor generation:  0.003087282180786133
mini_batch_src_global generation:  0.008325815200805664
r_  generation:  0.08806729316711426
local_output_nid generation:  0.0060787200927734375
local_in_edges_tensor generation:  0.003116607666015625
mini_batch_src_global generation:  0.0063054561614990234
r_  generation:  0.08865022659301758
local_output_nid generation:  0.005993843078613281
local_in_edges_tensor generation:  0.0030455589294433594
mini_batch_src_global generation:  0.006716489791870117
r_  generation:  0.09062409400939941
----------------------check_connections_block total spend ----------------------------- 0.5028653144836426
generate_one_block  0.10217881202697754
generate_one_block  0.1030113697052002
generate_one_block  0.10258960723876953
generate_one_block  0.10222053527832031
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.04179549217224121
gen group dst list time:  0.011244773864746094
time for parepare:  0.01985907554626465
local_output_nid generation:  0.015061140060424805
local_in_edges_tensor generation:  0.03681755065917969
mini_batch_src_global generation:  0.03735661506652832
r_  generation:  0.4049253463745117
local_output_nid generation:  0.023772239685058594
local_in_edges_tensor generation:  0.0405123233795166
mini_batch_src_global generation:  0.05153536796569824
r_  generation:  0.42373108863830566
local_output_nid generation:  0.02954387664794922
local_in_edges_tensor generation:  0.03167438507080078
mini_batch_src_global generation:  0.051466941833496094
r_  generation:  0.4279317855834961
local_output_nid generation:  0.026164770126342773
local_in_edges_tensor generation:  0.022966384887695312
mini_batch_src_global generation:  0.04999423027038574
r_  generation:  0.4570579528808594
----------------------check_connections_block total spend ----------------------------- 2.5272865295410156
generate_one_block  0.5824532508850098
generate_one_block  0.5512511730194092
generate_one_block  0.5528779029846191
generate_one_block  0.5505285263061523
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.058783769607543945
gen group dst list time:  0.020946979522705078
time for parepare:  0.018761157989501953
local_output_nid generation:  0.025383949279785156
local_in_edges_tensor generation:  0.05915379524230957
mini_batch_src_global generation:  0.05432891845703125
r_  generation:  0.5389773845672607
local_output_nid generation:  0.033086299896240234
local_in_edges_tensor generation:  0.05334925651550293
mini_batch_src_global generation:  0.06229519844055176
r_  generation:  0.5454070568084717
local_output_nid generation:  0.03393292427062988
local_in_edges_tensor generation:  0.03963446617126465
mini_batch_src_global generation:  0.057938337326049805
r_  generation:  0.5598454475402832
local_output_nid generation:  0.0343632698059082
local_in_edges_tensor generation:  0.04430389404296875
mini_batch_src_global generation:  0.05919146537780762
r_  generation:  0.5575871467590332
----------------------check_connections_block total spend ----------------------------- 3.248138666152954
generate_one_block  0.7096922397613525
generate_one_block  0.7346181869506836
generate_one_block  0.7263615131378174
generate_one_block  0.7331297397613525
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.059546709060668945
gen group dst list time:  0.02778339385986328
time for parepare:  0.018880605697631836
local_output_nid generation:  0.02829885482788086
local_in_edges_tensor generation:  0.062438011169433594
mini_batch_src_global generation:  0.05562782287597656
r_  generation:  0.5555887222290039
local_output_nid generation:  0.03474545478820801
local_in_edges_tensor generation:  0.05246996879577637
mini_batch_src_global generation:  0.06409859657287598
r_  generation:  0.5628621578216553
local_output_nid generation:  0.03692436218261719
local_in_edges_tensor generation:  0.04759383201599121
mini_batch_src_global generation:  0.06544661521911621
r_  generation:  0.5776946544647217
local_output_nid generation:  0.038956403732299805
local_in_edges_tensor generation:  0.04977536201477051
mini_batch_src_global generation:  0.06355953216552734
r_  generation:  0.5574603080749512
----------------------check_connections_block total spend ----------------------------- 3.3948569297790527
generate_one_block  0.7037980556488037
generate_one_block  0.7301661968231201
generate_one_block  0.721290111541748
generate_one_block  0.7180166244506836
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.0737004280090332
gen group dst list time:  0.02738213539123535
time for parepare:  0.018925189971923828
local_output_nid generation:  0.03160285949707031
local_in_edges_tensor generation:  0.07305526733398438
mini_batch_src_global generation:  0.05202507972717285
r_  generation:  0.545090913772583
local_output_nid generation:  0.03550577163696289
local_in_edges_tensor generation:  0.03564953804016113
mini_batch_src_global generation:  0.06731986999511719
r_  generation:  0.5545430183410645
local_output_nid generation:  0.037665367126464844
local_in_edges_tensor generation:  0.03754878044128418
mini_batch_src_global generation:  0.0651693344116211
r_  generation:  0.5534555912017822
local_output_nid generation:  0.03674054145812988
local_in_edges_tensor generation:  0.04228067398071289
mini_batch_src_global generation:  0.06493806838989258
r_  generation:  0.5626785755157471
----------------------check_connections_block total spend ----------------------------- 3.311406373977661
generate_one_block  0.7116837501525879
generate_one_block  0.7017624378204346
generate_one_block  0.6948180198669434
generate_one_block  0.717266321182251
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.041295528411865234
gen group dst list time:  0.02827286720275879
time for parepare:  0.01957535743713379
local_output_nid generation:  0.029139041900634766
local_in_edges_tensor generation:  0.05319380760192871
mini_batch_src_global generation:  0.046526432037353516
r_  generation:  0.5042440891265869
local_output_nid generation:  0.03556656837463379
local_in_edges_tensor generation:  0.04630875587463379
mini_batch_src_global generation:  0.08105874061584473
r_  generation:  0.5362539291381836
local_output_nid generation:  0.03613114356994629
local_in_edges_tensor generation:  0.039786338806152344
mini_batch_src_global generation:  0.0608515739440918
r_  generation:  0.5127959251403809
local_output_nid generation:  0.03675985336303711
local_in_edges_tensor generation:  0.04961085319519043
mini_batch_src_global generation:  0.06140708923339844
r_  generation:  0.5219013690948486
----------------------check_connections_block total spend ----------------------------- 3.145305871963501
generate_one_block  0.6306948661804199
generate_one_block  0.6654911041259766
generate_one_block  0.6464939117431641
generate_one_block  0.6418583393096924
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0013260841369628906  GigaBytes
Max Memory Allocated: 0.0013260841369628906  GigaBytes

connection checking time:  15.626994371414185
block generation total time  13.424252271652222
average batch blocks generation time:  3.3560630679130554
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2420654296875 GB
    Memory Allocated: 0.14356565475463867  GigaBytes
Max Memory Allocated: 0.14356565475463867  GigaBytes

torch.Size([167716, 128])
torch.Size([167483, 64])
torch.Size([166847, 64])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 438, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 434, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 253, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.27 GiB already allocated; 12.44 MiB free; 22.41 GiB reserved in total by PyTorch)
