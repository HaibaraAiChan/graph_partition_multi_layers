Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648475746.0750039
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.027780532836914062
range selection method range initialization spend 0.013066768646240234
time for parepare:  0.018278121948242188
local_output_nid generation:  0.0013365745544433594
local_in_edges_tensor generation:  0.004197835922241211
mini_batch_src_global generation:  0.0020101070404052734
r_  generation:  0.02031254768371582
local_output_nid generation:  0.001493692398071289
local_in_edges_tensor generation:  0.0009477138519287109
mini_batch_src_global generation:  0.0023000240325927734
r_  generation:  0.019283056259155273
local_output_nid generation:  0.0014641284942626953
local_in_edges_tensor generation:  0.0008702278137207031
mini_batch_src_global generation:  0.0014536380767822266
r_  generation:  0.0195615291595459
local_output_nid generation:  0.0016036033630371094
local_in_edges_tensor generation:  0.0008814334869384766
mini_batch_src_global generation:  0.0015299320220947266
r_  generation:  0.02024364471435547
local_output_nid generation:  0.001539468765258789
local_in_edges_tensor generation:  0.0008959770202636719
mini_batch_src_global generation:  0.0015208721160888672
r_  generation:  0.019942045211791992
local_output_nid generation:  0.0015149116516113281
local_in_edges_tensor generation:  0.0008630752563476562
mini_batch_src_global generation:  0.0016291141510009766
r_  generation:  0.02096414566040039
local_output_nid generation:  0.0014955997467041016
local_in_edges_tensor generation:  0.0008809566497802734
mini_batch_src_global generation:  0.0016644001007080078
r_  generation:  0.02117633819580078
local_output_nid generation:  0.0014989376068115234
local_in_edges_tensor generation:  0.0008747577667236328
mini_batch_src_global generation:  0.0016396045684814453
r_  generation:  0.021117210388183594
local_output_nid generation:  0.001508951187133789
local_in_edges_tensor generation:  0.0008561611175537109
mini_batch_src_global generation:  0.00162506103515625
r_  generation:  0.02133655548095703
local_output_nid generation:  0.0014998912811279297
local_in_edges_tensor generation:  0.0009014606475830078
mini_batch_src_global generation:  0.0016405582427978516
r_  generation:  0.02107548713684082
local_output_nid generation:  0.0015718936920166016
local_in_edges_tensor generation:  0.0008716583251953125
mini_batch_src_global generation:  0.0016970634460449219
r_  generation:  0.021302461624145508
local_output_nid generation:  0.0015053749084472656
local_in_edges_tensor generation:  0.0008704662322998047
mini_batch_src_global generation:  0.0016789436340332031
r_  generation:  0.02057337760925293
local_output_nid generation:  0.0015039443969726562
local_in_edges_tensor generation:  0.0008618831634521484
mini_batch_src_global generation:  0.0016791820526123047
r_  generation:  0.02144646644592285
local_output_nid generation:  0.001544952392578125
local_in_edges_tensor generation:  0.0008988380432128906
mini_batch_src_global generation:  0.0017328262329101562
r_  generation:  0.02082657814025879
local_output_nid generation:  0.001565694808959961
local_in_edges_tensor generation:  0.0008370876312255859
mini_batch_src_global generation:  0.0017042160034179688
r_  generation:  0.021055936813354492
local_output_nid generation:  0.0015385150909423828
local_in_edges_tensor generation:  0.0008933544158935547
mini_batch_src_global generation:  0.0016903877258300781
r_  generation:  0.02118659019470215
----------------------check_connections_block total spend ----------------------------- 0.4920473098754883
generate_one_block  0.031044960021972656
generate_one_block  0.03004741668701172
generate_one_block  0.03227066993713379
generate_one_block  0.03151369094848633
generate_one_block  0.031080245971679688
generate_one_block  0.03153395652770996
generate_one_block  0.031440019607543945
generate_one_block  0.031020164489746094
generate_one_block  0.03125810623168945
generate_one_block  0.030930042266845703
generate_one_block  0.03151535987854004
generate_one_block  0.02976083755493164
generate_one_block  0.031226634979248047
generate_one_block  0.03062272071838379
generate_one_block  0.0306546688079834
generate_one_block  0.03056502342224121
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.03794693946838379
gen group dst list time:  0.02068042755126953
time for parepare:  0.019895553588867188
local_output_nid generation:  0.007500410079956055
local_in_edges_tensor generation:  0.020289897918701172
mini_batch_src_global generation:  0.020941495895385742
r_  generation:  0.21237754821777344
local_output_nid generation:  0.013750314712524414
local_in_edges_tensor generation:  0.019810199737548828
mini_batch_src_global generation:  0.02654743194580078
r_  generation:  0.21544480323791504
local_output_nid generation:  0.014289617538452148
local_in_edges_tensor generation:  0.018534421920776367
mini_batch_src_global generation:  0.025808334350585938
r_  generation:  0.22283673286437988
local_output_nid generation:  0.014886617660522461
local_in_edges_tensor generation:  0.017627477645874023
mini_batch_src_global generation:  0.02732229232788086
r_  generation:  0.23071599006652832
local_output_nid generation:  0.015146493911743164
local_in_edges_tensor generation:  0.017183542251586914
mini_batch_src_global generation:  0.028269052505493164
r_  generation:  0.2366940975189209
local_output_nid generation:  0.015373706817626953
local_in_edges_tensor generation:  0.015409708023071289
mini_batch_src_global generation:  0.031369924545288086
r_  generation:  0.23729777336120605
local_output_nid generation:  0.015536785125732422
local_in_edges_tensor generation:  0.015997886657714844
mini_batch_src_global generation:  0.02955460548400879
r_  generation:  0.23343133926391602
local_output_nid generation:  0.015539884567260742
local_in_edges_tensor generation:  0.013439178466796875
mini_batch_src_global generation:  0.030354738235473633
r_  generation:  0.23295354843139648
local_output_nid generation:  0.015637874603271484
local_in_edges_tensor generation:  0.015041112899780273
mini_batch_src_global generation:  0.029672622680664062
r_  generation:  0.232069730758667
local_output_nid generation:  0.015531778335571289
local_in_edges_tensor generation:  0.015139102935791016
mini_batch_src_global generation:  0.030864953994750977
r_  generation:  0.23189997673034668
local_output_nid generation:  0.015717029571533203
local_in_edges_tensor generation:  0.015444517135620117
mini_batch_src_global generation:  0.03162741661071777
r_  generation:  0.23928260803222656
local_output_nid generation:  0.015523433685302734
local_in_edges_tensor generation:  0.013355255126953125
mini_batch_src_global generation:  0.029428482055664062
r_  generation:  0.22649502754211426
local_output_nid generation:  0.015936851501464844
local_in_edges_tensor generation:  0.01535487174987793
mini_batch_src_global generation:  0.030309200286865234
r_  generation:  0.23451972007751465
local_output_nid generation:  0.016146183013916016
local_in_edges_tensor generation:  0.017775535583496094
mini_batch_src_global generation:  0.029567241668701172
r_  generation:  0.2359333038330078
local_output_nid generation:  0.01594710350036621
local_in_edges_tensor generation:  0.015256404876708984
mini_batch_src_global generation:  0.029119253158569336
r_  generation:  0.23043537139892578
local_output_nid generation:  0.01592564582824707
local_in_edges_tensor generation:  0.01524806022644043
mini_batch_src_global generation:  0.02929520606994629
r_  generation:  0.23490619659423828
----------------------check_connections_block total spend ----------------------------- 5.482646226882935
generate_one_block  0.3093547821044922
generate_one_block  0.297191858291626
generate_one_block  0.3023076057434082
generate_one_block  0.31067943572998047
generate_one_block  0.31717872619628906
generate_one_block  0.3153698444366455
generate_one_block  0.3149290084838867
generate_one_block  0.3072471618652344
generate_one_block  0.299360990524292
generate_one_block  0.30022573471069336
generate_one_block  0.3092784881591797
generate_one_block  0.2918126583099365
generate_one_block  0.3090789318084717
generate_one_block  0.3130018711090088
generate_one_block  0.30338406562805176
generate_one_block  0.3020346164703369
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03615450859069824
gen group dst list time:  0.06111955642700195
time for parepare:  0.0196683406829834
local_output_nid generation:  0.02384185791015625
local_in_edges_tensor generation:  0.0381472110748291
mini_batch_src_global generation:  0.04520416259765625
r_  generation:  0.43556880950927734
local_output_nid generation:  0.03442192077636719
local_in_edges_tensor generation:  0.04242229461669922
mini_batch_src_global generation:  0.05094027519226074
r_  generation:  0.44397592544555664
local_output_nid generation:  0.034793853759765625
local_in_edges_tensor generation:  0.032547712326049805
mini_batch_src_global generation:  0.053929805755615234
r_  generation:  0.44871068000793457
local_output_nid generation:  0.03577995300292969
local_in_edges_tensor generation:  0.03758955001831055
mini_batch_src_global generation:  0.05217742919921875
r_  generation:  0.449047327041626
local_output_nid generation:  0.03562521934509277
local_in_edges_tensor generation:  0.028901338577270508
mini_batch_src_global generation:  0.05255007743835449
r_  generation:  0.4572179317474365
local_output_nid generation:  0.03579998016357422
local_in_edges_tensor generation:  0.02864813804626465
mini_batch_src_global generation:  0.05327630043029785
r_  generation:  0.45233964920043945
local_output_nid generation:  0.035741567611694336
local_in_edges_tensor generation:  0.04032158851623535
mini_batch_src_global generation:  0.0517427921295166
r_  generation:  0.45603442192077637
local_output_nid generation:  0.03571724891662598
local_in_edges_tensor generation:  0.031992435455322266
mini_batch_src_global generation:  0.053725481033325195
r_  generation:  0.4567105770111084
local_output_nid generation:  0.03602433204650879
local_in_edges_tensor generation:  0.029359102249145508
mini_batch_src_global generation:  0.05185270309448242
r_  generation:  0.4574859142303467
local_output_nid generation:  0.036496877670288086
local_in_edges_tensor generation:  0.029167652130126953
mini_batch_src_global generation:  0.05272245407104492
r_  generation:  0.4530618190765381
local_output_nid generation:  0.03631186485290527
local_in_edges_tensor generation:  0.039548635482788086
mini_batch_src_global generation:  0.052941322326660156
r_  generation:  0.4650087356567383
local_output_nid generation:  0.03632760047912598
local_in_edges_tensor generation:  0.027790069580078125
mini_batch_src_global generation:  0.05287432670593262
r_  generation:  0.4518396854400635
local_output_nid generation:  0.036017417907714844
local_in_edges_tensor generation:  0.028809785842895508
mini_batch_src_global generation:  0.05496478080749512
r_  generation:  0.45870041847229004
local_output_nid generation:  0.03646373748779297
local_in_edges_tensor generation:  0.03217649459838867
mini_batch_src_global generation:  0.052637577056884766
r_  generation:  0.46188950538635254
local_output_nid generation:  0.03659176826477051
local_in_edges_tensor generation:  0.03618264198303223
mini_batch_src_global generation:  0.05159449577331543
r_  generation:  0.4601716995239258
local_output_nid generation:  0.03641986846923828
local_in_edges_tensor generation:  0.031751155853271484
mini_batch_src_global generation:  0.05277395248413086
r_  generation:  0.45807766914367676
----------------------check_connections_block total spend ----------------------------- 10.789187908172607
generate_one_block  0.5778305530548096
generate_one_block  0.5830233097076416
generate_one_block  0.5962815284729004
generate_one_block  0.6041297912597656
generate_one_block  0.5698745250701904
generate_one_block  0.5823574066162109
generate_one_block  0.6307120323181152
generate_one_block  0.5841362476348877
generate_one_block  0.5695388317108154
generate_one_block  0.5939216613769531
generate_one_block  0.5941247940063477
generate_one_block  0.5869503021240234
generate_one_block  0.5731978416442871
generate_one_block  0.5995895862579346
generate_one_block  0.5760457515716553
generate_one_block  0.5949594974517822
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  16.271834135055542
block generation total time  14.319109439849854
average batch blocks generation time:  0.8949443399906158
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1795654296875 GB
    Memory Allocated: 0.0959172248840332  GigaBytes
Max Memory Allocated: 0.0959172248840332  GigaBytes

torch.Size([154987, 128])
torch.Size([124890, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 28.00 MiB (GPU 0; 23.62 GiB total capacity; 22.13 GiB already allocated; 28.44 MiB free; 22.40 GiB reserved in total by PyTorch)
