Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648506467.085919
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0029964447021484375  GigaBytes
Max Memory Allocated: 0.0029964447021484375  GigaBytes

The real block id is  4
get_global_graph_edges_ids_block function  spend 0.024376392364501953
range selection method range initialization spend 0.013664007186889648
time for parepare:  0.017839908599853516
local_output_nid generation:  0.0026209354400634766
local_in_edges_tensor generation:  0.004442453384399414
mini_batch_src_global generation:  0.0034885406494140625
r_  generation:  0.03802967071533203
local_output_nid generation:  0.0030455589294433594
local_in_edges_tensor generation:  0.0016107559204101562
mini_batch_src_global generation:  0.004372835159301758
r_  generation:  0.03994894027709961
local_output_nid generation:  0.003106832504272461
local_in_edges_tensor generation:  0.001683950424194336
mini_batch_src_global generation:  0.0028905868530273438
r_  generation:  0.03889107704162598
local_output_nid generation:  0.0031235218048095703
local_in_edges_tensor generation:  0.0016336441040039062
mini_batch_src_global generation:  0.002938508987426758
r_  generation:  0.03990674018859863
local_output_nid generation:  0.0031108856201171875
local_in_edges_tensor generation:  0.0016179084777832031
mini_batch_src_global generation:  0.0030586719512939453
r_  generation:  0.04029512405395508
local_output_nid generation:  0.0031728744506835938
local_in_edges_tensor generation:  0.0016090869903564453
mini_batch_src_global generation:  0.003186941146850586
r_  generation:  0.0431060791015625
local_output_nid generation:  0.003124237060546875
local_in_edges_tensor generation:  0.0016639232635498047
mini_batch_src_global generation:  0.0038890838623046875
r_  generation:  0.04295754432678223
local_output_nid generation:  0.0031511783599853516
local_in_edges_tensor generation:  0.001653432846069336
mini_batch_src_global generation:  0.003402233123779297
r_  generation:  0.041220664978027344
----------------------check_connections_block total spend ----------------------------- 0.4800527095794678
generate_one_block  0.05458498001098633
generate_one_block  0.0564267635345459
generate_one_block  0.055086374282836914
generate_one_block  0.05469989776611328
generate_one_block  0.05731058120727539
generate_one_block  0.05580925941467285
generate_one_block  0.054717063903808594
generate_one_block  0.05574345588684082
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.039374351501464844
gen group dst list time:  0.015230417251586914
time for parepare:  0.019802570343017578
local_output_nid generation:  0.010320425033569336
local_in_edges_tensor generation:  0.026078462600708008
mini_batch_src_global generation:  0.031262874603271484
r_  generation:  0.29749107360839844
local_output_nid generation:  0.017930269241333008
local_in_edges_tensor generation:  0.02753448486328125
mini_batch_src_global generation:  0.03960752487182617
r_  generation:  0.3074641227722168
local_output_nid generation:  0.018069982528686523
local_in_edges_tensor generation:  0.01710653305053711
mini_batch_src_global generation:  0.0374908447265625
r_  generation:  0.3083012104034424
local_output_nid generation:  0.01828455924987793
local_in_edges_tensor generation:  0.022435665130615234
mini_batch_src_global generation:  0.03739047050476074
r_  generation:  0.3112764358520508
local_output_nid generation:  0.018811702728271484
local_in_edges_tensor generation:  0.01973724365234375
mini_batch_src_global generation:  0.038399696350097656
r_  generation:  0.31180596351623535
local_output_nid generation:  0.01881861686706543
local_in_edges_tensor generation:  0.022191286087036133
mini_batch_src_global generation:  0.03898143768310547
r_  generation:  0.3134582042694092
local_output_nid generation:  0.0190889835357666
local_in_edges_tensor generation:  0.017863035202026367
mini_batch_src_global generation:  0.03888368606567383
r_  generation:  0.31186652183532715
local_output_nid generation:  0.019130229949951172
local_in_edges_tensor generation:  0.022587299346923828
mini_batch_src_global generation:  0.03928732872009277
r_  generation:  0.32238197326660156
----------------------check_connections_block total spend ----------------------------- 3.6558289527893066
generate_one_block  0.404843807220459
generate_one_block  0.41236114501953125
generate_one_block  0.40007877349853516
generate_one_block  0.4029114246368408
generate_one_block  0.40531325340270996
generate_one_block  0.41899800300598145
generate_one_block  0.4087247848510742
generate_one_block  0.41156673431396484
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.03519010543823242
gen group dst list time:  0.03562474250793457
time for parepare:  0.019197702407836914
local_output_nid generation:  0.02462458610534668
local_in_edges_tensor generation:  0.04176783561706543
mini_batch_src_global generation:  0.05308818817138672
r_  generation:  0.5383117198944092
local_output_nid generation:  0.031963348388671875
local_in_edges_tensor generation:  0.05190086364746094
mini_batch_src_global generation:  0.06144404411315918
r_  generation:  0.5236506462097168
local_output_nid generation:  0.032193899154663086
local_in_edges_tensor generation:  0.037168025970458984
mini_batch_src_global generation:  0.058222055435180664
r_  generation:  0.5404415130615234
local_output_nid generation:  0.03267693519592285
local_in_edges_tensor generation:  0.04241204261779785
mini_batch_src_global generation:  0.06122422218322754
r_  generation:  0.5300493240356445
local_output_nid generation:  0.03267049789428711
local_in_edges_tensor generation:  0.033452749252319336
mini_batch_src_global generation:  0.05945777893066406
r_  generation:  0.5415053367614746
local_output_nid generation:  0.03291964530944824
local_in_edges_tensor generation:  0.03756523132324219
mini_batch_src_global generation:  0.06270980834960938
r_  generation:  0.5374610424041748
local_output_nid generation:  0.03309917449951172
local_in_edges_tensor generation:  0.0374758243560791
mini_batch_src_global generation:  0.06009626388549805
r_  generation:  0.5454256534576416
local_output_nid generation:  0.03329825401306152
local_in_edges_tensor generation:  0.03809404373168945
mini_batch_src_global generation:  0.06702995300292969
r_  generation:  0.5319111347198486
----------------------check_connections_block total spend ----------------------------- 6.295442342758179
generate_one_block  0.6726913452148438
generate_one_block  0.6885826587677002
generate_one_block  0.6755740642547607
generate_one_block  0.6767570972442627
generate_one_block  0.6633069515228271
generate_one_block  0.6757423877716064
generate_one_block  0.6979703903198242
generate_one_block  0.6915512084960938
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.03320026397705078
gen group dst list time:  0.0447850227355957
time for parepare:  0.018932819366455078
local_output_nid generation:  0.029578685760498047
local_in_edges_tensor generation:  0.03959941864013672
mini_batch_src_global generation:  0.053327322006225586
r_  generation:  0.5303544998168945
local_output_nid generation:  0.035288095474243164
local_in_edges_tensor generation:  0.05322527885437012
mini_batch_src_global generation:  0.06270885467529297
r_  generation:  0.5510580539703369
local_output_nid generation:  0.03575491905212402
local_in_edges_tensor generation:  0.045444488525390625
mini_batch_src_global generation:  0.06279349327087402
r_  generation:  0.5450420379638672
local_output_nid generation:  0.036696672439575195
local_in_edges_tensor generation:  0.04578089714050293
mini_batch_src_global generation:  0.05979323387145996
r_  generation:  0.5554687976837158
local_output_nid generation:  0.03657698631286621
local_in_edges_tensor generation:  0.03529691696166992
mini_batch_src_global generation:  0.06045341491699219
r_  generation:  0.5422146320343018
local_output_nid generation:  0.03649711608886719
local_in_edges_tensor generation:  0.03603696823120117
mini_batch_src_global generation:  0.0604093074798584
r_  generation:  0.5563580989837646
local_output_nid generation:  0.03681778907775879
local_in_edges_tensor generation:  0.04318070411682129
mini_batch_src_global generation:  0.060494184494018555
r_  generation:  0.5529818534851074
local_output_nid generation:  0.036943674087524414
local_in_edges_tensor generation:  0.04575347900390625
mini_batch_src_global generation:  0.060118913650512695
r_  generation:  0.5613906383514404
----------------------check_connections_block total spend ----------------------------- 6.5237812995910645
generate_one_block  0.6813652515411377
generate_one_block  0.6819262504577637
generate_one_block  0.7031371593475342
generate_one_block  0.6910884380340576
generate_one_block  0.6756677627563477
generate_one_block  0.687363862991333
generate_one_block  0.736452579498291
generate_one_block  0.6901130676269531
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.05305814743041992
gen group dst list time:  0.048206329345703125
time for parepare:  0.019593238830566406
local_output_nid generation:  0.03216266632080078
local_in_edges_tensor generation:  0.04203224182128906
mini_batch_src_global generation:  0.047093868255615234
r_  generation:  0.504417896270752
local_output_nid generation:  0.03800463676452637
local_in_edges_tensor generation:  0.05117082595825195
mini_batch_src_global generation:  0.060012102127075195
r_  generation:  0.5041263103485107
local_output_nid generation:  0.03735756874084473
local_in_edges_tensor generation:  0.035532236099243164
mini_batch_src_global generation:  0.05957841873168945
r_  generation:  0.5028045177459717
local_output_nid generation:  0.03798627853393555
local_in_edges_tensor generation:  0.04002809524536133
mini_batch_src_global generation:  0.06728363037109375
r_  generation:  0.5126688480377197
local_output_nid generation:  0.03826427459716797
local_in_edges_tensor generation:  0.047534942626953125
mini_batch_src_global generation:  0.06004524230957031
r_  generation:  0.5041275024414062
local_output_nid generation:  0.038057804107666016
local_in_edges_tensor generation:  0.0392451286315918
mini_batch_src_global generation:  0.05837583541870117
r_  generation:  0.510793924331665
local_output_nid generation:  0.04090428352355957
local_in_edges_tensor generation:  0.04464435577392578
mini_batch_src_global generation:  0.05915689468383789
r_  generation:  0.50771164894104
local_output_nid generation:  0.03933525085449219
local_in_edges_tensor generation:  0.04444241523742676
mini_batch_src_global generation:  0.058176279067993164
r_  generation:  0.5106613636016846
----------------------check_connections_block total spend ----------------------------- 6.1566245555877686
generate_one_block  0.6395111083984375
generate_one_block  0.6349689960479736
generate_one_block  0.6345217227935791
generate_one_block  0.6399309635162354
generate_one_block  0.6356322765350342
generate_one_block  0.642247200012207
generate_one_block  0.6408531665802002
generate_one_block  0.6976149082183838
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0029964447021484375  GigaBytes
Max Memory Allocated: 0.0029964447021484375  GigaBytes

connection checking time:  22.63167715072632
block generation total time  19.419368743896484
average batch blocks generation time:  2.4274210929870605
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2225341796875 GB
    Memory Allocated: 0.1288771629333496  GigaBytes
Max Memory Allocated: 0.1288771629333496  GigaBytes

torch.Size([166932, 128])
torch.Size([165718, 128])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.35 GiB already allocated; 4.44 MiB free; 22.42 GiB reserved in total by PyTorch)
