Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648526600.7634637
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0013260841369628906  GigaBytes
Max Memory Allocated: 0.0013260841369628906  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.023681163787841797
range selection method range initialization spend 0.013742208480834961
time for parepare:  0.01846456527709961
local_output_nid generation:  0.010841846466064453
local_in_edges_tensor generation:  0.010108709335327148
mini_batch_src_global generation:  0.014112472534179688
r_  generation:  0.17205524444580078
local_output_nid generation:  0.011829137802124023
local_in_edges_tensor generation:  0.01051640510559082
mini_batch_src_global generation:  0.017073869705200195
r_  generation:  0.18093395233154297
----------------------check_connections_block total spend ----------------------------- 0.5154519081115723
generate_one_block  0.198836088180542
generate_one_block  0.20102572441101074
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.04062843322753906
gen group dst list time:  0.007529258728027344
time for parepare:  0.019492149353027344
local_output_nid generation:  0.017128705978393555
local_in_edges_tensor generation:  0.040531158447265625
mini_batch_src_global generation:  0.04941511154174805
r_  generation:  0.5231215953826904
local_output_nid generation:  0.030687570571899414
local_in_edges_tensor generation:  0.05311894416809082
mini_batch_src_global generation:  0.07467889785766602
r_  generation:  0.5295159816741943
----------------------check_connections_block total spend ----------------------------- 1.570185899734497
generate_one_block  0.6645298004150391
generate_one_block  0.6548550128936768
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.0468904972076416
gen group dst list time:  0.012792587280273438
time for parepare:  0.019243240356445312
local_output_nid generation:  0.02364373207092285
local_in_edges_tensor generation:  0.06738710403442383
mini_batch_src_global generation:  0.050254106521606445
r_  generation:  0.57157301902771
local_output_nid generation:  0.03084707260131836
local_in_edges_tensor generation:  0.05154705047607422
mini_batch_src_global generation:  0.06354141235351562
r_  generation:  0.5744011402130127
----------------------check_connections_block total spend ----------------------------- 1.6966187953948975
generate_one_block  0.7289397716522217
generate_one_block  0.7251129150390625
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.04191470146179199
gen group dst list time:  0.012640237808227539
time for parepare:  0.018920421600341797
local_output_nid generation:  0.023262977600097656
local_in_edges_tensor generation:  0.04125857353210449
mini_batch_src_global generation:  0.0545954704284668
r_  generation:  0.5737946033477783
local_output_nid generation:  0.031037569046020508
local_in_edges_tensor generation:  0.052135467529296875
mini_batch_src_global generation:  0.06438660621643066
r_  generation:  0.5866625308990479
----------------------check_connections_block total spend ----------------------------- 1.7024774551391602
generate_one_block  0.7572855949401855
generate_one_block  0.7364223003387451
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.050112009048461914
gen group dst list time:  0.015316963195800781
time for parepare:  0.01885819435119629
local_output_nid generation:  0.023755311965942383
local_in_edges_tensor generation:  0.04268622398376465
mini_batch_src_global generation:  0.05053544044494629
r_  generation:  0.554189920425415
local_output_nid generation:  0.03201150894165039
local_in_edges_tensor generation:  0.03112959861755371
mini_batch_src_global generation:  0.06356310844421387
r_  generation:  0.5641789436340332
----------------------check_connections_block total spend ----------------------------- 1.6436994075775146
generate_one_block  0.723416805267334
generate_one_block  0.7393131256103516
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04077863693237305
gen group dst list time:  0.015737295150756836
time for parepare:  0.018629074096679688
local_output_nid generation:  0.025774478912353516
local_in_edges_tensor generation:  0.03890705108642578
mini_batch_src_global generation:  0.04866218566894531
r_  generation:  0.5185518264770508
local_output_nid generation:  0.033145904541015625
local_in_edges_tensor generation:  0.044586896896362305
mini_batch_src_global generation:  0.058653831481933594
r_  generation:  0.5223584175109863
----------------------check_connections_block total spend ----------------------------- 1.5475571155548096
generate_one_block  0.6393675804138184
generate_one_block  0.6527535915374756
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0013260841369628906  GigaBytes
Max Memory Allocated: 0.0013260841369628906  GigaBytes

connection checking time:  8.160538673400879
block generation total time  7.02199649810791
average batch blocks generation time:  3.510998249053955
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2420654296875 GB
    Memory Allocated: 0.14833402633666992  GigaBytes
Max Memory Allocated: 0.14833402633666992  GigaBytes

torch.Size([168039, 128])
torch.Size([167909, 64])
torch.Size([167586, 64])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 438, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 434, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 253, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.26 GiB already allocated; 20.44 MiB free; 22.40 GiB reserved in total by PyTorch)
