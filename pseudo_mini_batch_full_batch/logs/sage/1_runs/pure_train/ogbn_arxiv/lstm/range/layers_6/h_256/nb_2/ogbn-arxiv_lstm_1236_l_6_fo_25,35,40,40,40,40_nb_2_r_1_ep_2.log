Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648528292.9138036
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0291748046875 GB
    Memory Allocated: 0.012590885162353516  GigaBytes
Max Memory Allocated: 0.012590885162353516  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.024106502532958984
range selection method range initialization spend 0.013862133026123047
time for parepare:  0.017738819122314453
local_output_nid generation:  0.010454654693603516
local_in_edges_tensor generation:  0.01011800765991211
mini_batch_src_global generation:  0.014350652694702148
r_  generation:  0.17052006721496582
local_output_nid generation:  0.011857271194458008
local_in_edges_tensor generation:  0.010664224624633789
mini_batch_src_global generation:  0.01716780662536621
r_  generation:  0.20746827125549316
----------------------check_connections_block total spend ----------------------------- 0.543503999710083
generate_one_block  0.21198034286499023
generate_one_block  0.22182011604309082
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.04506635665893555
gen group dst list time:  0.009070873260498047
time for parepare:  0.02046942710876465
local_output_nid generation:  0.01784372329711914
local_in_edges_tensor generation:  0.04254293441772461
mini_batch_src_global generation:  0.04577136039733887
r_  generation:  0.515594482421875
local_output_nid generation:  0.026379108428955078
local_in_edges_tensor generation:  0.04791879653930664
mini_batch_src_global generation:  0.05791187286376953
r_  generation:  0.5327653884887695
----------------------check_connections_block total spend ----------------------------- 1.530306339263916
generate_one_block  0.6841001510620117
generate_one_block  0.6733393669128418
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.03970503807067871
gen group dst list time:  0.014759063720703125
time for parepare:  0.020955801010131836
local_output_nid generation:  0.023919105529785156
local_in_edges_tensor generation:  0.0744636058807373
mini_batch_src_global generation:  0.05443620681762695
r_  generation:  0.6023092269897461
local_output_nid generation:  0.035338401794433594
local_in_edges_tensor generation:  0.05173611640930176
mini_batch_src_global generation:  0.06507205963134766
r_  generation:  0.5700995922088623
----------------------check_connections_block total spend ----------------------------- 1.7580044269561768
generate_one_block  0.7410905361175537
generate_one_block  0.7232880592346191
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.04737210273742676
gen group dst list time:  0.012578964233398438
time for parepare:  0.01929330825805664
local_output_nid generation:  0.023621082305908203
local_in_edges_tensor generation:  0.057723045349121094
mini_batch_src_global generation:  0.05089592933654785
r_  generation:  0.5658984184265137
local_output_nid generation:  0.03165268898010254
local_in_edges_tensor generation:  0.05365777015686035
mini_batch_src_global generation:  0.06429791450500488
r_  generation:  0.6028988361358643
----------------------check_connections_block total spend ----------------------------- 1.730741024017334
generate_one_block  0.7504074573516846
generate_one_block  0.7398457527160645
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.05328679084777832
gen group dst list time:  0.014125823974609375
time for parepare:  0.01886749267578125
local_output_nid generation:  0.023514747619628906
local_in_edges_tensor generation:  0.05171513557434082
mini_batch_src_global generation:  0.05293083190917969
r_  generation:  0.5610454082489014
local_output_nid generation:  0.032834768295288086
local_in_edges_tensor generation:  0.033408164978027344
mini_batch_src_global generation:  0.06323432922363281
r_  generation:  0.5610289573669434
----------------------check_connections_block total spend ----------------------------- 1.6500203609466553
generate_one_block  0.6924083232879639
generate_one_block  0.7424724102020264
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04599428176879883
gen group dst list time:  0.01579880714416504
time for parepare:  0.020885944366455078
local_output_nid generation:  0.02642822265625
local_in_edges_tensor generation:  0.04741716384887695
mini_batch_src_global generation:  0.06149101257324219
r_  generation:  0.5234577655792236
local_output_nid generation:  0.03501415252685547
local_in_edges_tensor generation:  0.03631329536437988
mini_batch_src_global generation:  0.0586705207824707
r_  generation:  0.5361595153808594
----------------------check_connections_block total spend ----------------------------- 1.5965919494628906
generate_one_block  0.6960692405700684
generate_one_block  0.6861395835876465
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0291748046875 GB
    Memory Allocated: 0.012590885162353516  GigaBytes
Max Memory Allocated: 0.012590885162353516  GigaBytes

connection checking time:  8.265664100646973
block generation total time  7.1291608810424805
average batch blocks generation time:  3.5645804405212402
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2537841796875 GB
    Memory Allocated: 0.15961265563964844  GigaBytes
Max Memory Allocated: 0.15961265563964844  GigaBytes

torch.Size([168071, 128])
torch.Size([167928, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 438, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 434, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 253, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 50.00 MiB (GPU 0; 23.62 GiB total capacity; 21.94 GiB already allocated; 12.44 MiB free; 22.41 GiB reserved in total by PyTorch)
