Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648475717.183738
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.026474475860595703
range selection method range initialization spend 0.01390695571899414
time for parepare:  0.018063783645629883
local_output_nid generation:  0.002624034881591797
local_in_edges_tensor generation:  0.0038437843322753906
mini_batch_src_global generation:  0.003746509552001953
r_  generation:  0.04252457618713379
local_output_nid generation:  0.003112316131591797
local_in_edges_tensor generation:  0.001683950424194336
mini_batch_src_global generation:  0.004815578460693359
r_  generation:  0.044046640396118164
local_output_nid generation:  0.0031023025512695312
local_in_edges_tensor generation:  0.001764535903930664
mini_batch_src_global generation:  0.003159046173095703
r_  generation:  0.04498934745788574
local_output_nid generation:  0.0031871795654296875
local_in_edges_tensor generation:  0.0017251968383789062
mini_batch_src_global generation:  0.003420114517211914
r_  generation:  0.046889543533325195
local_output_nid generation:  0.0031228065490722656
local_in_edges_tensor generation:  0.001697540283203125
mini_batch_src_global generation:  0.0035185813903808594
r_  generation:  0.04681396484375
local_output_nid generation:  0.0031273365020751953
local_in_edges_tensor generation:  0.0017285346984863281
mini_batch_src_global generation:  0.003656148910522461
r_  generation:  0.046846628189086914
local_output_nid generation:  0.0032265186309814453
local_in_edges_tensor generation:  0.0016779899597167969
mini_batch_src_global generation:  0.003612518310546875
r_  generation:  0.04765748977661133
local_output_nid generation:  0.003156900405883789
local_in_edges_tensor generation:  0.0016744136810302734
mini_batch_src_global generation:  0.003761768341064453
r_  generation:  0.047597646713256836
----------------------check_connections_block total spend ----------------------------- 0.5321216583251953
generate_one_block  0.06030678749084473
generate_one_block  0.06149625778198242
generate_one_block  0.06227469444274902
generate_one_block  0.06319761276245117
generate_one_block  0.06412744522094727
generate_one_block  0.061130523681640625
generate_one_block  0.06216287612915039
generate_one_block  0.06161952018737793
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.03477215766906738
gen group dst list time:  0.016559123992919922
time for parepare:  0.019275665283203125
local_output_nid generation:  0.010946989059448242
local_in_edges_tensor generation:  0.027452945709228516
mini_batch_src_global generation:  0.029279232025146484
r_  generation:  0.3158683776855469
local_output_nid generation:  0.01696634292602539
local_in_edges_tensor generation:  0.029837608337402344
mini_batch_src_global generation:  0.040807485580444336
r_  generation:  0.3347487449645996
local_output_nid generation:  0.01730632781982422
local_in_edges_tensor generation:  0.021582365036010742
mini_batch_src_global generation:  0.040375709533691406
r_  generation:  0.33771800994873047
local_output_nid generation:  0.01803755760192871
local_in_edges_tensor generation:  0.025003910064697266
mini_batch_src_global generation:  0.0394282341003418
r_  generation:  0.3438231945037842
local_output_nid generation:  0.018117904663085938
local_in_edges_tensor generation:  0.019350767135620117
mini_batch_src_global generation:  0.041338443756103516
r_  generation:  0.3409552574157715
local_output_nid generation:  0.018125057220458984
local_in_edges_tensor generation:  0.021684885025024414
mini_batch_src_global generation:  0.04105782508850098
r_  generation:  0.3414888381958008
local_output_nid generation:  0.018364906311035156
local_in_edges_tensor generation:  0.028135061264038086
mini_batch_src_global generation:  0.04001641273498535
r_  generation:  0.33981800079345703
local_output_nid generation:  0.018019914627075195
local_in_edges_tensor generation:  0.019464492797851562
mini_batch_src_global generation:  0.0403742790222168
r_  generation:  0.3343372344970703
----------------------check_connections_block total spend ----------------------------- 3.9195220470428467
generate_one_block  0.42858004570007324
generate_one_block  0.43157052993774414
generate_one_block  0.43881845474243164
generate_one_block  0.435349702835083
generate_one_block  0.4279160499572754
generate_one_block  0.4364602565765381
generate_one_block  0.4434232711791992
generate_one_block  0.42635345458984375
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03194856643676758
gen group dst list time:  0.036447763442993164
time for parepare:  0.01918935775756836
local_output_nid generation:  0.025039196014404297
local_in_edges_tensor generation:  0.03715157508850098
mini_batch_src_global generation:  0.04687047004699707
r_  generation:  0.4717869758605957
local_output_nid generation:  0.032326459884643555
local_in_edges_tensor generation:  0.04794192314147949
mini_batch_src_global generation:  0.05322885513305664
r_  generation:  0.48729610443115234
local_output_nid generation:  0.0335688591003418
local_in_edges_tensor generation:  0.04422903060913086
mini_batch_src_global generation:  0.04986000061035156
r_  generation:  0.4919276237487793
local_output_nid generation:  0.03353548049926758
local_in_edges_tensor generation:  0.032593727111816406
mini_batch_src_global generation:  0.05313396453857422
r_  generation:  0.48903465270996094
local_output_nid generation:  0.03395509719848633
local_in_edges_tensor generation:  0.035939693450927734
mini_batch_src_global generation:  0.055635929107666016
r_  generation:  0.5044901371002197
local_output_nid generation:  0.03365683555603027
local_in_edges_tensor generation:  0.032495975494384766
mini_batch_src_global generation:  0.053852081298828125
r_  generation:  0.494598388671875
local_output_nid generation:  0.034049034118652344
local_in_edges_tensor generation:  0.032434940338134766
mini_batch_src_global generation:  0.05701136589050293
r_  generation:  0.5085394382476807
local_output_nid generation:  0.03414130210876465
local_in_edges_tensor generation:  0.03694796562194824
mini_batch_src_global generation:  0.05724215507507324
r_  generation:  0.49348020553588867
----------------------check_connections_block total spend ----------------------------- 5.801365852355957
generate_one_block  0.6055595874786377
generate_one_block  0.6149237155914307
generate_one_block  0.6162540912628174
generate_one_block  0.6137628555297852
generate_one_block  0.6267361640930176
generate_one_block  0.6047451496124268
generate_one_block  0.6351191997528076
generate_one_block  0.6079349517822266
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  9.720887899398804
block generation total time  8.393507480621338
average batch blocks generation time:  1.0491884350776672
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1854248046875 GB
    Memory Allocated: 0.10237741470336914  GigaBytes
Max Memory Allocated: 0.10237741470336914  GigaBytes

torch.Size([160707, 128])
torch.Size([142451, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 138, in invoke_udf_reduce
    for k, msg in msgdata_bkt.items():
  File "/usr/lib/python3.6/_collections_abc.py", line 744, in __iter__
    yield (key, self._mapping[key])
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/frame.py", line 393, in __getitem__
    return self._columns[name].data
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/frame.py", line 122, in data
    self.storage = F.gather_row(self.storage, self.index)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/backend/pytorch/tensor.py", line 186, in gather_row
    return th.index_select(data, 0, row_index.long())
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.21 GiB already allocated; 20.44 MiB free; 22.40 GiB reserved in total by PyTorch)
