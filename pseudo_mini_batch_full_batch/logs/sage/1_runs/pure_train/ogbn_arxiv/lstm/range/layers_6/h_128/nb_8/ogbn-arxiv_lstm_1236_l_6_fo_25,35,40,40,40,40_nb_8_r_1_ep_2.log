Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648527514.7239802
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.003612995147705078  GigaBytes
Max Memory Allocated: 0.003612995147705078  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.024522781372070312
range selection method range initialization spend 0.013520956039428711
time for parepare:  0.01788187026977539
local_output_nid generation:  0.0026383399963378906
local_in_edges_tensor generation:  0.004597663879394531
mini_batch_src_global generation:  0.003317594528198242
r_  generation:  0.03809332847595215
local_output_nid generation:  0.0032672882080078125
local_in_edges_tensor generation:  0.0015952587127685547
mini_batch_src_global generation:  0.004209995269775391
r_  generation:  0.03812265396118164
local_output_nid generation:  0.0030641555786132812
local_in_edges_tensor generation:  0.001619100570678711
mini_batch_src_global generation:  0.0028018951416015625
r_  generation:  0.039344072341918945
local_output_nid generation:  0.0032019615173339844
local_in_edges_tensor generation:  0.0016779899597167969
mini_batch_src_global generation:  0.0027837753295898438
r_  generation:  0.039550065994262695
local_output_nid generation:  0.003055095672607422
local_in_edges_tensor generation:  0.001626729965209961
mini_batch_src_global generation:  0.0031173229217529297
r_  generation:  0.040059566497802734
local_output_nid generation:  0.003080606460571289
local_in_edges_tensor generation:  0.001621246337890625
mini_batch_src_global generation:  0.0030143260955810547
r_  generation:  0.04036974906921387
local_output_nid generation:  0.0030486583709716797
local_in_edges_tensor generation:  0.0016219615936279297
mini_batch_src_global generation:  0.003168344497680664
r_  generation:  0.04023456573486328
local_output_nid generation:  0.0032651424407958984
local_in_edges_tensor generation:  0.00165557861328125
mini_batch_src_global generation:  0.003161191940307617
r_  generation:  0.040305137634277344
----------------------check_connections_block total spend ----------------------------- 0.46697258949279785
generate_one_block  0.05566668510437012
generate_one_block  0.0553593635559082
generate_one_block  0.05591750144958496
generate_one_block  0.05515098571777344
generate_one_block  0.05733656883239746
generate_one_block  0.05419564247131348
generate_one_block  0.054583072662353516
generate_one_block  0.054291725158691406
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.042244911193847656
gen group dst list time:  0.015405893325805664
time for parepare:  0.020181894302368164
local_output_nid generation:  0.01072835922241211
local_in_edges_tensor generation:  0.02991318702697754
mini_batch_src_global generation:  0.030808210372924805
r_  generation:  0.2951476573944092
local_output_nid generation:  0.018167972564697266
local_in_edges_tensor generation:  0.02764415740966797
mini_batch_src_global generation:  0.03617119789123535
r_  generation:  0.30762648582458496
local_output_nid generation:  0.01905536651611328
local_in_edges_tensor generation:  0.0259091854095459
mini_batch_src_global generation:  0.03603363037109375
r_  generation:  0.309511661529541
local_output_nid generation:  0.019379138946533203
local_in_edges_tensor generation:  0.01809096336364746
mini_batch_src_global generation:  0.03709530830383301
r_  generation:  0.3124074935913086
local_output_nid generation:  0.01959395408630371
local_in_edges_tensor generation:  0.02055811882019043
mini_batch_src_global generation:  0.037352561950683594
r_  generation:  0.31479859352111816
local_output_nid generation:  0.019789934158325195
local_in_edges_tensor generation:  0.01778101921081543
mini_batch_src_global generation:  0.037850141525268555
r_  generation:  0.3205678462982178
local_output_nid generation:  0.01968216896057129
local_in_edges_tensor generation:  0.020369768142700195
mini_batch_src_global generation:  0.03743886947631836
r_  generation:  0.31252527236938477
local_output_nid generation:  0.02008342742919922
local_in_edges_tensor generation:  0.024005889892578125
mini_batch_src_global generation:  0.04035067558288574
r_  generation:  0.3202974796295166
----------------------check_connections_block total spend ----------------------------- 3.6677117347717285
generate_one_block  0.4147517681121826
generate_one_block  0.4132530689239502
generate_one_block  0.41707372665405273
generate_one_block  0.40787339210510254
generate_one_block  0.41580843925476074
generate_one_block  0.4210338592529297
generate_one_block  0.40900683403015137
generate_one_block  0.409393310546875
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.03678321838378906
gen group dst list time:  0.03562593460083008
time for parepare:  0.018865346908569336
local_output_nid generation:  0.02785778045654297
local_in_edges_tensor generation:  0.04687047004699707
mini_batch_src_global generation:  0.04909563064575195
r_  generation:  0.5157432556152344
local_output_nid generation:  0.031940460205078125
local_in_edges_tensor generation:  0.05171012878417969
mini_batch_src_global generation:  0.060985565185546875
r_  generation:  0.530493974685669
local_output_nid generation:  0.03234243392944336
local_in_edges_tensor generation:  0.043125152587890625
mini_batch_src_global generation:  0.05669689178466797
r_  generation:  0.542039155960083
local_output_nid generation:  0.03268289566040039
local_in_edges_tensor generation:  0.038817405700683594
mini_batch_src_global generation:  0.06273150444030762
r_  generation:  0.5326933860778809
local_output_nid generation:  0.032922983169555664
local_in_edges_tensor generation:  0.039096832275390625
mini_batch_src_global generation:  0.05869770050048828
r_  generation:  0.5440084934234619
local_output_nid generation:  0.03495597839355469
local_in_edges_tensor generation:  0.043755292892456055
mini_batch_src_global generation:  0.06281232833862305
r_  generation:  0.5371682643890381
local_output_nid generation:  0.03460955619812012
local_in_edges_tensor generation:  0.04734683036804199
mini_batch_src_global generation:  0.06502032279968262
r_  generation:  0.5653548240661621
local_output_nid generation:  0.03505301475524902
local_in_edges_tensor generation:  0.045586347579956055
mini_batch_src_global generation:  0.06674504280090332
r_  generation:  0.5307841300964355
----------------------check_connections_block total spend ----------------------------- 6.381273984909058
generate_one_block  0.6812005043029785
generate_one_block  0.6975419521331787
generate_one_block  0.697279691696167
generate_one_block  0.6960675716400146
generate_one_block  0.6825120449066162
generate_one_block  0.6792535781860352
generate_one_block  0.7280035018920898
generate_one_block  0.6871683597564697
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.05097365379333496
gen group dst list time:  0.04482555389404297
time for parepare:  0.018680572509765625
local_output_nid generation:  0.02983999252319336
local_in_edges_tensor generation:  0.07588744163513184
mini_batch_src_global generation:  0.056070566177368164
r_  generation:  0.54441237449646
local_output_nid generation:  0.036034584045410156
local_in_edges_tensor generation:  0.054418087005615234
mini_batch_src_global generation:  0.0642385482788086
r_  generation:  0.5516848564147949
local_output_nid generation:  0.03606271743774414
local_in_edges_tensor generation:  0.045876264572143555
mini_batch_src_global generation:  0.06390142440795898
r_  generation:  0.5510547161102295
local_output_nid generation:  0.03686189651489258
local_in_edges_tensor generation:  0.04134249687194824
mini_batch_src_global generation:  0.06083512306213379
r_  generation:  0.5602221488952637
local_output_nid generation:  0.03681683540344238
local_in_edges_tensor generation:  0.040633201599121094
mini_batch_src_global generation:  0.06449460983276367
r_  generation:  0.5522439479827881
local_output_nid generation:  0.03624582290649414
local_in_edges_tensor generation:  0.04168558120727539
mini_batch_src_global generation:  0.06009197235107422
r_  generation:  0.5631282329559326
local_output_nid generation:  0.037390708923339844
local_in_edges_tensor generation:  0.03594255447387695
mini_batch_src_global generation:  0.06465458869934082
r_  generation:  0.558161735534668
local_output_nid generation:  0.03727912902832031
local_in_edges_tensor generation:  0.04632282257080078
mini_batch_src_global generation:  0.06202292442321777
r_  generation:  0.5697941780090332
----------------------check_connections_block total spend ----------------------------- 6.643229007720947
generate_one_block  0.6946506500244141
generate_one_block  0.7128007411956787
generate_one_block  0.7108831405639648
generate_one_block  0.704139232635498
generate_one_block  0.7148821353912354
generate_one_block  0.7050151824951172
generate_one_block  0.7817397117614746
generate_one_block  0.714669942855835
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.03229331970214844
gen group dst list time:  0.0466303825378418
time for parepare:  0.019437074661254883
local_output_nid generation:  0.03133749961853027
local_in_edges_tensor generation:  0.04727983474731445
mini_batch_src_global generation:  0.05268144607543945
r_  generation:  0.5332722663879395
local_output_nid generation:  0.03787636756896973
local_in_edges_tensor generation:  0.03690075874328613
mini_batch_src_global generation:  0.06367969512939453
r_  generation:  0.5565621852874756
local_output_nid generation:  0.037743568420410156
local_in_edges_tensor generation:  0.04014873504638672
mini_batch_src_global generation:  0.06390953063964844
r_  generation:  0.5455551147460938
local_output_nid generation:  0.03726625442504883
local_in_edges_tensor generation:  0.038453102111816406
mini_batch_src_global generation:  0.06281876564025879
r_  generation:  0.5423345565795898
local_output_nid generation:  0.0375981330871582
local_in_edges_tensor generation:  0.0444643497467041
mini_batch_src_global generation:  0.06583499908447266
r_  generation:  0.5425558090209961
local_output_nid generation:  0.037685394287109375
local_in_edges_tensor generation:  0.03427839279174805
mini_batch_src_global generation:  0.06061601638793945
r_  generation:  0.5502955913543701
local_output_nid generation:  0.0381474494934082
local_in_edges_tensor generation:  0.0398402214050293
mini_batch_src_global generation:  0.06154656410217285
r_  generation:  0.5484588146209717
local_output_nid generation:  0.0382237434387207
local_in_edges_tensor generation:  0.045482635498046875
mini_batch_src_global generation:  0.06100344657897949
r_  generation:  0.5545895099639893
----------------------check_connections_block total spend ----------------------------- 6.513254404067993
generate_one_block  0.6997494697570801
generate_one_block  0.6828713417053223
generate_one_block  0.6882727146148682
generate_one_block  0.6918509006500244
generate_one_block  0.6866402626037598
generate_one_block  0.6743261814117432
generate_one_block  0.6811995506286621
generate_one_block  0.7389786243438721
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04210329055786133
gen group dst list time:  0.04771614074707031
time for parepare:  0.01939702033996582
local_output_nid generation:  0.03270602226257324
local_in_edges_tensor generation:  0.0586857795715332
mini_batch_src_global generation:  0.046402931213378906
r_  generation:  0.5038533210754395
local_output_nid generation:  0.03843045234680176
local_in_edges_tensor generation:  0.03358745574951172
mini_batch_src_global generation:  0.058324337005615234
r_  generation:  0.5060739517211914
local_output_nid generation:  0.03739595413208008
local_in_edges_tensor generation:  0.037919044494628906
mini_batch_src_global generation:  0.058981895446777344
r_  generation:  0.5080723762512207
local_output_nid generation:  0.03820490837097168
local_in_edges_tensor generation:  0.03751325607299805
mini_batch_src_global generation:  0.05873608589172363
r_  generation:  0.5154314041137695
local_output_nid generation:  0.038109540939331055
local_in_edges_tensor generation:  0.04297161102294922
mini_batch_src_global generation:  0.0587615966796875
r_  generation:  0.507615327835083
local_output_nid generation:  0.03793954849243164
local_in_edges_tensor generation:  0.04325437545776367
mini_batch_src_global generation:  0.05895423889160156
r_  generation:  0.5088489055633545
local_output_nid generation:  0.03808450698852539
local_in_edges_tensor generation:  0.03433966636657715
mini_batch_src_global generation:  0.05909585952758789
r_  generation:  0.5075666904449463
local_output_nid generation:  0.038446903228759766
local_in_edges_tensor generation:  0.03425884246826172
mini_batch_src_global generation:  0.06072807312011719
r_  generation:  0.5055429935455322
----------------------check_connections_block total spend ----------------------------- 6.119478702545166
generate_one_block  0.6247460842132568
generate_one_block  0.652442216873169
generate_one_block  0.6372227668762207
generate_one_block  0.6375167369842529
generate_one_block  0.6371712684631348
generate_one_block  0.6407275199890137
generate_one_block  0.6281886100769043
generate_one_block  0.639650821685791
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.003612995147705078  GigaBytes
Max Memory Allocated: 0.003612995147705078  GigaBytes

connection checking time:  29.324947834014893
block generation total time  25.237557411193848
average batch blocks generation time:  3.154694676399231
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2440185546875 GB
    Memory Allocated: 0.1421642303466797  GigaBytes
Max Memory Allocated: 0.1421642303466797  GigaBytes

torch.Size([167525, 128])
torch.Size([167072, 128])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 438, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 434, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 253, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.35 GiB already allocated; 12.44 MiB free; 22.41 GiB reserved in total by PyTorch)
