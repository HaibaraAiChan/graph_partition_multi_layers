Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648525172.4848676
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007319450378417969  GigaBytes
Max Memory Allocated: 0.0007319450378417969  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.024420499801635742
range selection method range initialization spend 0.017090320587158203
time for parepare:  0.017983675003051758
local_output_nid generation:  0.010308504104614258
local_in_edges_tensor generation:  0.009665966033935547
mini_batch_src_global generation:  0.016096830368041992
r_  generation:  0.16935467720031738
local_output_nid generation:  0.011750936508178711
local_in_edges_tensor generation:  0.010600566864013672
mini_batch_src_global generation:  0.01826763153076172
r_  generation:  0.18045878410339355
----------------------check_connections_block total spend ----------------------------- 0.5126111507415771
generate_one_block  0.19735050201416016
generate_one_block  0.20122528076171875
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.03922867774963379
gen group dst list time:  0.007529735565185547
time for parepare:  0.01938629150390625
local_output_nid generation:  0.016791343688964844
local_in_edges_tensor generation:  0.04179072380065918
mini_batch_src_global generation:  0.04583597183227539
r_  generation:  0.5082471370697021
local_output_nid generation:  0.02562737464904785
local_in_edges_tensor generation:  0.0487210750579834
mini_batch_src_global generation:  0.05689716339111328
r_  generation:  0.5256648063659668
----------------------check_connections_block total spend ----------------------------- 1.5096333026885986
generate_one_block  0.6839368343353271
generate_one_block  0.6625373363494873
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.045307159423828125
gen group dst list time:  0.014558076858520508
time for parepare:  0.02164912223815918
local_output_nid generation:  0.02180767059326172
local_in_edges_tensor generation:  0.057734012603759766
mini_batch_src_global generation:  0.05610799789428711
r_  generation:  0.5613255500793457
local_output_nid generation:  0.03098917007446289
local_in_edges_tensor generation:  0.052210092544555664
mini_batch_src_global generation:  0.06438970565795898
r_  generation:  0.5820543766021729
----------------------check_connections_block total spend ----------------------------- 1.6939594745635986
generate_one_block  0.7684652805328369
generate_one_block  0.7189209461212158
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.05003619194030762
gen group dst list time:  0.012787580490112305
time for parepare:  0.019248247146606445
local_output_nid generation:  0.023743867874145508
local_in_edges_tensor generation:  0.050392866134643555
mini_batch_src_global generation:  0.05321240425109863
r_  generation:  0.5654969215393066
local_output_nid generation:  0.03124523162841797
local_in_edges_tensor generation:  0.051577091217041016
mini_batch_src_global generation:  0.06607460975646973
r_  generation:  0.5679161548614502
----------------------check_connections_block total spend ----------------------------- 1.6828930377960205
generate_one_block  0.7034780979156494
generate_one_block  0.7304129600524902
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04230237007141113
gen group dst list time:  0.015175819396972656
time for parepare:  0.0186765193939209
local_output_nid generation:  0.022489547729492188
local_in_edges_tensor generation:  0.047780752182006836
mini_batch_src_global generation:  0.053371429443359375
r_  generation:  0.5452854633331299
local_output_nid generation:  0.03171515464782715
local_in_edges_tensor generation:  0.036827802658081055
mini_batch_src_global generation:  0.067962646484375
r_  generation:  0.5585453510284424
----------------------check_connections_block total spend ----------------------------- 1.6340186595916748
generate_one_block  0.6901078224182129
generate_one_block  0.6960022449493408
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04143357276916504
gen group dst list time:  0.015308380126953125
time for parepare:  0.02078986167907715
local_output_nid generation:  0.04273581504821777
local_in_edges_tensor generation:  0.036368608474731445
mini_batch_src_global generation:  0.04687333106994629
r_  generation:  0.5413820743560791
local_output_nid generation:  0.04527449607849121
local_in_edges_tensor generation:  0.05506539344787598
mini_batch_src_global generation:  0.06349802017211914
r_  generation:  0.5227651596069336
----------------------check_connections_block total spend ----------------------------- 1.6368145942687988
generate_one_block  0.6543936729431152
generate_one_block  0.657489538192749
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007319450378417969  GigaBytes
Max Memory Allocated: 0.0007319450378417969  GigaBytes

connection checking time:  8.157319068908691
block generation total time  6.965744733810425
average batch blocks generation time:  3.4828723669052124
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2420654296875 GB
    Memory Allocated: 0.14771032333374023  GigaBytes
Max Memory Allocated: 0.14771032333374023  GigaBytes

torch.Size([168051, 128])
torch.Size([167910, 32])
torch.Size([167610, 32])
torch.Size([166775, 32])
torch.Size([162971, 32])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 438, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 434, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 253, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.37 GiB already allocated; 16.44 MiB free; 22.40 GiB reserved in total by PyTorch)
