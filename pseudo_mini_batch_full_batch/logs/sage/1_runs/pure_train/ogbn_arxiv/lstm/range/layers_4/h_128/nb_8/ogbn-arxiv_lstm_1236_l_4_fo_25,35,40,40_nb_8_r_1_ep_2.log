Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648489799.6255639
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.002379894256591797  GigaBytes
Max Memory Allocated: 0.002379894256591797  GigaBytes

The real block id is  3
get_global_graph_edges_ids_block function  spend 0.02368903160095215
range selection method range initialization spend 0.013895511627197266
time for parepare:  0.01757216453552246
local_output_nid generation:  0.002649545669555664
local_in_edges_tensor generation:  0.0037958621978759766
mini_batch_src_global generation:  0.0033195018768310547
r_  generation:  0.03831934928894043
local_output_nid generation:  0.003116130828857422
local_in_edges_tensor generation:  0.0016601085662841797
mini_batch_src_global generation:  0.004269123077392578
r_  generation:  0.03913235664367676
local_output_nid generation:  0.0031599998474121094
local_in_edges_tensor generation:  0.0016732215881347656
mini_batch_src_global generation:  0.002991199493408203
r_  generation:  0.04001617431640625
local_output_nid generation:  0.0031816959381103516
local_in_edges_tensor generation:  0.001711130142211914
mini_batch_src_global generation:  0.003016233444213867
r_  generation:  0.040305137634277344
local_output_nid generation:  0.0031511783599853516
local_in_edges_tensor generation:  0.001619577407836914
mini_batch_src_global generation:  0.0029675960540771484
r_  generation:  0.04132866859436035
local_output_nid generation:  0.003161907196044922
local_in_edges_tensor generation:  0.0016427040100097656
mini_batch_src_global generation:  0.003193378448486328
r_  generation:  0.04172921180725098
local_output_nid generation:  0.003118753433227539
local_in_edges_tensor generation:  0.0016782283782958984
mini_batch_src_global generation:  0.0032324790954589844
r_  generation:  0.041431427001953125
local_output_nid generation:  0.0031516551971435547
local_in_edges_tensor generation:  0.0016796588897705078
mini_batch_src_global generation:  0.0032579898834228516
r_  generation:  0.042021989822387695
----------------------check_connections_block total spend ----------------------------- 0.47689175605773926
generate_one_block  0.05351519584655762
generate_one_block  0.05591702461242676
generate_one_block  0.0553441047668457
generate_one_block  0.05384993553161621
generate_one_block  0.05702924728393555
generate_one_block  0.054668426513671875
generate_one_block  0.055151939392089844
generate_one_block  0.05507802963256836
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.039540767669677734
gen group dst list time:  0.015363216400146484
time for parepare:  0.018986225128173828
local_output_nid generation:  0.010291099548339844
local_in_edges_tensor generation:  0.02679920196533203
mini_batch_src_global generation:  0.03021693229675293
r_  generation:  0.293384313583374
local_output_nid generation:  0.01626420021057129
local_in_edges_tensor generation:  0.0275571346282959
mini_batch_src_global generation:  0.03655838966369629
r_  generation:  0.3067622184753418
local_output_nid generation:  0.016751766204833984
local_in_edges_tensor generation:  0.02300405502319336
mini_batch_src_global generation:  0.036649227142333984
r_  generation:  0.3126688003540039
local_output_nid generation:  0.01710367202758789
local_in_edges_tensor generation:  0.020064592361450195
mini_batch_src_global generation:  0.0369563102722168
r_  generation:  0.3121323585510254
local_output_nid generation:  0.017250776290893555
local_in_edges_tensor generation:  0.01987433433532715
mini_batch_src_global generation:  0.038019418716430664
r_  generation:  0.3159196376800537
local_output_nid generation:  0.01772475242614746
local_in_edges_tensor generation:  0.02354717254638672
mini_batch_src_global generation:  0.03833651542663574
r_  generation:  0.3184318542480469
local_output_nid generation:  0.017700672149658203
local_in_edges_tensor generation:  0.024198055267333984
mini_batch_src_global generation:  0.03802037239074707
r_  generation:  0.31815099716186523
local_output_nid generation:  0.017917633056640625
local_in_edges_tensor generation:  0.019968748092651367
mini_batch_src_global generation:  0.03861260414123535
r_  generation:  0.3188815116882324
----------------------check_connections_block total spend ----------------------------- 3.6541712284088135
generate_one_block  0.40822601318359375
generate_one_block  0.4133872985839844
generate_one_block  0.40860795974731445
generate_one_block  0.3994326591491699
generate_one_block  0.40647125244140625
generate_one_block  0.42383337020874023
generate_one_block  0.4055941104888916
generate_one_block  0.4068105220794678
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.03822517395019531
gen group dst list time:  0.03572440147399902
time for parepare:  0.018994569778442383
local_output_nid generation:  0.024631738662719727
local_in_edges_tensor generation:  0.041046142578125
mini_batch_src_global generation:  0.051320552825927734
r_  generation:  0.5150880813598633
local_output_nid generation:  0.031220436096191406
local_in_edges_tensor generation:  0.04857611656188965
mini_batch_src_global generation:  0.0595090389251709
r_  generation:  0.5173473358154297
local_output_nid generation:  0.03169727325439453
local_in_edges_tensor generation:  0.04067826271057129
mini_batch_src_global generation:  0.05479931831359863
r_  generation:  0.5320119857788086
local_output_nid generation:  0.033030033111572266
local_in_edges_tensor generation:  0.03245115280151367
mini_batch_src_global generation:  0.0586397647857666
r_  generation:  0.5273466110229492
local_output_nid generation:  0.032782554626464844
local_in_edges_tensor generation:  0.04046511650085449
mini_batch_src_global generation:  0.06081795692443848
r_  generation:  0.5389571189880371
local_output_nid generation:  0.033197879791259766
local_in_edges_tensor generation:  0.037123680114746094
mini_batch_src_global generation:  0.059798479080200195
r_  generation:  0.5279269218444824
local_output_nid generation:  0.03298783302307129
local_in_edges_tensor generation:  0.03542351722717285
mini_batch_src_global generation:  0.05812716484069824
r_  generation:  0.5401842594146729
local_output_nid generation:  0.033325910568237305
local_in_edges_tensor generation:  0.035387277603149414
mini_batch_src_global generation:  0.06032991409301758
r_  generation:  0.5243043899536133
----------------------check_connections_block total spend ----------------------------- 6.177823305130005
generate_one_block  0.653505802154541
generate_one_block  0.6657071113586426
generate_one_block  0.6672022342681885
generate_one_block  0.6867489814758301
generate_one_block  0.7050662040710449
generate_one_block  0.7224624156951904
generate_one_block  0.664675235748291
generate_one_block  0.6653962135314941
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.05585813522338867
gen group dst list time:  0.04613685607910156
time for parepare:  0.01928544044494629
local_output_nid generation:  0.03172659873962402
local_in_edges_tensor generation:  0.051140785217285156
mini_batch_src_global generation:  0.06397771835327148
r_  generation:  0.5029392242431641
local_output_nid generation:  0.03645777702331543
local_in_edges_tensor generation:  0.044896602630615234
mini_batch_src_global generation:  0.05756378173828125
r_  generation:  0.523475170135498
local_output_nid generation:  0.037160634994506836
local_in_edges_tensor generation:  0.040561676025390625
mini_batch_src_global generation:  0.05801033973693848
r_  generation:  0.5211424827575684
local_output_nid generation:  0.0389561653137207
local_in_edges_tensor generation:  0.05325794219970703
mini_batch_src_global generation:  0.06781578063964844
r_  generation:  0.5289554595947266
local_output_nid generation:  0.04016423225402832
local_in_edges_tensor generation:  0.04569816589355469
mini_batch_src_global generation:  0.05512356758117676
r_  generation:  0.5186514854431152
local_output_nid generation:  0.03873729705810547
local_in_edges_tensor generation:  0.043853759765625
mini_batch_src_global generation:  0.0551152229309082
r_  generation:  0.5181081295013428
local_output_nid generation:  0.038846492767333984
local_in_edges_tensor generation:  0.035089731216430664
mini_batch_src_global generation:  0.05570101737976074
r_  generation:  0.5207302570343018
local_output_nid generation:  0.039154052734375
local_in_edges_tensor generation:  0.037516117095947266
mini_batch_src_global generation:  0.05463004112243652
r_  generation:  0.5342297554016113
----------------------check_connections_block total spend ----------------------------- 6.2503342628479
generate_one_block  0.6445169448852539
generate_one_block  0.6377863883972168
generate_one_block  0.6327834129333496
generate_one_block  0.634979248046875
generate_one_block  0.6358804702758789
generate_one_block  0.6469800472259521
generate_one_block  0.6883201599121094
generate_one_block  0.6550164222717285
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.002379894256591797  GigaBytes
Max Memory Allocated: 0.002379894256591797  GigaBytes

connection checking time:  16.08232879638672
block generation total time  13.879390478134155
average batch blocks generation time:  1.7349238097667694
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2030029296875 GB
    Memory Allocated: 0.11325311660766602  GigaBytes
Max Memory Allocated: 0.11325311660766602  GigaBytes

torch.Size([165346, 128])
torch.Size([160928, 128])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 22.00 MiB (GPU 0; 23.62 GiB total capacity; 22.37 GiB already allocated; 14.44 MiB free; 22.41 GiB reserved in total by PyTorch)
