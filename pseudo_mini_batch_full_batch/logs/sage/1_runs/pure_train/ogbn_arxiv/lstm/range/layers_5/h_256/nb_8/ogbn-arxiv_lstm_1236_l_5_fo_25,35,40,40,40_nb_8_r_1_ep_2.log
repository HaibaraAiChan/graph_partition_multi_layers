Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648507107.9232948
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0272216796875 GB
    Memory Allocated: 0.010137557983398438  GigaBytes
Max Memory Allocated: 0.010137557983398438  GigaBytes

The real block id is  4
get_global_graph_edges_ids_block function  spend 0.023946285247802734
range selection method range initialization spend 0.013747692108154297
time for parepare:  0.017757415771484375
local_output_nid generation:  0.002583742141723633
local_in_edges_tensor generation:  0.004498481750488281
mini_batch_src_global generation:  0.0033245086669921875
r_  generation:  0.03761434555053711
local_output_nid generation:  0.0030863285064697266
local_in_edges_tensor generation:  0.0016162395477294922
mini_batch_src_global generation:  0.004318714141845703
r_  generation:  0.038829803466796875
local_output_nid generation:  0.003107786178588867
local_in_edges_tensor generation:  0.001659393310546875
mini_batch_src_global generation:  0.0027866363525390625
r_  generation:  0.03864645957946777
local_output_nid generation:  0.003152608871459961
local_in_edges_tensor generation:  0.0016167163848876953
mini_batch_src_global generation:  0.002783536911010742
r_  generation:  0.040383338928222656
local_output_nid generation:  0.0031447410583496094
local_in_edges_tensor generation:  0.0015735626220703125
mini_batch_src_global generation:  0.0028901100158691406
r_  generation:  0.04115414619445801
local_output_nid generation:  0.0032079219818115234
local_in_edges_tensor generation:  0.0016562938690185547
mini_batch_src_global generation:  0.0031135082244873047
r_  generation:  0.041597843170166016
local_output_nid generation:  0.0031194686889648438
local_in_edges_tensor generation:  0.0016605854034423828
mini_batch_src_global generation:  0.0032351016998291016
r_  generation:  0.04096794128417969
local_output_nid generation:  0.0031638145446777344
local_in_edges_tensor generation:  0.001622915267944336
mini_batch_src_global generation:  0.003293275833129883
r_  generation:  0.0415802001953125
----------------------check_connections_block total spend ----------------------------- 0.4723072052001953
generate_one_block  0.0546717643737793
generate_one_block  0.05452466011047363
generate_one_block  0.0547945499420166
generate_one_block  0.05443549156188965
generate_one_block  0.057215213775634766
generate_one_block  0.05565047264099121
generate_one_block  0.05419588088989258
generate_one_block  0.05469346046447754
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.04129290580749512
gen group dst list time:  0.015174627304077148
time for parepare:  0.019322872161865234
local_output_nid generation:  0.010441064834594727
local_in_edges_tensor generation:  0.02910780906677246
mini_batch_src_global generation:  0.031018972396850586
r_  generation:  0.29863691329956055
local_output_nid generation:  0.017612218856811523
local_in_edges_tensor generation:  0.028429508209228516
mini_batch_src_global generation:  0.03618931770324707
r_  generation:  0.3011796474456787
local_output_nid generation:  0.0182492733001709
local_in_edges_tensor generation:  0.02366948127746582
mini_batch_src_global generation:  0.03603076934814453
r_  generation:  0.3112218379974365
local_output_nid generation:  0.018410205841064453
local_in_edges_tensor generation:  0.02071833610534668
mini_batch_src_global generation:  0.037216901779174805
r_  generation:  0.3150904178619385
local_output_nid generation:  0.01917409896850586
local_in_edges_tensor generation:  0.02121710777282715
mini_batch_src_global generation:  0.03795313835144043
r_  generation:  0.3162515163421631
local_output_nid generation:  0.01958441734313965
local_in_edges_tensor generation:  0.021446704864501953
mini_batch_src_global generation:  0.04102373123168945
r_  generation:  0.31841492652893066
local_output_nid generation:  0.019508838653564453
local_in_edges_tensor generation:  0.019120216369628906
mini_batch_src_global generation:  0.03850984573364258
r_  generation:  0.3191354274749756
local_output_nid generation:  0.019415855407714844
local_in_edges_tensor generation:  0.023471355438232422
mini_batch_src_global generation:  0.038387298583984375
r_  generation:  0.3205733299255371
----------------------check_connections_block total spend ----------------------------- 3.693303108215332
generate_one_block  0.41539573669433594
generate_one_block  0.4068272113800049
generate_one_block  0.40936756134033203
generate_one_block  0.4057595729827881
generate_one_block  0.40834808349609375
generate_one_block  0.4206533432006836
generate_one_block  0.40720415115356445
generate_one_block  0.40673208236694336
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.03649759292602539
gen group dst list time:  0.03570413589477539
time for parepare:  0.019373178482055664
local_output_nid generation:  0.0252077579498291
local_in_edges_tensor generation:  0.04223370552062988
mini_batch_src_global generation:  0.04927945137023926
r_  generation:  0.5268449783325195
local_output_nid generation:  0.03210043907165527
local_in_edges_tensor generation:  0.05298733711242676
mini_batch_src_global generation:  0.06124424934387207
r_  generation:  0.5282061100006104
local_output_nid generation:  0.03245854377746582
local_in_edges_tensor generation:  0.03992009162902832
mini_batch_src_global generation:  0.05691266059875488
r_  generation:  0.5445261001586914
local_output_nid generation:  0.03328061103820801
local_in_edges_tensor generation:  0.03951525688171387
mini_batch_src_global generation:  0.06228446960449219
r_  generation:  0.5331761837005615
local_output_nid generation:  0.03303718566894531
local_in_edges_tensor generation:  0.04393196105957031
mini_batch_src_global generation:  0.05898332595825195
r_  generation:  0.5511932373046875
local_output_nid generation:  0.03319954872131348
local_in_edges_tensor generation:  0.044465065002441406
mini_batch_src_global generation:  0.06217217445373535
r_  generation:  0.541966438293457
local_output_nid generation:  0.03356432914733887
local_in_edges_tensor generation:  0.034859418869018555
mini_batch_src_global generation:  0.0606229305267334
r_  generation:  0.5479824542999268
local_output_nid generation:  0.03325700759887695
local_in_edges_tensor generation:  0.044241905212402344
mini_batch_src_global generation:  0.061654090881347656
r_  generation:  0.535398006439209
----------------------check_connections_block total spend ----------------------------- 6.333063364028931
generate_one_block  0.6818180084228516
generate_one_block  0.6709003448486328
generate_one_block  0.6709744930267334
generate_one_block  0.6799428462982178
generate_one_block  0.6886427402496338
generate_one_block  0.6900234222412109
generate_one_block  0.6893866062164307
generate_one_block  0.6935057640075684
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.034940481185913086
gen group dst list time:  0.04466581344604492
time for parepare:  0.018926382064819336
local_output_nid generation:  0.030893564224243164
local_in_edges_tensor generation:  0.045334577560424805
mini_batch_src_global generation:  0.049916982650756836
r_  generation:  0.5350441932678223
local_output_nid generation:  0.03710198402404785
local_in_edges_tensor generation:  0.0545957088470459
mini_batch_src_global generation:  0.06306934356689453
r_  generation:  0.5479333400726318
local_output_nid generation:  0.037539005279541016
local_in_edges_tensor generation:  0.041275978088378906
mini_batch_src_global generation:  0.06650137901306152
r_  generation:  0.5443522930145264
local_output_nid generation:  0.037719011306762695
local_in_edges_tensor generation:  0.04978013038635254
mini_batch_src_global generation:  0.05927252769470215
r_  generation:  0.5435175895690918
local_output_nid generation:  0.037774085998535156
local_in_edges_tensor generation:  0.04121899604797363
mini_batch_src_global generation:  0.06302094459533691
r_  generation:  0.5502212047576904
local_output_nid generation:  0.03772091865539551
local_in_edges_tensor generation:  0.036379098892211914
mini_batch_src_global generation:  0.05887341499328613
r_  generation:  0.5614633560180664
local_output_nid generation:  0.03784894943237305
local_in_edges_tensor generation:  0.03697323799133301
mini_batch_src_global generation:  0.06065845489501953
r_  generation:  0.5549404621124268
local_output_nid generation:  0.037709951400756836
local_in_edges_tensor generation:  0.04129600524902344
mini_batch_src_global generation:  0.06293153762817383
r_  generation:  0.56270432472229
----------------------check_connections_block total spend ----------------------------- 6.535964012145996
generate_one_block  0.6784563064575195
generate_one_block  0.6884522438049316
generate_one_block  0.6962826251983643
generate_one_block  0.6900579929351807
generate_one_block  0.6992919445037842
generate_one_block  0.7108855247497559
generate_one_block  0.719768762588501
generate_one_block  0.6760318279266357
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.0730903148651123
gen group dst list time:  0.04814720153808594
time for parepare:  0.019213199615478516
local_output_nid generation:  0.03372597694396973
local_in_edges_tensor generation:  0.042638301849365234
mini_batch_src_global generation:  0.045194149017333984
r_  generation:  0.504709005355835
local_output_nid generation:  0.03795146942138672
local_in_edges_tensor generation:  0.03716754913330078
mini_batch_src_global generation:  0.05820584297180176
r_  generation:  0.5042860507965088
local_output_nid generation:  0.038767337799072266
local_in_edges_tensor generation:  0.038596391677856445
mini_batch_src_global generation:  0.058507442474365234
r_  generation:  0.5158319473266602
local_output_nid generation:  0.03919577598571777
local_in_edges_tensor generation:  0.045124053955078125
mini_batch_src_global generation:  0.05923628807067871
r_  generation:  0.505718469619751
local_output_nid generation:  0.03869986534118652
local_in_edges_tensor generation:  0.04013991355895996
mini_batch_src_global generation:  0.058531761169433594
r_  generation:  0.5136716365814209
local_output_nid generation:  0.03859448432922363
local_in_edges_tensor generation:  0.04864501953125
mini_batch_src_global generation:  0.0579075813293457
r_  generation:  0.5163741111755371
local_output_nid generation:  0.041315317153930664
local_in_edges_tensor generation:  0.0395355224609375
mini_batch_src_global generation:  0.05852937698364258
r_  generation:  0.5173020362854004
local_output_nid generation:  0.03986716270446777
local_in_edges_tensor generation:  0.03947949409484863
mini_batch_src_global generation:  0.05755734443664551
r_  generation:  0.5159084796905518
----------------------check_connections_block total spend ----------------------------- 6.1706202030181885
generate_one_block  0.6380155086517334
generate_one_block  0.6459348201751709
generate_one_block  0.6417100429534912
generate_one_block  0.6490039825439453
generate_one_block  0.6415047645568848
generate_one_block  0.6421446800231934
generate_one_block  0.647066593170166
generate_one_block  0.6978838443756104
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0272216796875 GB
    Memory Allocated: 0.010137557983398438  GigaBytes
Max Memory Allocated: 0.010137557983398438  GigaBytes

connection checking time:  22.732950687408447
block generation total time  19.507973432540894
average batch blocks generation time:  2.4384966790676117
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2303466796875 GB
    Memory Allocated: 0.13610601425170898  GigaBytes
Max Memory Allocated: 0.13610601425170898  GigaBytes

torch.Size([166891, 128])
torch.Size([165696, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 18.00 MiB (GPU 0; 23.62 GiB total capacity; 21.94 GiB already allocated; 6.44 MiB free; 22.42 GiB reserved in total by PyTorch)
