Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648476344.800522
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.025002479553222656
range selection method range initialization spend 0.013839960098266602
time for parepare:  0.018038272857666016
local_output_nid generation:  0.0026700496673583984
local_in_edges_tensor generation:  0.004034757614135742
mini_batch_src_global generation:  0.0038034915924072266
r_  generation:  0.04250478744506836
local_output_nid generation:  0.003171682357788086
local_in_edges_tensor generation:  0.0016951560974121094
mini_batch_src_global generation:  0.004787445068359375
r_  generation:  0.044180870056152344
local_output_nid generation:  0.0031702518463134766
local_in_edges_tensor generation:  0.0016965866088867188
mini_batch_src_global generation:  0.0032851696014404297
r_  generation:  0.04590320587158203
local_output_nid generation:  0.003217935562133789
local_in_edges_tensor generation:  0.0016980171203613281
mini_batch_src_global generation:  0.003437042236328125
r_  generation:  0.047591209411621094
local_output_nid generation:  0.003162384033203125
local_in_edges_tensor generation:  0.0017390251159667969
mini_batch_src_global generation:  0.003621816635131836
r_  generation:  0.04711723327636719
local_output_nid generation:  0.0031647682189941406
local_in_edges_tensor generation:  0.0016870498657226562
mini_batch_src_global generation:  0.006082773208618164
r_  generation:  0.047359466552734375
local_output_nid generation:  0.0031599998474121094
local_in_edges_tensor generation:  0.0016901493072509766
mini_batch_src_global generation:  0.0038335323333740234
r_  generation:  0.048152923583984375
local_output_nid generation:  0.0032148361206054688
local_in_edges_tensor generation:  0.0017046928405761719
mini_batch_src_global generation:  0.0038847923278808594
r_  generation:  0.04747343063354492
----------------------check_connections_block total spend ----------------------------- 0.5397217273712158
generate_one_block  0.059937477111816406
generate_one_block  0.061745405197143555
generate_one_block  0.06235980987548828
generate_one_block  0.0633690357208252
generate_one_block  0.06452131271362305
generate_one_block  0.06156039237976074
generate_one_block  0.0624537467956543
generate_one_block  0.06156110763549805
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.043184518814086914
gen group dst list time:  0.01655864715576172
time for parepare:  0.01896214485168457
local_output_nid generation:  0.01117706298828125
local_in_edges_tensor generation:  0.030338525772094727
mini_batch_src_global generation:  0.034420013427734375
r_  generation:  0.35405874252319336
local_output_nid generation:  0.017116069793701172
local_in_edges_tensor generation:  0.03203320503234863
mini_batch_src_global generation:  0.04734635353088379
r_  generation:  0.36727070808410645
local_output_nid generation:  0.017467498779296875
local_in_edges_tensor generation:  0.02615809440612793
mini_batch_src_global generation:  0.044380903244018555
r_  generation:  0.3786439895629883
local_output_nid generation:  0.017833709716796875
local_in_edges_tensor generation:  0.02627396583557129
mini_batch_src_global generation:  0.045653343200683594
r_  generation:  0.3793303966522217
local_output_nid generation:  0.018154144287109375
local_in_edges_tensor generation:  0.019373178482055664
mini_batch_src_global generation:  0.0463719367980957
r_  generation:  0.3801429271697998
local_output_nid generation:  0.01778864860534668
local_in_edges_tensor generation:  0.01938462257385254
mini_batch_src_global generation:  0.046597957611083984
r_  generation:  0.37581968307495117
local_output_nid generation:  0.018341064453125
local_in_edges_tensor generation:  0.029527664184570312
mini_batch_src_global generation:  0.04702401161193848
r_  generation:  0.3875586986541748
local_output_nid generation:  0.01800990104675293
local_in_edges_tensor generation:  0.019698143005371094
mini_batch_src_global generation:  0.046082496643066406
r_  generation:  0.3767855167388916
----------------------check_connections_block total spend ----------------------------- 4.3425538539886475
generate_one_block  0.48000645637512207
generate_one_block  0.48899316787719727
generate_one_block  0.5028083324432373
generate_one_block  0.5047118663787842
generate_one_block  0.4820373058319092
generate_one_block  0.49268603324890137
generate_one_block  0.5064575672149658
generate_one_block  0.48346853256225586
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03056812286376953
gen group dst list time:  0.037575483322143555
time for parepare:  0.01911449432373047
local_output_nid generation:  0.025825023651123047
local_in_edges_tensor generation:  0.039664506912231445
mini_batch_src_global generation:  0.04802703857421875
r_  generation:  0.4844939708709717
local_output_nid generation:  0.03381752967834473
local_in_edges_tensor generation:  0.04912281036376953
mini_batch_src_global generation:  0.054860591888427734
r_  generation:  0.5079188346862793
local_output_nid generation:  0.03453230857849121
local_in_edges_tensor generation:  0.04109835624694824
mini_batch_src_global generation:  0.05527687072753906
r_  generation:  0.49555444717407227
local_output_nid generation:  0.034873247146606445
local_in_edges_tensor generation:  0.03251028060913086
mini_batch_src_global generation:  0.05698394775390625
r_  generation:  0.49678540229797363
local_output_nid generation:  0.035376787185668945
local_in_edges_tensor generation:  0.041030168533325195
mini_batch_src_global generation:  0.05679512023925781
r_  generation:  0.49862003326416016
local_output_nid generation:  0.0352168083190918
local_in_edges_tensor generation:  0.03308582305908203
mini_batch_src_global generation:  0.05470466613769531
r_  generation:  0.5027265548706055
local_output_nid generation:  0.0354311466217041
local_in_edges_tensor generation:  0.03244805335998535
mini_batch_src_global generation:  0.05440330505371094
r_  generation:  0.5075511932373047
local_output_nid generation:  0.035558462142944336
local_in_edges_tensor generation:  0.045011281967163086
mini_batch_src_global generation:  0.054949045181274414
r_  generation:  0.5036830902099609
----------------------check_connections_block total spend ----------------------------- 5.906636476516724
generate_one_block  0.6072204113006592
generate_one_block  0.6228454113006592
generate_one_block  0.6101269721984863
generate_one_block  0.6219761371612549
generate_one_block  0.6265830993652344
generate_one_block  0.6069600582122803
generate_one_block  0.6348667144775391
generate_one_block  0.6209912300109863
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  10.249190330505371
block generation total time  8.892739295959473
average batch blocks generation time:  1.111592411994934
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2049560546875 GB
    Memory Allocated: 0.10463905334472656  GigaBytes
Max Memory Allocated: 0.10463905334472656  GigaBytes

torch.Size([162114, 128])
torch.Size([145759, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.23 GiB already allocated; 10.44 MiB free; 22.41 GiB reserved in total by PyTorch)
