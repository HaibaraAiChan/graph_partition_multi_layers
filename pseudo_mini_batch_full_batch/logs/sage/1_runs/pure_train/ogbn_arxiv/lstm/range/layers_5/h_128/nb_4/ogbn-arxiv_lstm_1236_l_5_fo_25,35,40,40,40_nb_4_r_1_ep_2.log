Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648506433.5676935
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0029964447021484375  GigaBytes
Max Memory Allocated: 0.0029964447021484375  GigaBytes

The real block id is  4
get_global_graph_edges_ids_block function  spend 0.025039196014404297
range selection method range initialization spend 0.01345372200012207
time for parepare:  0.0177609920501709
local_output_nid generation:  0.005326509475708008
local_in_edges_tensor generation:  0.005970478057861328
mini_batch_src_global generation:  0.006603240966796875
r_  generation:  0.0840599536895752
local_output_nid generation:  0.00601506233215332
local_in_edges_tensor generation:  0.0031549930572509766
mini_batch_src_global generation:  0.0086517333984375
r_  generation:  0.08849835395812988
local_output_nid generation:  0.006039857864379883
local_in_edges_tensor generation:  0.0030889511108398438
mini_batch_src_global generation:  0.0062863826751708984
r_  generation:  0.08859610557556152
local_output_nid generation:  0.006051063537597656
local_in_edges_tensor generation:  0.0030846595764160156
mini_batch_src_global generation:  0.006918430328369141
r_  generation:  0.09316754341125488
----------------------check_connections_block total spend ----------------------------- 0.5092852115631104
generate_one_block  0.10329103469848633
generate_one_block  0.10216617584228516
generate_one_block  0.10249900817871094
generate_one_block  0.10266542434692383
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.04042959213256836
gen group dst list time:  0.011209487915039062
time for parepare:  0.018952608108520508
local_output_nid generation:  0.015207290649414062
local_in_edges_tensor generation:  0.03819704055786133
mini_batch_src_global generation:  0.042012929916381836
r_  generation:  0.4103703498840332
local_output_nid generation:  0.021692514419555664
local_in_edges_tensor generation:  0.03754568099975586
mini_batch_src_global generation:  0.04814457893371582
r_  generation:  0.4114513397216797
local_output_nid generation:  0.022523164749145508
local_in_edges_tensor generation:  0.030942201614379883
mini_batch_src_global generation:  0.05266404151916504
r_  generation:  0.42459607124328613
local_output_nid generation:  0.022591590881347656
local_in_edges_tensor generation:  0.027297019958496094
mini_batch_src_global generation:  0.04893779754638672
r_  generation:  0.42111635208129883
----------------------check_connections_block total spend ----------------------------- 2.450035810470581
generate_one_block  0.5653650760650635
generate_one_block  0.5431866645812988
generate_one_block  0.5407335758209229
generate_one_block  0.5392923355102539
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.03665494918823242
gen group dst list time:  0.020949840545654297
time for parepare:  0.018723487854003906
local_output_nid generation:  0.024927854537963867
local_in_edges_tensor generation:  0.046526432037353516
mini_batch_src_global generation:  0.04977989196777344
r_  generation:  0.5457825660705566
local_output_nid generation:  0.032826900482177734
local_in_edges_tensor generation:  0.05253291130065918
mini_batch_src_global generation:  0.0638279914855957
r_  generation:  0.5457186698913574
local_output_nid generation:  0.03349637985229492
local_in_edges_tensor generation:  0.04007458686828613
mini_batch_src_global generation:  0.05787467956542969
r_  generation:  0.5590636730194092
local_output_nid generation:  0.03408217430114746
local_in_edges_tensor generation:  0.03850054740905762
mini_batch_src_global generation:  0.05985426902770996
r_  generation:  0.5628204345703125
----------------------check_connections_block total spend ----------------------------- 3.2401251792907715
generate_one_block  0.688934326171875
generate_one_block  0.6995611190795898
generate_one_block  0.7004337310791016
generate_one_block  0.6971826553344727
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.029786109924316406
gen group dst list time:  0.023651123046875
time for parepare:  0.018548250198364258
local_output_nid generation:  0.026961565017700195
local_in_edges_tensor generation:  0.03865528106689453
mini_batch_src_global generation:  0.04869866371154785
r_  generation:  0.5420365333557129
local_output_nid generation:  0.0346219539642334
local_in_edges_tensor generation:  0.05361366271972656
mini_batch_src_global generation:  0.062342166900634766
r_  generation:  0.5454778671264648
local_output_nid generation:  0.03520536422729492
local_in_edges_tensor generation:  0.041289567947387695
mini_batch_src_global generation:  0.06686520576477051
r_  generation:  0.5452184677124023
local_output_nid generation:  0.035521507263183594
local_in_edges_tensor generation:  0.04244685173034668
mini_batch_src_global generation:  0.062166452407836914
r_  generation:  0.5520660877227783
----------------------check_connections_block total spend ----------------------------- 3.2398769855499268
generate_one_block  0.6877319812774658
generate_one_block  0.713350772857666
generate_one_block  0.7034993171691895
generate_one_block  0.6893355846405029
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.026944875717163086
gen group dst list time:  0.024613618850708008
time for parepare:  0.01933765411376953
local_output_nid generation:  0.027552127838134766
local_in_edges_tensor generation:  0.037815093994140625
mini_batch_src_global generation:  0.04574418067932129
r_  generation:  0.5123031139373779
local_output_nid generation:  0.03533339500427246
local_in_edges_tensor generation:  0.04939889907836914
mini_batch_src_global generation:  0.059064388275146484
r_  generation:  0.5093293190002441
local_output_nid generation:  0.03628373146057129
local_in_edges_tensor generation:  0.04117941856384277
mini_batch_src_global generation:  0.0593111515045166
r_  generation:  0.5162200927734375
local_output_nid generation:  0.03677773475646973
local_in_edges_tensor generation:  0.04288148880004883
mini_batch_src_global generation:  0.05892777442932129
r_  generation:  0.5231451988220215
----------------------check_connections_block total spend ----------------------------- 3.0827159881591797
generate_one_block  0.6547560691833496
generate_one_block  0.6503093242645264
generate_one_block  0.6512529850006104
generate_one_block  0.647641658782959
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0029964447021484375  GigaBytes
Max Memory Allocated: 0.0029964447021484375  GigaBytes

connection checking time:  12.012753963470459
block generation total time  10.372567176818848
average batch blocks generation time:  2.593141794204712
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2244873046875 GB
    Memory Allocated: 0.13237762451171875  GigaBytes
Max Memory Allocated: 0.13237762451171875  GigaBytes

torch.Size([167367, 128])
torch.Size([166833, 128])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.34 GiB already allocated; 20.44 MiB free; 22.40 GiB reserved in total by PyTorch)
