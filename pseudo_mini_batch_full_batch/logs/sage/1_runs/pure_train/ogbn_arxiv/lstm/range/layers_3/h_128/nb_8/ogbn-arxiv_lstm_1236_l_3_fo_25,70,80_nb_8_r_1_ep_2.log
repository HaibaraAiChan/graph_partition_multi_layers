Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648473437.6699173
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0017633438110351562  GigaBytes
Max Memory Allocated: 0.0017633438110351562  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.028015613555908203
range selection method range initialization spend 0.013365983963012695
time for parepare:  0.017912626266479492
local_output_nid generation:  0.0026357173919677734
local_in_edges_tensor generation:  0.005064249038696289
mini_batch_src_global generation:  0.003694772720336914
r_  generation:  0.04079389572143555
local_output_nid generation:  0.003021240234375
local_in_edges_tensor generation:  0.0017192363739013672
mini_batch_src_global generation:  0.004786491394042969
r_  generation:  0.04446601867675781
local_output_nid generation:  0.0031058788299560547
local_in_edges_tensor generation:  0.0016908645629882812
mini_batch_src_global generation:  0.0031414031982421875
r_  generation:  0.04408121109008789
local_output_nid generation:  0.003147125244140625
local_in_edges_tensor generation:  0.0017099380493164062
mini_batch_src_global generation:  0.0033347606658935547
r_  generation:  0.044884681701660156
local_output_nid generation:  0.003131866455078125
local_in_edges_tensor generation:  0.00174713134765625
mini_batch_src_global generation:  0.0034284591674804688
r_  generation:  0.04605245590209961
local_output_nid generation:  0.003173828125
local_in_edges_tensor generation:  0.0016946792602539062
mini_batch_src_global generation:  0.0036873817443847656
r_  generation:  0.04691886901855469
local_output_nid generation:  0.00313568115234375
local_in_edges_tensor generation:  0.001752614974975586
mini_batch_src_global generation:  0.0036902427673339844
r_  generation:  0.046569108963012695
local_output_nid generation:  0.003159046173095703
local_in_edges_tensor generation:  0.0016901493072509766
mini_batch_src_global generation:  0.0035791397094726562
r_  generation:  0.04630422592163086
----------------------check_connections_block total spend ----------------------------- 0.5243542194366455
generate_one_block  0.06019878387451172
generate_one_block  0.06269645690917969
generate_one_block  0.060921430587768555
generate_one_block  0.061826467514038086
generate_one_block  0.06394553184509277
generate_one_block  0.06325721740722656
generate_one_block  0.0622706413269043
generate_one_block  0.0611116886138916
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04347968101501465
gen group dst list time:  0.01644110679626465
time for parepare:  0.019990205764770508
local_output_nid generation:  0.011183977127075195
local_in_edges_tensor generation:  0.034455060958862305
mini_batch_src_global generation:  0.03837013244628906
r_  generation:  0.35525012016296387
local_output_nid generation:  0.019876480102539062
local_in_edges_tensor generation:  0.03363466262817383
mini_batch_src_global generation:  0.04505586624145508
r_  generation:  0.37139320373535156
local_output_nid generation:  0.020238637924194336
local_in_edges_tensor generation:  0.03065800666809082
mini_batch_src_global generation:  0.0441889762878418
r_  generation:  0.37671923637390137
local_output_nid generation:  0.021079540252685547
local_in_edges_tensor generation:  0.020424604415893555
mini_batch_src_global generation:  0.045368194580078125
r_  generation:  0.3699185848236084
local_output_nid generation:  0.021161794662475586
local_in_edges_tensor generation:  0.02691650390625
mini_batch_src_global generation:  0.04608869552612305
r_  generation:  0.37658143043518066
local_output_nid generation:  0.021792173385620117
local_in_edges_tensor generation:  0.023925065994262695
mini_batch_src_global generation:  0.04734182357788086
r_  generation:  0.3817756175994873
local_output_nid generation:  0.02181267738342285
local_in_edges_tensor generation:  0.030495643615722656
mini_batch_src_global generation:  0.046388864517211914
r_  generation:  0.3813443183898926
local_output_nid generation:  0.021733760833740234
local_in_edges_tensor generation:  0.0207977294921875
mini_batch_src_global generation:  0.04679083824157715
r_  generation:  0.374530553817749
----------------------check_connections_block total spend ----------------------------- 4.374922275543213
generate_one_block  0.4887819290161133
generate_one_block  0.5057635307312012
generate_one_block  0.49491333961486816
generate_one_block  0.49188804626464844
generate_one_block  0.49594783782958984
generate_one_block  0.517423152923584
generate_one_block  0.5042364597320557
generate_one_block  0.48249363899230957
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.035721778869628906
gen group dst list time:  0.0370941162109375
time for parepare:  0.019936084747314453
local_output_nid generation:  0.02652287483215332
local_in_edges_tensor generation:  0.04197287559509277
mini_batch_src_global generation:  0.0439906120300293
r_  generation:  0.4803757667541504
local_output_nid generation:  0.03697490692138672
local_in_edges_tensor generation:  0.052886962890625
mini_batch_src_global generation:  0.05628514289855957
r_  generation:  0.48577380180358887
local_output_nid generation:  0.038378238677978516
local_in_edges_tensor generation:  0.04859662055969238
mini_batch_src_global generation:  0.05469918251037598
r_  generation:  0.488771915435791
local_output_nid generation:  0.03833317756652832
local_in_edges_tensor generation:  0.03892970085144043
mini_batch_src_global generation:  0.05339336395263672
r_  generation:  0.48847389221191406
local_output_nid generation:  0.03852725028991699
local_in_edges_tensor generation:  0.039269447326660156
mini_batch_src_global generation:  0.05388474464416504
r_  generation:  0.49198102951049805
local_output_nid generation:  0.03898453712463379
local_in_edges_tensor generation:  0.038725852966308594
mini_batch_src_global generation:  0.05679655075073242
r_  generation:  0.49486351013183594
local_output_nid generation:  0.03933358192443848
local_in_edges_tensor generation:  0.037644386291503906
mini_batch_src_global generation:  0.05465841293334961
r_  generation:  0.5011136531829834
local_output_nid generation:  0.03909587860107422
local_in_edges_tensor generation:  0.03913426399230957
mini_batch_src_global generation:  0.054337263107299805
r_  generation:  0.49747776985168457
----------------------check_connections_block total spend ----------------------------- 5.880403757095337
generate_one_block  0.6147058010101318
generate_one_block  0.6278643608093262
generate_one_block  0.6181025505065918
generate_one_block  0.6181612014770508
generate_one_block  0.6274468898773193
generate_one_block  0.6377222537994385
generate_one_block  0.6310882568359375
generate_one_block  0.6227269172668457
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0017633438110351562  GigaBytes
Max Memory Allocated: 0.0017633438110351562  GigaBytes

connection checking time:  10.25532603263855
block generation total time  8.979266166687012
average batch blocks generation time:  1.1224082708358765
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2010498046875 GB
    Memory Allocated: 0.1012258529663086  GigaBytes
Max Memory Allocated: 0.1012258529663086  GigaBytes

torch.Size([162273, 128])
torch.Size([145779, 128])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.2030029296875 GB
    Memory Allocated: 21.577366828918457  GigaBytes
Max Memory Allocated: 21.641918182373047  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7987060546875 GB
    Memory Allocated: 0.10463190078735352  GigaBytes
Max Memory Allocated: 21.641918182373047  GigaBytes

torch.Size([162412, 128])
torch.Size([146708, 128])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 203, in forward
    x = self.layers[-1](blocks[-1], x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 23.62 GiB total capacity; 21.36 GiB already allocated; 2.44 MiB free; 22.41 GiB reserved in total by PyTorch)
