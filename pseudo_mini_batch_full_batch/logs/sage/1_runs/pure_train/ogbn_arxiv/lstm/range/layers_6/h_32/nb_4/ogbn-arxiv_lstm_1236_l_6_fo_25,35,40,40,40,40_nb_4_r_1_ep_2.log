Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648525199.6225905
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007319450378417969  GigaBytes
Max Memory Allocated: 0.0007319450378417969  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.024065732955932617
range selection method range initialization spend 0.017401695251464844
time for parepare:  0.017685651779174805
local_output_nid generation:  0.00570225715637207
local_in_edges_tensor generation:  0.005669116973876953
mini_batch_src_global generation:  0.007605314254760742
r_  generation:  0.08463907241821289
local_output_nid generation:  0.006551265716552734
local_in_edges_tensor generation:  0.0030083656311035156
mini_batch_src_global generation:  0.008727312088012695
r_  generation:  0.09148049354553223
local_output_nid generation:  0.006571531295776367
local_in_edges_tensor generation:  0.0029997825622558594
mini_batch_src_global generation:  0.006652116775512695
r_  generation:  0.09174466133117676
local_output_nid generation:  0.006556987762451172
local_in_edges_tensor generation:  0.0031027793884277344
mini_batch_src_global generation:  0.0070073604583740234
r_  generation:  0.09352374076843262
----------------------check_connections_block total spend ----------------------------- 0.5216400623321533
generate_one_block  0.1005551815032959
generate_one_block  0.1033015251159668
generate_one_block  0.10361385345458984
generate_one_block  0.10373711585998535
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.03551149368286133
gen group dst list time:  0.01145625114440918
time for parepare:  0.01928424835205078
local_output_nid generation:  0.01522207260131836
local_in_edges_tensor generation:  0.03513169288635254
mini_batch_src_global generation:  0.04110097885131836
r_  generation:  0.40749406814575195
local_output_nid generation:  0.022214889526367188
local_in_edges_tensor generation:  0.040254831314086914
mini_batch_src_global generation:  0.05164694786071777
r_  generation:  0.44951581954956055
local_output_nid generation:  0.025992631912231445
local_in_edges_tensor generation:  0.04420900344848633
mini_batch_src_global generation:  0.06829237937927246
r_  generation:  0.42645978927612305
local_output_nid generation:  0.02366948127746582
local_in_edges_tensor generation:  0.032811880111694336
mini_batch_src_global generation:  0.05041933059692383
r_  generation:  0.4255945682525635
----------------------check_connections_block total spend ----------------------------- 2.5570502281188965
generate_one_block  0.5617203712463379
generate_one_block  0.5468413829803467
generate_one_block  0.5933971405029297
generate_one_block  0.5528254508972168
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.03186774253845215
gen group dst list time:  0.024720430374145508
time for parepare:  0.018868684768676758
local_output_nid generation:  0.025431394577026367
local_in_edges_tensor generation:  0.05683469772338867
mini_batch_src_global generation:  0.06516265869140625
r_  generation:  0.561593770980835
local_output_nid generation:  0.03260970115661621
local_in_edges_tensor generation:  0.05442237854003906
mini_batch_src_global generation:  0.06448507308959961
r_  generation:  0.5676727294921875
local_output_nid generation:  0.03374505043029785
local_in_edges_tensor generation:  0.04124259948730469
mini_batch_src_global generation:  0.06726932525634766
r_  generation:  0.5842275619506836
local_output_nid generation:  0.03390836715698242
local_in_edges_tensor generation:  0.04672551155090332
mini_batch_src_global generation:  0.06080341339111328
r_  generation:  0.569998025894165
----------------------check_connections_block total spend ----------------------------- 3.4069275856018066
generate_one_block  0.7082760334014893
generate_one_block  0.726370096206665
generate_one_block  0.754467248916626
generate_one_block  0.705357551574707
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.035266876220703125
gen group dst list time:  0.028849363327026367
time for parepare:  0.01892399787902832
local_output_nid generation:  0.028308391571044922
local_in_edges_tensor generation:  0.053498268127441406
mini_batch_src_global generation:  0.05164074897766113
r_  generation:  0.5512430667877197
local_output_nid generation:  0.03462553024291992
local_in_edges_tensor generation:  0.05279350280761719
mini_batch_src_global generation:  0.06430673599243164
r_  generation:  0.5574030876159668
local_output_nid generation:  0.03552603721618652
local_in_edges_tensor generation:  0.03832054138183594
mini_batch_src_global generation:  0.06803393363952637
r_  generation:  0.5629489421844482
local_output_nid generation:  0.03716468811035156
local_in_edges_tensor generation:  0.04938530921936035
mini_batch_src_global generation:  0.06626558303833008
r_  generation:  0.5802357196807861
----------------------check_connections_block total spend ----------------------------- 3.3573219776153564
generate_one_block  0.751650333404541
generate_one_block  0.7388885021209717
generate_one_block  0.7181403636932373
generate_one_block  0.7264647483825684
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.034131765365600586
gen group dst list time:  0.024545669555664062
time for parepare:  0.019159317016601562
local_output_nid generation:  0.028624296188354492
local_in_edges_tensor generation:  0.041604042053222656
mini_batch_src_global generation:  0.050347328186035156
r_  generation:  0.5493698120117188
local_output_nid generation:  0.03551077842712402
local_in_edges_tensor generation:  0.03538393974304199
mini_batch_src_global generation:  0.0635223388671875
r_  generation:  0.549919605255127
local_output_nid generation:  0.036344051361083984
local_in_edges_tensor generation:  0.03606581687927246
mini_batch_src_global generation:  0.08067607879638672
r_  generation:  0.5788798332214355
local_output_nid generation:  0.03824329376220703
local_in_edges_tensor generation:  0.05795693397521973
mini_batch_src_global generation:  0.07760810852050781
r_  generation:  0.584892749786377
----------------------check_connections_block total spend ----------------------------- 3.394044876098633
generate_one_block  0.7237849235534668
generate_one_block  0.6924917697906494
generate_one_block  0.7015814781188965
generate_one_block  0.7005248069763184
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.032828330993652344
gen group dst list time:  0.0276639461517334
time for parepare:  0.019331932067871094
local_output_nid generation:  0.029219388961791992
local_in_edges_tensor generation:  0.041988372802734375
mini_batch_src_global generation:  0.04576706886291504
r_  generation:  0.5454177856445312
local_output_nid generation:  0.036907196044921875
local_in_edges_tensor generation:  0.042485952377319336
mini_batch_src_global generation:  0.05930972099304199
r_  generation:  0.5429775714874268
local_output_nid generation:  0.03768157958984375
local_in_edges_tensor generation:  0.03748297691345215
mini_batch_src_global generation:  0.062389373779296875
r_  generation:  0.5277862548828125
local_output_nid generation:  0.03866267204284668
local_in_edges_tensor generation:  0.04683089256286621
mini_batch_src_global generation:  0.05984663963317871
r_  generation:  0.5449144840240479
----------------------check_connections_block total spend ----------------------------- 3.2117114067077637
generate_one_block  0.6628048419952393
generate_one_block  0.7215337753295898
generate_one_block  0.6801087856292725
generate_one_block  0.6443564891815186
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007319450378417969  GigaBytes
Max Memory Allocated: 0.0007319450378417969  GigaBytes

connection checking time:  15.927056074142456
block generation total time  13.611586093902588
average batch blocks generation time:  3.402896523475647
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2420654296875 GB
    Memory Allocated: 0.14284467697143555  GigaBytes
Max Memory Allocated: 0.14284467697143555  GigaBytes

torch.Size([167791, 128])
torch.Size([167574, 32])
torch.Size([167003, 32])
torch.Size([164972, 32])
torch.Size([155248, 32])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 438, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 434, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 253, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.34 GiB already allocated; 14.44 MiB free; 22.41 GiB reserved in total by PyTorch)
