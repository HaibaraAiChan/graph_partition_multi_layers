Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648505821.9227033
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0011692047119140625  GigaBytes
Max Memory Allocated: 0.0011692047119140625  GigaBytes

The real block id is  4
get_global_graph_edges_ids_block function  spend 0.053009986877441406
range selection method range initialization spend 0.01745772361755371
time for parepare:  0.01804804801940918
local_output_nid generation:  0.002626180648803711
local_in_edges_tensor generation:  0.0047914981842041016
mini_batch_src_global generation:  0.0032584667205810547
r_  generation:  0.037847042083740234
local_output_nid generation:  0.003090381622314453
local_in_edges_tensor generation:  0.0016374588012695312
mini_batch_src_global generation:  0.0041866302490234375
r_  generation:  0.039289236068725586
local_output_nid generation:  0.0031697750091552734
local_in_edges_tensor generation:  0.0016243457794189453
mini_batch_src_global generation:  0.0028181076049804688
r_  generation:  0.03974318504333496
local_output_nid generation:  0.003187417984008789
local_in_edges_tensor generation:  0.0016629695892333984
mini_batch_src_global generation:  0.0029578208923339844
r_  generation:  0.04151606559753418
local_output_nid generation:  0.0031583309173583984
local_in_edges_tensor generation:  0.0016629695892333984
mini_batch_src_global generation:  0.0030150413513183594
r_  generation:  0.04191088676452637
local_output_nid generation:  0.0031867027282714844
local_in_edges_tensor generation:  0.0016677379608154297
mini_batch_src_global generation:  0.0033273696899414062
r_  generation:  0.043088436126708984
local_output_nid generation:  0.0031859874725341797
local_in_edges_tensor generation:  0.001712799072265625
mini_batch_src_global generation:  0.003352642059326172
r_  generation:  0.04332304000854492
local_output_nid generation:  0.003173828125
local_in_edges_tensor generation:  0.0016007423400878906
mini_batch_src_global generation:  0.0033135414123535156
r_  generation:  0.04166531562805176
----------------------check_connections_block total spend ----------------------------- 0.4829063415527344
generate_one_block  0.05403757095336914
generate_one_block  0.05638885498046875
generate_one_block  0.05600690841674805
generate_one_block  0.05611681938171387
generate_one_block  0.057898759841918945
generate_one_block  0.05672788619995117
generate_one_block  0.05731368064880371
generate_one_block  0.05473589897155762
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.03952813148498535
gen group dst list time:  0.015356779098510742
time for parepare:  0.019249439239501953
local_output_nid generation:  0.010818004608154297
local_in_edges_tensor generation:  0.029578208923339844
mini_batch_src_global generation:  0.03166317939758301
r_  generation:  0.3010842800140381
local_output_nid generation:  0.01580190658569336
local_in_edges_tensor generation:  0.029094457626342773
mini_batch_src_global generation:  0.04317116737365723
r_  generation:  0.32157301902770996
local_output_nid generation:  0.016199827194213867
local_in_edges_tensor generation:  0.020751476287841797
mini_batch_src_global generation:  0.03943634033203125
r_  generation:  0.31760311126708984
local_output_nid generation:  0.01660609245300293
local_in_edges_tensor generation:  0.0269775390625
mini_batch_src_global generation:  0.03725790977478027
r_  generation:  0.3402247428894043
local_output_nid generation:  0.019934415817260742
local_in_edges_tensor generation:  0.04073357582092285
mini_batch_src_global generation:  0.05231213569641113
r_  generation:  0.32981109619140625
local_output_nid generation:  0.017540931701660156
local_in_edges_tensor generation:  0.02615952491760254
mini_batch_src_global generation:  0.038938045501708984
r_  generation:  0.3290371894836426
local_output_nid generation:  0.018310070037841797
local_in_edges_tensor generation:  0.023601293563842773
mini_batch_src_global generation:  0.03833341598510742
r_  generation:  0.3304140567779541
local_output_nid generation:  0.01698899269104004
local_in_edges_tensor generation:  0.016898155212402344
mini_batch_src_global generation:  0.038466691970825195
r_  generation:  0.30580568313598633
----------------------check_connections_block total spend ----------------------------- 3.8607449531555176
generate_one_block  0.40718817710876465
generate_one_block  0.41252636909484863
generate_one_block  0.3985404968261719
generate_one_block  0.4089386463165283
generate_one_block  0.41173410415649414
generate_one_block  0.45092344284057617
generate_one_block  0.43990492820739746
generate_one_block  0.41600966453552246
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.0536198616027832
gen group dst list time:  0.04110383987426758
time for parepare:  0.019136667251586914
local_output_nid generation:  0.025821208953857422
local_in_edges_tensor generation:  0.07736992835998535
mini_batch_src_global generation:  0.053223371505737305
r_  generation:  0.5247881412506104
local_output_nid generation:  0.03125619888305664
local_in_edges_tensor generation:  0.051352500915527344
mini_batch_src_global generation:  0.06015157699584961
r_  generation:  0.52899169921875
local_output_nid generation:  0.03229522705078125
local_in_edges_tensor generation:  0.03856062889099121
mini_batch_src_global generation:  0.05774998664855957
r_  generation:  0.5499379634857178
local_output_nid generation:  0.03376436233520508
local_in_edges_tensor generation:  0.055669307708740234
mini_batch_src_global generation:  0.06072664260864258
r_  generation:  0.5568082332611084
local_output_nid generation:  0.03657364845275879
local_in_edges_tensor generation:  0.05410480499267578
mini_batch_src_global generation:  0.06560993194580078
r_  generation:  0.546687126159668
local_output_nid generation:  0.034177303314208984
local_in_edges_tensor generation:  0.04098343849182129
mini_batch_src_global generation:  0.06100606918334961
r_  generation:  0.5378074645996094
local_output_nid generation:  0.03416609764099121
local_in_edges_tensor generation:  0.04130101203918457
mini_batch_src_global generation:  0.059381961822509766
r_  generation:  0.5461606979370117
local_output_nid generation:  0.0340268611907959
local_in_edges_tensor generation:  0.03784942626953125
mini_batch_src_global generation:  0.08870410919189453
r_  generation:  0.5401403903961182
----------------------check_connections_block total spend ----------------------------- 6.467445373535156
generate_one_block  0.7044827938079834
generate_one_block  0.6842737197875977
generate_one_block  0.6856865882873535
generate_one_block  0.7152211666107178
generate_one_block  0.6688997745513916
generate_one_block  0.6731326580047607
generate_one_block  0.7143867015838623
generate_one_block  0.6934335231781006
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.054898977279663086
gen group dst list time:  0.04699301719665527
time for parepare:  0.01919412612915039
local_output_nid generation:  0.030112028121948242
local_in_edges_tensor generation:  0.05406045913696289
mini_batch_src_global generation:  0.056156158447265625
r_  generation:  0.5339758396148682
local_output_nid generation:  0.03599143028259277
local_in_edges_tensor generation:  0.05527853965759277
mini_batch_src_global generation:  0.06870484352111816
r_  generation:  0.540191650390625
local_output_nid generation:  0.036385297775268555
local_in_edges_tensor generation:  0.046402692794799805
mini_batch_src_global generation:  0.0640878677368164
r_  generation:  0.5384521484375
local_output_nid generation:  0.036673545837402344
local_in_edges_tensor generation:  0.041413307189941406
mini_batch_src_global generation:  0.06600594520568848
r_  generation:  0.5509741306304932
local_output_nid generation:  0.03887462615966797
local_in_edges_tensor generation:  0.040885210037231445
mini_batch_src_global generation:  0.06152820587158203
r_  generation:  0.5498542785644531
local_output_nid generation:  0.03719663619995117
local_in_edges_tensor generation:  0.04034686088562012
mini_batch_src_global generation:  0.09502482414245605
r_  generation:  0.5589427947998047
local_output_nid generation:  0.04063224792480469
local_in_edges_tensor generation:  0.0517580509185791
mini_batch_src_global generation:  0.06348776817321777
r_  generation:  0.5643367767333984
local_output_nid generation:  0.03830742835998535
local_in_edges_tensor generation:  0.052134037017822266
mini_batch_src_global generation:  0.06136369705200195
r_  generation:  0.561490535736084
----------------------check_connections_block total spend ----------------------------- 6.638282537460327
generate_one_block  0.6762433052062988
generate_one_block  0.6888515949249268
generate_one_block  0.6961853504180908
generate_one_block  0.6948423385620117
generate_one_block  0.6739273071289062
generate_one_block  0.6803338527679443
generate_one_block  0.7547781467437744
generate_one_block  0.7098414897918701
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.035721540451049805
gen group dst list time:  0.049356937408447266
time for parepare:  0.019349098205566406
local_output_nid generation:  0.032700538635253906
local_in_edges_tensor generation:  0.061151981353759766
mini_batch_src_global generation:  0.04565787315368652
r_  generation:  0.5108871459960938
local_output_nid generation:  0.03822755813598633
local_in_edges_tensor generation:  0.03355145454406738
mini_batch_src_global generation:  0.061369895935058594
r_  generation:  0.5140244960784912
local_output_nid generation:  0.03960680961608887
local_in_edges_tensor generation:  0.04170060157775879
mini_batch_src_global generation:  0.06841897964477539
r_  generation:  0.5131256580352783
local_output_nid generation:  0.038620948791503906
local_in_edges_tensor generation:  0.04435276985168457
mini_batch_src_global generation:  0.07513260841369629
r_  generation:  0.5192384719848633
local_output_nid generation:  0.043169260025024414
local_in_edges_tensor generation:  0.038927555084228516
mini_batch_src_global generation:  0.05933356285095215
r_  generation:  0.5151278972625732
local_output_nid generation:  0.04023575782775879
local_in_edges_tensor generation:  0.036727190017700195
mini_batch_src_global generation:  0.058096885681152344
r_  generation:  0.5146708488464355
local_output_nid generation:  0.04017925262451172
local_in_edges_tensor generation:  0.03920888900756836
mini_batch_src_global generation:  0.05790996551513672
r_  generation:  0.5207555294036865
local_output_nid generation:  0.040439605712890625
local_in_edges_tensor generation:  0.03491520881652832
mini_batch_src_global generation:  0.058309316635131836
r_  generation:  0.5273263454437256
----------------------check_connections_block total spend ----------------------------- 6.2704174518585205
generate_one_block  0.6465721130371094
generate_one_block  0.6488256454467773
generate_one_block  0.6476535797119141
generate_one_block  0.641103982925415
generate_one_block  0.6442010402679443
generate_one_block  0.6426858901977539
generate_one_block  0.6480951309204102
generate_one_block  0.7016961574554443
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0011692047119140625  GigaBytes
Max Memory Allocated: 0.0011692047119140625  GigaBytes

connection checking time:  23.23689031600952
block generation total time  19.681119680404663
average batch blocks generation time:  2.460139960050583
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2225341796875 GB
    Memory Allocated: 0.1269841194152832  GigaBytes
Max Memory Allocated: 0.1269841194152832  GigaBytes

torch.Size([166942, 128])
torch.Size([165741, 64])
torch.Size([161328, 64])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 23.62 GiB total capacity; 22.28 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
