Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648475142.8373766
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.02497410774230957
range selection method range initialization spend 0.013016223907470703
time for parepare:  0.0179898738861084
local_output_nid generation:  0.002650737762451172
local_in_edges_tensor generation:  0.004632234573364258
mini_batch_src_global generation:  0.0031976699829101562
r_  generation:  0.036740779876708984
local_output_nid generation:  0.002952098846435547
local_in_edges_tensor generation:  0.0016753673553466797
mini_batch_src_global generation:  0.004023313522338867
r_  generation:  0.037676334381103516
local_output_nid generation:  0.0031120777130126953
local_in_edges_tensor generation:  0.0016396045684814453
mini_batch_src_global generation:  0.00272369384765625
r_  generation:  0.039296627044677734
local_output_nid generation:  0.0030982494354248047
local_in_edges_tensor generation:  0.0017180442810058594
mini_batch_src_global generation:  0.002740144729614258
r_  generation:  0.04016399383544922
local_output_nid generation:  0.003116607666015625
local_in_edges_tensor generation:  0.0016803741455078125
mini_batch_src_global generation:  0.0029649734497070312
r_  generation:  0.04158592224121094
local_output_nid generation:  0.003188610076904297
local_in_edges_tensor generation:  0.001683950424194336
mini_batch_src_global generation:  0.0030837059020996094
r_  generation:  0.04100370407104492
local_output_nid generation:  0.003155946731567383
local_in_edges_tensor generation:  0.0016291141510009766
mini_batch_src_global generation:  0.0031282901763916016
r_  generation:  0.04098391532897949
local_output_nid generation:  0.003124237060546875
local_in_edges_tensor generation:  0.0016388893127441406
mini_batch_src_global generation:  0.003189563751220703
r_  generation:  0.04163479804992676
----------------------check_connections_block total spend ----------------------------- 0.4697115421295166
generate_one_block  0.054120540618896484
generate_one_block  0.05463147163391113
generate_one_block  0.05536365509033203
generate_one_block  0.05613064765930176
generate_one_block  0.05709385871887207
generate_one_block  0.05453181266784668
generate_one_block  0.055034637451171875
generate_one_block  0.05472517013549805
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04114055633544922
gen group dst list time:  0.015114545822143555
time for parepare:  0.01923346519470215
local_output_nid generation:  0.010699272155761719
local_in_edges_tensor generation:  0.028892993927001953
mini_batch_src_global generation:  0.02931523323059082
r_  generation:  0.2873561382293701
local_output_nid generation:  0.01595139503479004
local_in_edges_tensor generation:  0.0272066593170166
mini_batch_src_global generation:  0.03546571731567383
r_  generation:  0.3057749271392822
local_output_nid generation:  0.01620030403137207
local_in_edges_tensor generation:  0.02517080307006836
mini_batch_src_global generation:  0.034856557846069336
r_  generation:  0.30881285667419434
local_output_nid generation:  0.016594648361206055
local_in_edges_tensor generation:  0.02622056007385254
mini_batch_src_global generation:  0.03864264488220215
r_  generation:  0.31903576850891113
local_output_nid generation:  0.016694307327270508
local_in_edges_tensor generation:  0.01792311668395996
mini_batch_src_global generation:  0.03647589683532715
r_  generation:  0.3112514019012451
local_output_nid generation:  0.01693439483642578
local_in_edges_tensor generation:  0.0178678035736084
mini_batch_src_global generation:  0.03692913055419922
r_  generation:  0.3122062683105469
local_output_nid generation:  0.016899585723876953
local_in_edges_tensor generation:  0.020587444305419922
mini_batch_src_global generation:  0.037474632263183594
r_  generation:  0.31282472610473633
local_output_nid generation:  0.017001628875732422
local_in_edges_tensor generation:  0.024078845977783203
mini_batch_src_global generation:  0.036913394927978516
r_  generation:  0.31227636337280273
----------------------check_connections_block total spend ----------------------------- 3.613987922668457
generate_one_block  0.39263272285461426
generate_one_block  0.39251708984375
generate_one_block  0.4002647399902344
generate_one_block  0.3995091915130615
generate_one_block  0.392564058303833
generate_one_block  0.4038994312286377
generate_one_block  0.39829206466674805
generate_one_block  0.3929286003112793
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03363776206970215
gen group dst list time:  0.035839080810546875
time for parepare:  0.019288063049316406
local_output_nid generation:  0.02549147605895996
local_in_edges_tensor generation:  0.04060959815979004
mini_batch_src_global generation:  0.04735207557678223
r_  generation:  0.4723217487335205
local_output_nid generation:  0.03279399871826172
local_in_edges_tensor generation:  0.0487213134765625
mini_batch_src_global generation:  0.056371450424194336
r_  generation:  0.48317766189575195
local_output_nid generation:  0.03295540809631348
local_in_edges_tensor generation:  0.04131269454956055
mini_batch_src_global generation:  0.05048012733459473
r_  generation:  0.4929826259613037
local_output_nid generation:  0.033548593521118164
local_in_edges_tensor generation:  0.03334951400756836
mini_batch_src_global generation:  0.05407595634460449
r_  generation:  0.49378252029418945
local_output_nid generation:  0.033676862716674805
local_in_edges_tensor generation:  0.03739786148071289
mini_batch_src_global generation:  0.05371737480163574
r_  generation:  0.5064170360565186
local_output_nid generation:  0.03363776206970215
local_in_edges_tensor generation:  0.03309130668640137
mini_batch_src_global generation:  0.055057525634765625
r_  generation:  0.49401044845581055
local_output_nid generation:  0.03387045860290527
local_in_edges_tensor generation:  0.0376131534576416
mini_batch_src_global generation:  0.053533315658569336
r_  generation:  0.5068912506103516
local_output_nid generation:  0.0341334342956543
local_in_edges_tensor generation:  0.04157519340515137
mini_batch_src_global generation:  0.05501270294189453
r_  generation:  0.49582743644714355
----------------------check_connections_block total spend ----------------------------- 5.818375587463379
generate_one_block  0.623713493347168
generate_one_block  0.6325700283050537
generate_one_block  0.610680103302002
generate_one_block  0.6160564422607422
generate_one_block  0.6223866939544678
generate_one_block  0.6132855415344238
generate_one_block  0.6358580589294434
generate_one_block  0.6220476627349854
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  9.432363510131836
block generation total time  8.149205923080444
average batch blocks generation time:  1.0186507403850555
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1854248046875 GB
    Memory Allocated: 0.10066652297973633  GigaBytes
Max Memory Allocated: 0.10066652297973633  GigaBytes

torch.Size([160399, 128])
torch.Size([140902, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 138, in invoke_udf_reduce
    for k, msg in msgdata_bkt.items():
  File "/usr/lib/python3.6/_collections_abc.py", line 744, in __iter__
    yield (key, self._mapping[key])
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/frame.py", line 393, in __getitem__
    return self._columns[name].data
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/frame.py", line 122, in data
    self.storage = F.gather_row(self.storage, self.index)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/backend/pytorch/tensor.py", line 186, in gather_row
    return th.index_select(data, 0, row_index.long())
RuntimeError: CUDA out of memory. Tried to allocate 278.00 MiB (GPU 0; 23.62 GiB total capacity; 22.20 GiB already allocated; 128.44 MiB free; 22.30 GiB reserved in total by PyTorch)
