Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648507074.6613343
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0272216796875 GB
    Memory Allocated: 0.010137557983398438  GigaBytes
Max Memory Allocated: 0.010137557983398438  GigaBytes

The real block id is  4
get_global_graph_edges_ids_block function  spend 0.025638818740844727
range selection method range initialization spend 0.01702880859375
time for parepare:  0.017786026000976562
local_output_nid generation:  0.0052068233489990234
local_in_edges_tensor generation:  0.006258964538574219
mini_batch_src_global generation:  0.007897377014160156
r_  generation:  0.08383059501647949
local_output_nid generation:  0.005947589874267578
local_in_edges_tensor generation:  0.0030150413513183594
mini_batch_src_global generation:  0.010131120681762695
r_  generation:  0.08939456939697266
local_output_nid generation:  0.005922079086303711
local_in_edges_tensor generation:  0.0030782222747802734
mini_batch_src_global generation:  0.007595539093017578
r_  generation:  0.09835004806518555
local_output_nid generation:  0.005909442901611328
local_in_edges_tensor generation:  0.003130674362182617
mini_batch_src_global generation:  0.006964206695556641
r_  generation:  0.09187078475952148
----------------------check_connections_block total spend ----------------------------- 0.5257067680358887
generate_one_block  0.10121774673461914
generate_one_block  0.10248994827270508
generate_one_block  0.10210847854614258
generate_one_block  0.10225248336791992
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.04087114334106445
gen group dst list time:  0.011513471603393555
time for parepare:  0.019384384155273438
local_output_nid generation:  0.014483451843261719
local_in_edges_tensor generation:  0.03633832931518555
mini_batch_src_global generation:  0.041364431381225586
r_  generation:  0.40342283248901367
local_output_nid generation:  0.02324843406677246
local_in_edges_tensor generation:  0.03589129447937012
mini_batch_src_global generation:  0.04833650588989258
r_  generation:  0.41436100006103516
local_output_nid generation:  0.024392127990722656
local_in_edges_tensor generation:  0.031034469604492188
mini_batch_src_global generation:  0.048433542251586914
r_  generation:  0.4257073402404785
local_output_nid generation:  0.025247573852539062
local_in_edges_tensor generation:  0.026289701461791992
mini_batch_src_global generation:  0.04919123649597168
r_  generation:  0.430804967880249
----------------------check_connections_block total spend ----------------------------- 2.4556899070739746
generate_one_block  0.561784029006958
generate_one_block  0.5475380420684814
generate_one_block  0.5433797836303711
generate_one_block  0.5360860824584961
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.03732180595397949
gen group dst list time:  0.02124333381652832
time for parepare:  0.0184481143951416
local_output_nid generation:  0.02317953109741211
local_in_edges_tensor generation:  0.05072665214538574
mini_batch_src_global generation:  0.05035138130187988
r_  generation:  0.5402801036834717
local_output_nid generation:  0.03190493583679199
local_in_edges_tensor generation:  0.05234956741333008
mini_batch_src_global generation:  0.06261634826660156
r_  generation:  0.546269416809082
local_output_nid generation:  0.033106088638305664
local_in_edges_tensor generation:  0.04494428634643555
mini_batch_src_global generation:  0.057874202728271484
r_  generation:  0.5608909130096436
local_output_nid generation:  0.033371925354003906
local_in_edges_tensor generation:  0.04018282890319824
mini_batch_src_global generation:  0.06019878387451172
r_  generation:  0.5624871253967285
----------------------check_connections_block total spend ----------------------------- 3.24289608001709
generate_one_block  0.7004129886627197
generate_one_block  0.7069919109344482
generate_one_block  0.7144179344177246
generate_one_block  0.7057068347930908
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.029229164123535156
gen group dst list time:  0.023951292037963867
time for parepare:  0.018557071685791016
local_output_nid generation:  0.026995182037353516
local_in_edges_tensor generation:  0.0387270450592041
mini_batch_src_global generation:  0.04931235313415527
r_  generation:  0.5472674369812012
local_output_nid generation:  0.03459572792053223
local_in_edges_tensor generation:  0.03287053108215332
mini_batch_src_global generation:  0.06310486793518066
r_  generation:  0.545778751373291
local_output_nid generation:  0.03532981872558594
local_in_edges_tensor generation:  0.038536787033081055
mini_batch_src_global generation:  0.06732654571533203
r_  generation:  0.5489420890808105
local_output_nid generation:  0.03582501411437988
local_in_edges_tensor generation:  0.03557181358337402
mini_batch_src_global generation:  0.061570167541503906
r_  generation:  0.5488603115081787
----------------------check_connections_block total spend ----------------------------- 3.2187249660491943
generate_one_block  0.6870343685150146
generate_one_block  0.7198402881622314
generate_one_block  0.7044899463653564
generate_one_block  0.6871278285980225
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.026584625244140625
gen group dst list time:  0.024683713912963867
time for parepare:  0.01874518394470215
local_output_nid generation:  0.028041601181030273
local_in_edges_tensor generation:  0.04002690315246582
mini_batch_src_global generation:  0.04743528366088867
r_  generation:  0.5119121074676514
local_output_nid generation:  0.034978389739990234
local_in_edges_tensor generation:  0.04990506172180176
mini_batch_src_global generation:  0.0601954460144043
r_  generation:  0.5095677375793457
local_output_nid generation:  0.03578543663024902
local_in_edges_tensor generation:  0.0424191951751709
mini_batch_src_global generation:  0.05975508689880371
r_  generation:  0.5113990306854248
local_output_nid generation:  0.0365750789642334
local_in_edges_tensor generation:  0.03918910026550293
mini_batch_src_global generation:  0.0602107048034668
r_  generation:  0.5167109966278076
----------------------check_connections_block total spend ----------------------------- 3.0706570148468018
generate_one_block  0.6482632160186768
generate_one_block  0.6524627208709717
generate_one_block  0.6560647487640381
generate_one_block  0.6430299282073975
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0272216796875 GB
    Memory Allocated: 0.010137557983398438  GigaBytes
Max Memory Allocated: 0.010137557983398438  GigaBytes

connection checking time:  11.98796796798706
block generation total time  10.414630651473999
average batch blocks generation time:  2.6036576628684998
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2322998046875 GB
    Memory Allocated: 0.13942813873291016  GigaBytes
Max Memory Allocated: 0.13942813873291016  GigaBytes

torch.Size([167428, 128])
torch.Size([166859, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 18.00 MiB (GPU 0; 23.62 GiB total capacity; 21.94 GiB already allocated; 4.44 MiB free; 22.42 GiB reserved in total by PyTorch)
