Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648464190.071113
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.02717280387878418
random selection method range initialization spend 0.005858898162841797
time for parepare:  0.01838541030883789
local_output_nid generation:  0.004185914993286133
local_in_edges_tensor generation:  0.006721973419189453
mini_batch_src_global generation:  0.003652811050415039
r_  generation:  0.04123282432556152
local_output_nid generation:  0.0056989192962646484
local_in_edges_tensor generation:  0.0031685829162597656
mini_batch_src_global generation:  0.004695415496826172
r_  generation:  0.04561901092529297
local_output_nid generation:  0.00619959831237793
local_in_edges_tensor generation:  0.0033376216888427734
mini_batch_src_global generation:  0.003280162811279297
r_  generation:  0.04615211486816406
local_output_nid generation:  0.0062716007232666016
local_in_edges_tensor generation:  0.0033609867095947266
mini_batch_src_global generation:  0.003393411636352539
r_  generation:  0.04418015480041504
local_output_nid generation:  0.0060367584228515625
local_in_edges_tensor generation:  0.0033707618713378906
mini_batch_src_global generation:  0.0035762786865234375
r_  generation:  0.04585075378417969
local_output_nid generation:  0.00604557991027832
local_in_edges_tensor generation:  0.0032279491424560547
mini_batch_src_global generation:  0.0039055347442626953
r_  generation:  0.04663419723510742
local_output_nid generation:  0.005998373031616211
local_in_edges_tensor generation:  0.0033240318298339844
mini_batch_src_global generation:  0.00395965576171875
r_  generation:  0.04653787612915039
local_output_nid generation:  0.0060346126556396484
local_in_edges_tensor generation:  0.003376483917236328
mini_batch_src_global generation:  0.0039141178131103516
r_  generation:  0.04681086540222168
----------------------check_connections_block total spend ----------------------------- 0.5720837116241455
generate_one_block  0.061112165451049805
generate_one_block  0.06194949150085449
generate_one_block  0.061760663986206055
generate_one_block  0.06029367446899414
generate_one_block  0.06461334228515625
generate_one_block  0.0621790885925293
generate_one_block  0.0611264705657959
generate_one_block  0.061133623123168945
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04333758354187012
gen group dst list time:  0.016247034072875977
time for parepare:  0.02003622055053711
local_output_nid generation:  0.014623403549194336
local_in_edges_tensor generation:  0.03579401969909668
mini_batch_src_global generation:  0.03496837615966797
r_  generation:  0.353452205657959
local_output_nid generation:  0.024182796478271484
local_in_edges_tensor generation:  0.03560328483581543
mini_batch_src_global generation:  0.04532909393310547
r_  generation:  0.3710927963256836
local_output_nid generation:  0.024324417114257812
local_in_edges_tensor generation:  0.028758764266967773
mini_batch_src_global generation:  0.04463076591491699
r_  generation:  0.37677836418151855
local_output_nid generation:  0.024090051651000977
local_in_edges_tensor generation:  0.02822589874267578
mini_batch_src_global generation:  0.044710636138916016
r_  generation:  0.3667440414428711
local_output_nid generation:  0.024674654006958008
local_in_edges_tensor generation:  0.025562286376953125
mini_batch_src_global generation:  0.04807615280151367
r_  generation:  0.378159761428833
local_output_nid generation:  0.024356603622436523
local_in_edges_tensor generation:  0.024975061416625977
mini_batch_src_global generation:  0.04640960693359375
r_  generation:  0.3791053295135498
local_output_nid generation:  0.024582862854003906
local_in_edges_tensor generation:  0.029154300689697266
mini_batch_src_global generation:  0.04713106155395508
r_  generation:  0.3829648494720459
local_output_nid generation:  0.024181604385375977
local_in_edges_tensor generation:  0.02507925033569336
mini_batch_src_global generation:  0.04686427116394043
r_  generation:  0.3784670829772949
----------------------check_connections_block total spend ----------------------------- 4.416261911392212
generate_one_block  0.5137615203857422
generate_one_block  0.5036845207214355
generate_one_block  0.4997284412384033
generate_one_block  0.4885079860687256
generate_one_block  0.49610114097595215
generate_one_block  0.5152134895324707
generate_one_block  0.5036993026733398
generate_one_block  0.4882991313934326
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03302168846130371
gen group dst list time:  0.036794185638427734
time for parepare:  0.01941990852355957
local_output_nid generation:  0.028945446014404297
local_in_edges_tensor generation:  0.04613065719604492
mini_batch_src_global generation:  0.043985605239868164
r_  generation:  0.4784269332885742
local_output_nid generation:  0.0348668098449707
local_in_edges_tensor generation:  0.053864240646362305
mini_batch_src_global generation:  0.055344343185424805
r_  generation:  0.4848158359527588
local_output_nid generation:  0.03497815132141113
local_in_edges_tensor generation:  0.04133796691894531
mini_batch_src_global generation:  0.055199623107910156
r_  generation:  0.49004173278808594
local_output_nid generation:  0.03527545928955078
local_in_edges_tensor generation:  0.04028034210205078
mini_batch_src_global generation:  0.05228686332702637
r_  generation:  0.4931647777557373
local_output_nid generation:  0.038521766662597656
local_in_edges_tensor generation:  0.04849362373352051
mini_batch_src_global generation:  0.053615570068359375
r_  generation:  0.4960196018218994
local_output_nid generation:  0.035419464111328125
local_in_edges_tensor generation:  0.04336833953857422
mini_batch_src_global generation:  0.05678248405456543
r_  generation:  0.4993901252746582
local_output_nid generation:  0.03524017333984375
local_in_edges_tensor generation:  0.03536367416381836
mini_batch_src_global generation:  0.05395054817199707
r_  generation:  0.5010080337524414
local_output_nid generation:  0.03517270088195801
local_in_edges_tensor generation:  0.0388486385345459
mini_batch_src_global generation:  0.0545651912689209
r_  generation:  0.5021255016326904
----------------------check_connections_block total spend ----------------------------- 5.89994740486145
generate_one_block  0.6119210720062256
generate_one_block  0.6181735992431641
generate_one_block  0.6097595691680908
generate_one_block  0.6192622184753418
generate_one_block  0.6270122528076172
generate_one_block  0.6237831115722656
generate_one_block  0.6434140205383301
generate_one_block  0.6266510486602783
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  10.316209316253662
block generation total time  8.988972425460815
average batch blocks generation time:  1.123621553182602
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2049560546875 GB
    Memory Allocated: 0.10480117797851562  GigaBytes
Max Memory Allocated: 0.10480117797851562  GigaBytes

torch.Size([162175, 128])
torch.Size([145868, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.21 GiB already allocated; 12.44 MiB free; 22.41 GiB reserved in total by PyTorch)
