Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648462116.7380261
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0017633438110351562  GigaBytes
Max Memory Allocated: 0.0017633438110351562  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.02741408348083496
random selection method range initialization spend 0.006284952163696289
time for parepare:  0.018465280532836914
local_output_nid generation:  0.004286050796508789
local_in_edges_tensor generation:  0.006447792053222656
mini_batch_src_global generation:  0.0037145614624023438
r_  generation:  0.041681766510009766
local_output_nid generation:  0.005690336227416992
local_in_edges_tensor generation:  0.0033202171325683594
mini_batch_src_global generation:  0.0046787261962890625
r_  generation:  0.04406404495239258
local_output_nid generation:  0.0060443878173828125
local_in_edges_tensor generation:  0.0035047531127929688
mini_batch_src_global generation:  0.0032682418823242188
r_  generation:  0.04364132881164551
local_output_nid generation:  0.0061075687408447266
local_in_edges_tensor generation:  0.003374338150024414
mini_batch_src_global generation:  0.003270864486694336
r_  generation:  0.04562020301818848
local_output_nid generation:  0.006039619445800781
local_in_edges_tensor generation:  0.0033462047576904297
mini_batch_src_global generation:  0.003598451614379883
r_  generation:  0.04538416862487793
local_output_nid generation:  0.006032228469848633
local_in_edges_tensor generation:  0.0032944679260253906
mini_batch_src_global generation:  0.0039594173431396484
r_  generation:  0.04604458808898926
local_output_nid generation:  0.006136655807495117
local_in_edges_tensor generation:  0.003432750701904297
mini_batch_src_global generation:  0.004103183746337891
r_  generation:  0.04610633850097656
local_output_nid generation:  0.006074666976928711
local_in_edges_tensor generation:  0.0033614635467529297
mini_batch_src_global generation:  0.004006147384643555
r_  generation:  0.04721522331237793
----------------------check_connections_block total spend ----------------------------- 0.5699238777160645
generate_one_block  0.061502933502197266
generate_one_block  0.06612801551818848
generate_one_block  0.06569170951843262
generate_one_block  0.06042885780334473
generate_one_block  0.06377410888671875
generate_one_block  0.061395883560180664
generate_one_block  0.06152653694152832
generate_one_block  0.06242704391479492
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04605245590209961
gen group dst list time:  0.016197919845581055
time for parepare:  0.019544363021850586
local_output_nid generation:  0.014644861221313477
local_in_edges_tensor generation:  0.0376734733581543
mini_batch_src_global generation:  0.034982919692993164
r_  generation:  0.35961484909057617
local_output_nid generation:  0.019704818725585938
local_in_edges_tensor generation:  0.035433292388916016
mini_batch_src_global generation:  0.04474687576293945
r_  generation:  0.3685612678527832
local_output_nid generation:  0.01923847198486328
local_in_edges_tensor generation:  0.028636932373046875
mini_batch_src_global generation:  0.04386425018310547
r_  generation:  0.37582945823669434
local_output_nid generation:  0.01932048797607422
local_in_edges_tensor generation:  0.025275468826293945
mini_batch_src_global generation:  0.045122623443603516
r_  generation:  0.3705265522003174
local_output_nid generation:  0.01935863494873047
local_in_edges_tensor generation:  0.024608612060546875
mini_batch_src_global generation:  0.06453514099121094
r_  generation:  0.38157010078430176
local_output_nid generation:  0.019322872161865234
local_in_edges_tensor generation:  0.028056621551513672
mini_batch_src_global generation:  0.04678940773010254
r_  generation:  0.3791670799255371
local_output_nid generation:  0.019440650939941406
local_in_edges_tensor generation:  0.02570486068725586
mini_batch_src_global generation:  0.053838491439819336
r_  generation:  0.3882408142089844
local_output_nid generation:  0.019356966018676758
local_in_edges_tensor generation:  0.02478933334350586
mini_batch_src_global generation:  0.04634428024291992
r_  generation:  0.3794386386871338
----------------------check_connections_block total spend ----------------------------- 4.412449836730957
generate_one_block  0.49504709243774414
generate_one_block  0.5002367496490479
generate_one_block  0.49482178688049316
generate_one_block  0.48068809509277344
generate_one_block  0.48587560653686523
generate_one_block  0.5057687759399414
generate_one_block  0.4994809627532959
generate_one_block  0.4852113723754883
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03780531883239746
gen group dst list time:  0.036828041076660156
time for parepare:  0.018923282623291016
local_output_nid generation:  0.028566837310791016
local_in_edges_tensor generation:  0.04793214797973633
mini_batch_src_global generation:  0.05244946479797363
r_  generation:  0.5420758724212646
local_output_nid generation:  0.03503584861755371
local_in_edges_tensor generation:  0.05621767044067383
mini_batch_src_global generation:  0.06467747688293457
r_  generation:  0.5491921901702881
local_output_nid generation:  0.03532552719116211
local_in_edges_tensor generation:  0.04240894317626953
mini_batch_src_global generation:  0.06181979179382324
r_  generation:  0.5625486373901367
local_output_nid generation:  0.03534364700317383
local_in_edges_tensor generation:  0.04115486145019531
mini_batch_src_global generation:  0.06079602241516113
r_  generation:  0.562885046005249
local_output_nid generation:  0.03542661666870117
local_in_edges_tensor generation:  0.04147458076477051
mini_batch_src_global generation:  0.06231570243835449
r_  generation:  0.5609748363494873
local_output_nid generation:  0.03522825241088867
local_in_edges_tensor generation:  0.04241442680358887
mini_batch_src_global generation:  0.062183380126953125
r_  generation:  0.564692497253418
local_output_nid generation:  0.0353853702545166
local_in_edges_tensor generation:  0.04611539840698242
mini_batch_src_global generation:  0.06285619735717773
r_  generation:  0.5667939186096191
local_output_nid generation:  0.03541445732116699
local_in_edges_tensor generation:  0.037241220474243164
mini_batch_src_global generation:  0.06288695335388184
r_  generation:  0.5683834552764893
----------------------check_connections_block total spend ----------------------------- 6.6003758907318115
generate_one_block  0.7182314395904541
generate_one_block  0.7152340412139893
generate_one_block  0.6974124908447266
generate_one_block  0.7098739147186279
generate_one_block  0.714552640914917
generate_one_block  0.7005665302276611
generate_one_block  0.7658097743988037
generate_one_block  0.7014987468719482
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0017633438110351562  GigaBytes
Max Memory Allocated: 0.0017633438110351562  GigaBytes

connection checking time:  11.012825727462769
block generation total time  9.670310020446777
average batch blocks generation time:  1.2087887525558472
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2010498046875 GB
    Memory Allocated: 0.1033334732055664  GigaBytes
Max Memory Allocated: 0.1033334732055664  GigaBytes

torch.Size([162629, 128])
torch.Size([146381, 128])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.40 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
