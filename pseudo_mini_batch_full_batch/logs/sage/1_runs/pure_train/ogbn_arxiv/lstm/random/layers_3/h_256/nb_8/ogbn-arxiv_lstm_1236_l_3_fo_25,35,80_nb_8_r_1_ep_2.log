Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648463582.1250246
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.027768373489379883
random selection method range initialization spend 0.006356477737426758
time for parepare:  0.018691539764404297
local_output_nid generation:  0.004198789596557617
local_in_edges_tensor generation:  0.006711721420288086
mini_batch_src_global generation:  0.0037534236907958984
r_  generation:  0.041083335876464844
local_output_nid generation:  0.005614519119262695
local_in_edges_tensor generation:  0.0031976699829101562
mini_batch_src_global generation:  0.004748344421386719
r_  generation:  0.04281210899353027
local_output_nid generation:  0.005994558334350586
local_in_edges_tensor generation:  0.003210783004760742
mini_batch_src_global generation:  0.003195524215698242
r_  generation:  0.0442960262298584
local_output_nid generation:  0.006087064743041992
local_in_edges_tensor generation:  0.0036187171936035156
mini_batch_src_global generation:  0.003457307815551758
r_  generation:  0.04435372352600098
local_output_nid generation:  0.006082296371459961
local_in_edges_tensor generation:  0.0032396316528320312
mini_batch_src_global generation:  0.0035250186920166016
r_  generation:  0.04551506042480469
local_output_nid generation:  0.006091117858886719
local_in_edges_tensor generation:  0.0032753944396972656
mini_batch_src_global generation:  0.003813028335571289
r_  generation:  0.047064781188964844
local_output_nid generation:  0.006245136260986328
local_in_edges_tensor generation:  0.0033881664276123047
mini_batch_src_global generation:  0.004010677337646484
r_  generation:  0.04628157615661621
local_output_nid generation:  0.0060613155364990234
local_in_edges_tensor generation:  0.003281116485595703
mini_batch_src_global generation:  0.0038864612579345703
r_  generation:  0.04629874229431152
----------------------check_connections_block total spend ----------------------------- 0.5671653747558594
generate_one_block  0.06149482727050781
generate_one_block  0.06217217445373535
generate_one_block  0.06212496757507324
generate_one_block  0.06127190589904785
generate_one_block  0.06551551818847656
generate_one_block  0.06266140937805176
generate_one_block  0.062273263931274414
generate_one_block  0.0619657039642334
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.03874635696411133
gen group dst list time:  0.016084909439086914
time for parepare:  0.019629955291748047
local_output_nid generation:  0.014809131622314453
local_in_edges_tensor generation:  0.03349733352661133
mini_batch_src_global generation:  0.029914140701293945
r_  generation:  0.3149988651275635
local_output_nid generation:  0.02332615852355957
local_in_edges_tensor generation:  0.03259539604187012
mini_batch_src_global generation:  0.03934764862060547
r_  generation:  0.33043336868286133
local_output_nid generation:  0.02310800552368164
local_in_edges_tensor generation:  0.026674747467041016
mini_batch_src_global generation:  0.040703773498535156
r_  generation:  0.33353686332702637
local_output_nid generation:  0.022831201553344727
local_in_edges_tensor generation:  0.023901939392089844
mini_batch_src_global generation:  0.038744211196899414
r_  generation:  0.32610177993774414
local_output_nid generation:  0.023246288299560547
local_in_edges_tensor generation:  0.026183128356933594
mini_batch_src_global generation:  0.04207801818847656
r_  generation:  0.34214353561401367
local_output_nid generation:  0.023372411727905273
local_in_edges_tensor generation:  0.027213573455810547
mini_batch_src_global generation:  0.04021954536437988
r_  generation:  0.34102940559387207
local_output_nid generation:  0.02353072166442871
local_in_edges_tensor generation:  0.02693462371826172
mini_batch_src_global generation:  0.04061722755432129
r_  generation:  0.34087228775024414
local_output_nid generation:  0.023240327835083008
local_in_edges_tensor generation:  0.02376413345336914
mini_batch_src_global generation:  0.04073953628540039
r_  generation:  0.34207653999328613
----------------------check_connections_block total spend ----------------------------- 3.9718246459960938
generate_one_block  0.43325281143188477
generate_one_block  0.4406602382659912
generate_one_block  0.4428825378417969
generate_one_block  0.42366504669189453
generate_one_block  0.4441521167755127
generate_one_block  0.4714171886444092
generate_one_block  0.44588637351989746
generate_one_block  0.4388241767883301
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.049462080001831055
gen group dst list time:  0.043549299240112305
time for parepare:  0.019423484802246094
local_output_nid generation:  0.029217004776000977
local_in_edges_tensor generation:  0.07932305335998535
mini_batch_src_global generation:  0.04448676109313965
r_  generation:  0.47710657119750977
local_output_nid generation:  0.035037994384765625
local_in_edges_tensor generation:  0.05110645294189453
mini_batch_src_global generation:  0.05378007888793945
r_  generation:  0.4806032180786133
local_output_nid generation:  0.03485822677612305
local_in_edges_tensor generation:  0.03908109664916992
mini_batch_src_global generation:  0.05443143844604492
r_  generation:  0.49015140533447266
local_output_nid generation:  0.034934043884277344
local_in_edges_tensor generation:  0.0349116325378418
mini_batch_src_global generation:  0.053697824478149414
r_  generation:  0.4903576374053955
local_output_nid generation:  0.03498196601867676
local_in_edges_tensor generation:  0.037674665451049805
mini_batch_src_global generation:  0.05720186233520508
r_  generation:  0.49733805656433105
local_output_nid generation:  0.03489112854003906
local_in_edges_tensor generation:  0.04349231719970703
mini_batch_src_global generation:  0.058495521545410156
r_  generation:  0.5064942836761475
local_output_nid generation:  0.03492403030395508
local_in_edges_tensor generation:  0.034208059310913086
mini_batch_src_global generation:  0.054978370666503906
r_  generation:  0.49994969367980957
local_output_nid generation:  0.03477931022644043
local_in_edges_tensor generation:  0.03839874267578125
mini_batch_src_global generation:  0.055882930755615234
r_  generation:  0.4980475902557373
----------------------check_connections_block total spend ----------------------------- 5.903553009033203
generate_one_block  0.6259448528289795
generate_one_block  0.6289751529693604
generate_one_block  0.6188864707946777
generate_one_block  0.6198849678039551
generate_one_block  0.6268844604492188
generate_one_block  0.6283290386199951
generate_one_block  0.6588551998138428
generate_one_block  0.617264986038208
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  9.875377655029297
block generation total time  8.565765619277954
average batch blocks generation time:  1.0707207024097443
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1854248046875 GB
    Memory Allocated: 0.10248994827270508  GigaBytes
Max Memory Allocated: 0.10248994827270508  GigaBytes

torch.Size([160929, 128])
torch.Size([142984, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.22 GiB already allocated; 10.44 MiB free; 22.41 GiB reserved in total by PyTorch)
