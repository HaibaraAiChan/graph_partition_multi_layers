Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648502992.4879014
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0029964447021484375  GigaBytes
Max Memory Allocated: 0.0029964447021484375  GigaBytes

The real block id is  4
get_global_graph_edges_ids_block function  spend 0.023039579391479492
random selection method range initialization spend 0.005718231201171875
time for parepare:  0.01856517791748047
local_output_nid generation:  0.00823831558227539
local_in_edges_tensor generation:  0.007805585861206055
mini_batch_src_global generation:  0.006510734558105469
r_  generation:  0.08237791061401367
local_output_nid generation:  0.01165461540222168
local_in_edges_tensor generation:  0.005930662155151367
mini_batch_src_global generation:  0.008626222610473633
r_  generation:  0.08868002891540527
local_output_nid generation:  0.011712074279785156
local_in_edges_tensor generation:  0.0059125423431396484
mini_batch_src_global generation:  0.006526947021484375
r_  generation:  0.08784914016723633
local_output_nid generation:  0.011703968048095703
local_in_edges_tensor generation:  0.0058672428131103516
mini_batch_src_global generation:  0.007223367691040039
r_  generation:  0.09113144874572754
----------------------check_connections_block total spend ----------------------------- 0.5485846996307373
generate_one_block  0.10078120231628418
generate_one_block  0.10201859474182129
generate_one_block  0.10135984420776367
generate_one_block  0.10159540176391602
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.036733150482177734
gen group dst list time:  0.011492490768432617
time for parepare:  0.01890850067138672
local_output_nid generation:  0.01896357536315918
local_in_edges_tensor generation:  0.04015946388244629
mini_batch_src_global generation:  0.04121232032775879
r_  generation:  0.4047105312347412
local_output_nid generation:  0.024895906448364258
local_in_edges_tensor generation:  0.03876304626464844
mini_batch_src_global generation:  0.04855036735534668
r_  generation:  0.4134683609008789
local_output_nid generation:  0.02506732940673828
local_in_edges_tensor generation:  0.03243255615234375
mini_batch_src_global generation:  0.04796314239501953
r_  generation:  0.4222559928894043
local_output_nid generation:  0.024963855743408203
local_in_edges_tensor generation:  0.02466297149658203
mini_batch_src_global generation:  0.049407243728637695
r_  generation:  0.4187295436859131
----------------------check_connections_block total spend ----------------------------- 2.459610939025879
generate_one_block  0.5614871978759766
generate_one_block  0.5460066795349121
generate_one_block  0.5395948886871338
generate_one_block  0.5316383838653564
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.028506040573120117
gen group dst list time:  0.020936012268066406
time for parepare:  0.018506526947021484
local_output_nid generation:  0.028603315353393555
local_in_edges_tensor generation:  0.055052757263183594
mini_batch_src_global generation:  0.05092358589172363
r_  generation:  0.5336124897003174
local_output_nid generation:  0.03558993339538574
local_in_edges_tensor generation:  0.05584430694580078
mini_batch_src_global generation:  0.06617999076843262
r_  generation:  0.5419080257415771
local_output_nid generation:  0.03560447692871094
local_in_edges_tensor generation:  0.041204214096069336
mini_batch_src_global generation:  0.05680584907531738
r_  generation:  0.5581784248352051
local_output_nid generation:  0.035573482513427734
local_in_edges_tensor generation:  0.04617905616760254
mini_batch_src_global generation:  0.059403419494628906
r_  generation:  0.5536890029907227
----------------------check_connections_block total spend ----------------------------- 3.2518792152404785
generate_one_block  0.6799044609069824
generate_one_block  0.6901295185089111
generate_one_block  0.6943442821502686
generate_one_block  0.6998090744018555
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.02694416046142578
gen group dst list time:  0.023958921432495117
time for parepare:  0.018694400787353516
local_output_nid generation:  0.032114505767822266
local_in_edges_tensor generation:  0.042617082595825195
mini_batch_src_global generation:  0.049429893493652344
r_  generation:  0.5375418663024902
local_output_nid generation:  0.04158639907836914
local_in_edges_tensor generation:  0.04510045051574707
mini_batch_src_global generation:  0.06282281875610352
r_  generation:  0.5476233959197998
local_output_nid generation:  0.038367509841918945
local_in_edges_tensor generation:  0.04493308067321777
mini_batch_src_global generation:  0.0628354549407959
r_  generation:  0.5509748458862305
local_output_nid generation:  0.038230180740356445
local_in_edges_tensor generation:  0.04555535316467285
mini_batch_src_global generation:  0.06233787536621094
r_  generation:  0.5547895431518555
----------------------check_connections_block total spend ----------------------------- 3.2733349800109863
generate_one_block  0.6875457763671875
generate_one_block  0.7045071125030518
generate_one_block  0.6863524913787842
generate_one_block  0.6826465129852295
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.02310037612915039
gen group dst list time:  0.02437615394592285
time for parepare:  0.0188748836517334
local_output_nid generation:  0.03339695930480957
local_in_edges_tensor generation:  0.04129171371459961
mini_batch_src_global generation:  0.04460430145263672
r_  generation:  0.5062980651855469
local_output_nid generation:  0.039034366607666016
local_in_edges_tensor generation:  0.052666664123535156
mini_batch_src_global generation:  0.05702972412109375
r_  generation:  0.5073471069335938
local_output_nid generation:  0.03879070281982422
local_in_edges_tensor generation:  0.043483734130859375
mini_batch_src_global generation:  0.057341575622558594
r_  generation:  0.510066032409668
local_output_nid generation:  0.03897380828857422
local_in_edges_tensor generation:  0.044345855712890625
mini_batch_src_global generation:  0.05733656883239746
r_  generation:  0.5142226219177246
----------------------check_connections_block total spend ----------------------------- 3.0794119834899902
generate_one_block  0.6405251026153564
generate_one_block  0.6502246856689453
generate_one_block  0.6436061859130859
generate_one_block  0.6417751312255859
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0029964447021484375  GigaBytes
Max Memory Allocated: 0.0029964447021484375  GigaBytes

connection checking time:  12.064237117767334
block generation total time  10.280097484588623
average batch blocks generation time:  2.5700243711471558
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2244873046875 GB
    Memory Allocated: 0.13232803344726562  GigaBytes
Max Memory Allocated: 0.13232803344726562  GigaBytes

torch.Size([167372, 128])
torch.Size([166817, 128])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 23.62 GiB total capacity; 22.35 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
