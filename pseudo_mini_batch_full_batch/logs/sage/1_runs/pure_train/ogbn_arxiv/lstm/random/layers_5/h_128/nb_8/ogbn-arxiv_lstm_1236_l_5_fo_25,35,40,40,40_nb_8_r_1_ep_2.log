Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648503025.6561215
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0029964447021484375  GigaBytes
Max Memory Allocated: 0.0029964447021484375  GigaBytes

The real block id is  4
get_global_graph_edges_ids_block function  spend 0.029634952545166016
random selection method range initialization spend 0.005756378173828125
time for parepare:  0.018841028213500977
local_output_nid generation:  0.004156589508056641
local_in_edges_tensor generation:  0.0061304569244384766
mini_batch_src_global generation:  0.0034215450286865234
r_  generation:  0.038025856018066406
local_output_nid generation:  0.00586390495300293
local_in_edges_tensor generation:  0.0031540393829345703
mini_batch_src_global generation:  0.004351377487182617
r_  generation:  0.03993725776672363
local_output_nid generation:  0.0061054229736328125
local_in_edges_tensor generation:  0.003197908401489258
mini_batch_src_global generation:  0.0029675960540771484
r_  generation:  0.04051852226257324
local_output_nid generation:  0.006124258041381836
local_in_edges_tensor generation:  0.0030579566955566406
mini_batch_src_global generation:  0.0030541419982910156
r_  generation:  0.04053139686584473
local_output_nid generation:  0.00602412223815918
local_in_edges_tensor generation:  0.003112316131591797
mini_batch_src_global generation:  0.0031311511993408203
r_  generation:  0.04160618782043457
local_output_nid generation:  0.006083965301513672
local_in_edges_tensor generation:  0.003213644027709961
mini_batch_src_global generation:  0.003240823745727539
r_  generation:  0.04121041297912598
local_output_nid generation:  0.006051063537597656
local_in_edges_tensor generation:  0.0031652450561523438
mini_batch_src_global generation:  0.0032176971435546875
r_  generation:  0.04133009910583496
local_output_nid generation:  0.006045103073120117
local_in_edges_tensor generation:  0.003153562545776367
mini_batch_src_global generation:  0.003302335739135742
r_  generation:  0.04208946228027344
----------------------check_connections_block total spend ----------------------------- 0.5229599475860596
generate_one_block  0.0554814338684082
generate_one_block  0.05660057067871094
generate_one_block  0.057012081146240234
generate_one_block  0.05578184127807617
generate_one_block  0.05912446975708008
generate_one_block  0.056234121322631836
generate_one_block  0.054884910583496094
generate_one_block  0.05660510063171387
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.03833818435668945
gen group dst list time:  0.015468120574951172
time for parepare:  0.019067764282226562
local_output_nid generation:  0.013049602508544922
local_in_edges_tensor generation:  0.03152275085449219
mini_batch_src_global generation:  0.031170129776000977
r_  generation:  0.2976350784301758
local_output_nid generation:  0.01834392547607422
local_in_edges_tensor generation:  0.029698848724365234
mini_batch_src_global generation:  0.03663468360900879
r_  generation:  0.3122081756591797
local_output_nid generation:  0.018062591552734375
local_in_edges_tensor generation:  0.02702021598815918
mini_batch_src_global generation:  0.03649091720581055
r_  generation:  0.3157529830932617
local_output_nid generation:  0.01775383949279785
local_in_edges_tensor generation:  0.02118968963623047
mini_batch_src_global generation:  0.036940813064575195
r_  generation:  0.3092479705810547
local_output_nid generation:  0.0178525447845459
local_in_edges_tensor generation:  0.018061399459838867
mini_batch_src_global generation:  0.03955578804016113
r_  generation:  0.3174290657043457
local_output_nid generation:  0.018051624298095703
local_in_edges_tensor generation:  0.02405405044555664
mini_batch_src_global generation:  0.03814530372619629
r_  generation:  0.31944823265075684
local_output_nid generation:  0.017644643783569336
local_in_edges_tensor generation:  0.018349647521972656
mini_batch_src_global generation:  0.03799796104431152
r_  generation:  0.311159610748291
local_output_nid generation:  0.01794290542602539
local_in_edges_tensor generation:  0.020861148834228516
mini_batch_src_global generation:  0.04044198989868164
r_  generation:  0.31903600692749023
----------------------check_connections_block total spend ----------------------------- 3.6858060359954834
generate_one_block  0.40874528884887695
generate_one_block  0.4218282699584961
generate_one_block  0.42180824279785156
generate_one_block  0.3997948169708252
generate_one_block  0.40662312507629395
generate_one_block  0.42563343048095703
generate_one_block  0.40599846839904785
generate_one_block  0.43257665634155273
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.050533294677734375
gen group dst list time:  0.039522409439086914
time for parepare:  0.01945018768310547
local_output_nid generation:  0.02921915054321289
local_in_edges_tensor generation:  0.0632627010345459
mini_batch_src_global generation:  0.05379772186279297
r_  generation:  0.5361876487731934
local_output_nid generation:  0.037067413330078125
local_in_edges_tensor generation:  0.054877519607543945
mini_batch_src_global generation:  0.06143999099731445
r_  generation:  0.5245904922485352
local_output_nid generation:  0.035291433334350586
local_in_edges_tensor generation:  0.04528975486755371
mini_batch_src_global generation:  0.056962013244628906
r_  generation:  0.5368313789367676
local_output_nid generation:  0.035277605056762695
local_in_edges_tensor generation:  0.03605508804321289
mini_batch_src_global generation:  0.06131291389465332
r_  generation:  0.5286281108856201
local_output_nid generation:  0.035086631774902344
local_in_edges_tensor generation:  0.040151119232177734
mini_batch_src_global generation:  0.05958294868469238
r_  generation:  0.5437514781951904
local_output_nid generation:  0.035039424896240234
local_in_edges_tensor generation:  0.045305728912353516
mini_batch_src_global generation:  0.06172680854797363
r_  generation:  0.5340044498443604
local_output_nid generation:  0.03549814224243164
local_in_edges_tensor generation:  0.0356290340423584
mini_batch_src_global generation:  0.05983257293701172
r_  generation:  0.5464968681335449
local_output_nid generation:  0.03550243377685547
local_in_edges_tensor generation:  0.04026460647583008
mini_batch_src_global generation:  0.061965227127075195
r_  generation:  0.5342552661895752
----------------------check_connections_block total spend ----------------------------- 6.35209059715271
generate_one_block  0.6855716705322266
generate_one_block  0.6891229152679443
generate_one_block  0.7039742469787598
generate_one_block  0.6703348159790039
generate_one_block  0.6895859241485596
generate_one_block  0.6830074787139893
generate_one_block  0.7022819519042969
generate_one_block  0.7096133232116699
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04680609703063965
gen group dst list time:  0.047052860260009766
time for parepare:  0.019457340240478516
local_output_nid generation:  0.035138607025146484
local_in_edges_tensor generation:  0.06234288215637207
mini_batch_src_global generation:  0.04961347579956055
r_  generation:  0.5392096042633057
local_output_nid generation:  0.0385289192199707
local_in_edges_tensor generation:  0.05643057823181152
mini_batch_src_global generation:  0.06944131851196289
r_  generation:  0.545403242111206
local_output_nid generation:  0.04039597511291504
local_in_edges_tensor generation:  0.047730445861816406
mini_batch_src_global generation:  0.06228375434875488
r_  generation:  0.5396735668182373
local_output_nid generation:  0.039411306381225586
local_in_edges_tensor generation:  0.05006837844848633
mini_batch_src_global generation:  0.058614492416381836
r_  generation:  0.5443572998046875
local_output_nid generation:  0.039299964904785156
local_in_edges_tensor generation:  0.03775143623352051
mini_batch_src_global generation:  0.06311917304992676
r_  generation:  0.5463466644287109
local_output_nid generation:  0.03950142860412598
local_in_edges_tensor generation:  0.042279720306396484
mini_batch_src_global generation:  0.059507131576538086
r_  generation:  0.5556559562683105
local_output_nid generation:  0.03958916664123535
local_in_edges_tensor generation:  0.03876757621765137
mini_batch_src_global generation:  0.05927634239196777
r_  generation:  0.5571153163909912
local_output_nid generation:  0.04255223274230957
local_in_edges_tensor generation:  0.04257559776306152
mini_batch_src_global generation:  0.06371378898620605
r_  generation:  0.557908296585083
----------------------check_connections_block total spend ----------------------------- 6.598753452301025
generate_one_block  0.7240917682647705
generate_one_block  0.6863830089569092
generate_one_block  0.6991908550262451
generate_one_block  0.688265323638916
generate_one_block  0.6874754428863525
generate_one_block  0.6968379020690918
generate_one_block  0.7244751453399658
generate_one_block  0.683013916015625
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04927539825439453
gen group dst list time:  0.04870152473449707
time for parepare:  0.019495487213134766
local_output_nid generation:  0.03641629219055176
local_in_edges_tensor generation:  0.057178497314453125
mini_batch_src_global generation:  0.05094003677368164
r_  generation:  0.5167331695556641
local_output_nid generation:  0.03962564468383789
local_in_edges_tensor generation:  0.049150705337524414
mini_batch_src_global generation:  0.060701608657836914
r_  generation:  0.5081169605255127
local_output_nid generation:  0.04000425338745117
local_in_edges_tensor generation:  0.045030832290649414
mini_batch_src_global generation:  0.059241294860839844
r_  generation:  0.5059740543365479
local_output_nid generation:  0.04008817672729492
local_in_edges_tensor generation:  0.03891777992248535
mini_batch_src_global generation:  0.05844855308532715
r_  generation:  0.5204043388366699
local_output_nid generation:  0.04128599166870117
local_in_edges_tensor generation:  0.03957867622375488
mini_batch_src_global generation:  0.059227943420410156
r_  generation:  0.5113053321838379
local_output_nid generation:  0.04050087928771973
local_in_edges_tensor generation:  0.03855156898498535
mini_batch_src_global generation:  0.05794811248779297
r_  generation:  0.5070168972015381
local_output_nid generation:  0.04188275337219238
local_in_edges_tensor generation:  0.04069399833679199
mini_batch_src_global generation:  0.05792737007141113
r_  generation:  0.5110211372375488
local_output_nid generation:  0.04462265968322754
local_in_edges_tensor generation:  0.05059957504272461
mini_batch_src_global generation:  0.05923962593078613
r_  generation:  0.5132176876068115
----------------------check_connections_block total spend ----------------------------- 6.220837116241455
generate_one_block  0.6399440765380859
generate_one_block  0.6340591907501221
generate_one_block  0.6359665393829346
generate_one_block  0.6432042121887207
generate_one_block  0.6281540393829346
generate_one_block  0.6437678337097168
generate_one_block  0.6384508609771729
generate_one_block  0.6898329257965088
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0029964447021484375  GigaBytes
Max Memory Allocated: 0.0029964447021484375  GigaBytes

connection checking time:  22.857487201690674
block generation total time  19.599613666534424
average batch blocks generation time:  2.449951708316803
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2225341796875 GB
    Memory Allocated: 0.12885618209838867  GigaBytes
Max Memory Allocated: 0.12885618209838867  GigaBytes

torch.Size([166942, 128])
torch.Size([165770, 128])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.33 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
