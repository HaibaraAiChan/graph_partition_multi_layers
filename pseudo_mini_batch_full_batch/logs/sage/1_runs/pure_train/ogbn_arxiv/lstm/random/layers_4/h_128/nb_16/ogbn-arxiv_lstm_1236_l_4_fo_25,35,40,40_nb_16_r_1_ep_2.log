Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648486865.131798
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.002379894256591797  GigaBytes
Max Memory Allocated: 0.002379894256591797  GigaBytes

The real block id is  3
get_global_graph_edges_ids_block function  spend 0.02416205406188965
random selection method range initialization spend 0.006234169006347656
time for parepare:  0.018110275268554688
local_output_nid generation:  0.0021440982818603516
local_in_edges_tensor generation:  0.0046880245208740234
mini_batch_src_global generation:  0.0017781257629394531
r_  generation:  0.017928361892700195
local_output_nid generation:  0.002492666244506836
local_in_edges_tensor generation:  0.0017120838165283203
mini_batch_src_global generation:  0.0020961761474609375
r_  generation:  0.01729607582092285
local_output_nid generation:  0.0027806758880615234
local_in_edges_tensor generation:  0.0015892982482910156
mini_batch_src_global generation:  0.0013549327850341797
r_  generation:  0.017316818237304688
local_output_nid generation:  0.0027937889099121094
local_in_edges_tensor generation:  0.0015909671783447266
mini_batch_src_global generation:  0.0013175010681152344
r_  generation:  0.018264293670654297
local_output_nid generation:  0.002778768539428711
local_in_edges_tensor generation:  0.0015177726745605469
mini_batch_src_global generation:  0.0014040470123291016
r_  generation:  0.01717543601989746
local_output_nid generation:  0.0027904510498046875
local_in_edges_tensor generation:  0.0015189647674560547
mini_batch_src_global generation:  0.0013222694396972656
r_  generation:  0.017984390258789062
local_output_nid generation:  0.0028045177459716797
local_in_edges_tensor generation:  0.0014925003051757812
mini_batch_src_global generation:  0.0014698505401611328
r_  generation:  0.0183866024017334
local_output_nid generation:  0.0028061866760253906
local_in_edges_tensor generation:  0.0015292167663574219
mini_batch_src_global generation:  0.0014662742614746094
r_  generation:  0.017986774444580078
local_output_nid generation:  0.002873659133911133
local_in_edges_tensor generation:  0.0014672279357910156
mini_batch_src_global generation:  0.0014429092407226562
r_  generation:  0.01878523826599121
local_output_nid generation:  0.0028464794158935547
local_in_edges_tensor generation:  0.0014820098876953125
mini_batch_src_global generation:  0.0015180110931396484
r_  generation:  0.019435882568359375
local_output_nid generation:  0.002834796905517578
local_in_edges_tensor generation:  0.0015804767608642578
mini_batch_src_global generation:  0.0015397071838378906
r_  generation:  0.01863574981689453
local_output_nid generation:  0.002852916717529297
local_in_edges_tensor generation:  0.0014538764953613281
mini_batch_src_global generation:  0.0015540122985839844
r_  generation:  0.01885509490966797
local_output_nid generation:  0.002843618392944336
local_in_edges_tensor generation:  0.0014684200286865234
mini_batch_src_global generation:  0.0015680789947509766
r_  generation:  0.01929473876953125
local_output_nid generation:  0.002847433090209961
local_in_edges_tensor generation:  0.0015382766723632812
mini_batch_src_global generation:  0.0015451908111572266
r_  generation:  0.019356966018676758
local_output_nid generation:  0.0028629302978515625
local_in_edges_tensor generation:  0.0014972686767578125
mini_batch_src_global generation:  0.0015361309051513672
r_  generation:  0.0190126895904541
local_output_nid generation:  0.0028541088104248047
local_in_edges_tensor generation:  0.0014641284942626953
mini_batch_src_global generation:  0.0015687942504882812
r_  generation:  0.018991947174072266
----------------------check_connections_block total spend ----------------------------- 0.4854135513305664
generate_one_block  0.027315139770507812
generate_one_block  0.027510643005371094
generate_one_block  0.027100086212158203
generate_one_block  0.03158211708068848
generate_one_block  0.0269162654876709
generate_one_block  0.027748584747314453
generate_one_block  0.027536869049072266
generate_one_block  0.026567697525024414
generate_one_block  0.027976274490356445
generate_one_block  0.028070449829101562
generate_one_block  0.027651548385620117
generate_one_block  0.027522563934326172
generate_one_block  0.027788877487182617
generate_one_block  0.028151988983154297
generate_one_block  0.0273587703704834
generate_one_block  0.027550458908081055
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.041033029556274414
gen group dst list time:  0.018542766571044922
time for parepare:  0.01951003074645996
local_output_nid generation:  0.008332252502441406
local_in_edges_tensor generation:  0.01778388023376465
mini_batch_src_global generation:  0.018903732299804688
r_  generation:  0.19506525993347168
local_output_nid generation:  0.014642953872680664
local_in_edges_tensor generation:  0.02033233642578125
mini_batch_src_global generation:  0.024312734603881836
r_  generation:  0.2052912712097168
local_output_nid generation:  0.014836311340332031
local_in_edges_tensor generation:  0.017040491104125977
mini_batch_src_global generation:  0.02356863021850586
r_  generation:  0.20936059951782227
local_output_nid generation:  0.015102863311767578
local_in_edges_tensor generation:  0.01914668083190918
mini_batch_src_global generation:  0.03526663780212402
r_  generation:  0.22142291069030762
local_output_nid generation:  0.014702796936035156
local_in_edges_tensor generation:  0.013254642486572266
mini_batch_src_global generation:  0.02590322494506836
r_  generation:  0.21233773231506348
local_output_nid generation:  0.015021085739135742
local_in_edges_tensor generation:  0.013165712356567383
mini_batch_src_global generation:  0.0337367057800293
r_  generation:  0.2212810516357422
local_output_nid generation:  0.015038728713989258
local_in_edges_tensor generation:  0.014716386795043945
mini_batch_src_global generation:  0.02684307098388672
r_  generation:  0.21740984916687012
local_output_nid generation:  0.014605283737182617
local_in_edges_tensor generation:  0.01453852653503418
mini_batch_src_global generation:  0.02605414390563965
r_  generation:  0.2165534496307373
local_output_nid generation:  0.015164613723754883
local_in_edges_tensor generation:  0.018773555755615234
mini_batch_src_global generation:  0.027019739151000977
r_  generation:  0.21816611289978027
local_output_nid generation:  0.015268802642822266
local_in_edges_tensor generation:  0.017369747161865234
mini_batch_src_global generation:  0.027971982955932617
r_  generation:  0.22352123260498047
local_output_nid generation:  0.015035629272460938
local_in_edges_tensor generation:  0.013414144515991211
mini_batch_src_global generation:  0.027320146560668945
r_  generation:  0.21852850914001465
local_output_nid generation:  0.015201807022094727
local_in_edges_tensor generation:  0.015218734741210938
mini_batch_src_global generation:  0.027270793914794922
r_  generation:  0.21977758407592773
local_output_nid generation:  0.015148639678955078
local_in_edges_tensor generation:  0.018778085708618164
mini_batch_src_global generation:  0.027762174606323242
r_  generation:  0.22552919387817383
local_output_nid generation:  0.015432596206665039
local_in_edges_tensor generation:  0.017322063446044922
mini_batch_src_global generation:  0.028269529342651367
r_  generation:  0.22475004196166992
local_output_nid generation:  0.014998912811279297
local_in_edges_tensor generation:  0.013393163681030273
mini_batch_src_global generation:  0.02727222442626953
r_  generation:  0.21711158752441406
local_output_nid generation:  0.015205144882202148
local_in_edges_tensor generation:  0.013210058212280273
mini_batch_src_global generation:  0.029244661331176758
r_  generation:  0.22287607192993164
----------------------check_connections_block total spend ----------------------------- 5.170392036437988
generate_one_block  0.2797093391418457
generate_one_block  0.27899718284606934
generate_one_block  0.27695488929748535
generate_one_block  0.2928636074066162
generate_one_block  0.29262852668762207
generate_one_block  0.2811260223388672
generate_one_block  0.2798960208892822
generate_one_block  0.26892518997192383
generate_one_block  0.2881016731262207
generate_one_block  0.2851858139038086
generate_one_block  0.27466893196105957
generate_one_block  0.27640819549560547
generate_one_block  0.2887568473815918
generate_one_block  0.2880222797393799
generate_one_block  0.280198335647583
generate_one_block  0.2817411422729492
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.039290428161621094
gen group dst list time:  0.05962800979614258
time for parepare:  0.019636154174804688
local_output_nid generation:  0.026517152786254883
local_in_edges_tensor generation:  0.041702985763549805
mini_batch_src_global generation:  0.049978017807006836
r_  generation:  0.4693300724029541
local_output_nid generation:  0.03639793395996094
local_in_edges_tensor generation:  0.04894566535949707
mini_batch_src_global generation:  0.05626368522644043
r_  generation:  0.47988319396972656
local_output_nid generation:  0.03612637519836426
local_in_edges_tensor generation:  0.04516458511352539
mini_batch_src_global generation:  0.05567669868469238
r_  generation:  0.4990966320037842
local_output_nid generation:  0.03656268119812012
local_in_edges_tensor generation:  0.03721928596496582
mini_batch_src_global generation:  0.0585637092590332
r_  generation:  0.48842692375183105
local_output_nid generation:  0.03617525100708008
local_in_edges_tensor generation:  0.034861087799072266
mini_batch_src_global generation:  0.05684852600097656
r_  generation:  0.4883246421813965
local_output_nid generation:  0.03643441200256348
local_in_edges_tensor generation:  0.03549909591674805
mini_batch_src_global generation:  0.06158876419067383
r_  generation:  0.49086594581604004
local_output_nid generation:  0.03182578086853027
local_in_edges_tensor generation:  0.04732012748718262
mini_batch_src_global generation:  0.0568544864654541
r_  generation:  0.4906611442565918
local_output_nid generation:  0.031017541885375977
local_in_edges_tensor generation:  0.040934085845947266
mini_batch_src_global generation:  0.058429718017578125
r_  generation:  0.48989439010620117
local_output_nid generation:  0.03459525108337402
local_in_edges_tensor generation:  0.03170490264892578
mini_batch_src_global generation:  0.06081867218017578
r_  generation:  0.4954659938812256
local_output_nid generation:  0.03141427040100098
local_in_edges_tensor generation:  0.03953886032104492
mini_batch_src_global generation:  0.05809330940246582
r_  generation:  0.4895670413970947
local_output_nid generation:  0.03119182586669922
local_in_edges_tensor generation:  0.02935504913330078
mini_batch_src_global generation:  0.05791497230529785
r_  generation:  0.4974234104156494
local_output_nid generation:  0.031467437744140625
local_in_edges_tensor generation:  0.0390019416809082
mini_batch_src_global generation:  0.06655573844909668
r_  generation:  0.4885530471801758
local_output_nid generation:  0.031208515167236328
local_in_edges_tensor generation:  0.03741264343261719
mini_batch_src_global generation:  0.06070995330810547
r_  generation:  0.49452686309814453
local_output_nid generation:  0.031592369079589844
local_in_edges_tensor generation:  0.03904557228088379
mini_batch_src_global generation:  0.05750584602355957
r_  generation:  0.49993157386779785
local_output_nid generation:  0.031461238861083984
local_in_edges_tensor generation:  0.041184425354003906
mini_batch_src_global generation:  0.0650026798248291
r_  generation:  0.4965066909790039
local_output_nid generation:  0.03138113021850586
local_in_edges_tensor generation:  0.03672003746032715
mini_batch_src_global generation:  0.05856776237487793
r_  generation:  0.49332380294799805
----------------------check_connections_block total spend ----------------------------- 11.63379168510437
generate_one_block  0.6397616863250732
generate_one_block  0.6391911506652832
generate_one_block  0.6363859176635742
generate_one_block  0.6544821262359619
generate_one_block  0.6200592517852783
generate_one_block  0.6301705837249756
generate_one_block  0.678546667098999
generate_one_block  0.6232411861419678
generate_one_block  0.6571080684661865
generate_one_block  0.6391468048095703
generate_one_block  0.6282298564910889
generate_one_block  0.6298718452453613
generate_one_block  0.6372087001800537
generate_one_block  0.655350923538208
generate_one_block  0.6205482482910156
generate_one_block  0.6223766803741455
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04585981369018555
gen group dst list time:  0.08989524841308594
time for parepare:  0.01943659782409668
local_output_nid generation:  0.033844709396362305
local_in_edges_tensor generation:  0.05807685852050781
mini_batch_src_global generation:  0.04459524154663086
r_  generation:  0.49365758895874023
local_output_nid generation:  0.03919219970703125
local_in_edges_tensor generation:  0.03974151611328125
mini_batch_src_global generation:  0.05595207214355469
r_  generation:  0.4958062171936035
local_output_nid generation:  0.03792572021484375
local_in_edges_tensor generation:  0.03498363494873047
mini_batch_src_global generation:  0.05391812324523926
r_  generation:  0.49970459938049316
local_output_nid generation:  0.03838539123535156
local_in_edges_tensor generation:  0.03771519660949707
mini_batch_src_global generation:  0.05393624305725098
r_  generation:  0.5045628547668457
local_output_nid generation:  0.03824138641357422
local_in_edges_tensor generation:  0.041959285736083984
mini_batch_src_global generation:  0.053711891174316406
r_  generation:  0.5094847679138184
local_output_nid generation:  0.0380399227142334
local_in_edges_tensor generation:  0.03923916816711426
mini_batch_src_global generation:  0.05397820472717285
r_  generation:  0.5090923309326172
local_output_nid generation:  0.038628339767456055
local_in_edges_tensor generation:  0.03960108757019043
mini_batch_src_global generation:  0.054679155349731445
r_  generation:  0.5097954273223877
local_output_nid generation:  0.038378238677978516
local_in_edges_tensor generation:  0.04340243339538574
mini_batch_src_global generation:  0.05491781234741211
r_  generation:  0.5105044841766357
local_output_nid generation:  0.03775453567504883
local_in_edges_tensor generation:  0.039461374282836914
mini_batch_src_global generation:  0.05557560920715332
r_  generation:  0.5201466083526611
local_output_nid generation:  0.03828573226928711
local_in_edges_tensor generation:  0.04591560363769531
mini_batch_src_global generation:  0.05819392204284668
r_  generation:  0.5207452774047852
local_output_nid generation:  0.03858184814453125
local_in_edges_tensor generation:  0.0439913272857666
mini_batch_src_global generation:  0.05927014350891113
r_  generation:  0.5411064624786377
local_output_nid generation:  0.0385587215423584
local_in_edges_tensor generation:  0.036275386810302734
mini_batch_src_global generation:  0.056487083435058594
r_  generation:  0.519273042678833
local_output_nid generation:  0.03790926933288574
local_in_edges_tensor generation:  0.03911852836608887
mini_batch_src_global generation:  0.05618858337402344
r_  generation:  0.5294327735900879
local_output_nid generation:  0.03921818733215332
local_in_edges_tensor generation:  0.04828977584838867
mini_batch_src_global generation:  0.062413930892944336
r_  generation:  0.5204877853393555
local_output_nid generation:  0.03920865058898926
local_in_edges_tensor generation:  0.04194140434265137
mini_batch_src_global generation:  0.05707812309265137
r_  generation:  0.5272567272186279
local_output_nid generation:  0.03910255432128906
local_in_edges_tensor generation:  0.04100775718688965
mini_batch_src_global generation:  0.06025362014770508
r_  generation:  0.5160205364227295
----------------------check_connections_block total spend ----------------------------- 12.314814805984497
generate_one_block  0.6346089839935303
generate_one_block  0.7090518474578857
generate_one_block  0.6423535346984863
generate_one_block  0.6344027519226074
generate_one_block  0.6335036754608154
generate_one_block  0.6341543197631836
generate_one_block  0.6339781284332275
generate_one_block  0.6380927562713623
generate_one_block  0.6313076019287109
generate_one_block  0.6366322040557861
generate_one_block  0.6705796718597412
generate_one_block  0.6277658939361572
generate_one_block  0.6182971000671387
generate_one_block  0.6438558101654053
generate_one_block  0.6326420307159424
generate_one_block  0.6345870494842529
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.002379894256591797  GigaBytes
Max Memory Allocated: 0.002379894256591797  GigaBytes

connection checking time:  29.118998527526855
block generation total time  24.981677055358887
average batch blocks generation time:  1.5613548159599304
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2010498046875 GB
    Memory Allocated: 0.10887336730957031  GigaBytes
Max Memory Allocated: 0.10887336730957031  GigaBytes

torch.Size([163415, 128])
torch.Size([155279, 128])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 22.00 MiB (GPU 0; 23.62 GiB total capacity; 22.31 GiB already allocated; 18.44 MiB free; 22.40 GiB reserved in total by PyTorch)
