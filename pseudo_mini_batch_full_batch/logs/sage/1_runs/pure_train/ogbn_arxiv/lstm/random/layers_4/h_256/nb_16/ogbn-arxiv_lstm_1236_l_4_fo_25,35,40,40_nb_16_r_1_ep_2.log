Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648487362.387896
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0233154296875 GB
    Memory Allocated: 0.007684230804443359  GigaBytes
Max Memory Allocated: 0.007684230804443359  GigaBytes

The real block id is  3
get_global_graph_edges_ids_block function  spend 0.0248563289642334
random selection method range initialization spend 0.0060994625091552734
time for parepare:  0.01845240592956543
local_output_nid generation:  0.0021092891693115234
local_in_edges_tensor generation:  0.00471043586730957
mini_batch_src_global generation:  0.0017957687377929688
r_  generation:  0.01850104331970215
local_output_nid generation:  0.0026395320892333984
local_in_edges_tensor generation:  0.0017273426055908203
mini_batch_src_global generation:  0.002146482467651367
r_  generation:  0.017885208129882812
local_output_nid generation:  0.0028264522552490234
local_in_edges_tensor generation:  0.0015609264373779297
mini_batch_src_global generation:  0.001378774642944336
r_  generation:  0.01740431785583496
local_output_nid generation:  0.0028569698333740234
local_in_edges_tensor generation:  0.0015649795532226562
mini_batch_src_global generation:  0.001382589340209961
r_  generation:  0.01765918731689453
local_output_nid generation:  0.0028815269470214844
local_in_edges_tensor generation:  0.0015091896057128906
mini_batch_src_global generation:  0.0014400482177734375
r_  generation:  0.018448829650878906
local_output_nid generation:  0.0028951168060302734
local_in_edges_tensor generation:  0.001485586166381836
mini_batch_src_global generation:  0.0014717578887939453
r_  generation:  0.018442153930664062
local_output_nid generation:  0.0028715133666992188
local_in_edges_tensor generation:  0.0015034675598144531
mini_batch_src_global generation:  0.00150299072265625
r_  generation:  0.019202470779418945
local_output_nid generation:  0.002885580062866211
local_in_edges_tensor generation:  0.0015673637390136719
mini_batch_src_global generation:  0.0015478134155273438
r_  generation:  0.018954038619995117
local_output_nid generation:  0.0029060840606689453
local_in_edges_tensor generation:  0.0015225410461425781
mini_batch_src_global generation:  0.0014944076538085938
r_  generation:  0.018766403198242188
local_output_nid generation:  0.002902507781982422
local_in_edges_tensor generation:  0.0014998912811279297
mini_batch_src_global generation:  0.0015149116516113281
r_  generation:  0.018749475479125977
local_output_nid generation:  0.0028777122497558594
local_in_edges_tensor generation:  0.0015375614166259766
mini_batch_src_global generation:  0.0014815330505371094
r_  generation:  0.018938779830932617
local_output_nid generation:  0.0028536319732666016
local_in_edges_tensor generation:  0.0014538764953613281
mini_batch_src_global generation:  0.001539468765258789
r_  generation:  0.0186464786529541
local_output_nid generation:  0.002870798110961914
local_in_edges_tensor generation:  0.0014233589172363281
mini_batch_src_global generation:  0.001508474349975586
r_  generation:  0.018928050994873047
local_output_nid generation:  0.002870321273803711
local_in_edges_tensor generation:  0.0014424324035644531
mini_batch_src_global generation:  0.0015099048614501953
r_  generation:  0.01888418197631836
local_output_nid generation:  0.0029397010803222656
local_in_edges_tensor generation:  0.001535654067993164
mini_batch_src_global generation:  0.00145721435546875
r_  generation:  0.018789052963256836
local_output_nid generation:  0.002969503402709961
local_in_edges_tensor generation:  0.0015091896057128906
mini_batch_src_global generation:  0.0015399456024169922
r_  generation:  0.019005775451660156
----------------------check_connections_block total spend ----------------------------- 0.4900243282318115
generate_one_block  0.02727985382080078
generate_one_block  0.027589797973632812
generate_one_block  0.02643561363220215
generate_one_block  0.029835939407348633
generate_one_block  0.027942657470703125
generate_one_block  0.027661561965942383
generate_one_block  0.028203487396240234
generate_one_block  0.02753448486328125
generate_one_block  0.027634620666503906
generate_one_block  0.027278423309326172
generate_one_block  0.027329206466674805
generate_one_block  0.027261972427368164
generate_one_block  0.027544021606445312
generate_one_block  0.02773284912109375
generate_one_block  0.026706933975219727
generate_one_block  0.027597904205322266
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.04036855697631836
gen group dst list time:  0.018720626831054688
time for parepare:  0.01932382583618164
local_output_nid generation:  0.008449077606201172
local_in_edges_tensor generation:  0.021362781524658203
mini_batch_src_global generation:  0.02153468132019043
r_  generation:  0.1983320713043213
local_output_nid generation:  0.013944864273071289
local_in_edges_tensor generation:  0.020549774169921875
mini_batch_src_global generation:  0.024546384811401367
r_  generation:  0.2000424861907959
local_output_nid generation:  0.01366114616394043
local_in_edges_tensor generation:  0.01658320426940918
mini_batch_src_global generation:  0.023182153701782227
r_  generation:  0.2030625343322754
local_output_nid generation:  0.013958215713500977
local_in_edges_tensor generation:  0.014652490615844727
mini_batch_src_global generation:  0.02942657470703125
r_  generation:  0.20943832397460938
local_output_nid generation:  0.014155387878417969
local_in_edges_tensor generation:  0.017328739166259766
mini_batch_src_global generation:  0.02622056007385254
r_  generation:  0.21269536018371582
local_output_nid generation:  0.014108657836914062
local_in_edges_tensor generation:  0.014917373657226562
mini_batch_src_global generation:  0.03149986267089844
r_  generation:  0.2152702808380127
local_output_nid generation:  0.014380455017089844
local_in_edges_tensor generation:  0.019671201705932617
mini_batch_src_global generation:  0.02701115608215332
r_  generation:  0.22014784812927246
local_output_nid generation:  0.014250040054321289
local_in_edges_tensor generation:  0.013314247131347656
mini_batch_src_global generation:  0.027240991592407227
r_  generation:  0.21388959884643555
local_output_nid generation:  0.014183521270751953
local_in_edges_tensor generation:  0.013372659683227539
mini_batch_src_global generation:  0.026666641235351562
r_  generation:  0.2151484489440918
local_output_nid generation:  0.014277935028076172
local_in_edges_tensor generation:  0.015232324600219727
mini_batch_src_global generation:  0.026796579360961914
r_  generation:  0.21576499938964844
local_output_nid generation:  0.014150381088256836
local_in_edges_tensor generation:  0.01732659339904785
mini_batch_src_global generation:  0.027161359786987305
r_  generation:  0.21529364585876465
local_output_nid generation:  0.01428985595703125
local_in_edges_tensor generation:  0.017148256301879883
mini_batch_src_global generation:  0.028993606567382812
r_  generation:  0.22287225723266602
local_output_nid generation:  0.014010906219482422
local_in_edges_tensor generation:  0.013403654098510742
mini_batch_src_global generation:  0.027194976806640625
r_  generation:  0.21589326858520508
local_output_nid generation:  0.014225006103515625
local_in_edges_tensor generation:  0.015247344970703125
mini_batch_src_global generation:  0.027216434478759766
r_  generation:  0.22028040885925293
local_output_nid generation:  0.013901233673095703
local_in_edges_tensor generation:  0.015164852142333984
mini_batch_src_global generation:  0.026862382888793945
r_  generation:  0.2156844139099121
local_output_nid generation:  0.014190196990966797
local_in_edges_tensor generation:  0.017294645309448242
mini_batch_src_global generation:  0.028913021087646484
r_  generation:  0.22367405891418457
----------------------check_connections_block total spend ----------------------------- 5.100342035293579
generate_one_block  0.2838747501373291
generate_one_block  0.27669334411621094
generate_one_block  0.26686954498291016
generate_one_block  0.28033447265625
generate_one_block  0.29749321937561035
generate_one_block  0.2792682647705078
generate_one_block  0.2897324562072754
generate_one_block  0.27469682693481445
generate_one_block  0.27615976333618164
generate_one_block  0.27832484245300293
generate_one_block  0.2806053161621094
generate_one_block  0.28491854667663574
generate_one_block  0.2718486785888672
generate_one_block  0.2791717052459717
generate_one_block  0.2816884517669678
generate_one_block  0.2923011779785156
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.036026716232299805
gen group dst list time:  0.05906343460083008
time for parepare:  0.01863574981689453
local_output_nid generation:  0.025428295135498047
local_in_edges_tensor generation:  0.04217338562011719
mini_batch_src_global generation:  0.04532933235168457
r_  generation:  0.47127199172973633
local_output_nid generation:  0.0312652587890625
local_in_edges_tensor generation:  0.04948306083679199
mini_batch_src_global generation:  0.05608940124511719
r_  generation:  0.48443031311035156
local_output_nid generation:  0.030535459518432617
local_in_edges_tensor generation:  0.035584211349487305
mini_batch_src_global generation:  0.05532050132751465
r_  generation:  0.488466739654541
local_output_nid generation:  0.030950069427490234
local_in_edges_tensor generation:  0.040822744369506836
mini_batch_src_global generation:  0.0574345588684082
r_  generation:  0.48943042755126953
local_output_nid generation:  0.03068852424621582
local_in_edges_tensor generation:  0.04010963439941406
mini_batch_src_global generation:  0.05603599548339844
r_  generation:  0.49001502990722656
local_output_nid generation:  0.03068399429321289
local_in_edges_tensor generation:  0.03548073768615723
mini_batch_src_global generation:  0.061400413513183594
r_  generation:  0.49436402320861816
local_output_nid generation:  0.03110814094543457
local_in_edges_tensor generation:  0.036295413970947266
mini_batch_src_global generation:  0.05735158920288086
r_  generation:  0.4938509464263916
local_output_nid generation:  0.030781030654907227
local_in_edges_tensor generation:  0.03210902214050293
mini_batch_src_global generation:  0.058976173400878906
r_  generation:  0.49123620986938477
local_output_nid generation:  0.030603408813476562
local_in_edges_tensor generation:  0.036148786544799805
mini_batch_src_global generation:  0.05995988845825195
r_  generation:  0.49378204345703125
local_output_nid generation:  0.031040430068969727
local_in_edges_tensor generation:  0.044883012771606445
mini_batch_src_global generation:  0.05756950378417969
r_  generation:  0.4874701499938965
local_output_nid generation:  0.031065702438354492
local_in_edges_tensor generation:  0.036704301834106445
mini_batch_src_global generation:  0.05765509605407715
r_  generation:  0.5001223087310791
local_output_nid generation:  0.03120589256286621
local_in_edges_tensor generation:  0.03727436065673828
mini_batch_src_global generation:  0.05941319465637207
r_  generation:  0.4891202449798584
local_output_nid generation:  0.030960798263549805
local_in_edges_tensor generation:  0.040239810943603516
mini_batch_src_global generation:  0.060193538665771484
r_  generation:  0.4942348003387451
local_output_nid generation:  0.030778884887695312
local_in_edges_tensor generation:  0.03254985809326172
mini_batch_src_global generation:  0.05780482292175293
r_  generation:  0.49401092529296875
local_output_nid generation:  0.030578136444091797
local_in_edges_tensor generation:  0.03886055946350098
mini_batch_src_global generation:  0.057010650634765625
r_  generation:  0.49045515060424805
local_output_nid generation:  0.030771255493164062
local_in_edges_tensor generation:  0.042279958724975586
mini_batch_src_global generation:  0.058702707290649414
r_  generation:  0.4897620677947998
----------------------check_connections_block total spend ----------------------------- 11.546864986419678
generate_one_block  0.6259660720825195
generate_one_block  0.6281723976135254
generate_one_block  0.6628201007843018
generate_one_block  0.6910817623138428
generate_one_block  0.6454284191131592
generate_one_block  0.6355090141296387
generate_one_block  0.71417236328125
generate_one_block  0.6341352462768555
generate_one_block  0.6548049449920654
generate_one_block  0.6534452438354492
generate_one_block  0.6457548141479492
generate_one_block  0.6380894184112549
generate_one_block  0.6686182022094727
generate_one_block  0.6240942478179932
generate_one_block  0.6281461715698242
generate_one_block  0.6434924602508545
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.041576385498046875
gen group dst list time:  0.10382461547851562
time for parepare:  0.019610881805419922
local_output_nid generation:  0.03469252586364746
local_in_edges_tensor generation:  0.06108570098876953
mini_batch_src_global generation:  0.04732680320739746
r_  generation:  0.5037922859191895
local_output_nid generation:  0.04314136505126953
local_in_edges_tensor generation:  0.04432511329650879
mini_batch_src_global generation:  0.05712103843688965
r_  generation:  0.49417591094970703
local_output_nid generation:  0.03967022895812988
local_in_edges_tensor generation:  0.04099750518798828
mini_batch_src_global generation:  0.05439567565917969
r_  generation:  0.5042269229888916
local_output_nid generation:  0.03947734832763672
local_in_edges_tensor generation:  0.036434173583984375
mini_batch_src_global generation:  0.05441451072692871
r_  generation:  0.5028889179229736
local_output_nid generation:  0.04126143455505371
local_in_edges_tensor generation:  0.04574871063232422
mini_batch_src_global generation:  0.05442333221435547
r_  generation:  0.5089278221130371
local_output_nid generation:  0.03945779800415039
local_in_edges_tensor generation:  0.05499005317687988
mini_batch_src_global generation:  0.05386519432067871
r_  generation:  0.5066132545471191
local_output_nid generation:  0.03991413116455078
local_in_edges_tensor generation:  0.03978681564331055
mini_batch_src_global generation:  0.05602288246154785
r_  generation:  0.5206611156463623
local_output_nid generation:  0.039565086364746094
local_in_edges_tensor generation:  0.04009079933166504
mini_batch_src_global generation:  0.05567812919616699
r_  generation:  0.5134978294372559
local_output_nid generation:  0.03932547569274902
local_in_edges_tensor generation:  0.044213056564331055
mini_batch_src_global generation:  0.05728888511657715
r_  generation:  0.526071310043335
local_output_nid generation:  0.03960847854614258
local_in_edges_tensor generation:  0.04034066200256348
mini_batch_src_global generation:  0.05557727813720703
r_  generation:  0.5164110660552979
local_output_nid generation:  0.04079151153564453
local_in_edges_tensor generation:  0.045279502868652344
mini_batch_src_global generation:  0.05883908271789551
r_  generation:  0.5330088138580322
local_output_nid generation:  0.040075063705444336
local_in_edges_tensor generation:  0.045250654220581055
mini_batch_src_global generation:  0.056627511978149414
r_  generation:  0.5201354026794434
local_output_nid generation:  0.04025983810424805
local_in_edges_tensor generation:  0.03962969779968262
mini_batch_src_global generation:  0.05935215950012207
r_  generation:  0.593881368637085
local_output_nid generation:  0.053650856018066406
local_in_edges_tensor generation:  0.046193838119506836
mini_batch_src_global generation:  0.11119890213012695
r_  generation:  0.5275845527648926
local_output_nid generation:  0.0396270751953125
local_in_edges_tensor generation:  0.043875932693481445
mini_batch_src_global generation:  0.05585145950317383
r_  generation:  0.5344436168670654
local_output_nid generation:  0.039710283279418945
local_in_edges_tensor generation:  0.044820308685302734
mini_batch_src_global generation:  0.05755305290222168
r_  generation:  0.5494914054870605
----------------------check_connections_block total spend ----------------------------- 12.653777122497559
generate_one_block  0.6503915786743164
generate_one_block  0.7510015964508057
generate_one_block  0.6409189701080322
generate_one_block  0.6844391822814941
generate_one_block  0.6366503238677979
generate_one_block  0.6312367916107178
generate_one_block  0.6433970928192139
generate_one_block  0.6282098293304443
generate_one_block  0.6360125541687012
generate_one_block  0.6423168182373047
generate_one_block  0.637427568435669
generate_one_block  0.6378908157348633
generate_one_block  0.6381626129150391
generate_one_block  0.6243467330932617
generate_one_block  0.6371798515319824
generate_one_block  0.6534445285797119
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0233154296875 GB
    Memory Allocated: 0.007684230804443359  GigaBytes
Max Memory Allocated: 0.007684230804443359  GigaBytes

connection checking time:  29.300984144210815
block generation total time  25.26073908805847
average batch blocks generation time:  1.5787961930036545
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2069091796875 GB
    Memory Allocated: 0.11434555053710938  GigaBytes
Max Memory Allocated: 0.11434555053710938  GigaBytes

torch.Size([163592, 128])
torch.Size([155497, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 12.00 MiB (GPU 0; 23.62 GiB total capacity; 21.95 GiB already allocated; 4.44 MiB free; 22.42 GiB reserved in total by PyTorch)
