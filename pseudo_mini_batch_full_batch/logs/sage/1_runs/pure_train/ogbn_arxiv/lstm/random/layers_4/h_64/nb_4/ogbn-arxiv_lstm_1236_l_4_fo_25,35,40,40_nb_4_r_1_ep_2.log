Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648485815.3957639
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0010123252868652344  GigaBytes
Max Memory Allocated: 0.0010123252868652344  GigaBytes

The real block id is  3
get_global_graph_edges_ids_block function  spend 0.023745059967041016
random selection method range initialization spend 0.0066111087799072266
time for parepare:  0.018781423568725586
local_output_nid generation:  0.00835275650024414
local_in_edges_tensor generation:  0.008534908294677734
mini_batch_src_global generation:  0.006749629974365234
r_  generation:  0.08323907852172852
local_output_nid generation:  0.01178884506225586
local_in_edges_tensor generation:  0.006777286529541016
mini_batch_src_global generation:  0.00880122184753418
r_  generation:  0.08753013610839844
local_output_nid generation:  0.011983871459960938
local_in_edges_tensor generation:  0.006838560104370117
mini_batch_src_global generation:  0.00687408447265625
r_  generation:  0.09025835990905762
local_output_nid generation:  0.011941909790039062
local_in_edges_tensor generation:  0.00690460205078125
mini_batch_src_global generation:  0.007262229919433594
r_  generation:  0.0913395881652832
----------------------check_connections_block total spend ----------------------------- 0.5569193363189697
generate_one_block  0.1036067008972168
generate_one_block  0.1030735969543457
generate_one_block  0.10449695587158203
generate_one_block  0.10182332992553711
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.03974103927612305
gen group dst list time:  0.011661529541015625
time for parepare:  0.019590377807617188
local_output_nid generation:  0.019317150115966797
local_in_edges_tensor generation:  0.03856062889099121
mini_batch_src_global generation:  0.03861427307128906
r_  generation:  0.403322696685791
local_output_nid generation:  0.030747175216674805
local_in_edges_tensor generation:  0.03865528106689453
mini_batch_src_global generation:  0.04842209815979004
r_  generation:  0.4418051242828369
local_output_nid generation:  0.029343843460083008
local_in_edges_tensor generation:  0.04784727096557617
mini_batch_src_global generation:  0.05496978759765625
r_  generation:  0.42403364181518555
local_output_nid generation:  0.02614450454711914
local_in_edges_tensor generation:  0.03139972686767578
mini_batch_src_global generation:  0.04892730712890625
r_  generation:  0.41920948028564453
----------------------check_connections_block total spend ----------------------------- 2.5447278022766113
generate_one_block  0.5829200744628906
generate_one_block  0.5504145622253418
generate_one_block  0.556420087814331
generate_one_block  0.5402283668518066
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.05090188980102539
gen group dst list time:  0.021376609802246094
time for parepare:  0.019066572189331055
local_output_nid generation:  0.029102325439453125
local_in_edges_tensor generation:  0.07471108436584473
mini_batch_src_global generation:  0.052954673767089844
r_  generation:  0.5296459197998047
local_output_nid generation:  0.03615736961364746
local_in_edges_tensor generation:  0.054369211196899414
mini_batch_src_global generation:  0.060456037521362305
r_  generation:  0.5336198806762695
local_output_nid generation:  0.03660702705383301
local_in_edges_tensor generation:  0.041101694107055664
mini_batch_src_global generation:  0.05649232864379883
r_  generation:  0.546309232711792
local_output_nid generation:  0.03638172149658203
local_in_edges_tensor generation:  0.050316572189331055
mini_batch_src_global generation:  0.05583834648132324
r_  generation:  0.5482017993927002
----------------------check_connections_block total spend ----------------------------- 3.236335039138794
generate_one_block  0.6965291500091553
generate_one_block  0.7017028331756592
generate_one_block  0.7212200164794922
generate_one_block  0.6954469680786133
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.044150352478027344
gen group dst list time:  0.029451370239257812
time for parepare:  0.01914191246032715
local_output_nid generation:  0.032985687255859375
local_in_edges_tensor generation:  0.057027578353881836
mini_batch_src_global generation:  0.04684281349182129
r_  generation:  0.5226011276245117
local_output_nid generation:  0.03998756408691406
local_in_edges_tensor generation:  0.05526924133300781
mini_batch_src_global generation:  0.05701804161071777
r_  generation:  0.5257854461669922
local_output_nid generation:  0.04116368293762207
local_in_edges_tensor generation:  0.05609440803527832
mini_batch_src_global generation:  0.0574040412902832
r_  generation:  0.542593240737915
local_output_nid generation:  0.04349946975708008
local_in_edges_tensor generation:  0.051406145095825195
mini_batch_src_global generation:  0.05952572822570801
r_  generation:  0.5218472480773926
----------------------check_connections_block total spend ----------------------------- 3.2051146030426025
generate_one_block  0.684807300567627
generate_one_block  0.6416823863983154
generate_one_block  0.6688778400421143
generate_one_block  0.6464552879333496
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0010123252868652344  GigaBytes
Max Memory Allocated: 0.0010123252868652344  GigaBytes

connection checking time:  8.986177444458008
block generation total time  7.686704874038696
average batch blocks generation time:  1.921676218509674
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2030029296875 GB
    Memory Allocated: 0.11697626113891602  GigaBytes
Max Memory Allocated: 0.11697626113891602  GigaBytes

torch.Size([166620, 128])
torch.Size([164658, 64])
torch.Size([155118, 64])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 23.62 GiB total capacity; 22.37 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
