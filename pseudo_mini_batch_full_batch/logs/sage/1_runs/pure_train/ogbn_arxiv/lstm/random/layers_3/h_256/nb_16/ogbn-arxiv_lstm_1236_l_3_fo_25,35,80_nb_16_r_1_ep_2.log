Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648463611.5668445
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.02697610855102539
random selection method range initialization spend 0.006181001663208008
time for parepare:  0.019144773483276367
local_output_nid generation:  0.0021517276763916016
local_in_edges_tensor generation:  0.003958225250244141
mini_batch_src_global generation:  0.0020368099212646484
r_  generation:  0.021584033966064453
local_output_nid generation:  0.002882242202758789
local_in_edges_tensor generation:  0.001669168472290039
mini_batch_src_global generation:  0.0022728443145751953
r_  generation:  0.020244836807250977
local_output_nid generation:  0.0029430389404296875
local_in_edges_tensor generation:  0.0015990734100341797
mini_batch_src_global generation:  0.0015053749084472656
r_  generation:  0.02061915397644043
local_output_nid generation:  0.002954244613647461
local_in_edges_tensor generation:  0.0015778541564941406
mini_batch_src_global generation:  0.0015978813171386719
r_  generation:  0.021431922912597656
local_output_nid generation:  0.0029702186584472656
local_in_edges_tensor generation:  0.0015926361083984375
mini_batch_src_global generation:  0.00157928466796875
r_  generation:  0.02106618881225586
local_output_nid generation:  0.0030078887939453125
local_in_edges_tensor generation:  0.0015716552734375
mini_batch_src_global generation:  0.001641988754272461
r_  generation:  0.021930456161499023
local_output_nid generation:  0.0029866695404052734
local_in_edges_tensor generation:  0.0015838146209716797
mini_batch_src_global generation:  0.0016536712646484375
r_  generation:  0.021738052368164062
local_output_nid generation:  0.0029723644256591797
local_in_edges_tensor generation:  0.0015735626220703125
mini_batch_src_global generation:  0.0016529560089111328
r_  generation:  0.0214231014251709
local_output_nid generation:  0.0029838085174560547
local_in_edges_tensor generation:  0.001561880111694336
mini_batch_src_global generation:  0.0016753673553466797
r_  generation:  0.02200031280517578
local_output_nid generation:  0.0030050277709960938
local_in_edges_tensor generation:  0.0015368461608886719
mini_batch_src_global generation:  0.0016980171203613281
r_  generation:  0.021733760833740234
local_output_nid generation:  0.002967357635498047
local_in_edges_tensor generation:  0.0015125274658203125
mini_batch_src_global generation:  0.0016932487487792969
r_  generation:  0.0220639705657959
local_output_nid generation:  0.0030128955841064453
local_in_edges_tensor generation:  0.0015063285827636719
mini_batch_src_global generation:  0.0017805099487304688
r_  generation:  0.022774696350097656
local_output_nid generation:  0.0030035972595214844
local_in_edges_tensor generation:  0.0015912055969238281
mini_batch_src_global generation:  0.0017635822296142578
r_  generation:  0.022547245025634766
local_output_nid generation:  0.002953767776489258
local_in_edges_tensor generation:  0.0015044212341308594
mini_batch_src_global generation:  0.00176239013671875
r_  generation:  0.02221846580505371
local_output_nid generation:  0.0029702186584472656
local_in_edges_tensor generation:  0.001585245132446289
mini_batch_src_global generation:  0.0017483234405517578
r_  generation:  0.022745847702026367
local_output_nid generation:  0.002973794937133789
local_in_edges_tensor generation:  0.0015397071838378906
mini_batch_src_global generation:  0.0017516613006591797
r_  generation:  0.021260738372802734
----------------------check_connections_block total spend ----------------------------- 0.5569150447845459
generate_one_block  0.03225350379943848
generate_one_block  0.03104257583618164
generate_one_block  0.03473496437072754
generate_one_block  0.032328128814697266
generate_one_block  0.031269073486328125
generate_one_block  0.032181739807128906
generate_one_block  0.031717538833618164
generate_one_block  0.030647754669189453
generate_one_block  0.03150677680969238
generate_one_block  0.031080961227416992
generate_one_block  0.03149223327636719
generate_one_block  0.032353878021240234
generate_one_block  0.03197908401489258
generate_one_block  0.030817031860351562
generate_one_block  0.03166389465332031
generate_one_block  0.030664443969726562
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.03599882125854492
gen group dst list time:  0.020633220672607422
time for parepare:  0.01928234100341797
local_output_nid generation:  0.009563684463500977
local_in_edges_tensor generation:  0.019599199295043945
mini_batch_src_global generation:  0.02379322052001953
r_  generation:  0.2287611961364746
local_output_nid generation:  0.013903617858886719
local_in_edges_tensor generation:  0.020934104919433594
mini_batch_src_global generation:  0.02647542953491211
r_  generation:  0.21819591522216797
local_output_nid generation:  0.013844728469848633
local_in_edges_tensor generation:  0.015407562255859375
mini_batch_src_global generation:  0.032814741134643555
r_  generation:  0.23391199111938477
local_output_nid generation:  0.014054059982299805
local_in_edges_tensor generation:  0.022596120834350586
mini_batch_src_global generation:  0.027440547943115234
r_  generation:  0.23625993728637695
local_output_nid generation:  0.017284631729125977
local_in_edges_tensor generation:  0.01565074920654297
mini_batch_src_global generation:  0.028419017791748047
r_  generation:  0.24181556701660156
local_output_nid generation:  0.014517784118652344
local_in_edges_tensor generation:  0.018064022064208984
mini_batch_src_global generation:  0.03248858451843262
r_  generation:  0.2537841796875
local_output_nid generation:  0.016809701919555664
local_in_edges_tensor generation:  0.025499820709228516
mini_batch_src_global generation:  0.03316521644592285
r_  generation:  0.23314809799194336
local_output_nid generation:  0.012990951538085938
local_in_edges_tensor generation:  0.015766620635986328
mini_batch_src_global generation:  0.02868342399597168
r_  generation:  0.2260582447052002
local_output_nid generation:  0.013392925262451172
local_in_edges_tensor generation:  0.015043497085571289
mini_batch_src_global generation:  0.030961036682128906
r_  generation:  0.23565316200256348
local_output_nid generation:  0.01352238655090332
local_in_edges_tensor generation:  0.01496744155883789
mini_batch_src_global generation:  0.029328346252441406
r_  generation:  0.23454809188842773
local_output_nid generation:  0.013437747955322266
local_in_edges_tensor generation:  0.016910552978515625
mini_batch_src_global generation:  0.02967524528503418
r_  generation:  0.23687148094177246
local_output_nid generation:  0.013772964477539062
local_in_edges_tensor generation:  0.015207290649414062
mini_batch_src_global generation:  0.029659748077392578
r_  generation:  0.2374584674835205
local_output_nid generation:  0.013498067855834961
local_in_edges_tensor generation:  0.017415761947631836
mini_batch_src_global generation:  0.02989816665649414
r_  generation:  0.24170637130737305
local_output_nid generation:  0.025553464889526367
local_in_edges_tensor generation:  0.015050649642944336
mini_batch_src_global generation:  0.029839277267456055
r_  generation:  0.23773479461669922
local_output_nid generation:  0.013634681701660156
local_in_edges_tensor generation:  0.017412662506103516
mini_batch_src_global generation:  0.029879331588745117
r_  generation:  0.24144530296325684
local_output_nid generation:  0.014253616333007812
local_in_edges_tensor generation:  0.018844127655029297
mini_batch_src_global generation:  0.029449462890625
r_  generation:  0.25048160552978516
----------------------check_connections_block total spend ----------------------------- 5.626672029495239
generate_one_block  0.329085111618042
generate_one_block  0.3006887435913086
generate_one_block  0.32352566719055176
generate_one_block  0.3258790969848633
generate_one_block  0.32500290870666504
generate_one_block  0.31191015243530273
generate_one_block  0.30413317680358887
generate_one_block  0.3083372116088867
generate_one_block  0.310805082321167
generate_one_block  0.30759692192077637
generate_one_block  0.30292844772338867
generate_one_block  0.31151294708251953
generate_one_block  0.31303977966308594
generate_one_block  0.2969393730163574
generate_one_block  0.3105792999267578
generate_one_block  0.29792237281799316
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04690718650817871
gen group dst list time:  0.06808662414550781
time for parepare:  0.021964311599731445
local_output_nid generation:  0.026787281036376953
local_in_edges_tensor generation:  0.05598568916320801
mini_batch_src_global generation:  0.04483819007873535
r_  generation:  0.44656825065612793
local_output_nid generation:  0.032030344009399414
local_in_edges_tensor generation:  0.04640030860900879
mini_batch_src_global generation:  0.05166292190551758
r_  generation:  0.4504663944244385
local_output_nid generation:  0.03156733512878418
local_in_edges_tensor generation:  0.035178184509277344
mini_batch_src_global generation:  0.05032706260681152
r_  generation:  0.4587373733520508
local_output_nid generation:  0.031838417053222656
local_in_edges_tensor generation:  0.03896903991699219
mini_batch_src_global generation:  0.055307865142822266
r_  generation:  0.4655418395996094
local_output_nid generation:  0.03139472007751465
local_in_edges_tensor generation:  0.03873395919799805
mini_batch_src_global generation:  0.0517423152923584
r_  generation:  0.46935081481933594
local_output_nid generation:  0.032151222229003906
local_in_edges_tensor generation:  0.03451132774353027
mini_batch_src_global generation:  0.0556187629699707
r_  generation:  0.4588508605957031
local_output_nid generation:  0.0319364070892334
local_in_edges_tensor generation:  0.03917384147644043
mini_batch_src_global generation:  0.051785945892333984
r_  generation:  0.4622652530670166
local_output_nid generation:  0.0313258171081543
local_in_edges_tensor generation:  0.030012130737304688
mini_batch_src_global generation:  0.055661916732788086
r_  generation:  0.4622838497161865
local_output_nid generation:  0.03286552429199219
local_in_edges_tensor generation:  0.03136038780212402
mini_batch_src_global generation:  0.051404476165771484
r_  generation:  0.47649240493774414
local_output_nid generation:  0.032140493392944336
local_in_edges_tensor generation:  0.04545760154724121
mini_batch_src_global generation:  0.0533750057220459
r_  generation:  0.4786989688873291
local_output_nid generation:  0.03503775596618652
local_in_edges_tensor generation:  0.03898334503173828
mini_batch_src_global generation:  0.05363130569458008
r_  generation:  0.4713437557220459
local_output_nid generation:  0.03291726112365723
local_in_edges_tensor generation:  0.037116289138793945
mini_batch_src_global generation:  0.0561068058013916
r_  generation:  0.4634101390838623
local_output_nid generation:  0.032927513122558594
local_in_edges_tensor generation:  0.034790754318237305
mini_batch_src_global generation:  0.05214881896972656
r_  generation:  0.46846461296081543
local_output_nid generation:  0.032996416091918945
local_in_edges_tensor generation:  0.0374910831451416
mini_batch_src_global generation:  0.053984880447387695
r_  generation:  0.4666709899902344
local_output_nid generation:  0.033376455307006836
local_in_edges_tensor generation:  0.03869891166687012
mini_batch_src_global generation:  0.05558919906616211
r_  generation:  0.46993207931518555
local_output_nid generation:  0.03276562690734863
local_in_edges_tensor generation:  0.029877662658691406
mini_batch_src_global generation:  0.05348014831542969
r_  generation:  0.46432971954345703
----------------------check_connections_block total spend ----------------------------- 11.025486946105957
generate_one_block  0.6004927158355713
generate_one_block  0.5968794822692871
generate_one_block  0.5900566577911377
generate_one_block  0.5935478210449219
generate_one_block  0.6640536785125732
generate_one_block  0.5943629741668701
generate_one_block  0.6383731365203857
generate_one_block  0.5839416980743408
generate_one_block  0.6167182922363281
generate_one_block  0.6207702159881592
generate_one_block  0.6196177005767822
generate_one_block  0.5917363166809082
generate_one_block  0.5882987976074219
generate_one_block  0.599768877029419
generate_one_block  0.6030304431915283
generate_one_block  0.5941753387451172
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  16.652158975601196
block generation total time  14.675710439682007
average batch blocks generation time:  0.9172319024801254
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1795654296875 GB
    Memory Allocated: 0.09620046615600586  GigaBytes
Max Memory Allocated: 0.09620046615600586  GigaBytes

torch.Size([155136, 128])
torch.Size([125706, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 30.00 MiB (GPU 0; 23.62 GiB total capacity; 22.08 GiB already allocated; 6.44 MiB free; 22.42 GiB reserved in total by PyTorch)
