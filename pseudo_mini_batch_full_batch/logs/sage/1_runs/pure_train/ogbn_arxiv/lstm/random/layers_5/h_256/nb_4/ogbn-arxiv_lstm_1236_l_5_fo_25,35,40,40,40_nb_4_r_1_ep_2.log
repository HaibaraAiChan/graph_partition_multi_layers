Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648503633.0747156
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0272216796875 GB
    Memory Allocated: 0.010137557983398438  GigaBytes
Max Memory Allocated: 0.010137557983398438  GigaBytes

The real block id is  4
get_global_graph_edges_ids_block function  spend 0.02485823631286621
random selection method range initialization spend 0.0063855648040771484
time for parepare:  0.01862049102783203
local_output_nid generation:  0.008454084396362305
local_in_edges_tensor generation:  0.009233713150024414
mini_batch_src_global generation:  0.006720304489135742
r_  generation:  0.08257913589477539
local_output_nid generation:  0.011656045913696289
local_in_edges_tensor generation:  0.0060443878173828125
mini_batch_src_global generation:  0.00893259048461914
r_  generation:  0.08851361274719238
local_output_nid generation:  0.011867761611938477
local_in_edges_tensor generation:  0.005980730056762695
mini_batch_src_global generation:  0.00675201416015625
r_  generation:  0.08668160438537598
local_output_nid generation:  0.011695384979248047
local_in_edges_tensor generation:  0.006035327911376953
mini_batch_src_global generation:  0.00733184814453125
r_  generation:  0.09118866920471191
----------------------check_connections_block total spend ----------------------------- 0.5489480495452881
generate_one_block  0.10307025909423828
generate_one_block  0.10272407531738281
generate_one_block  0.10042738914489746
generate_one_block  0.10295844078063965
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.04157233238220215
gen group dst list time:  0.011199712753295898
time for parepare:  0.01988077163696289
local_output_nid generation:  0.019379138946533203
local_in_edges_tensor generation:  0.04233527183532715
mini_batch_src_global generation:  0.03934645652770996
r_  generation:  0.4075353145599365
local_output_nid generation:  0.028910160064697266
local_in_edges_tensor generation:  0.043172597885131836
mini_batch_src_global generation:  0.0488278865814209
r_  generation:  0.4348568916320801
local_output_nid generation:  0.029428958892822266
local_in_edges_tensor generation:  0.029300928115844727
mini_batch_src_global generation:  0.0524749755859375
r_  generation:  0.45182132720947266
local_output_nid generation:  0.02599644660949707
local_in_edges_tensor generation:  0.04297304153442383
mini_batch_src_global generation:  0.07205057144165039
r_  generation:  0.4284846782684326
----------------------check_connections_block total spend ----------------------------- 2.6169376373291016
generate_one_block  0.594707727432251
generate_one_block  0.5741686820983887
generate_one_block  0.5365569591522217
generate_one_block  0.5365662574768066
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.05697751045227051
gen group dst list time:  0.02125072479248047
time for parepare:  0.01904296875
local_output_nid generation:  0.02935791015625
local_in_edges_tensor generation:  0.06439805030822754
mini_batch_src_global generation:  0.05062556266784668
r_  generation:  0.5385148525238037
local_output_nid generation:  0.03617382049560547
local_in_edges_tensor generation:  0.05700397491455078
mini_batch_src_global generation:  0.06516146659851074
r_  generation:  0.5475397109985352
local_output_nid generation:  0.03577446937561035
local_in_edges_tensor generation:  0.047226905822753906
mini_batch_src_global generation:  0.0578455924987793
r_  generation:  0.5577914714813232
local_output_nid generation:  0.03593754768371582
local_in_edges_tensor generation:  0.042032480239868164
mini_batch_src_global generation:  0.0598142147064209
r_  generation:  0.5544936656951904
----------------------check_connections_block total spend ----------------------------- 3.2890241146087646
generate_one_block  0.7093391418457031
generate_one_block  0.7330539226531982
generate_one_block  0.7209370136260986
generate_one_block  0.7217020988464355
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04057121276855469
gen group dst list time:  0.029082775115966797
time for parepare:  0.019318342208862305
local_output_nid generation:  0.03286910057067871
local_in_edges_tensor generation:  0.0728769302368164
mini_batch_src_global generation:  0.051461219787597656
r_  generation:  0.5485641956329346
local_output_nid generation:  0.038550376892089844
local_in_edges_tensor generation:  0.05281233787536621
mini_batch_src_global generation:  0.06400132179260254
r_  generation:  0.5518336296081543
local_output_nid generation:  0.03866171836853027
local_in_edges_tensor generation:  0.046607017517089844
mini_batch_src_global generation:  0.06384658813476562
r_  generation:  0.556654691696167
local_output_nid generation:  0.03863930702209473
local_in_edges_tensor generation:  0.0370481014251709
mini_batch_src_global generation:  0.06744194030761719
r_  generation:  0.5541305541992188
----------------------check_connections_block total spend ----------------------------- 3.3413894176483154
generate_one_block  0.6948189735412598
generate_one_block  0.7294888496398926
generate_one_block  0.6830432415008545
generate_one_block  0.6889569759368896
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.045823097229003906
gen group dst list time:  0.02864694595336914
time for parepare:  0.01903820037841797
local_output_nid generation:  0.033510684967041016
local_in_edges_tensor generation:  0.05627107620239258
mini_batch_src_global generation:  0.0490114688873291
r_  generation:  0.5133645534515381
local_output_nid generation:  0.03898048400878906
local_in_edges_tensor generation:  0.05684041976928711
mini_batch_src_global generation:  0.05954122543334961
r_  generation:  0.507941722869873
local_output_nid generation:  0.038678646087646484
local_in_edges_tensor generation:  0.04725813865661621
mini_batch_src_global generation:  0.06000399589538574
r_  generation:  0.5187342166900635
local_output_nid generation:  0.03922319412231445
local_in_edges_tensor generation:  0.0477755069732666
mini_batch_src_global generation:  0.06074070930480957
r_  generation:  0.5360169410705566
----------------------check_connections_block total spend ----------------------------- 3.170619010925293
generate_one_block  0.6529991626739502
generate_one_block  0.6476552486419678
generate_one_block  0.6446163654327393
generate_one_block  0.6455550193786621
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0272216796875 GB
    Memory Allocated: 0.010137557983398438  GigaBytes
Max Memory Allocated: 0.010137557983398438  GigaBytes

connection checking time:  12.417970180511475
block generation total time  10.51416563987732
average batch blocks generation time:  2.62854140996933
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2322998046875 GB
    Memory Allocated: 0.13942193984985352  GigaBytes
Max Memory Allocated: 0.13942193984985352  GigaBytes

torch.Size([167459, 128])
torch.Size([166902, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 21.94 GiB already allocated; 4.44 MiB free; 22.42 GiB reserved in total by PyTorch)
