Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648463010.646501
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.0270693302154541
random selection method range initialization spend 0.007898330688476562
time for parepare:  0.018946409225463867
local_output_nid generation:  0.0041811466217041016
local_in_edges_tensor generation:  0.0075571537017822266
mini_batch_src_global generation:  0.0038716793060302734
r_  generation:  0.04801821708679199
local_output_nid generation:  0.005671501159667969
local_in_edges_tensor generation:  0.003213644027709961
mini_batch_src_global generation:  0.004105806350708008
r_  generation:  0.03864598274230957
local_output_nid generation:  0.005935192108154297
local_in_edges_tensor generation:  0.003270387649536133
mini_batch_src_global generation:  0.0028052330017089844
r_  generation:  0.03919100761413574
local_output_nid generation:  0.0059642791748046875
local_in_edges_tensor generation:  0.0031309127807617188
mini_batch_src_global generation:  0.002863168716430664
r_  generation:  0.03995156288146973
local_output_nid generation:  0.006005048751831055
local_in_edges_tensor generation:  0.0031659603118896484
mini_batch_src_global generation:  0.003100872039794922
r_  generation:  0.04049229621887207
local_output_nid generation:  0.006003379821777344
local_in_edges_tensor generation:  0.0031609535217285156
mini_batch_src_global generation:  0.0032927989959716797
r_  generation:  0.04189801216125488
local_output_nid generation:  0.00601959228515625
local_in_edges_tensor generation:  0.003231048583984375
mini_batch_src_global generation:  0.00330352783203125
r_  generation:  0.04178881645202637
local_output_nid generation:  0.006025791168212891
local_in_edges_tensor generation:  0.0031511783599853516
mini_batch_src_global generation:  0.0032787322998046875
r_  generation:  0.04109501838684082
----------------------check_connections_block total spend ----------------------------- 0.5297250747680664
generate_one_block  0.05439186096191406
generate_one_block  0.05530142784118652
generate_one_block  0.05545186996459961
generate_one_block  0.05420517921447754
generate_one_block  0.05808854103088379
generate_one_block  0.055261850357055664
generate_one_block  0.0546109676361084
generate_one_block  0.05466198921203613
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.0400235652923584
gen group dst list time:  0.014997243881225586
time for parepare:  0.01906442642211914
local_output_nid generation:  0.013141393661499023
local_in_edges_tensor generation:  0.033843278884887695
mini_batch_src_global generation:  0.029579639434814453
r_  generation:  0.2915618419647217
local_output_nid generation:  0.018661975860595703
local_in_edges_tensor generation:  0.030393600463867188
mini_batch_src_global generation:  0.03522753715515137
r_  generation:  0.3009932041168213
local_output_nid generation:  0.018228530883789062
local_in_edges_tensor generation:  0.027266740798950195
mini_batch_src_global generation:  0.03491473197937012
r_  generation:  0.30606794357299805
local_output_nid generation:  0.017922401428222656
local_in_edges_tensor generation:  0.01913738250732422
mini_batch_src_global generation:  0.035886287689208984
r_  generation:  0.3048102855682373
local_output_nid generation:  0.018117666244506836
local_in_edges_tensor generation:  0.021456003189086914
mini_batch_src_global generation:  0.03627777099609375
r_  generation:  0.3098583221435547
local_output_nid generation:  0.01818108558654785
local_in_edges_tensor generation:  0.026774883270263672
mini_batch_src_global generation:  0.037203311920166016
r_  generation:  0.3069028854370117
local_output_nid generation:  0.017875194549560547
local_in_edges_tensor generation:  0.02707815170288086
mini_batch_src_global generation:  0.03718113899230957
r_  generation:  0.3069620132446289
local_output_nid generation:  0.0181124210357666
local_in_edges_tensor generation:  0.01844310760498047
mini_batch_src_global generation:  0.0370783805847168
r_  generation:  0.30669474601745605
----------------------check_connections_block total spend ----------------------------- 3.6026976108551025
generate_one_block  0.39974379539489746
generate_one_block  0.40283799171447754
generate_one_block  0.4027571678161621
generate_one_block  0.3856654167175293
generate_one_block  0.3913099765777588
generate_one_block  0.4141421318054199
generate_one_block  0.3990817070007324
generate_one_block  0.39692115783691406
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.0365605354309082
gen group dst list time:  0.035631418228149414
time for parepare:  0.019135236740112305
local_output_nid generation:  0.028244972229003906
local_in_edges_tensor generation:  0.04392099380493164
mini_batch_src_global generation:  0.04429173469543457
r_  generation:  0.4737718105316162
local_output_nid generation:  0.03462338447570801
local_in_edges_tensor generation:  0.05155634880065918
mini_batch_src_global generation:  0.053557395935058594
r_  generation:  0.4770207405090332
local_output_nid generation:  0.03439807891845703
local_in_edges_tensor generation:  0.03840136528015137
mini_batch_src_global generation:  0.05106496810913086
r_  generation:  0.4868452548980713
local_output_nid generation:  0.03467869758605957
local_in_edges_tensor generation:  0.0379939079284668
mini_batch_src_global generation:  0.05415987968444824
r_  generation:  0.4854545593261719
local_output_nid generation:  0.03487038612365723
local_in_edges_tensor generation:  0.03784036636352539
mini_batch_src_global generation:  0.05340242385864258
r_  generation:  0.49563097953796387
local_output_nid generation:  0.03486180305480957
local_in_edges_tensor generation:  0.04271650314331055
mini_batch_src_global generation:  0.05810379981994629
r_  generation:  0.4869804382324219
local_output_nid generation:  0.03474926948547363
local_in_edges_tensor generation:  0.038004159927368164
mini_batch_src_global generation:  0.05333375930786133
r_  generation:  0.5008199214935303
local_output_nid generation:  0.0349431037902832
local_in_edges_tensor generation:  0.03429150581359863
mini_batch_src_global generation:  0.055431365966796875
r_  generation:  0.4862990379333496
----------------------check_connections_block total spend ----------------------------- 5.785783529281616
generate_one_block  0.6103181838989258
generate_one_block  0.6297962665557861
generate_one_block  0.6018259525299072
generate_one_block  0.6033360958099365
generate_one_block  0.6140375137329102
generate_one_block  0.6234896183013916
generate_one_block  0.6385412216186523
generate_one_block  0.6135826110839844
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  9.388481140136719
block generation total time  8.127386808395386
average batch blocks generation time:  1.0159233510494232
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1854248046875 GB
    Memory Allocated: 0.10085391998291016  GigaBytes
Max Memory Allocated: 0.10085391998291016  GigaBytes

torch.Size([160514, 128])
torch.Size([141248, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.33 GiB already allocated; 18.44 MiB free; 22.41 GiB reserved in total by PyTorch)
