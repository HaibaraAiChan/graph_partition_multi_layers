Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648464220.1844528
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.0276949405670166
random selection method range initialization spend 0.00634002685546875
time for parepare:  0.018384695053100586
local_output_nid generation:  0.0021669864654541016
local_in_edges_tensor generation:  0.004954338073730469
mini_batch_src_global generation:  0.002033710479736328
r_  generation:  0.020662784576416016
local_output_nid generation:  0.002629518508911133
local_in_edges_tensor generation:  0.0017101764678955078
mini_batch_src_global generation:  0.0022821426391601562
r_  generation:  0.01946234703063965
local_output_nid generation:  0.002962350845336914
local_in_edges_tensor generation:  0.001634359359741211
mini_batch_src_global generation:  0.001596212387084961
r_  generation:  0.021452665328979492
local_output_nid generation:  0.0032515525817871094
local_in_edges_tensor generation:  0.0016977787017822266
mini_batch_src_global generation:  0.0016388893127441406
r_  generation:  0.021231651306152344
local_output_nid generation:  0.0031380653381347656
local_in_edges_tensor generation:  0.0017230510711669922
mini_batch_src_global generation:  0.001646280288696289
r_  generation:  0.02036571502685547
local_output_nid generation:  0.003064870834350586
local_in_edges_tensor generation:  0.0016326904296875
mini_batch_src_global generation:  0.0016317367553710938
r_  generation:  0.021164417266845703
local_output_nid generation:  0.003008604049682617
local_in_edges_tensor generation:  0.0015413761138916016
mini_batch_src_global generation:  0.0016260147094726562
r_  generation:  0.02093648910522461
local_output_nid generation:  0.002981901168823242
local_in_edges_tensor generation:  0.0014796257019042969
mini_batch_src_global generation:  0.0016148090362548828
r_  generation:  0.02075028419494629
local_output_nid generation:  0.002979278564453125
local_in_edges_tensor generation:  0.0014688968658447266
mini_batch_src_global generation:  0.0015726089477539062
r_  generation:  0.021173477172851562
local_output_nid generation:  0.0029671192169189453
local_in_edges_tensor generation:  0.0014688968658447266
mini_batch_src_global generation:  0.0017201900482177734
r_  generation:  0.021035432815551758
local_output_nid generation:  0.0029382705688476562
local_in_edges_tensor generation:  0.0014872550964355469
mini_batch_src_global generation:  0.001737356185913086
r_  generation:  0.02112102508544922
local_output_nid generation:  0.0029315948486328125
local_in_edges_tensor generation:  0.0015714168548583984
mini_batch_src_global generation:  0.0016982555389404297
r_  generation:  0.021672725677490234
local_output_nid generation:  0.0029425621032714844
local_in_edges_tensor generation:  0.0015914440155029297
mini_batch_src_global generation:  0.001810312271118164
r_  generation:  0.021968603134155273
local_output_nid generation:  0.002939462661743164
local_in_edges_tensor generation:  0.0014786720275878906
mini_batch_src_global generation:  0.0017688274383544922
r_  generation:  0.021562576293945312
local_output_nid generation:  0.0029320716857910156
local_in_edges_tensor generation:  0.001505136489868164
mini_batch_src_global generation:  0.0017690658569335938
r_  generation:  0.02155470848083496
local_output_nid generation:  0.0029554367065429688
local_in_edges_tensor generation:  0.0015845298767089844
mini_batch_src_global generation:  0.0017611980438232422
r_  generation:  0.020837068557739258
----------------------check_connections_block total spend ----------------------------- 0.543910026550293
generate_one_block  0.03186774253845215
generate_one_block  0.030188322067260742
generate_one_block  0.03408479690551758
generate_one_block  0.031980037689208984
generate_one_block  0.031084537506103516
generate_one_block  0.031507253646850586
generate_one_block  0.030527353286743164
generate_one_block  0.030102252960205078
generate_one_block  0.030676603317260742
generate_one_block  0.03059554100036621
generate_one_block  0.030698060989379883
generate_one_block  0.031826019287109375
generate_one_block  0.0313262939453125
generate_one_block  0.030405044555664062
generate_one_block  0.030969619750976562
generate_one_block  0.029617786407470703
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04226422309875488
gen group dst list time:  0.020616769790649414
time for parepare:  0.01973271369934082
local_output_nid generation:  0.009283304214477539
local_in_edges_tensor generation:  0.02560901641845703
mini_batch_src_global generation:  0.025224924087524414
r_  generation:  0.2532927989959717
local_output_nid generation:  0.015126228332519531
local_in_edges_tensor generation:  0.024359941482543945
mini_batch_src_global generation:  0.03126096725463867
r_  generation:  0.24764585494995117
local_output_nid generation:  0.015131711959838867
local_in_edges_tensor generation:  0.022584915161132812
mini_batch_src_global generation:  0.03222799301147461
r_  generation:  0.2567317485809326
local_output_nid generation:  0.015480518341064453
local_in_edges_tensor generation:  0.018213272094726562
mini_batch_src_global generation:  0.032053470611572266
r_  generation:  0.26411962509155273
local_output_nid generation:  0.015439033508300781
local_in_edges_tensor generation:  0.020359516143798828
mini_batch_src_global generation:  0.03618788719177246
r_  generation:  0.26293134689331055
local_output_nid generation:  0.015392780303955078
local_in_edges_tensor generation:  0.018230438232421875
mini_batch_src_global generation:  0.03393912315368652
r_  generation:  0.2658395767211914
local_output_nid generation:  0.01521754264831543
local_in_edges_tensor generation:  0.017411231994628906
mini_batch_src_global generation:  0.03366279602050781
r_  generation:  0.26168203353881836
local_output_nid generation:  0.015067815780639648
local_in_edges_tensor generation:  0.01743769645690918
mini_batch_src_global generation:  0.0330045223236084
r_  generation:  0.2561299800872803
local_output_nid generation:  0.015389204025268555
local_in_edges_tensor generation:  0.018068313598632812
mini_batch_src_global generation:  0.03555035591125488
r_  generation:  0.2668192386627197
local_output_nid generation:  0.015343189239501953
local_in_edges_tensor generation:  0.0204923152923584
mini_batch_src_global generation:  0.03412365913391113
r_  generation:  0.26787614822387695
local_output_nid generation:  0.015310287475585938
local_in_edges_tensor generation:  0.015465021133422852
mini_batch_src_global generation:  0.03426480293273926
r_  generation:  0.26922106742858887
local_output_nid generation:  0.015573740005493164
local_in_edges_tensor generation:  0.016827106475830078
mini_batch_src_global generation:  0.0346829891204834
r_  generation:  0.27135396003723145
local_output_nid generation:  0.015405416488647461
local_in_edges_tensor generation:  0.02337932586669922
mini_batch_src_global generation:  0.034631967544555664
r_  generation:  0.27198052406311035
local_output_nid generation:  0.015345335006713867
local_in_edges_tensor generation:  0.015725374221801758
mini_batch_src_global generation:  0.03452444076538086
r_  generation:  0.2643425464630127
local_output_nid generation:  0.015375137329101562
local_in_edges_tensor generation:  0.015937089920043945
mini_batch_src_global generation:  0.03452587127685547
r_  generation:  0.27713894844055176
local_output_nid generation:  0.015195846557617188
local_in_edges_tensor generation:  0.018004417419433594
mini_batch_src_global generation:  0.034446001052856445
r_  generation:  0.2652304172515869
----------------------check_connections_block total spend ----------------------------- 6.23252272605896
generate_one_block  0.3654799461364746
generate_one_block  0.3413708209991455
generate_one_block  0.34891653060913086
generate_one_block  0.3576657772064209
generate_one_block  0.3676443099975586
generate_one_block  0.35576891899108887
generate_one_block  0.3504476547241211
generate_one_block  0.34041452407836914
generate_one_block  0.3512256145477295
generate_one_block  0.35390233993530273
generate_one_block  0.35117506980895996
generate_one_block  0.3564188480377197
generate_one_block  0.3579840660095215
generate_one_block  0.34417724609375
generate_one_block  0.36598634719848633
generate_one_block  0.3474245071411133
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.0361475944519043
gen group dst list time:  0.06256842613220215
time for parepare:  0.018676042556762695
local_output_nid generation:  0.026119232177734375
local_in_edges_tensor generation:  0.041115522384643555
mini_batch_src_global generation:  0.045769453048706055
r_  generation:  0.44866371154785156
local_output_nid generation:  0.03261876106262207
local_in_edges_tensor generation:  0.04712700843811035
mini_batch_src_global generation:  0.05327415466308594
r_  generation:  0.45383763313293457
local_output_nid generation:  0.03235173225402832
local_in_edges_tensor generation:  0.035747528076171875
mini_batch_src_global generation:  0.05099916458129883
r_  generation:  0.460155725479126
local_output_nid generation:  0.03216910362243652
local_in_edges_tensor generation:  0.03957843780517578
mini_batch_src_global generation:  0.05133867263793945
r_  generation:  0.4661257266998291
local_output_nid generation:  0.03212308883666992
local_in_edges_tensor generation:  0.04341459274291992
mini_batch_src_global generation:  0.052100419998168945
r_  generation:  0.46633219718933105
local_output_nid generation:  0.032030582427978516
local_in_edges_tensor generation:  0.031874895095825195
mini_batch_src_global generation:  0.05940389633178711
r_  generation:  0.4676506519317627
local_output_nid generation:  0.03207588195800781
local_in_edges_tensor generation:  0.031092166900634766
mini_batch_src_global generation:  0.05312824249267578
r_  generation:  0.4709787368774414
local_output_nid generation:  0.03171563148498535
local_in_edges_tensor generation:  0.03200411796569824
mini_batch_src_global generation:  0.05310225486755371
r_  generation:  0.46685338020324707
local_output_nid generation:  0.03502988815307617
local_in_edges_tensor generation:  0.03923296928405762
mini_batch_src_global generation:  0.05322861671447754
r_  generation:  0.47301793098449707
local_output_nid generation:  0.032003164291381836
local_in_edges_tensor generation:  0.03997516632080078
mini_batch_src_global generation:  0.05349612236022949
r_  generation:  0.47312402725219727
local_output_nid generation:  0.0319366455078125
local_in_edges_tensor generation:  0.03545999526977539
mini_batch_src_global generation:  0.05278944969177246
r_  generation:  0.47664618492126465
local_output_nid generation:  0.032103538513183594
local_in_edges_tensor generation:  0.03537130355834961
mini_batch_src_global generation:  0.056878089904785156
r_  generation:  0.4725837707519531
local_output_nid generation:  0.031816959381103516
local_in_edges_tensor generation:  0.03151226043701172
mini_batch_src_global generation:  0.0526273250579834
r_  generation:  0.4770841598510742
local_output_nid generation:  0.031983375549316406
local_in_edges_tensor generation:  0.03508448600769043
mini_batch_src_global generation:  0.053256988525390625
r_  generation:  0.4743473529815674
local_output_nid generation:  0.03214001655578613
local_in_edges_tensor generation:  0.0396726131439209
mini_batch_src_global generation:  0.05251646041870117
r_  generation:  0.4738640785217285
local_output_nid generation:  0.031876325607299805
local_in_edges_tensor generation:  0.031575679779052734
mini_batch_src_global generation:  0.05321836471557617
r_  generation:  0.4697451591491699
----------------------check_connections_block total spend ----------------------------- 11.109864711761475
generate_one_block  0.5864396095275879
generate_one_block  0.5821478366851807
generate_one_block  0.5875699520111084
generate_one_block  0.6153163909912109
generate_one_block  0.5926928520202637
generate_one_block  0.588099479675293
generate_one_block  0.6309728622436523
generate_one_block  0.5852224826812744
generate_one_block  0.5986356735229492
generate_one_block  0.609398365020752
generate_one_block  0.5937621593475342
generate_one_block  0.6014211177825928
generate_one_block  0.5975420475006104
generate_one_block  0.603278398513794
generate_one_block  0.5994629859924316
generate_one_block  0.5876436233520508
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  17.342387437820435
block generation total time  15.215608358383179
average batch blocks generation time:  0.9509755223989487
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1815185546875 GB
    Memory Allocated: 0.09805870056152344  GigaBytes
Max Memory Allocated: 0.09805870056152344  GigaBytes

torch.Size([156875, 128])
torch.Size([130384, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 23.62 GiB total capacity; 22.36 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
