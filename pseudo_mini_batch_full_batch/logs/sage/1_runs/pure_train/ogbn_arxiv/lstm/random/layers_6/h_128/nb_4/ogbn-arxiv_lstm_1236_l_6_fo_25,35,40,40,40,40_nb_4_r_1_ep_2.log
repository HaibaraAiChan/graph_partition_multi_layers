Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648523505.1798754
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.003612995147705078  GigaBytes
Max Memory Allocated: 0.003612995147705078  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.02403569221496582
random selection method range initialization spend 0.006274700164794922
time for parepare:  0.01956915855407715
local_output_nid generation:  0.009336471557617188
local_in_edges_tensor generation:  0.008584260940551758
mini_batch_src_global generation:  0.006706714630126953
r_  generation:  0.08484673500061035
local_output_nid generation:  0.01200723648071289
local_in_edges_tensor generation:  0.006238698959350586
mini_batch_src_global generation:  0.0089263916015625
r_  generation:  0.08893632888793945
local_output_nid generation:  0.012056112289428711
local_in_edges_tensor generation:  0.006307363510131836
mini_batch_src_global generation:  0.0066606998443603516
r_  generation:  0.0898432731628418
local_output_nid generation:  0.012220144271850586
local_in_edges_tensor generation:  0.00606846809387207
mini_batch_src_global generation:  0.007489681243896484
r_  generation:  0.0933992862701416
----------------------check_connections_block total spend ----------------------------- 0.5625243186950684
generate_one_block  0.10367560386657715
generate_one_block  0.10421586036682129
generate_one_block  0.10357832908630371
generate_one_block  0.10425233840942383
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.0388031005859375
gen group dst list time:  0.01158761978149414
time for parepare:  0.019190073013305664
local_output_nid generation:  0.020201683044433594
local_in_edges_tensor generation:  0.040888071060180664
mini_batch_src_global generation:  0.04186296463012695
r_  generation:  0.4219200611114502
local_output_nid generation:  0.025660276412963867
local_in_edges_tensor generation:  0.042684078216552734
mini_batch_src_global generation:  0.04891371726989746
r_  generation:  0.429135799407959
local_output_nid generation:  0.02915167808532715
local_in_edges_tensor generation:  0.03317761421203613
mini_batch_src_global generation:  0.048403024673461914
r_  generation:  0.43528079986572266
local_output_nid generation:  0.027672290802001953
local_in_edges_tensor generation:  0.02670741081237793
mini_batch_src_global generation:  0.05060625076293945
r_  generation:  0.45737600326538086
----------------------check_connections_block total spend ----------------------------- 2.5794754028320312
generate_one_block  0.5858259201049805
generate_one_block  0.5552613735198975
generate_one_block  0.5487368106842041
generate_one_block  0.5591018199920654
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.05393171310424805
gen group dst list time:  0.021383047103881836
time for parepare:  0.019931316375732422
local_output_nid generation:  0.03151392936706543
local_in_edges_tensor generation:  0.059607505798339844
mini_batch_src_global generation:  0.056223154067993164
r_  generation:  0.559899091720581
local_output_nid generation:  0.038512468338012695
local_in_edges_tensor generation:  0.05842447280883789
mini_batch_src_global generation:  0.06640315055847168
r_  generation:  0.5733678340911865
local_output_nid generation:  0.047449588775634766
local_in_edges_tensor generation:  0.05553579330444336
mini_batch_src_global generation:  0.06741189956665039
r_  generation:  0.5859458446502686
local_output_nid generation:  0.03799152374267578
local_in_edges_tensor generation:  0.05260491371154785
mini_batch_src_global generation:  0.0647737979888916
r_  generation:  0.5833795070648193
----------------------check_connections_block total spend ----------------------------- 3.498122215270996
generate_one_block  0.7384459972381592
generate_one_block  0.71065354347229
generate_one_block  0.7472827434539795
generate_one_block  0.7166879177093506
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.06054806709289551
gen group dst list time:  0.02952742576599121
time for parepare:  0.019341707229614258
local_output_nid generation:  0.03438568115234375
local_in_edges_tensor generation:  0.0604550838470459
mini_batch_src_global generation:  0.05512380599975586
r_  generation:  0.5738856792449951
local_output_nid generation:  0.0422663688659668
local_in_edges_tensor generation:  0.06078767776489258
mini_batch_src_global generation:  0.06813263893127441
r_  generation:  0.5583887100219727
local_output_nid generation:  0.040036916732788086
local_in_edges_tensor generation:  0.05206441879272461
mini_batch_src_global generation:  0.06387114524841309
r_  generation:  0.5616986751556396
local_output_nid generation:  0.04048895835876465
local_in_edges_tensor generation:  0.039208412170410156
mini_batch_src_global generation:  0.06328153610229492
r_  generation:  0.568678617477417
----------------------check_connections_block total spend ----------------------------- 3.427800416946411
generate_one_block  0.6990697383880615
generate_one_block  0.738156795501709
generate_one_block  0.7242777347564697
generate_one_block  0.7134749889373779
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.053164005279541016
gen group dst list time:  0.025203704833984375
time for parepare:  0.01914811134338379
local_output_nid generation:  0.03341984748840332
local_in_edges_tensor generation:  0.04895663261413574
mini_batch_src_global generation:  0.05036783218383789
r_  generation:  0.5414056777954102
local_output_nid generation:  0.039285898208618164
local_in_edges_tensor generation:  0.04083061218261719
mini_batch_src_global generation:  0.06383967399597168
r_  generation:  0.5636117458343506
local_output_nid generation:  0.03916287422180176
local_in_edges_tensor generation:  0.04116320610046387
mini_batch_src_global generation:  0.06477785110473633
r_  generation:  0.5647861957550049
local_output_nid generation:  0.04094862937927246
local_in_edges_tensor generation:  0.047714948654174805
mini_batch_src_global generation:  0.06303739547729492
r_  generation:  0.5626277923583984
----------------------check_connections_block total spend ----------------------------- 3.351201057434082
generate_one_block  0.7124428749084473
generate_one_block  0.7009572982788086
generate_one_block  0.697894811630249
generate_one_block  0.6915912628173828
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03918933868408203
gen group dst list time:  0.02887415885925293
time for parepare:  0.019434690475463867
local_output_nid generation:  0.03534293174743652
local_in_edges_tensor generation:  0.0541539192199707
mini_batch_src_global generation:  0.04857134819030762
r_  generation:  0.5490915775299072
local_output_nid generation:  0.0488438606262207
local_in_edges_tensor generation:  0.05113387107849121
mini_batch_src_global generation:  0.05940890312194824
r_  generation:  0.5585174560546875
local_output_nid generation:  0.04429769515991211
local_in_edges_tensor generation:  0.060565948486328125
mini_batch_src_global generation:  0.06259703636169434
r_  generation:  0.525794506072998
local_output_nid generation:  0.041355133056640625
local_in_edges_tensor generation:  0.04621243476867676
mini_batch_src_global generation:  0.05950212478637695
r_  generation:  0.5216403007507324
----------------------check_connections_block total spend ----------------------------- 3.3090779781341553
generate_one_block  0.6451270580291748
generate_one_block  0.6791424751281738
generate_one_block  0.6760330200195312
generate_one_block  0.6501054763793945
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.003612995147705078  GigaBytes
Max Memory Allocated: 0.003612995147705078  GigaBytes

connection checking time:  16.165677070617676
block generation total time  13.490269660949707
average batch blocks generation time:  3.3725674152374268
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2440185546875 GB
    Memory Allocated: 0.14586496353149414  GigaBytes
Max Memory Allocated: 0.14586496353149414  GigaBytes

torch.Size([167768, 128])
torch.Size([167536, 128])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.35 GiB already allocated; 14.44 MiB free; 22.41 GiB reserved in total by PyTorch)
