Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648486824.071828
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.002379894256591797  GigaBytes
Max Memory Allocated: 0.002379894256591797  GigaBytes

The real block id is  3
get_global_graph_edges_ids_block function  spend 0.024273395538330078
random selection method range initialization spend 0.006198883056640625
time for parepare:  0.018923282623291016
local_output_nid generation:  0.00423121452331543
local_in_edges_tensor generation:  0.0063517093658447266
mini_batch_src_global generation:  0.0033566951751708984
r_  generation:  0.03766679763793945
local_output_nid generation:  0.0059814453125
local_in_edges_tensor generation:  0.0029761791229248047
mini_batch_src_global generation:  0.004326820373535156
r_  generation:  0.03990983963012695
local_output_nid generation:  0.006018161773681641
local_in_edges_tensor generation:  0.0032296180725097656
mini_batch_src_global generation:  0.002916097640991211
r_  generation:  0.03893423080444336
local_output_nid generation:  0.006072282791137695
local_in_edges_tensor generation:  0.003091096878051758
mini_batch_src_global generation:  0.002991914749145508
r_  generation:  0.040656089782714844
local_output_nid generation:  0.00611567497253418
local_in_edges_tensor generation:  0.0030934810638427734
mini_batch_src_global generation:  0.0032393932342529297
r_  generation:  0.04217886924743652
local_output_nid generation:  0.006015300750732422
local_in_edges_tensor generation:  0.003099203109741211
mini_batch_src_global generation:  0.0033419132232666016
r_  generation:  0.04199504852294922
local_output_nid generation:  0.006077289581298828
local_in_edges_tensor generation:  0.003094911575317383
mini_batch_src_global generation:  0.0034952163696289062
r_  generation:  0.04320120811462402
local_output_nid generation:  0.0061991214752197266
local_in_edges_tensor generation:  0.0031795501708984375
mini_batch_src_global generation:  0.003473520278930664
r_  generation:  0.04211282730102539
----------------------check_connections_block total spend ----------------------------- 0.525672435760498
generate_one_block  0.05418658256530762
generate_one_block  0.05594015121459961
generate_one_block  0.05482935905456543
generate_one_block  0.054987192153930664
generate_one_block  0.060102224349975586
generate_one_block  0.05573678016662598
generate_one_block  0.056606292724609375
generate_one_block  0.05590391159057617
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.03984546661376953
gen group dst list time:  0.015376567840576172
time for parepare:  0.019225120544433594
local_output_nid generation:  0.013575553894042969
local_in_edges_tensor generation:  0.03222823143005371
mini_batch_src_global generation:  0.030518054962158203
r_  generation:  0.29209017753601074
local_output_nid generation:  0.020740985870361328
local_in_edges_tensor generation:  0.029176712036132812
mini_batch_src_global generation:  0.03632545471191406
r_  generation:  0.3076446056365967
local_output_nid generation:  0.020669221878051758
local_in_edges_tensor generation:  0.023877382278442383
mini_batch_src_global generation:  0.035742998123168945
r_  generation:  0.30622315406799316
local_output_nid generation:  0.02048349380493164
local_in_edges_tensor generation:  0.018312454223632812
mini_batch_src_global generation:  0.0367732048034668
r_  generation:  0.3137083053588867
local_output_nid generation:  0.020987510681152344
local_in_edges_tensor generation:  0.027146577835083008
mini_batch_src_global generation:  0.040055036544799805
r_  generation:  0.3207559585571289
local_output_nid generation:  0.02083611488342285
local_in_edges_tensor generation:  0.019006729125976562
mini_batch_src_global generation:  0.03817129135131836
r_  generation:  0.31752467155456543
local_output_nid generation:  0.021003007888793945
local_in_edges_tensor generation:  0.021609067916870117
mini_batch_src_global generation:  0.039249420166015625
r_  generation:  0.3260490894317627
local_output_nid generation:  0.020917177200317383
local_in_edges_tensor generation:  0.02145671844482422
mini_batch_src_global generation:  0.039040327072143555
r_  generation:  0.32466769218444824
----------------------check_connections_block total spend ----------------------------- 3.7072367668151855
generate_one_block  0.40645670890808105
generate_one_block  0.41344666481018066
generate_one_block  0.404573917388916
generate_one_block  0.40192079544067383
generate_one_block  0.41860151290893555
generate_one_block  0.4238243103027344
generate_one_block  0.41780900955200195
generate_one_block  0.403139591217041
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.037831783294677734
gen group dst list time:  0.035666704177856445
time for parepare:  0.019272327423095703
local_output_nid generation:  0.028312206268310547
local_in_edges_tensor generation:  0.045270442962646484
mini_batch_src_global generation:  0.05143237113952637
r_  generation:  0.509953498840332
local_output_nid generation:  0.03505659103393555
local_in_edges_tensor generation:  0.05369853973388672
mini_batch_src_global generation:  0.058831214904785156
r_  generation:  0.513556957244873
local_output_nid generation:  0.03467750549316406
local_in_edges_tensor generation:  0.04017376899719238
mini_batch_src_global generation:  0.055280208587646484
r_  generation:  0.5301740169525146
local_output_nid generation:  0.034926652908325195
local_in_edges_tensor generation:  0.03910040855407715
mini_batch_src_global generation:  0.058930397033691406
r_  generation:  0.5211935043334961
local_output_nid generation:  0.03465747833251953
local_in_edges_tensor generation:  0.04426765441894531
mini_batch_src_global generation:  0.05638527870178223
r_  generation:  0.535940408706665
local_output_nid generation:  0.03487682342529297
local_in_edges_tensor generation:  0.04436659812927246
mini_batch_src_global generation:  0.058876752853393555
r_  generation:  0.530778169631958
local_output_nid generation:  0.0349428653717041
local_in_edges_tensor generation:  0.0396885871887207
mini_batch_src_global generation:  0.05802035331726074
r_  generation:  0.5413222312927246
local_output_nid generation:  0.03509068489074707
local_in_edges_tensor generation:  0.04514193534851074
mini_batch_src_global generation:  0.05966758728027344
r_  generation:  0.5282001495361328
----------------------check_connections_block total spend ----------------------------- 6.216137886047363
generate_one_block  0.656243085861206
generate_one_block  0.6658873558044434
generate_one_block  0.6632616519927979
generate_one_block  0.6571958065032959
generate_one_block  0.6736388206481934
generate_one_block  0.7086822986602783
generate_one_block  0.6915702819824219
generate_one_block  0.6618025302886963
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.02487659454345703
gen group dst list time:  0.04471397399902344
time for parepare:  0.018836498260498047
local_output_nid generation:  0.03436088562011719
local_in_edges_tensor generation:  0.04121565818786621
mini_batch_src_global generation:  0.044168949127197266
r_  generation:  0.5005261898040771
local_output_nid generation:  0.039391517639160156
local_in_edges_tensor generation:  0.03432822227478027
mini_batch_src_global generation:  0.05626559257507324
r_  generation:  0.5013430118560791
local_output_nid generation:  0.03945565223693848
local_in_edges_tensor generation:  0.04416370391845703
mini_batch_src_global generation:  0.05630040168762207
r_  generation:  0.5027172565460205
local_output_nid generation:  0.03907036781311035
local_in_edges_tensor generation:  0.03932309150695801
mini_batch_src_global generation:  0.053659915924072266
r_  generation:  0.5221409797668457
local_output_nid generation:  0.03949570655822754
local_in_edges_tensor generation:  0.047600507736206055
mini_batch_src_global generation:  0.05433082580566406
r_  generation:  0.515906810760498
local_output_nid generation:  0.03920578956604004
local_in_edges_tensor generation:  0.03910088539123535
mini_batch_src_global generation:  0.0539553165435791
r_  generation:  0.5199298858642578
local_output_nid generation:  0.0389704704284668
local_in_edges_tensor generation:  0.04367327690124512
mini_batch_src_global generation:  0.0549311637878418
r_  generation:  0.5212187767028809
local_output_nid generation:  0.03937196731567383
local_in_edges_tensor generation:  0.039010047912597656
mini_batch_src_global generation:  0.05659818649291992
r_  generation:  0.5206780433654785
----------------------check_connections_block total spend ----------------------------- 6.130812406539917
generate_one_block  0.636791467666626
generate_one_block  0.6496350765228271
generate_one_block  0.6280817985534668
generate_one_block  0.6513206958770752
generate_one_block  0.6464643478393555
generate_one_block  0.6629595756530762
generate_one_block  0.6987454891204834
generate_one_block  0.6384522914886475
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.002379894256591797  GigaBytes
Max Memory Allocated: 0.002379894256591797  GigaBytes

connection checking time:  16.054187059402466
block generation total time  13.880505084991455
average batch blocks generation time:  1.7350631356239319
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2030029296875 GB
    Memory Allocated: 0.11323738098144531  GigaBytes
Max Memory Allocated: 0.11323738098144531  GigaBytes

torch.Size([165429, 128])
torch.Size([161006, 128])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 22.00 MiB (GPU 0; 23.62 GiB total capacity; 22.36 GiB already allocated; 6.44 MiB free; 22.42 GiB reserved in total by PyTorch)
