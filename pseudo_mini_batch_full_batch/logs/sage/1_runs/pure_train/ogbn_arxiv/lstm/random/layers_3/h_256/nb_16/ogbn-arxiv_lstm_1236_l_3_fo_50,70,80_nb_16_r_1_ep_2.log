Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648464985.0289977
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.03036212921142578
random selection method range initialization spend 0.007651329040527344
time for parepare:  0.019060611724853516
local_output_nid generation:  0.0021278858184814453
local_in_edges_tensor generation:  0.005698442459106445
mini_batch_src_global generation:  0.0022802352905273438
r_  generation:  0.02202153205871582
local_output_nid generation:  0.002504587173461914
local_in_edges_tensor generation:  0.0017049312591552734
mini_batch_src_global generation:  0.002577066421508789
r_  generation:  0.020708322525024414
local_output_nid generation:  0.002769947052001953
local_in_edges_tensor generation:  0.0016591548919677734
mini_batch_src_global generation:  0.0018315315246582031
r_  generation:  0.021006345748901367
local_output_nid generation:  0.0028884410858154297
local_in_edges_tensor generation:  0.0016825199127197266
mini_batch_src_global generation:  0.0017805099487304688
r_  generation:  0.021938323974609375
local_output_nid generation:  0.0028810501098632812
local_in_edges_tensor generation:  0.0015823841094970703
mini_batch_src_global generation:  0.001771688461303711
r_  generation:  0.021329641342163086
local_output_nid generation:  0.002855062484741211
local_in_edges_tensor generation:  0.0014698505401611328
mini_batch_src_global generation:  0.0019314289093017578
r_  generation:  0.02204608917236328
local_output_nid generation:  0.002911090850830078
local_in_edges_tensor generation:  0.0015211105346679688
mini_batch_src_global generation:  0.0018343925476074219
r_  generation:  0.02187347412109375
local_output_nid generation:  0.0028502941131591797
local_in_edges_tensor generation:  0.0014491081237792969
mini_batch_src_global generation:  0.0019423961639404297
r_  generation:  0.022202014923095703
local_output_nid generation:  0.002887248992919922
local_in_edges_tensor generation:  0.0015530586242675781
mini_batch_src_global generation:  0.001955270767211914
r_  generation:  0.022494077682495117
local_output_nid generation:  0.0029001235961914062
local_in_edges_tensor generation:  0.0014657974243164062
mini_batch_src_global generation:  0.0019414424896240234
r_  generation:  0.022527217864990234
local_output_nid generation:  0.0028564929962158203
local_in_edges_tensor generation:  0.001483917236328125
mini_batch_src_global generation:  0.0020508766174316406
r_  generation:  0.02260732650756836
local_output_nid generation:  0.0028870105743408203
local_in_edges_tensor generation:  0.0014734268188476562
mini_batch_src_global generation:  0.0020020008087158203
r_  generation:  0.02840566635131836
local_output_nid generation:  0.002885580062866211
local_in_edges_tensor generation:  0.001478433609008789
mini_batch_src_global generation:  0.0016727447509765625
r_  generation:  0.021620512008666992
local_output_nid generation:  0.002939462661743164
local_in_edges_tensor generation:  0.0014908313751220703
mini_batch_src_global generation:  0.0017268657684326172
r_  generation:  0.020963668823242188
local_output_nid generation:  0.002871990203857422
local_in_edges_tensor generation:  0.0015292167663574219
mini_batch_src_global generation:  0.001743316650390625
r_  generation:  0.021399497985839844
local_output_nid generation:  0.002935171127319336
local_in_edges_tensor generation:  0.001500844955444336
mini_batch_src_global generation:  0.0016734600067138672
r_  generation:  0.02051544189453125
----------------------check_connections_block total spend ----------------------------- 0.5747194290161133
generate_one_block  0.03213691711425781
generate_one_block  0.029785871505737305
generate_one_block  0.03359818458557129
generate_one_block  0.03175210952758789
generate_one_block  0.030693769454956055
generate_one_block  0.031095027923583984
generate_one_block  0.030179977416992188
generate_one_block  0.02973198890686035
generate_one_block  0.030775785446166992
generate_one_block  0.030750036239624023
generate_one_block  0.030650615692138672
generate_one_block  0.03146100044250488
generate_one_block  0.03141975402832031
generate_one_block  0.030379533767700195
generate_one_block  0.031621456146240234
generate_one_block  0.030405282974243164
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.043991804122924805
gen group dst list time:  0.020404338836669922
time for parepare:  0.019568204879760742
local_output_nid generation:  0.009412765502929688
local_in_edges_tensor generation:  0.023667335510253906
mini_batch_src_global generation:  0.027905702590942383
r_  generation:  0.2568700313568115
local_output_nid generation:  0.01584601402282715
local_in_edges_tensor generation:  0.023540973663330078
mini_batch_src_global generation:  0.03148627281188965
r_  generation:  0.2479991912841797
local_output_nid generation:  0.016096115112304688
local_in_edges_tensor generation:  0.02225661277770996
mini_batch_src_global generation:  0.030273914337158203
r_  generation:  0.25668835639953613
local_output_nid generation:  0.016344308853149414
local_in_edges_tensor generation:  0.022885799407958984
mini_batch_src_global generation:  0.03163337707519531
r_  generation:  0.26590824127197266
local_output_nid generation:  0.016443490982055664
local_in_edges_tensor generation:  0.017217159271240234
mini_batch_src_global generation:  0.03292036056518555
r_  generation:  0.26892971992492676
local_output_nid generation:  0.01653909683227539
local_in_edges_tensor generation:  0.02005910873413086
mini_batch_src_global generation:  0.0359044075012207
r_  generation:  0.2695596218109131
local_output_nid generation:  0.01616215705871582
local_in_edges_tensor generation:  0.014949798583984375
mini_batch_src_global generation:  0.033890724182128906
r_  generation:  0.26261210441589355
local_output_nid generation:  0.015889883041381836
local_in_edges_tensor generation:  0.014383792877197266
mini_batch_src_global generation:  0.03379249572753906
r_  generation:  0.25890398025512695
local_output_nid generation:  0.016286373138427734
local_in_edges_tensor generation:  0.019365549087524414
mini_batch_src_global generation:  0.03419804573059082
r_  generation:  0.27061939239501953
local_output_nid generation:  0.016312360763549805
local_in_edges_tensor generation:  0.020619869232177734
mini_batch_src_global generation:  0.03387284278869629
r_  generation:  0.2674751281738281
local_output_nid generation:  0.016027212142944336
local_in_edges_tensor generation:  0.019428253173828125
mini_batch_src_global generation:  0.03409123420715332
r_  generation:  0.27431344985961914
local_output_nid generation:  0.016505718231201172
local_in_edges_tensor generation:  0.017750263214111328
mini_batch_src_global generation:  0.034891366958618164
r_  generation:  0.2757279872894287
local_output_nid generation:  0.01646733283996582
local_in_edges_tensor generation:  0.020443201065063477
mini_batch_src_global generation:  0.037333011627197266
r_  generation:  0.2715773582458496
local_output_nid generation:  0.016152143478393555
local_in_edges_tensor generation:  0.015349864959716797
mini_batch_src_global generation:  0.03383135795593262
r_  generation:  0.26320981979370117
local_output_nid generation:  0.016529321670532227
local_in_edges_tensor generation:  0.015758037567138672
mini_batch_src_global generation:  0.03486347198486328
r_  generation:  0.2714202404022217
local_output_nid generation:  0.016023874282836914
local_in_edges_tensor generation:  0.01695084571838379
mini_batch_src_global generation:  0.03384113311767578
r_  generation:  0.26585960388183594
----------------------check_connections_block total spend ----------------------------- 6.27425217628479
generate_one_block  0.3701152801513672
generate_one_block  0.3424956798553467
generate_one_block  0.352276086807251
generate_one_block  0.3588387966156006
generate_one_block  0.3730461597442627
generate_one_block  0.36063122749328613
generate_one_block  0.35024547576904297
generate_one_block  0.3450610637664795
generate_one_block  0.36095595359802246
generate_one_block  0.35709357261657715
generate_one_block  0.3605492115020752
generate_one_block  0.3648676872253418
generate_one_block  0.36508631706237793
generate_one_block  0.34291529655456543
generate_one_block  0.3636596202850342
generate_one_block  0.3460123538970947
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04183244705200195
gen group dst list time:  0.06298136711120605
time for parepare:  0.018875837326049805
local_output_nid generation:  0.026784896850585938
local_in_edges_tensor generation:  0.04531574249267578
mini_batch_src_global generation:  0.05433487892150879
r_  generation:  0.5121867656707764
local_output_nid generation:  0.032079219818115234
local_in_edges_tensor generation:  0.05260968208312988
mini_batch_src_global generation:  0.062315940856933594
r_  generation:  0.5214798450469971
local_output_nid generation:  0.0316925048828125
local_in_edges_tensor generation:  0.03880119323730469
mini_batch_src_global generation:  0.05841803550720215
r_  generation:  0.5262305736541748
local_output_nid generation:  0.031697750091552734
local_in_edges_tensor generation:  0.04391217231750488
mini_batch_src_global generation:  0.05950498580932617
r_  generation:  0.5274577140808105
local_output_nid generation:  0.03182053565979004
local_in_edges_tensor generation:  0.04821181297302246
mini_batch_src_global generation:  0.05995512008666992
r_  generation:  0.5323255062103271
local_output_nid generation:  0.0315394401550293
local_in_edges_tensor generation:  0.04261064529418945
mini_batch_src_global generation:  0.06689262390136719
r_  generation:  0.5356254577636719
local_output_nid generation:  0.03179144859313965
local_in_edges_tensor generation:  0.031603336334228516
mini_batch_src_global generation:  0.06222391128540039
r_  generation:  0.5488502979278564
local_output_nid generation:  0.03283858299255371
local_in_edges_tensor generation:  0.031397342681884766
mini_batch_src_global generation:  0.06311297416687012
r_  generation:  0.5398714542388916
local_output_nid generation:  0.032114267349243164
local_in_edges_tensor generation:  0.03662419319152832
mini_batch_src_global generation:  0.062163591384887695
r_  generation:  0.5393729209899902
local_output_nid generation:  0.032509803771972656
local_in_edges_tensor generation:  0.04656386375427246
mini_batch_src_global generation:  0.061903953552246094
r_  generation:  0.5476276874542236
local_output_nid generation:  0.03214716911315918
local_in_edges_tensor generation:  0.05122184753417969
mini_batch_src_global generation:  0.0610651969909668
r_  generation:  0.5433382987976074
local_output_nid generation:  0.033177852630615234
local_in_edges_tensor generation:  0.03742170333862305
mini_batch_src_global generation:  0.0661776065826416
r_  generation:  0.5535814762115479
local_output_nid generation:  0.03319692611694336
local_in_edges_tensor generation:  0.03922867774963379
mini_batch_src_global generation:  0.06751298904418945
r_  generation:  0.5445787906646729
local_output_nid generation:  0.033556222915649414
local_in_edges_tensor generation:  0.04008150100708008
mini_batch_src_global generation:  0.06343817710876465
r_  generation:  0.5406811237335205
local_output_nid generation:  0.03321647644042969
local_in_edges_tensor generation:  0.04541754722595215
mini_batch_src_global generation:  0.061448097229003906
r_  generation:  0.5625226497650146
local_output_nid generation:  0.034285783767700195
local_in_edges_tensor generation:  0.03755044937133789
mini_batch_src_global generation:  0.06412458419799805
r_  generation:  0.5353562831878662
----------------------check_connections_block total spend ----------------------------- 12.69544267654419
generate_one_block  0.6921975612640381
generate_one_block  0.6747701168060303
generate_one_block  0.6731693744659424
generate_one_block  0.7101049423217773
generate_one_block  0.690516471862793
generate_one_block  0.6919381618499756
generate_one_block  0.7287688255310059
generate_one_block  0.6844277381896973
generate_one_block  0.6841044425964355
generate_one_block  0.7064981460571289
generate_one_block  0.6860921382904053
generate_one_block  0.693657398223877
generate_one_block  0.6991760730743408
generate_one_block  0.6852455139160156
generate_one_block  0.6921031475067139
generate_one_block  0.6751303672790527
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  18.96969485282898
block generation total time  16.781750202178955
average batch blocks generation time:  1.0488593876361847
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1815185546875 GB
    Memory Allocated: 0.10045671463012695  GigaBytes
Max Memory Allocated: 0.10045671463012695  GigaBytes

torch.Size([157664, 128])
torch.Size([130536, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 23.62 GiB total capacity; 22.36 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
