Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648523546.4574516
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.003612995147705078  GigaBytes
Max Memory Allocated: 0.003612995147705078  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.0251314640045166
random selection method range initialization spend 0.00653386116027832
time for parepare:  0.019128084182739258
local_output_nid generation:  0.004300117492675781
local_in_edges_tensor generation:  0.006317138671875
mini_batch_src_global generation:  0.0033562183380126953
r_  generation:  0.037926673889160156
local_output_nid generation:  0.0059626102447509766
local_in_edges_tensor generation:  0.0030667781829833984
mini_batch_src_global generation:  0.004247903823852539
r_  generation:  0.03913474082946777
local_output_nid generation:  0.006124973297119141
local_in_edges_tensor generation:  0.0032033920288085938
mini_batch_src_global generation:  0.002883434295654297
r_  generation:  0.04024696350097656
local_output_nid generation:  0.006118297576904297
local_in_edges_tensor generation:  0.0032453536987304688
mini_batch_src_global generation:  0.003010988235473633
r_  generation:  0.040650129318237305
local_output_nid generation:  0.006143093109130859
local_in_edges_tensor generation:  0.003098011016845703
mini_batch_src_global generation:  0.003072500228881836
r_  generation:  0.04189729690551758
local_output_nid generation:  0.006178140640258789
local_in_edges_tensor generation:  0.003200531005859375
mini_batch_src_global generation:  0.0033206939697265625
r_  generation:  0.040561676025390625
local_output_nid generation:  0.006147623062133789
local_in_edges_tensor generation:  0.0030879974365234375
mini_batch_src_global generation:  0.003262042999267578
r_  generation:  0.04207420349121094
local_output_nid generation:  0.00626373291015625
local_in_edges_tensor generation:  0.0031461715698242188
mini_batch_src_global generation:  0.0034101009368896484
r_  generation:  0.04207754135131836
----------------------check_connections_block total spend ----------------------------- 0.5232100486755371
generate_one_block  0.055054664611816406
generate_one_block  0.05630373954772949
generate_one_block  0.056145429611206055
generate_one_block  0.05502676963806152
generate_one_block  0.05877566337585449
generate_one_block  0.05501151084899902
generate_one_block  0.05601859092712402
generate_one_block  0.05585074424743652
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.04159283638000488
gen group dst list time:  0.015261411666870117
time for parepare:  0.019486188888549805
local_output_nid generation:  0.013954877853393555
local_in_edges_tensor generation:  0.03289031982421875
mini_batch_src_global generation:  0.031104564666748047
r_  generation:  0.2967641353607178
local_output_nid generation:  0.020992755889892578
local_in_edges_tensor generation:  0.03012704849243164
mini_batch_src_global generation:  0.03662300109863281
r_  generation:  0.31046080589294434
local_output_nid generation:  0.021122217178344727
local_in_edges_tensor generation:  0.028092384338378906
mini_batch_src_global generation:  0.03696274757385254
r_  generation:  0.31299877166748047
local_output_nid generation:  0.02068495750427246
local_in_edges_tensor generation:  0.019116878509521484
mini_batch_src_global generation:  0.03759002685546875
r_  generation:  0.31418538093566895
local_output_nid generation:  0.020795106887817383
local_in_edges_tensor generation:  0.021260499954223633
mini_batch_src_global generation:  0.03878355026245117
r_  generation:  0.31751418113708496
local_output_nid generation:  0.020814895629882812
local_in_edges_tensor generation:  0.021290063858032227
mini_batch_src_global generation:  0.03891301155090332
r_  generation:  0.3222825527191162
local_output_nid generation:  0.0209348201751709
local_in_edges_tensor generation:  0.024585962295532227
mini_batch_src_global generation:  0.03850746154785156
r_  generation:  0.31705474853515625
local_output_nid generation:  0.021015644073486328
local_in_edges_tensor generation:  0.024523019790649414
mini_batch_src_global generation:  0.03932595252990723
r_  generation:  0.3208653926849365
----------------------check_connections_block total spend ----------------------------- 3.72995662689209
generate_one_block  0.41588854789733887
generate_one_block  0.4128406047821045
generate_one_block  0.42290186882019043
generate_one_block  0.40655064582824707
generate_one_block  0.4118387699127197
generate_one_block  0.4310605525970459
generate_one_block  0.4067223072052002
generate_one_block  0.42272186279296875
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.03535103797912598
gen group dst list time:  0.036087751388549805
time for parepare:  0.019766569137573242
local_output_nid generation:  0.028432369232177734
local_in_edges_tensor generation:  0.041007280349731445
mini_batch_src_global generation:  0.05318403244018555
r_  generation:  0.5208241939544678
local_output_nid generation:  0.03433489799499512
local_in_edges_tensor generation:  0.05166006088256836
mini_batch_src_global generation:  0.06199383735656738
r_  generation:  0.5239546298980713
local_output_nid generation:  0.03476357460021973
local_in_edges_tensor generation:  0.05079054832458496
mini_batch_src_global generation:  0.05678224563598633
r_  generation:  0.5389704704284668
local_output_nid generation:  0.03448128700256348
local_in_edges_tensor generation:  0.03343057632446289
mini_batch_src_global generation:  0.06154775619506836
r_  generation:  0.531013011932373
local_output_nid generation:  0.034882545471191406
local_in_edges_tensor generation:  0.033310890197753906
mini_batch_src_global generation:  0.06444692611694336
r_  generation:  0.5496861934661865
local_output_nid generation:  0.03599905967712402
local_in_edges_tensor generation:  0.0453641414642334
mini_batch_src_global generation:  0.06170964241027832
r_  generation:  0.53898024559021
local_output_nid generation:  0.0367431640625
local_in_edges_tensor generation:  0.03585171699523926
mini_batch_src_global generation:  0.06006264686584473
r_  generation:  0.5550339221954346
local_output_nid generation:  0.03666520118713379
local_in_edges_tensor generation:  0.04482841491699219
mini_batch_src_global generation:  0.06382036209106445
r_  generation:  0.5539631843566895
----------------------check_connections_block total spend ----------------------------- 6.379532098770142
generate_one_block  0.6994102001190186
generate_one_block  0.719857931137085
generate_one_block  0.7371909618377686
generate_one_block  0.7057299613952637
generate_one_block  0.7455289363861084
generate_one_block  0.7501723766326904
generate_one_block  0.7466354370117188
generate_one_block  0.7253246307373047
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.04876232147216797
gen group dst list time:  0.05814766883850098
time for parepare:  0.01907658576965332
local_output_nid generation:  0.03616213798522949
local_in_edges_tensor generation:  0.0701899528503418
mini_batch_src_global generation:  0.07301568984985352
r_  generation:  0.5587160587310791
local_output_nid generation:  0.04100155830383301
local_in_edges_tensor generation:  0.062465667724609375
mini_batch_src_global generation:  0.08298373222351074
r_  generation:  0.5716733932495117
local_output_nid generation:  0.041510581970214844
local_in_edges_tensor generation:  0.052220821380615234
mini_batch_src_global generation:  0.06365108489990234
r_  generation:  0.5572164058685303
local_output_nid generation:  0.04178571701049805
local_in_edges_tensor generation:  0.04916810989379883
mini_batch_src_global generation:  0.06191372871398926
r_  generation:  0.5762231349945068
local_output_nid generation:  0.040358543395996094
local_in_edges_tensor generation:  0.04961729049682617
mini_batch_src_global generation:  0.06690430641174316
r_  generation:  0.5799322128295898
local_output_nid generation:  0.041715145111083984
local_in_edges_tensor generation:  0.0464777946472168
mini_batch_src_global generation:  0.06115603446960449
r_  generation:  0.5790708065032959
local_output_nid generation:  0.04070925712585449
local_in_edges_tensor generation:  0.046405792236328125
mini_batch_src_global generation:  0.06080508232116699
r_  generation:  0.5777781009674072
local_output_nid generation:  0.040496826171875
local_in_edges_tensor generation:  0.041040658950805664
mini_batch_src_global generation:  0.061632394790649414
r_  generation:  0.5759439468383789
----------------------check_connections_block total spend ----------------------------- 6.9279351234436035
generate_one_block  0.7104701995849609
generate_one_block  0.718174934387207
generate_one_block  0.7108864784240723
generate_one_block  0.7080750465393066
generate_one_block  0.7063300609588623
generate_one_block  0.7047214508056641
generate_one_block  0.7761721611022949
generate_one_block  0.7035009860992432
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04403948783874512
gen group dst list time:  0.04748892784118652
time for parepare:  0.01987457275390625
local_output_nid generation:  0.036170005798339844
local_in_edges_tensor generation:  0.05312395095825195
mini_batch_src_global generation:  0.05138802528381348
r_  generation:  0.5383651256561279
local_output_nid generation:  0.04081535339355469
local_in_edges_tensor generation:  0.03806900978088379
mini_batch_src_global generation:  0.06734228134155273
r_  generation:  0.5514209270477295
local_output_nid generation:  0.04051709175109863
local_in_edges_tensor generation:  0.0556948184967041
mini_batch_src_global generation:  0.06408977508544922
r_  generation:  0.5486364364624023
local_output_nid generation:  0.04187202453613281
local_in_edges_tensor generation:  0.039284706115722656
mini_batch_src_global generation:  0.06369185447692871
r_  generation:  0.5505728721618652
local_output_nid generation:  0.04076671600341797
local_in_edges_tensor generation:  0.041345834732055664
mini_batch_src_global generation:  0.06435656547546387
r_  generation:  0.5567491054534912
local_output_nid generation:  0.04097294807434082
local_in_edges_tensor generation:  0.03909158706665039
mini_batch_src_global generation:  0.06879019737243652
r_  generation:  0.5550050735473633
local_output_nid generation:  0.0402522087097168
local_in_edges_tensor generation:  0.05873394012451172
mini_batch_src_global generation:  0.07164168357849121
r_  generation:  0.5729560852050781
local_output_nid generation:  0.043981075286865234
local_in_edges_tensor generation:  0.05231618881225586
mini_batch_src_global generation:  0.07015824317932129
r_  generation:  0.5512304306030273
----------------------check_connections_block total spend ----------------------------- 6.694757699966431
generate_one_block  0.6882369518280029
generate_one_block  0.694462776184082
generate_one_block  0.7012009620666504
generate_one_block  0.6865541934967041
generate_one_block  0.6873879432678223
generate_one_block  0.7192587852478027
generate_one_block  0.7075951099395752
generate_one_block  0.7433521747589111
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04068613052368164
gen group dst list time:  0.04791402816772461
time for parepare:  0.019465208053588867
local_output_nid generation:  0.03653216361999512
local_in_edges_tensor generation:  0.05086779594421387
mini_batch_src_global generation:  0.0476231575012207
r_  generation:  0.507056713104248
local_output_nid generation:  0.04215741157531738
local_in_edges_tensor generation:  0.043411970138549805
mini_batch_src_global generation:  0.05848121643066406
r_  generation:  0.5115454196929932
local_output_nid generation:  0.04181408882141113
local_in_edges_tensor generation:  0.037848472595214844
mini_batch_src_global generation:  0.05917501449584961
r_  generation:  0.5103530883789062
local_output_nid generation:  0.0409393310546875
local_in_edges_tensor generation:  0.041298866271972656
mini_batch_src_global generation:  0.05855393409729004
r_  generation:  0.5302159786224365
local_output_nid generation:  0.04090237617492676
local_in_edges_tensor generation:  0.046137332916259766
mini_batch_src_global generation:  0.058405399322509766
r_  generation:  0.5234148502349854
local_output_nid generation:  0.04143691062927246
local_in_edges_tensor generation:  0.05170917510986328
mini_batch_src_global generation:  0.06189465522766113
r_  generation:  0.5179691314697266
local_output_nid generation:  0.04109930992126465
local_in_edges_tensor generation:  0.03875088691711426
mini_batch_src_global generation:  0.05907869338989258
r_  generation:  0.5197184085845947
local_output_nid generation:  0.04076862335205078
local_in_edges_tensor generation:  0.04165816307067871
mini_batch_src_global generation:  0.05840587615966797
r_  generation:  0.5182547569274902
----------------------check_connections_block total spend ----------------------------- 6.260657548904419
generate_one_block  0.6335983276367188
generate_one_block  0.6404576301574707
generate_one_block  0.640458345413208
generate_one_block  0.6394557952880859
generate_one_block  0.6415359973907471
generate_one_block  0.6550028324127197
generate_one_block  0.651496171951294
generate_one_block  0.6517634391784668
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.003612995147705078  GigaBytes
Max Memory Allocated: 0.003612995147705078  GigaBytes

connection checking time:  29.992839097976685
block generation total time  25.680524349212646
average batch blocks generation time:  3.210065543651581
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2440185546875 GB
    Memory Allocated: 0.14215993881225586  GigaBytes
Max Memory Allocated: 0.14215993881225586  GigaBytes

torch.Size([167487, 128])
torch.Size([167017, 128])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 23.62 GiB total capacity; 22.34 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
