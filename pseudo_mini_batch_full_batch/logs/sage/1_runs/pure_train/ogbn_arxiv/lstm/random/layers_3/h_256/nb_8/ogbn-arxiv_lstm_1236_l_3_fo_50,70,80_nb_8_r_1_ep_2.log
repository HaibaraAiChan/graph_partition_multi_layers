Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648464952.9935858
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.027494192123413086
random selection method range initialization spend 0.006498813629150391
time for parepare:  0.01869797706604004
local_output_nid generation:  0.0041615962982177734
local_in_edges_tensor generation:  0.006466388702392578
mini_batch_src_global generation:  0.0038793087005615234
r_  generation:  0.04179501533508301
local_output_nid generation:  0.005946636199951172
local_in_edges_tensor generation:  0.0033011436462402344
mini_batch_src_global generation:  0.004991292953491211
r_  generation:  0.04344439506530762
local_output_nid generation:  0.0060443878173828125
local_in_edges_tensor generation:  0.003296375274658203
mini_batch_src_global generation:  0.003248929977416992
r_  generation:  0.04430270195007324
local_output_nid generation:  0.0060732364654541016
local_in_edges_tensor generation:  0.0033698081970214844
mini_batch_src_global generation:  0.003504514694213867
r_  generation:  0.04443025588989258
local_output_nid generation:  0.006111860275268555
local_in_edges_tensor generation:  0.0032286643981933594
mini_batch_src_global generation:  0.003564596176147461
r_  generation:  0.04537224769592285
local_output_nid generation:  0.00613856315612793
local_in_edges_tensor generation:  0.0032548904418945312
mini_batch_src_global generation:  0.003798246383666992
r_  generation:  0.04626631736755371
local_output_nid generation:  0.006106138229370117
local_in_edges_tensor generation:  0.0032160282135009766
mini_batch_src_global generation:  0.0038747787475585938
r_  generation:  0.04614830017089844
local_output_nid generation:  0.0061664581298828125
local_in_edges_tensor generation:  0.0032417774200439453
mini_batch_src_global generation:  0.003854036331176758
r_  generation:  0.045943498611450195
----------------------check_connections_block total spend ----------------------------- 0.5682821273803711
generate_one_block  0.061118125915527344
generate_one_block  0.06211686134338379
generate_one_block  0.06236076354980469
generate_one_block  0.06053638458251953
generate_one_block  0.06432652473449707
generate_one_block  0.06254315376281738
generate_one_block  0.06216120719909668
generate_one_block  0.0607905387878418
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04446601867675781
gen group dst list time:  0.016217947006225586
time for parepare:  0.019666194915771484
local_output_nid generation:  0.014569997787475586
local_in_edges_tensor generation:  0.03761792182922363
mini_batch_src_global generation:  0.03619527816772461
r_  generation:  0.3585786819458008
local_output_nid generation:  0.02272820472717285
local_in_edges_tensor generation:  0.03513526916503906
mini_batch_src_global generation:  0.04596424102783203
r_  generation:  0.3715381622314453
local_output_nid generation:  0.02261519432067871
local_in_edges_tensor generation:  0.028409242630004883
mini_batch_src_global generation:  0.047241926193237305
r_  generation:  0.3789041042327881
local_output_nid generation:  0.022283315658569336
local_in_edges_tensor generation:  0.021852493286132812
mini_batch_src_global generation:  0.04468584060668945
r_  generation:  0.3698451519012451
local_output_nid generation:  0.022652626037597656
local_in_edges_tensor generation:  0.025071382522583008
mini_batch_src_global generation:  0.04596066474914551
r_  generation:  0.3800199031829834
local_output_nid generation:  0.02282404899597168
local_in_edges_tensor generation:  0.02900242805480957
mini_batch_src_global generation:  0.046694278717041016
r_  generation:  0.3874797821044922
local_output_nid generation:  0.022661685943603516
local_in_edges_tensor generation:  0.026210308074951172
mini_batch_src_global generation:  0.047051191329956055
r_  generation:  0.3882465362548828
local_output_nid generation:  0.022713184356689453
local_in_edges_tensor generation:  0.025431394577026367
mini_batch_src_global generation:  0.04659271240234375
r_  generation:  0.3796055316925049
----------------------check_connections_block total spend ----------------------------- 4.428691148757935
generate_one_block  0.4990732669830322
generate_one_block  0.5043284893035889
generate_one_block  0.50616455078125
generate_one_block  0.4800875186920166
generate_one_block  0.48985862731933594
generate_one_block  0.5174949169158936
generate_one_block  0.507310152053833
generate_one_block  0.4903442859649658
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.038523197174072266
gen group dst list time:  0.03716015815734863
time for parepare:  0.01987433433532715
local_output_nid generation:  0.029580116271972656
local_in_edges_tensor generation:  0.04840207099914551
mini_batch_src_global generation:  0.0536651611328125
r_  generation:  0.5443763732910156
local_output_nid generation:  0.039020538330078125
local_in_edges_tensor generation:  0.05597853660583496
mini_batch_src_global generation:  0.06769537925720215
r_  generation:  0.5492219924926758
local_output_nid generation:  0.03949236869812012
local_in_edges_tensor generation:  0.047606706619262695
mini_batch_src_global generation:  0.06170296669006348
r_  generation:  0.5586822032928467
local_output_nid generation:  0.03914833068847656
local_in_edges_tensor generation:  0.03612184524536133
mini_batch_src_global generation:  0.060450077056884766
r_  generation:  0.5630533695220947
local_output_nid generation:  0.03973126411437988
local_in_edges_tensor generation:  0.041439056396484375
mini_batch_src_global generation:  0.06258749961853027
r_  generation:  0.5669765472412109
local_output_nid generation:  0.039159297943115234
local_in_edges_tensor generation:  0.04674673080444336
mini_batch_src_global generation:  0.06595277786254883
r_  generation:  0.5652153491973877
local_output_nid generation:  0.04324674606323242
local_in_edges_tensor generation:  0.03735828399658203
mini_batch_src_global generation:  0.06363892555236816
r_  generation:  0.5730059146881104
local_output_nid generation:  0.03970980644226074
local_in_edges_tensor generation:  0.04168868064880371
mini_batch_src_global generation:  0.06332612037658691
r_  generation:  0.5762667655944824
----------------------check_connections_block total spend ----------------------------- 6.666412591934204
generate_one_block  0.7146947383880615
generate_one_block  0.7090785503387451
generate_one_block  0.7225244045257568
generate_one_block  0.7136130332946777
generate_one_block  0.7297399044036865
generate_one_block  0.7335679531097412
generate_one_block  0.7379834651947021
generate_one_block  0.7220828533172607
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  11.095103740692139
block generation total time  9.777946710586548
average batch blocks generation time:  1.2222433388233185
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2049560546875 GB
    Memory Allocated: 0.10672760009765625  GigaBytes
Max Memory Allocated: 0.10672760009765625  GigaBytes

torch.Size([162516, 128])
torch.Size([145829, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.21 GiB already allocated; 12.44 MiB free; 22.41 GiB reserved in total by PyTorch)
