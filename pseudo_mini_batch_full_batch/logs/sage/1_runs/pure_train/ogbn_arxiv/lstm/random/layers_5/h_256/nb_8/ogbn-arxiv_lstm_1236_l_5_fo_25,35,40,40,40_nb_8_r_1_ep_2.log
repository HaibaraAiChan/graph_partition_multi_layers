Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648503667.0822263
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0272216796875 GB
    Memory Allocated: 0.010137557983398438  GigaBytes
Max Memory Allocated: 0.010137557983398438  GigaBytes

The real block id is  4
get_global_graph_edges_ids_block function  spend 0.0255739688873291
random selection method range initialization spend 0.0065326690673828125
time for parepare:  0.018442153930664062
local_output_nid generation:  0.004271030426025391
local_in_edges_tensor generation:  0.0061342716217041016
mini_batch_src_global generation:  0.003417491912841797
r_  generation:  0.03799271583557129
local_output_nid generation:  0.005789279937744141
local_in_edges_tensor generation:  0.0031385421752929688
mini_batch_src_global generation:  0.006105184555053711
r_  generation:  0.03875732421875
local_output_nid generation:  0.005982398986816406
local_in_edges_tensor generation:  0.0032570362091064453
mini_batch_src_global generation:  0.0028603076934814453
r_  generation:  0.04075956344604492
local_output_nid generation:  0.006051063537597656
local_in_edges_tensor generation:  0.0032930374145507812
mini_batch_src_global generation:  0.0029747486114501953
r_  generation:  0.040247440338134766
local_output_nid generation:  0.0061113834381103516
local_in_edges_tensor generation:  0.0032176971435546875
mini_batch_src_global generation:  0.0032074451446533203
r_  generation:  0.04037618637084961
local_output_nid generation:  0.006068229675292969
local_in_edges_tensor generation:  0.003182649612426758
mini_batch_src_global generation:  0.0032241344451904297
r_  generation:  0.04043245315551758
local_output_nid generation:  0.006064414978027344
local_in_edges_tensor generation:  0.0031638145446777344
mini_batch_src_global generation:  0.0033521652221679688
r_  generation:  0.04087185859680176
local_output_nid generation:  0.006062984466552734
local_in_edges_tensor generation:  0.0033152103424072266
mini_batch_src_global generation:  0.003324270248413086
r_  generation:  0.041443824768066406
----------------------check_connections_block total spend ----------------------------- 0.5198938846588135
generate_one_block  0.055123329162597656
generate_one_block  0.056580305099487305
generate_one_block  0.05718255043029785
generate_one_block  0.055278778076171875
generate_one_block  0.05711555480957031
generate_one_block  0.05444192886352539
generate_one_block  0.05515766143798828
generate_one_block  0.05487418174743652
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.041409969329833984
gen group dst list time:  0.01633143424987793
time for parepare:  0.0197145938873291
local_output_nid generation:  0.01352548599243164
local_in_edges_tensor generation:  0.03313112258911133
mini_batch_src_global generation:  0.031238317489624023
r_  generation:  0.2961764335632324
local_output_nid generation:  0.02092885971069336
local_in_edges_tensor generation:  0.031216859817504883
mini_batch_src_global generation:  0.03627133369445801
r_  generation:  0.30705809593200684
local_output_nid generation:  0.021245479583740234
local_in_edges_tensor generation:  0.029018402099609375
mini_batch_src_global generation:  0.036843299865722656
r_  generation:  0.3197312355041504
local_output_nid generation:  0.02132725715637207
local_in_edges_tensor generation:  0.02045917510986328
mini_batch_src_global generation:  0.04151487350463867
r_  generation:  0.31902265548706055
local_output_nid generation:  0.021056413650512695
local_in_edges_tensor generation:  0.026009321212768555
mini_batch_src_global generation:  0.03900885581970215
r_  generation:  0.31992435455322266
local_output_nid generation:  0.021067380905151367
local_in_edges_tensor generation:  0.022739171981811523
mini_batch_src_global generation:  0.038550615310668945
r_  generation:  0.3176307678222656
local_output_nid generation:  0.02123570442199707
local_in_edges_tensor generation:  0.025579452514648438
mini_batch_src_global generation:  0.04114556312561035
r_  generation:  0.3195953369140625
local_output_nid generation:  0.02147364616394043
local_in_edges_tensor generation:  0.020568370819091797
mini_batch_src_global generation:  0.03879809379577637
r_  generation:  0.3211812973022461
----------------------check_connections_block total spend ----------------------------- 3.750948905944824
generate_one_block  0.4111924171447754
generate_one_block  0.4146385192871094
generate_one_block  0.41756272315979004
generate_one_block  0.41146063804626465
generate_one_block  0.39987993240356445
generate_one_block  0.4191422462463379
generate_one_block  0.41525721549987793
generate_one_block  0.40640950202941895
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.044142723083496094
gen group dst list time:  0.04034280776977539
time for parepare:  0.019488811492919922
local_output_nid generation:  0.029310226440429688
local_in_edges_tensor generation:  0.05469822883605957
mini_batch_src_global generation:  0.05199885368347168
r_  generation:  0.5261969566345215
local_output_nid generation:  0.03476881980895996
local_in_edges_tensor generation:  0.05822873115539551
mini_batch_src_global generation:  0.06283354759216309
r_  generation:  0.5271060466766357
local_output_nid generation:  0.034778594970703125
local_in_edges_tensor generation:  0.04698061943054199
mini_batch_src_global generation:  0.059815168380737305
r_  generation:  0.5463895797729492
local_output_nid generation:  0.03488874435424805
local_in_edges_tensor generation:  0.04280233383178711
mini_batch_src_global generation:  0.06413125991821289
r_  generation:  0.5383298397064209
local_output_nid generation:  0.03497195243835449
local_in_edges_tensor generation:  0.0389101505279541
mini_batch_src_global generation:  0.06200242042541504
r_  generation:  0.5492503643035889
local_output_nid generation:  0.034983158111572266
local_in_edges_tensor generation:  0.04273509979248047
mini_batch_src_global generation:  0.0642096996307373
r_  generation:  0.5426101684570312
local_output_nid generation:  0.035214900970458984
local_in_edges_tensor generation:  0.04197835922241211
mini_batch_src_global generation:  0.06352639198303223
r_  generation:  0.5568404197692871
local_output_nid generation:  0.03489518165588379
local_in_edges_tensor generation:  0.03776860237121582
mini_batch_src_global generation:  0.06541180610656738
r_  generation:  0.5442066192626953
----------------------check_connections_block total spend ----------------------------- 6.408764362335205
generate_one_block  0.6804664134979248
generate_one_block  0.6829042434692383
generate_one_block  0.7010295391082764
generate_one_block  0.6976447105407715
generate_one_block  0.6733310222625732
generate_one_block  0.6788666248321533
generate_one_block  0.7088987827301025
generate_one_block  0.6851232051849365
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04095649719238281
gen group dst list time:  0.04999113082885742
time for parepare:  0.018957853317260742
local_output_nid generation:  0.03401517868041992
local_in_edges_tensor generation:  0.04864811897277832
mini_batch_src_global generation:  0.04992055892944336
r_  generation:  0.5443546772003174
local_output_nid generation:  0.03878474235534668
local_in_edges_tensor generation:  0.05873227119445801
mini_batch_src_global generation:  0.06293153762817383
r_  generation:  0.5424323081970215
local_output_nid generation:  0.03868889808654785
local_in_edges_tensor generation:  0.054117679595947266
mini_batch_src_global generation:  0.06247997283935547
r_  generation:  0.5536742210388184
local_output_nid generation:  0.03927254676818848
local_in_edges_tensor generation:  0.04923057556152344
mini_batch_src_global generation:  0.06023740768432617
r_  generation:  0.5586416721343994
local_output_nid generation:  0.03917860984802246
local_in_edges_tensor generation:  0.039399147033691406
mini_batch_src_global generation:  0.05963873863220215
r_  generation:  0.5524616241455078
local_output_nid generation:  0.03893017768859863
local_in_edges_tensor generation:  0.04534173011779785
mini_batch_src_global generation:  0.06311511993408203
r_  generation:  0.56612229347229
local_output_nid generation:  0.03973054885864258
local_in_edges_tensor generation:  0.044647932052612305
mini_batch_src_global generation:  0.06700015068054199
r_  generation:  0.556272029876709
local_output_nid generation:  0.03962111473083496
local_in_edges_tensor generation:  0.04456186294555664
mini_batch_src_global generation:  0.0636134147644043
r_  generation:  0.5648651123046875
----------------------check_connections_block total spend ----------------------------- 6.643481969833374
generate_one_block  0.6816740036010742
generate_one_block  0.676734447479248
generate_one_block  0.7040667533874512
generate_one_block  0.6983516216278076
generate_one_block  0.6800353527069092
generate_one_block  0.697256326675415
generate_one_block  0.7277266979217529
generate_one_block  0.7001819610595703
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.05581021308898926
gen group dst list time:  0.05047917366027832
time for parepare:  0.01986241340637207
local_output_nid generation:  0.034882545471191406
local_in_edges_tensor generation:  0.050506591796875
mini_batch_src_global generation:  0.04867196083068848
r_  generation:  0.5080986022949219
local_output_nid generation:  0.03991818428039551
local_in_edges_tensor generation:  0.04585886001586914
mini_batch_src_global generation:  0.05737709999084473
r_  generation:  0.5060713291168213
local_output_nid generation:  0.040030717849731445
local_in_edges_tensor generation:  0.0386509895324707
mini_batch_src_global generation:  0.05789613723754883
r_  generation:  0.5112764835357666
local_output_nid generation:  0.04010581970214844
local_in_edges_tensor generation:  0.03878951072692871
mini_batch_src_global generation:  0.05828142166137695
r_  generation:  0.5105767250061035
local_output_nid generation:  0.040526390075683594
local_in_edges_tensor generation:  0.04048323631286621
mini_batch_src_global generation:  0.05898571014404297
r_  generation:  0.5086126327514648
local_output_nid generation:  0.046276092529296875
local_in_edges_tensor generation:  0.03874063491821289
mini_batch_src_global generation:  0.06897830963134766
r_  generation:  0.5168509483337402
local_output_nid generation:  0.04141068458557129
local_in_edges_tensor generation:  0.03941798210144043
mini_batch_src_global generation:  0.057813167572021484
r_  generation:  0.5141282081604004
local_output_nid generation:  0.041222572326660156
local_in_edges_tensor generation:  0.04833102226257324
mini_batch_src_global generation:  0.05728292465209961
r_  generation:  0.5200517177581787
----------------------check_connections_block total spend ----------------------------- 6.2000954151153564
generate_one_block  0.6284501552581787
generate_one_block  0.6428983211517334
generate_one_block  0.6433422565460205
generate_one_block  0.6410725116729736
generate_one_block  0.6322920322418213
generate_one_block  0.6398766040802002
generate_one_block  0.6399610042572021
generate_one_block  0.6971819400787354
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0272216796875 GB
    Memory Allocated: 0.010137557983398438  GigaBytes
Max Memory Allocated: 0.010137557983398438  GigaBytes

connection checking time:  23.00329065322876
block generation total time  19.53490972518921
average batch blocks generation time:  2.441863715648651
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2303466796875 GB
    Memory Allocated: 0.1359882354736328  GigaBytes
Max Memory Allocated: 0.1359882354736328  GigaBytes

torch.Size([167026, 128])
torch.Size([165860, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 18.00 MiB (GPU 0; 23.62 GiB total capacity; 21.92 GiB already allocated; 6.44 MiB free; 22.42 GiB reserved in total by PyTorch)
