Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648522698.2476206
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0013260841369628906  GigaBytes
Max Memory Allocated: 0.0013260841369628906  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.02484869956970215
random selection method range initialization spend 0.0064198970794677734
time for parepare:  0.018533706665039062
local_output_nid generation:  0.004335880279541016
local_in_edges_tensor generation:  0.006394147872924805
mini_batch_src_global generation:  0.003340005874633789
r_  generation:  0.037384033203125
local_output_nid generation:  0.005662679672241211
local_in_edges_tensor generation:  0.0031824111938476562
mini_batch_src_global generation:  0.004183530807495117
r_  generation:  0.03803205490112305
local_output_nid generation:  0.006035327911376953
local_in_edges_tensor generation:  0.003335237503051758
mini_batch_src_global generation:  0.0028803348541259766
r_  generation:  0.03808879852294922
local_output_nid generation:  0.005999565124511719
local_in_edges_tensor generation:  0.003377199172973633
mini_batch_src_global generation:  0.002866506576538086
r_  generation:  0.03940081596374512
local_output_nid generation:  0.0060272216796875
local_in_edges_tensor generation:  0.0032472610473632812
mini_batch_src_global generation:  0.0030295848846435547
r_  generation:  0.0406641960144043
local_output_nid generation:  0.006179094314575195
local_in_edges_tensor generation:  0.0033135414123535156
mini_batch_src_global generation:  0.003320455551147461
r_  generation:  0.04084658622741699
local_output_nid generation:  0.005991220474243164
local_in_edges_tensor generation:  0.0032529830932617188
mini_batch_src_global generation:  0.0032727718353271484
r_  generation:  0.040581464767456055
local_output_nid generation:  0.006036996841430664
local_in_edges_tensor generation:  0.0032100677490234375
mini_batch_src_global generation:  0.003418445587158203
r_  generation:  0.040482521057128906
----------------------check_connections_block total spend ----------------------------- 0.5114223957061768
generate_one_block  0.055153846740722656
generate_one_block  0.05542254447937012
generate_one_block  0.055029869079589844
generate_one_block  0.054421424865722656
generate_one_block  0.05829143524169922
generate_one_block  0.05550384521484375
generate_one_block  0.05400204658508301
generate_one_block  0.054378509521484375
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.04260706901550293
gen group dst list time:  0.01523447036743164
time for parepare:  0.019754648208618164
local_output_nid generation:  0.013733863830566406
local_in_edges_tensor generation:  0.0338740348815918
mini_batch_src_global generation:  0.03099966049194336
r_  generation:  0.2935671806335449
local_output_nid generation:  0.021859169006347656
local_in_edges_tensor generation:  0.030377626419067383
mini_batch_src_global generation:  0.036453962326049805
r_  generation:  0.305619478225708
local_output_nid generation:  0.021940231323242188
local_in_edges_tensor generation:  0.02442002296447754
mini_batch_src_global generation:  0.036031484603881836
r_  generation:  0.3113417625427246
local_output_nid generation:  0.02180767059326172
local_in_edges_tensor generation:  0.019469499588012695
mini_batch_src_global generation:  0.03746938705444336
r_  generation:  0.30892443656921387
local_output_nid generation:  0.021973371505737305
local_in_edges_tensor generation:  0.02422332763671875
mini_batch_src_global generation:  0.03751087188720703
r_  generation:  0.31598544120788574
local_output_nid generation:  0.02200460433959961
local_in_edges_tensor generation:  0.027613401412963867
mini_batch_src_global generation:  0.03809332847595215
r_  generation:  0.31679821014404297
local_output_nid generation:  0.02167487144470215
local_in_edges_tensor generation:  0.019396305084228516
mini_batch_src_global generation:  0.037667274475097656
r_  generation:  0.3109149932861328
local_output_nid generation:  0.021923542022705078
local_in_edges_tensor generation:  0.02155017852783203
mini_batch_src_global generation:  0.03850579261779785
r_  generation:  0.3161764144897461
----------------------check_connections_block total spend ----------------------------- 3.6987931728363037
generate_one_block  0.41614222526550293
generate_one_block  0.4179215431213379
generate_one_block  0.40874195098876953
generate_one_block  0.4119575023651123
generate_one_block  0.41133546829223633
generate_one_block  0.4387497901916504
generate_one_block  0.4033958911895752
generate_one_block  0.4110734462738037
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.03614354133605957
gen group dst list time:  0.03596758842468262
time for parepare:  0.019184589385986328
local_output_nid generation:  0.029001474380493164
local_in_edges_tensor generation:  0.051146507263183594
mini_batch_src_global generation:  0.05296063423156738
r_  generation:  0.5161023139953613
local_output_nid generation:  0.03421616554260254
local_in_edges_tensor generation:  0.0579226016998291
mini_batch_src_global generation:  0.060718536376953125
r_  generation:  0.5292773246765137
local_output_nid generation:  0.0344088077545166
local_in_edges_tensor generation:  0.05311775207519531
mini_batch_src_global generation:  0.056733131408691406
r_  generation:  0.539654016494751
local_output_nid generation:  0.034322500228881836
local_in_edges_tensor generation:  0.03935885429382324
mini_batch_src_global generation:  0.06164717674255371
r_  generation:  0.5319082736968994
local_output_nid generation:  0.03420424461364746
local_in_edges_tensor generation:  0.04186415672302246
mini_batch_src_global generation:  0.06253242492675781
r_  generation:  0.5447475910186768
local_output_nid generation:  0.0345609188079834
local_in_edges_tensor generation:  0.04687690734863281
mini_batch_src_global generation:  0.06162285804748535
r_  generation:  0.5336134433746338
local_output_nid generation:  0.03453683853149414
local_in_edges_tensor generation:  0.03694963455200195
mini_batch_src_global generation:  0.059548139572143555
r_  generation:  0.546734094619751
local_output_nid generation:  0.034503936767578125
local_in_edges_tensor generation:  0.04211688041687012
mini_batch_src_global generation:  0.06556320190429688
r_  generation:  0.537459135055542
----------------------check_connections_block total spend ----------------------------- 6.353301525115967
generate_one_block  0.6731719970703125
generate_one_block  0.6993801593780518
generate_one_block  0.6912369728088379
generate_one_block  0.6708076000213623
generate_one_block  0.682511568069458
generate_one_block  0.6930148601531982
generate_one_block  0.6916680335998535
generate_one_block  0.6810238361358643
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.03628253936767578
gen group dst list time:  0.04482221603393555
time for parepare:  0.01877903938293457
local_output_nid generation:  0.0342106819152832
local_in_edges_tensor generation:  0.04792332649230957
mini_batch_src_global generation:  0.05518341064453125
r_  generation:  0.5383520126342773
local_output_nid generation:  0.03967928886413574
local_in_edges_tensor generation:  0.05562257766723633
mini_batch_src_global generation:  0.06335973739624023
r_  generation:  0.5521926879882812
local_output_nid generation:  0.03862714767456055
local_in_edges_tensor generation:  0.04646611213684082
mini_batch_src_global generation:  0.06380009651184082
r_  generation:  0.5499274730682373
local_output_nid generation:  0.038887739181518555
local_in_edges_tensor generation:  0.047382354736328125
mini_batch_src_global generation:  0.059854745864868164
r_  generation:  0.5615177154541016
local_output_nid generation:  0.03888082504272461
local_in_edges_tensor generation:  0.03506612777709961
mini_batch_src_global generation:  0.06044745445251465
r_  generation:  0.5558743476867676
local_output_nid generation:  0.03908824920654297
local_in_edges_tensor generation:  0.042661190032958984
mini_batch_src_global generation:  0.06405520439147949
r_  generation:  0.5692126750946045
local_output_nid generation:  0.039391279220581055
local_in_edges_tensor generation:  0.04081106185913086
mini_batch_src_global generation:  0.062448978424072266
r_  generation:  0.5674948692321777
local_output_nid generation:  0.03922224044799805
local_in_edges_tensor generation:  0.042391300201416016
mini_batch_src_global generation:  0.06543803215026855
r_  generation:  0.6138262748718262
----------------------check_connections_block total spend ----------------------------- 6.713278770446777
generate_one_block  0.7173388004302979
generate_one_block  0.7447860240936279
generate_one_block  0.7550616264343262
generate_one_block  0.7311975955963135
generate_one_block  0.7238979339599609
generate_one_block  0.7391667366027832
generate_one_block  0.7534918785095215
generate_one_block  0.7383618354797363
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.06386446952819824
gen group dst list time:  0.04908871650695801
time for parepare:  0.02016448974609375
local_output_nid generation:  0.03650069236755371
local_in_edges_tensor generation:  0.05258369445800781
mini_batch_src_global generation:  0.05030965805053711
r_  generation:  0.5407683849334717
local_output_nid generation:  0.04011225700378418
local_in_edges_tensor generation:  0.056752681732177734
mini_batch_src_global generation:  0.0638434886932373
r_  generation:  0.5521454811096191
local_output_nid generation:  0.0399775505065918
local_in_edges_tensor generation:  0.04662752151489258
mini_batch_src_global generation:  0.06850600242614746
r_  generation:  0.5661365985870361
local_output_nid generation:  0.040146589279174805
local_in_edges_tensor generation:  0.04965925216674805
mini_batch_src_global generation:  0.06389474868774414
r_  generation:  0.5438954830169678
local_output_nid generation:  0.03983187675476074
local_in_edges_tensor generation:  0.04162311553955078
mini_batch_src_global generation:  0.07838177680969238
r_  generation:  0.5503780841827393
local_output_nid generation:  0.04209136962890625
local_in_edges_tensor generation:  0.048897743225097656
mini_batch_src_global generation:  0.0620722770690918
r_  generation:  0.5472960472106934
local_output_nid generation:  0.04115486145019531
local_in_edges_tensor generation:  0.03924131393432617
mini_batch_src_global generation:  0.06236600875854492
r_  generation:  0.5532574653625488
local_output_nid generation:  0.04141354560852051
local_in_edges_tensor generation:  0.0482330322265625
mini_batch_src_global generation:  0.06174755096435547
r_  generation:  0.5488474369049072
----------------------check_connections_block total spend ----------------------------- 6.664620637893677
generate_one_block  0.684812068939209
generate_one_block  0.7225370407104492
generate_one_block  0.7062439918518066
generate_one_block  0.7004728317260742
generate_one_block  0.7167739868164062
generate_one_block  0.7323541641235352
generate_one_block  0.71651291847229
generate_one_block  0.7532446384429932
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.0489192008972168
gen group dst list time:  0.048896074295043945
time for parepare:  0.019600391387939453
local_output_nid generation:  0.03615212440490723
local_in_edges_tensor generation:  0.05462527275085449
mini_batch_src_global generation:  0.04927253723144531
r_  generation:  0.518944263458252
local_output_nid generation:  0.04156851768493652
local_in_edges_tensor generation:  0.035423994064331055
mini_batch_src_global generation:  0.06054544448852539
r_  generation:  0.5063984394073486
local_output_nid generation:  0.040053606033325195
local_in_edges_tensor generation:  0.034740447998046875
mini_batch_src_global generation:  0.06077146530151367
r_  generation:  0.5094316005706787
local_output_nid generation:  0.041146278381347656
local_in_edges_tensor generation:  0.03615212440490723
mini_batch_src_global generation:  0.06520986557006836
r_  generation:  0.5126683712005615
local_output_nid generation:  0.03998732566833496
local_in_edges_tensor generation:  0.04645848274230957
mini_batch_src_global generation:  0.06133294105529785
r_  generation:  0.511986494064331
local_output_nid generation:  0.04061484336853027
local_in_edges_tensor generation:  0.0404815673828125
mini_batch_src_global generation:  0.0623469352722168
r_  generation:  0.5149941444396973
local_output_nid generation:  0.040456295013427734
local_in_edges_tensor generation:  0.03946328163146973
mini_batch_src_global generation:  0.05890059471130371
r_  generation:  0.5318140983581543
local_output_nid generation:  0.04157137870788574
local_in_edges_tensor generation:  0.049271345138549805
mini_batch_src_global generation:  0.05874061584472656
r_  generation:  0.5172426700592041
----------------------check_connections_block total spend ----------------------------- 6.246378421783447
generate_one_block  0.6486475467681885
generate_one_block  0.6454176902770996
generate_one_block  0.6448063850402832
generate_one_block  0.6756813526153564
generate_one_block  0.638340950012207
generate_one_block  0.6395308971405029
generate_one_block  0.6550614833831787
generate_one_block  0.6568911075592041
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0013260841369628906  GigaBytes
Max Memory Allocated: 0.0013260841369628906  GigaBytes

connection checking time:  29.676372528076172
block generation total time  25.64276432991028
average batch blocks generation time:  3.205345541238785
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2420654296875 GB
    Memory Allocated: 0.13983964920043945  GigaBytes
Max Memory Allocated: 0.13983964920043945  GigaBytes

torch.Size([167466, 128])
torch.Size([166986, 64])
torch.Size([165656, 64])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 138, in invoke_udf_reduce
    for k, msg in msgdata_bkt.items():
  File "/usr/lib/python3.6/_collections_abc.py", line 744, in __iter__
    yield (key, self._mapping[key])
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/frame.py", line 393, in __getitem__
    return self._columns[name].data
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/frame.py", line 122, in data
    self.storage = F.gather_row(self.storage, self.index)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/backend/pytorch/tensor.py", line 186, in gather_row
    return th.index_select(data, 0, row_index.long())
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.24 GiB already allocated; 12.44 MiB free; 22.41 GiB reserved in total by PyTorch)
