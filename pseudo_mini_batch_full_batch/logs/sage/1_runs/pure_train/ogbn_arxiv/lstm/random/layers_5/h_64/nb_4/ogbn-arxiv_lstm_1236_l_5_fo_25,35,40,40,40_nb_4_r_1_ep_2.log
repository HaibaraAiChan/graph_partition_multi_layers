Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648502351.3565755
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0011692047119140625  GigaBytes
Max Memory Allocated: 0.0011692047119140625  GigaBytes

The real block id is  4
get_global_graph_edges_ids_block function  spend 0.026398181915283203
random selection method range initialization spend 0.008079290390014648
time for parepare:  0.019056320190429688
local_output_nid generation:  0.008228778839111328
local_in_edges_tensor generation:  0.010682106018066406
mini_batch_src_global generation:  0.007771730422973633
r_  generation:  0.08484435081481934
local_output_nid generation:  0.011672019958496094
local_in_edges_tensor generation:  0.0060160160064697266
mini_batch_src_global generation:  0.010294675827026367
r_  generation:  0.0911710262298584
local_output_nid generation:  0.01180577278137207
local_in_edges_tensor generation:  0.006143808364868164
mini_batch_src_global generation:  0.007714748382568359
r_  generation:  0.0903472900390625
local_output_nid generation:  0.011864662170410156
local_in_edges_tensor generation:  0.006033658981323242
mini_batch_src_global generation:  0.008693695068359375
r_  generation:  0.10171961784362793
----------------------check_connections_block total spend ----------------------------- 0.5788853168487549
generate_one_block  0.10358905792236328
generate_one_block  0.10341405868530273
generate_one_block  0.10302948951721191
generate_one_block  0.10326600074768066
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.0404665470123291
gen group dst list time:  0.011286497116088867
time for parepare:  0.019539356231689453
local_output_nid generation:  0.019085168838500977
local_in_edges_tensor generation:  0.042682647705078125
mini_batch_src_global generation:  0.03881025314331055
r_  generation:  0.40639710426330566
local_output_nid generation:  0.024941444396972656
local_in_edges_tensor generation:  0.04100608825683594
mini_batch_src_global generation:  0.047759056091308594
r_  generation:  0.41919851303100586
local_output_nid generation:  0.02495551109313965
local_in_edges_tensor generation:  0.034079551696777344
mini_batch_src_global generation:  0.04763078689575195
r_  generation:  0.42540431022644043
local_output_nid generation:  0.02488255500793457
local_in_edges_tensor generation:  0.026269912719726562
mini_batch_src_global generation:  0.04976177215576172
r_  generation:  0.4195253849029541
----------------------check_connections_block total spend ----------------------------- 2.481904983520508
generate_one_block  0.5759255886077881
generate_one_block  0.5464992523193359
generate_one_block  0.5396571159362793
generate_one_block  0.5395989418029785
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.03710651397705078
gen group dst list time:  0.02064204216003418
time for parepare:  0.01938652992248535
local_output_nid generation:  0.030164480209350586
local_in_edges_tensor generation:  0.0517573356628418
mini_batch_src_global generation:  0.050508975982666016
r_  generation:  0.5367476940155029
local_output_nid generation:  0.04058194160461426
local_in_edges_tensor generation:  0.05273628234863281
mini_batch_src_global generation:  0.0625467300415039
r_  generation:  0.5474841594696045
local_output_nid generation:  0.04071164131164551
local_in_edges_tensor generation:  0.04444313049316406
mini_batch_src_global generation:  0.06092548370361328
r_  generation:  0.555889368057251
local_output_nid generation:  0.04070568084716797
local_in_edges_tensor generation:  0.035004615783691406
mini_batch_src_global generation:  0.05886197090148926
r_  generation:  0.559229850769043
----------------------check_connections_block total spend ----------------------------- 3.2838244438171387
generate_one_block  0.6920592784881592
generate_one_block  0.7005295753479004
generate_one_block  0.7090010643005371
generate_one_block  0.7048299312591553
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04947018623352051
gen group dst list time:  0.025557279586791992
time for parepare:  0.01983332633972168
local_output_nid generation:  0.03331589698791504
local_in_edges_tensor generation:  0.06291699409484863
mini_batch_src_global generation:  0.05058574676513672
r_  generation:  0.5424036979675293
local_output_nid generation:  0.03743934631347656
local_in_edges_tensor generation:  0.06723713874816895
mini_batch_src_global generation:  0.0635075569152832
r_  generation:  0.5590484142303467
local_output_nid generation:  0.040804386138916016
local_in_edges_tensor generation:  0.0433497428894043
mini_batch_src_global generation:  0.0636751651763916
r_  generation:  0.5438594818115234
local_output_nid generation:  0.03867340087890625
local_in_edges_tensor generation:  0.04088878631591797
mini_batch_src_global generation:  0.06187129020690918
r_  generation:  0.5496203899383545
----------------------check_connections_block total spend ----------------------------- 3.3210089206695557
generate_one_block  0.6777164936065674
generate_one_block  0.705596923828125
generate_one_block  0.6943414211273193
generate_one_block  0.6724834442138672
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.057596445083618164
gen group dst list time:  0.024959802627563477
time for parepare:  0.01871204376220703
local_output_nid generation:  0.03218984603881836
local_in_edges_tensor generation:  0.05434441566467285
mini_batch_src_global generation:  0.04593467712402344
r_  generation:  0.5030002593994141
local_output_nid generation:  0.038452863693237305
local_in_edges_tensor generation:  0.05218315124511719
mini_batch_src_global generation:  0.05791354179382324
r_  generation:  0.5120947360992432
local_output_nid generation:  0.038956642150878906
local_in_edges_tensor generation:  0.04767608642578125
mini_batch_src_global generation:  0.061533212661743164
r_  generation:  0.5099046230316162
local_output_nid generation:  0.03852701187133789
local_in_edges_tensor generation:  0.03716683387756348
mini_batch_src_global generation:  0.05832076072692871
r_  generation:  0.5176501274108887
----------------------check_connections_block total spend ----------------------------- 3.1019060611724854
generate_one_block  0.6540372371673584
generate_one_block  0.6502809524536133
generate_one_block  0.6570737361907959
generate_one_block  0.645932674407959
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0011692047119140625  GigaBytes
Max Memory Allocated: 0.0011692047119140625  GigaBytes

connection checking time:  12.188644409179688
block generation total time  10.36556363105774
average batch blocks generation time:  2.591390907764435
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2225341796875 GB
    Memory Allocated: 0.13048124313354492  GigaBytes
Max Memory Allocated: 0.13048124313354492  GigaBytes

torch.Size([167359, 128])
torch.Size([166824, 64])
torch.Size([164816, 64])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.27 GiB already allocated; 14.44 MiB free; 22.41 GiB reserved in total by PyTorch)
