Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648524352.2624063
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0291748046875 GB
    Memory Allocated: 0.012590885162353516  GigaBytes
Max Memory Allocated: 0.012590885162353516  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.024419546127319336
random selection method range initialization spend 0.006070852279663086
time for parepare:  0.01853013038635254
local_output_nid generation:  0.008405923843383789
local_in_edges_tensor generation:  0.009259700775146484
mini_batch_src_global generation:  0.0065038204193115234
r_  generation:  0.08189916610717773
local_output_nid generation:  0.01160120964050293
local_in_edges_tensor generation:  0.0059871673583984375
mini_batch_src_global generation:  0.008553028106689453
r_  generation:  0.08777284622192383
local_output_nid generation:  0.01173543930053711
local_in_edges_tensor generation:  0.006206035614013672
mini_batch_src_global generation:  0.006742715835571289
r_  generation:  0.08839178085327148
local_output_nid generation:  0.011877775192260742
local_in_edges_tensor generation:  0.006048440933227539
mini_batch_src_global generation:  0.0075418949127197266
r_  generation:  0.09267544746398926
----------------------check_connections_block total spend ----------------------------- 0.5503318309783936
generate_one_block  0.10159063339233398
generate_one_block  0.10218238830566406
generate_one_block  0.10135006904602051
generate_one_block  0.10270476341247559
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.042032480239868164
gen group dst list time:  0.01120305061340332
time for parepare:  0.01873493194580078
local_output_nid generation:  0.019362926483154297
local_in_edges_tensor generation:  0.043041229248046875
mini_batch_src_global generation:  0.04193377494812012
r_  generation:  0.408963680267334
local_output_nid generation:  0.024936676025390625
local_in_edges_tensor generation:  0.04064130783081055
mini_batch_src_global generation:  0.04808163642883301
r_  generation:  0.4172182083129883
local_output_nid generation:  0.02477717399597168
local_in_edges_tensor generation:  0.03340625762939453
mini_batch_src_global generation:  0.051915645599365234
r_  generation:  0.42897820472717285
local_output_nid generation:  0.024752378463745117
local_in_edges_tensor generation:  0.029814481735229492
mini_batch_src_global generation:  0.052083730697631836
r_  generation:  0.422497034072876
----------------------check_connections_block total spend ----------------------------- 2.5014169216156006
generate_one_block  0.578876256942749
generate_one_block  0.5573065280914307
generate_one_block  0.5351078510284424
generate_one_block  0.5454604625701904
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.03588271141052246
gen group dst list time:  0.02055835723876953
time for parepare:  0.01882147789001465
local_output_nid generation:  0.029880046844482422
local_in_edges_tensor generation:  0.04880571365356445
mini_batch_src_global generation:  0.05340123176574707
r_  generation:  0.571580171585083
local_output_nid generation:  0.03638720512390137
local_in_edges_tensor generation:  0.056183576583862305
mini_batch_src_global generation:  0.06357192993164062
r_  generation:  0.5531177520751953
local_output_nid generation:  0.03663325309753418
local_in_edges_tensor generation:  0.04344606399536133
mini_batch_src_global generation:  0.059448957443237305
r_  generation:  0.5637471675872803
local_output_nid generation:  0.040248870849609375
local_in_edges_tensor generation:  0.04076790809631348
mini_batch_src_global generation:  0.0632925033569336
r_  generation:  0.5618312358856201
----------------------check_connections_block total spend ----------------------------- 3.3371775150299072
generate_one_block  0.697577953338623
generate_one_block  0.7092955112457275
generate_one_block  0.6928505897521973
generate_one_block  0.7051408290863037
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.03688955307006836
gen group dst list time:  0.023380041122436523
time for parepare:  0.018820524215698242
local_output_nid generation:  0.03239631652832031
local_in_edges_tensor generation:  0.04521656036376953
mini_batch_src_global generation:  0.055358171463012695
r_  generation:  0.5529241561889648
local_output_nid generation:  0.03863859176635742
local_in_edges_tensor generation:  0.06010794639587402
mini_batch_src_global generation:  0.06447839736938477
r_  generation:  0.567596435546875
local_output_nid generation:  0.03898811340332031
local_in_edges_tensor generation:  0.04663538932800293
mini_batch_src_global generation:  0.06569647789001465
r_  generation:  0.5616908073425293
local_output_nid generation:  0.03891444206237793
local_in_edges_tensor generation:  0.04493069648742676
mini_batch_src_global generation:  0.06437969207763672
r_  generation:  0.5631275177001953
----------------------check_connections_block total spend ----------------------------- 3.3748691082000732
generate_one_block  0.7193372249603271
generate_one_block  0.7343714237213135
generate_one_block  0.6972181797027588
generate_one_block  0.708073616027832
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.029340505599975586
gen group dst list time:  0.023925304412841797
time for parepare:  0.018852710723876953
local_output_nid generation:  0.03288149833679199
local_in_edges_tensor generation:  0.04488682746887207
mini_batch_src_global generation:  0.05026721954345703
r_  generation:  0.546189546585083
local_output_nid generation:  0.03911256790161133
local_in_edges_tensor generation:  0.04088878631591797
mini_batch_src_global generation:  0.06351566314697266
r_  generation:  0.549962043762207
local_output_nid generation:  0.039273738861083984
local_in_edges_tensor generation:  0.0467524528503418
mini_batch_src_global generation:  0.06400680541992188
r_  generation:  0.5659785270690918
local_output_nid generation:  0.039200544357299805
local_in_edges_tensor generation:  0.04170680046081543
mini_batch_src_global generation:  0.06340551376342773
r_  generation:  0.5596814155578613
----------------------check_connections_block total spend ----------------------------- 3.317589282989502
generate_one_block  0.6882302761077881
generate_one_block  0.6993272304534912
generate_one_block  0.702106237411499
generate_one_block  0.7097883224487305
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04809141159057617
gen group dst list time:  0.028301239013671875
time for parepare:  0.018974781036376953
local_output_nid generation:  0.035370588302612305
local_in_edges_tensor generation:  0.04608726501464844
mini_batch_src_global generation:  0.0496063232421875
r_  generation:  0.5120792388916016
local_output_nid generation:  0.03950357437133789
local_in_edges_tensor generation:  0.05254387855529785
mini_batch_src_global generation:  0.05783247947692871
r_  generation:  0.5204532146453857
local_output_nid generation:  0.039446353912353516
local_in_edges_tensor generation:  0.04924774169921875
mini_batch_src_global generation:  0.05869746208190918
r_  generation:  0.519294023513794
local_output_nid generation:  0.03927254676818848
local_in_edges_tensor generation:  0.037630558013916016
mini_batch_src_global generation:  0.05896806716918945
r_  generation:  0.5218355655670166
----------------------check_connections_block total spend ----------------------------- 3.1530210971832275
generate_one_block  0.6468675136566162
generate_one_block  0.6853830814361572
generate_one_block  0.6430854797363281
generate_one_block  0.6374540328979492
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0291748046875 GB
    Memory Allocated: 0.012590885162353516  GigaBytes
Max Memory Allocated: 0.012590885162353516  GigaBytes

connection checking time:  15.68407392501831
block generation total time  13.292858600616455
average batch blocks generation time:  3.3232146501541138
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2537841796875 GB
    Memory Allocated: 0.15479803085327148  GigaBytes
Max Memory Allocated: 0.15479803085327148  GigaBytes

torch.Size([167768, 128])
torch.Size([167525, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 50.00 MiB (GPU 0; 23.62 GiB total capacity; 21.91 GiB already allocated; 32.44 MiB free; 22.39 GiB reserved in total by PyTorch)
