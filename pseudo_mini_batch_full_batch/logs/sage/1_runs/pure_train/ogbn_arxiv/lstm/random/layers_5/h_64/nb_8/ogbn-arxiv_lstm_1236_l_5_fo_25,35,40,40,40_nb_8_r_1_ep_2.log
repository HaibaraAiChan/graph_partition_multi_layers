Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648502385.2722108
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0011692047119140625  GigaBytes
Max Memory Allocated: 0.0011692047119140625  GigaBytes

The real block id is  4
get_global_graph_edges_ids_block function  spend 0.024824857711791992
random selection method range initialization spend 0.006371974945068359
time for parepare:  0.01862049102783203
local_output_nid generation:  0.004233837127685547
local_in_edges_tensor generation:  0.00620579719543457
mini_batch_src_global generation:  0.0032520294189453125
r_  generation:  0.037604331970214844
local_output_nid generation:  0.005761623382568359
local_in_edges_tensor generation:  0.003175020217895508
mini_batch_src_global generation:  0.004275321960449219
r_  generation:  0.038634300231933594
local_output_nid generation:  0.0060079097747802734
local_in_edges_tensor generation:  0.003298044204711914
mini_batch_src_global generation:  0.002829313278198242
r_  generation:  0.03888273239135742
local_output_nid generation:  0.0060307979583740234
local_in_edges_tensor generation:  0.0031960010528564453
mini_batch_src_global generation:  0.003016233444213867
r_  generation:  0.04009127616882324
local_output_nid generation:  0.006048679351806641
local_in_edges_tensor generation:  0.0032227039337158203
mini_batch_src_global generation:  0.002981901168823242
r_  generation:  0.040488243103027344
local_output_nid generation:  0.006079673767089844
local_in_edges_tensor generation:  0.0032396316528320312
mini_batch_src_global generation:  0.0032122135162353516
r_  generation:  0.041136741638183594
local_output_nid generation:  0.006067037582397461
local_in_edges_tensor generation:  0.003165006637573242
mini_batch_src_global generation:  0.0031507015228271484
r_  generation:  0.04013514518737793
local_output_nid generation:  0.0060672760009765625
local_in_edges_tensor generation:  0.0031359195709228516
mini_batch_src_global generation:  0.003422975540161133
r_  generation:  0.041506052017211914
----------------------check_connections_block total spend ----------------------------- 0.514535665512085
generate_one_block  0.054646968841552734
generate_one_block  0.055883169174194336
generate_one_block  0.05491232872009277
generate_one_block  0.05534219741821289
generate_one_block  0.058104515075683594
generate_one_block  0.055082082748413086
generate_one_block  0.05427289009094238
generate_one_block  0.05539727210998535
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.04207181930541992
gen group dst list time:  0.01552891731262207
time for parepare:  0.019193649291992188
local_output_nid generation:  0.013125896453857422
local_in_edges_tensor generation:  0.03458547592163086
mini_batch_src_global generation:  0.031175613403320312
r_  generation:  0.2969202995300293
local_output_nid generation:  0.01828455924987793
local_in_edges_tensor generation:  0.0316624641418457
mini_batch_src_global generation:  0.036641836166381836
r_  generation:  0.3107788562774658
local_output_nid generation:  0.01819634437561035
local_in_edges_tensor generation:  0.025856494903564453
mini_batch_src_global generation:  0.03547930717468262
r_  generation:  0.3087148666381836
local_output_nid generation:  0.018010854721069336
local_in_edges_tensor generation:  0.023168325424194336
mini_batch_src_global generation:  0.039022207260131836
r_  generation:  0.31856489181518555
local_output_nid generation:  0.01806807518005371
local_in_edges_tensor generation:  0.020646333694458008
mini_batch_src_global generation:  0.03803420066833496
r_  generation:  0.31513118743896484
local_output_nid generation:  0.018178224563598633
local_in_edges_tensor generation:  0.022708415985107422
mini_batch_src_global generation:  0.040242671966552734
r_  generation:  0.3227109909057617
local_output_nid generation:  0.01799631118774414
local_in_edges_tensor generation:  0.020601987838745117
mini_batch_src_global generation:  0.03846406936645508
r_  generation:  0.3163731098175049
local_output_nid generation:  0.018329381942749023
local_in_edges_tensor generation:  0.02797675132751465
mini_batch_src_global generation:  0.03824281692504883
r_  generation:  0.3220188617706299
----------------------check_connections_block total spend ----------------------------- 3.714367628097534
generate_one_block  0.40377283096313477
generate_one_block  0.4168431758880615
generate_one_block  0.4054436683654785
generate_one_block  0.40384483337402344
generate_one_block  0.4008491039276123
generate_one_block  0.4141669273376465
generate_one_block  0.40689659118652344
generate_one_block  0.419677734375
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.03682756423950195
gen group dst list time:  0.03666329383850098
time for parepare:  0.01884150505065918
local_output_nid generation:  0.02870321273803711
local_in_edges_tensor generation:  0.05028390884399414
mini_batch_src_global generation:  0.052828311920166016
r_  generation:  0.5231208801269531
local_output_nid generation:  0.0344083309173584
local_in_edges_tensor generation:  0.0538485050201416
mini_batch_src_global generation:  0.06094050407409668
r_  generation:  0.526669979095459
local_output_nid generation:  0.03463411331176758
local_in_edges_tensor generation:  0.04968690872192383
mini_batch_src_global generation:  0.0566105842590332
r_  generation:  0.5434877872467041
local_output_nid generation:  0.034630537033081055
local_in_edges_tensor generation:  0.03984713554382324
mini_batch_src_global generation:  0.0610048770904541
r_  generation:  0.5382938385009766
local_output_nid generation:  0.035160064697265625
local_in_edges_tensor generation:  0.040508270263671875
mini_batch_src_global generation:  0.0640866756439209
r_  generation:  0.551887035369873
local_output_nid generation:  0.0351712703704834
local_in_edges_tensor generation:  0.05256152153015137
mini_batch_src_global generation:  0.0652163028717041
r_  generation:  0.5426821708679199
local_output_nid generation:  0.036128997802734375
local_in_edges_tensor generation:  0.03635883331298828
mini_batch_src_global generation:  0.05948209762573242
r_  generation:  0.5465857982635498
local_output_nid generation:  0.03819680213928223
local_in_edges_tensor generation:  0.04943561553955078
mini_batch_src_global generation:  0.06390953063964844
r_  generation:  0.5325391292572021
----------------------check_connections_block total spend ----------------------------- 6.401215076446533
generate_one_block  0.6905736923217773
generate_one_block  0.6865284442901611
generate_one_block  0.6845710277557373
generate_one_block  0.6798920631408691
generate_one_block  0.6940991878509521
generate_one_block  0.6897361278533936
generate_one_block  0.7054188251495361
generate_one_block  0.6798419952392578
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.051993608474731445
gen group dst list time:  0.04614591598510742
time for parepare:  0.01886892318725586
local_output_nid generation:  0.03394889831542969
local_in_edges_tensor generation:  0.06821322441101074
mini_batch_src_global generation:  0.050299882888793945
r_  generation:  0.5470902919769287
local_output_nid generation:  0.03895878791809082
local_in_edges_tensor generation:  0.05670166015625
mini_batch_src_global generation:  0.06532955169677734
r_  generation:  0.5431258678436279
local_output_nid generation:  0.038553476333618164
local_in_edges_tensor generation:  0.05284595489501953
mini_batch_src_global generation:  0.06504225730895996
r_  generation:  0.5434494018554688
local_output_nid generation:  0.03993535041809082
local_in_edges_tensor generation:  0.04835772514343262
mini_batch_src_global generation:  0.06056475639343262
r_  generation:  0.5665481090545654
local_output_nid generation:  0.042677879333496094
local_in_edges_tensor generation:  0.05218338966369629
mini_batch_src_global generation:  0.06813406944274902
r_  generation:  0.5491342544555664
local_output_nid generation:  0.039964914321899414
local_in_edges_tensor generation:  0.04459857940673828
mini_batch_src_global generation:  0.060811758041381836
r_  generation:  0.553654670715332
local_output_nid generation:  0.039774417877197266
local_in_edges_tensor generation:  0.03951430320739746
mini_batch_src_global generation:  0.06245923042297363
r_  generation:  0.5560705661773682
local_output_nid generation:  0.03988337516784668
local_in_edges_tensor generation:  0.03896045684814453
mini_batch_src_global generation:  0.05882000923156738
r_  generation:  0.558372974395752
----------------------check_connections_block total spend ----------------------------- 6.652101278305054
generate_one_block  0.6929645538330078
generate_one_block  0.6903767585754395
generate_one_block  0.7302520275115967
generate_one_block  0.687631368637085
generate_one_block  0.6959776878356934
generate_one_block  0.6900680065155029
generate_one_block  0.7489874362945557
generate_one_block  0.6768980026245117
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.047289371490478516
gen group dst list time:  0.0520627498626709
time for parepare:  0.019971609115600586
local_output_nid generation:  0.037384986877441406
local_in_edges_tensor generation:  0.05488133430480957
mini_batch_src_global generation:  0.04522824287414551
r_  generation:  0.5005800724029541
local_output_nid generation:  0.0411834716796875
local_in_edges_tensor generation:  0.03620195388793945
mini_batch_src_global generation:  0.056290626525878906
r_  generation:  0.5077970027923584
local_output_nid generation:  0.04148364067077637
local_in_edges_tensor generation:  0.04147648811340332
mini_batch_src_global generation:  0.057598114013671875
r_  generation:  0.5221385955810547
local_output_nid generation:  0.041089534759521484
local_in_edges_tensor generation:  0.04679512977600098
mini_batch_src_global generation:  0.06479883193969727
r_  generation:  0.5073671340942383
local_output_nid generation:  0.04063296318054199
local_in_edges_tensor generation:  0.04153180122375488
mini_batch_src_global generation:  0.057503700256347656
r_  generation:  0.5120866298675537
local_output_nid generation:  0.04321599006652832
local_in_edges_tensor generation:  0.042105674743652344
mini_batch_src_global generation:  0.05765652656555176
r_  generation:  0.5193734169006348
local_output_nid generation:  0.04158139228820801
local_in_edges_tensor generation:  0.03967118263244629
mini_batch_src_global generation:  0.05738425254821777
r_  generation:  0.5114154815673828
local_output_nid generation:  0.04166436195373535
local_in_edges_tensor generation:  0.04578828811645508
mini_batch_src_global generation:  0.056806325912475586
r_  generation:  0.5181405544281006
----------------------check_connections_block total spend ----------------------------- 6.193209171295166
generate_one_block  0.6373286247253418
generate_one_block  0.644136905670166
generate_one_block  0.6657137870788574
generate_one_block  0.6355130672454834
generate_one_block  0.6608867645263672
generate_one_block  0.6529965400695801
generate_one_block  0.6283919811248779
generate_one_block  0.6948018074035645
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0011692047119140625  GigaBytes
Max Memory Allocated: 0.0011692047119140625  GigaBytes

connection checking time:  22.960893154144287
block generation total time  19.615081548690796
average batch blocks generation time:  2.4518851935863495
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2225341796875 GB
    Memory Allocated: 0.1269688606262207  GigaBytes
Max Memory Allocated: 0.1269688606262207  GigaBytes

torch.Size([167038, 128])
torch.Size([165813, 64])
torch.Size([161409, 64])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 23.62 GiB total capacity; 22.27 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
