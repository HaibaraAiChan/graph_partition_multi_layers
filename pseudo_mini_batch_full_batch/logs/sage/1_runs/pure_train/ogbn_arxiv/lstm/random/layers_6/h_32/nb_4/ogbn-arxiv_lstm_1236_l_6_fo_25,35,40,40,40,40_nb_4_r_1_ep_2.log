Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648521233.7949398
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007319450378417969  GigaBytes
Max Memory Allocated: 0.0007319450378417969  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.024405717849731445
random selection method range initialization spend 0.006436347961425781
time for parepare:  0.018484115600585938
local_output_nid generation:  0.008491754531860352
local_in_edges_tensor generation:  0.008978605270385742
mini_batch_src_global generation:  0.0066220760345458984
r_  generation:  0.08300566673278809
local_output_nid generation:  0.011948585510253906
local_in_edges_tensor generation:  0.006011962890625
mini_batch_src_global generation:  0.008542060852050781
r_  generation:  0.08817458152770996
local_output_nid generation:  0.012035131454467773
local_in_edges_tensor generation:  0.006194114685058594
mini_batch_src_global generation:  0.006651401519775391
r_  generation:  0.0880577564239502
local_output_nid generation:  0.012027978897094727
local_in_edges_tensor generation:  0.006055355072021484
mini_batch_src_global generation:  0.0073740482330322266
r_  generation:  0.09237265586853027
----------------------check_connections_block total spend ----------------------------- 0.5516939163208008
generate_one_block  0.10277462005615234
generate_one_block  0.10201621055603027
generate_one_block  0.10218667984008789
generate_one_block  0.10189461708068848
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.041045427322387695
gen group dst list time:  0.011132478713989258
time for parepare:  0.019103288650512695
local_output_nid generation:  0.019009113311767578
local_in_edges_tensor generation:  0.046174049377441406
mini_batch_src_global generation:  0.039763689041137695
r_  generation:  0.40837597846984863
local_output_nid generation:  0.0252840518951416
local_in_edges_tensor generation:  0.04310297966003418
mini_batch_src_global generation:  0.04865097999572754
r_  generation:  0.4180159568786621
local_output_nid generation:  0.025327444076538086
local_in_edges_tensor generation:  0.036135196685791016
mini_batch_src_global generation:  0.04889225959777832
r_  generation:  0.4239833354949951
local_output_nid generation:  0.02505779266357422
local_in_edges_tensor generation:  0.028661012649536133
mini_batch_src_global generation:  0.05081439018249512
r_  generation:  0.4219787120819092
----------------------check_connections_block total spend ----------------------------- 2.5084688663482666
generate_one_block  0.5608599185943604
generate_one_block  0.5476119518280029
generate_one_block  0.5420448780059814
generate_one_block  0.5290052890777588
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.03776097297668457
gen group dst list time:  0.02061295509338379
time for parepare:  0.01911330223083496
local_output_nid generation:  0.030227184295654297
local_in_edges_tensor generation:  0.05365872383117676
mini_batch_src_global generation:  0.05644392967224121
r_  generation:  0.5394411087036133
local_output_nid generation:  0.0366511344909668
local_in_edges_tensor generation:  0.05925917625427246
mini_batch_src_global generation:  0.06399178504943848
r_  generation:  0.5407395362854004
local_output_nid generation:  0.036611318588256836
local_in_edges_tensor generation:  0.054305076599121094
mini_batch_src_global generation:  0.05823564529418945
r_  generation:  0.556957483291626
local_output_nid generation:  0.03685164451599121
local_in_edges_tensor generation:  0.04460573196411133
mini_batch_src_global generation:  0.06007528305053711
r_  generation:  0.5552289485931396
----------------------check_connections_block total spend ----------------------------- 3.291849136352539
generate_one_block  0.6873342990875244
generate_one_block  0.698004961013794
generate_one_block  0.703784704208374
generate_one_block  0.692814826965332
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.036572933197021484
gen group dst list time:  0.02344679832458496
time for parepare:  0.018866539001464844
local_output_nid generation:  0.0323939323425293
local_in_edges_tensor generation:  0.04510378837585449
mini_batch_src_global generation:  0.056555747985839844
r_  generation:  0.5571746826171875
local_output_nid generation:  0.0387425422668457
local_in_edges_tensor generation:  0.05854392051696777
mini_batch_src_global generation:  0.0646967887878418
r_  generation:  0.5545132160186768
local_output_nid generation:  0.038832902908325195
local_in_edges_tensor generation:  0.050076961517333984
mini_batch_src_global generation:  0.0656886100769043
r_  generation:  0.5684103965759277
local_output_nid generation:  0.03895092010498047
local_in_edges_tensor generation:  0.0448613166809082
mini_batch_src_global generation:  0.06444263458251953
r_  generation:  0.561617374420166
----------------------check_connections_block total spend ----------------------------- 3.375811815261841
generate_one_block  0.7162606716156006
generate_one_block  0.7359716892242432
generate_one_block  0.7147207260131836
generate_one_block  0.702190637588501
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.030396699905395508
gen group dst list time:  0.02410745620727539
time for parepare:  0.018856525421142578
local_output_nid generation:  0.03289985656738281
local_in_edges_tensor generation:  0.04602169990539551
mini_batch_src_global generation:  0.05555558204650879
r_  generation:  0.5471813678741455
local_output_nid generation:  0.03933429718017578
local_in_edges_tensor generation:  0.03871345520019531
mini_batch_src_global generation:  0.06453561782836914
r_  generation:  0.5444152355194092
local_output_nid generation:  0.039278507232666016
local_in_edges_tensor generation:  0.03949284553527832
mini_batch_src_global generation:  0.06584429740905762
r_  generation:  0.5589487552642822
local_output_nid generation:  0.03880500793457031
local_in_edges_tensor generation:  0.04352879524230957
mini_batch_src_global generation:  0.06397819519042969
r_  generation:  0.5550453662872314
----------------------check_connections_block total spend ----------------------------- 3.312906503677368
generate_one_block  0.6854732036590576
generate_one_block  0.7023606300354004
generate_one_block  0.7006814479827881
generate_one_block  0.6862039566040039
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03315567970275879
gen group dst list time:  0.028872966766357422
time for parepare:  0.021122455596923828
local_output_nid generation:  0.03593277931213379
local_in_edges_tensor generation:  0.06532168388366699
mini_batch_src_global generation:  0.04971647262573242
r_  generation:  0.508415699005127
local_output_nid generation:  0.039669036865234375
local_in_edges_tensor generation:  0.05247950553894043
mini_batch_src_global generation:  0.05932927131652832
r_  generation:  0.5104489326477051
local_output_nid generation:  0.039995431900024414
local_in_edges_tensor generation:  0.04825925827026367
mini_batch_src_global generation:  0.06264710426330566
r_  generation:  0.516272783279419
local_output_nid generation:  0.04009699821472168
local_in_edges_tensor generation:  0.05064868927001953
mini_batch_src_global generation:  0.05995750427246094
r_  generation:  0.5110349655151367
----------------------check_connections_block total spend ----------------------------- 3.165151357650757
generate_one_block  0.651669979095459
generate_one_block  0.6860873699188232
generate_one_block  0.6470105648040771
generate_one_block  0.6422755718231201
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007319450378417969  GigaBytes
Max Memory Allocated: 0.0007319450378417969  GigaBytes

connection checking time:  15.654187679290771
block generation total time  13.232367277145386
average batch blocks generation time:  3.3080918192863464
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2420654296875 GB
    Memory Allocated: 0.1429734230041504  GigaBytes
Max Memory Allocated: 0.1429734230041504  GigaBytes

torch.Size([167758, 128])
torch.Size([167542, 32])
torch.Size([166872, 32])
torch.Size([164788, 32])
torch.Size([155003, 32])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.35 GiB already allocated; 14.44 MiB free; 22.41 GiB reserved in total by PyTorch)
