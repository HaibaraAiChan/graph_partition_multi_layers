Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648524392.4402792
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0291748046875 GB
    Memory Allocated: 0.012590885162353516  GigaBytes
Max Memory Allocated: 0.012590885162353516  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.02489948272705078
random selection method range initialization spend 0.006053924560546875
time for parepare:  0.0184478759765625
local_output_nid generation:  0.00421905517578125
local_in_edges_tensor generation:  0.006124258041381836
mini_batch_src_global generation:  0.0032608509063720703
r_  generation:  0.037126779556274414
local_output_nid generation:  0.005666971206665039
local_in_edges_tensor generation:  0.003223896026611328
mini_batch_src_global generation:  0.004157543182373047
r_  generation:  0.038919925689697266
local_output_nid generation:  0.0060389041900634766
local_in_edges_tensor generation:  0.0031931400299072266
mini_batch_src_global generation:  0.0027997493743896484
r_  generation:  0.03881263732910156
local_output_nid generation:  0.006015300750732422
local_in_edges_tensor generation:  0.0031805038452148438
mini_batch_src_global generation:  0.0030221939086914062
r_  generation:  0.040215492248535156
local_output_nid generation:  0.0060350894927978516
local_in_edges_tensor generation:  0.003268003463745117
mini_batch_src_global generation:  0.0030736923217773438
r_  generation:  0.04007077217102051
local_output_nid generation:  0.006055355072021484
local_in_edges_tensor generation:  0.0032150745391845703
mini_batch_src_global generation:  0.003186941146850586
r_  generation:  0.040407657623291016
local_output_nid generation:  0.006009101867675781
local_in_edges_tensor generation:  0.0031816959381103516
mini_batch_src_global generation:  0.0068852901458740234
r_  generation:  0.04102921485900879
local_output_nid generation:  0.0060272216796875
local_in_edges_tensor generation:  0.003246784210205078
mini_batch_src_global generation:  0.0034456253051757812
r_  generation:  0.041336774826049805
----------------------check_connections_block total spend ----------------------------- 0.5169601440429688
generate_one_block  0.0544285774230957
generate_one_block  0.05469965934753418
generate_one_block  0.0551450252532959
generate_one_block  0.05550122261047363
generate_one_block  0.05828380584716797
generate_one_block  0.05484294891357422
generate_one_block  0.05509614944458008
generate_one_block  0.05536818504333496
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.04144644737243652
gen group dst list time:  0.015142679214477539
time for parepare:  0.019416093826293945
local_output_nid generation:  0.013702154159545898
local_in_edges_tensor generation:  0.0336916446685791
mini_batch_src_global generation:  0.029079437255859375
r_  generation:  0.2985217571258545
local_output_nid generation:  0.021370649337768555
local_in_edges_tensor generation:  0.02965688705444336
mini_batch_src_global generation:  0.03963661193847656
r_  generation:  0.2999415397644043
local_output_nid generation:  0.021518945693969727
local_in_edges_tensor generation:  0.024782419204711914
mini_batch_src_global generation:  0.03587508201599121
r_  generation:  0.30673718452453613
local_output_nid generation:  0.02200031280517578
local_in_edges_tensor generation:  0.022141218185424805
mini_batch_src_global generation:  0.037789106369018555
r_  generation:  0.3158457279205322
local_output_nid generation:  0.021688461303710938
local_in_edges_tensor generation:  0.021485328674316406
mini_batch_src_global generation:  0.03846931457519531
r_  generation:  0.32254648208618164
local_output_nid generation:  0.021303415298461914
local_in_edges_tensor generation:  0.01927042007446289
mini_batch_src_global generation:  0.03826546669006348
r_  generation:  0.3141508102416992
local_output_nid generation:  0.02142333984375
local_in_edges_tensor generation:  0.024567127227783203
mini_batch_src_global generation:  0.03830599784851074
r_  generation:  0.3206820487976074
local_output_nid generation:  0.021582841873168945
local_in_edges_tensor generation:  0.02173137664794922
mini_batch_src_global generation:  0.03906393051147461
r_  generation:  0.32183194160461426
----------------------check_connections_block total spend ----------------------------- 3.7280595302581787
generate_one_block  0.42067408561706543
generate_one_block  0.4034762382507324
generate_one_block  0.4094693660736084
generate_one_block  0.4240849018096924
generate_one_block  0.40038633346557617
generate_one_block  0.4192652702331543
generate_one_block  0.4216001033782959
generate_one_block  0.4097001552581787
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.03675723075866699
gen group dst list time:  0.035767316818237305
time for parepare:  0.019580841064453125
local_output_nid generation:  0.027990102767944336
local_in_edges_tensor generation:  0.04671287536621094
mini_batch_src_global generation:  0.050638675689697266
r_  generation:  0.5192809104919434
local_output_nid generation:  0.03449654579162598
local_in_edges_tensor generation:  0.05549025535583496
mini_batch_src_global generation:  0.06080341339111328
r_  generation:  0.5227689743041992
local_output_nid generation:  0.0346372127532959
local_in_edges_tensor generation:  0.04173707962036133
mini_batch_src_global generation:  0.06109046936035156
r_  generation:  0.5360143184661865
local_output_nid generation:  0.03493928909301758
local_in_edges_tensor generation:  0.04668879508972168
mini_batch_src_global generation:  0.06502890586853027
r_  generation:  0.5312535762786865
local_output_nid generation:  0.03469204902648926
local_in_edges_tensor generation:  0.0364987850189209
mini_batch_src_global generation:  0.059807777404785156
r_  generation:  0.5406126976013184
local_output_nid generation:  0.03445577621459961
local_in_edges_tensor generation:  0.03642106056213379
mini_batch_src_global generation:  0.06294751167297363
r_  generation:  0.537449836730957
local_output_nid generation:  0.03463172912597656
local_in_edges_tensor generation:  0.04535627365112305
mini_batch_src_global generation:  0.06358146667480469
r_  generation:  0.5506131649017334
local_output_nid generation:  0.0348055362701416
local_in_edges_tensor generation:  0.03655815124511719
mini_batch_src_global generation:  0.06310296058654785
r_  generation:  0.5317907333374023
----------------------check_connections_block total spend ----------------------------- 6.315517902374268
generate_one_block  0.6738219261169434
generate_one_block  0.6891610622406006
generate_one_block  0.678438663482666
generate_one_block  0.7061107158660889
generate_one_block  0.6726319789886475
generate_one_block  0.6659998893737793
generate_one_block  0.7177286148071289
generate_one_block  0.678619384765625
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.03794431686401367
gen group dst list time:  0.046585798263549805
time for parepare:  0.018819570541381836
local_output_nid generation:  0.03331923484802246
local_in_edges_tensor generation:  0.04838395118713379
mini_batch_src_global generation:  0.051750898361206055
r_  generation:  0.5404956340789795
local_output_nid generation:  0.03866744041442871
local_in_edges_tensor generation:  0.05683541297912598
mini_batch_src_global generation:  0.06417584419250488
r_  generation:  0.5493898391723633
local_output_nid generation:  0.038498878479003906
local_in_edges_tensor generation:  0.04292917251586914
mini_batch_src_global generation:  0.06336402893066406
r_  generation:  0.5512306690216064
local_output_nid generation:  0.038626909255981445
local_in_edges_tensor generation:  0.047937631607055664
mini_batch_src_global generation:  0.05949997901916504
r_  generation:  0.5629785060882568
local_output_nid generation:  0.038573265075683594
local_in_edges_tensor generation:  0.05220317840576172
mini_batch_src_global generation:  0.060170650482177734
r_  generation:  0.5562844276428223
local_output_nid generation:  0.03819441795349121
local_in_edges_tensor generation:  0.03769850730895996
mini_batch_src_global generation:  0.0595400333404541
r_  generation:  0.5641770362854004
local_output_nid generation:  0.03876614570617676
local_in_edges_tensor generation:  0.037935733795166016
mini_batch_src_global generation:  0.06376004219055176
r_  generation:  0.5636281967163086
local_output_nid generation:  0.03839564323425293
local_in_edges_tensor generation:  0.05251431465148926
mini_batch_src_global generation:  0.06244468688964844
r_  generation:  0.5686936378479004
----------------------check_connections_block total spend ----------------------------- 6.65017294883728
generate_one_block  0.6959517002105713
generate_one_block  0.706045389175415
generate_one_block  0.6975321769714355
generate_one_block  0.7020218372344971
generate_one_block  0.7323966026306152
generate_one_block  0.6914620399475098
generate_one_block  0.7387828826904297
generate_one_block  0.7086770534515381
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04139423370361328
gen group dst list time:  0.04676103591918945
time for parepare:  0.01891946792602539
local_output_nid generation:  0.03571009635925293
local_in_edges_tensor generation:  0.04854869842529297
mini_batch_src_global generation:  0.04920053482055664
r_  generation:  0.5378990173339844
local_output_nid generation:  0.0397796630859375
local_in_edges_tensor generation:  0.06838583946228027
mini_batch_src_global generation:  0.06743144989013672
r_  generation:  0.5373177528381348
local_output_nid generation:  0.03957843780517578
local_in_edges_tensor generation:  0.04225420951843262
mini_batch_src_global generation:  0.06300806999206543
r_  generation:  0.5397074222564697
local_output_nid generation:  0.03953981399536133
local_in_edges_tensor generation:  0.0447080135345459
mini_batch_src_global generation:  0.07532930374145508
r_  generation:  0.5430247783660889
local_output_nid generation:  0.039592742919921875
local_in_edges_tensor generation:  0.050035953521728516
mini_batch_src_global generation:  0.06262540817260742
r_  generation:  0.5416975021362305
local_output_nid generation:  0.03960299491882324
local_in_edges_tensor generation:  0.03973054885864258
mini_batch_src_global generation:  0.061473846435546875
r_  generation:  0.5633325576782227
local_output_nid generation:  0.040248870849609375
local_in_edges_tensor generation:  0.047446250915527344
mini_batch_src_global generation:  0.06222701072692871
r_  generation:  0.5467407703399658
local_output_nid generation:  0.03959393501281738
local_in_edges_tensor generation:  0.04715466499328613
mini_batch_src_global generation:  0.06129026412963867
r_  generation:  0.5509049892425537
----------------------check_connections_block total spend ----------------------------- 6.595471143722534
generate_one_block  0.6833205223083496
generate_one_block  0.6990203857421875
generate_one_block  0.6816573143005371
generate_one_block  0.6995227336883545
generate_one_block  0.698458194732666
generate_one_block  0.6817624568939209
generate_one_block  0.6924707889556885
generate_one_block  0.746896505355835
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04530501365661621
gen group dst list time:  0.04824233055114746
time for parepare:  0.018886327743530273
local_output_nid generation:  0.03569531440734863
local_in_edges_tensor generation:  0.060838937759399414
mini_batch_src_global generation:  0.04875469207763672
r_  generation:  0.5018019676208496
local_output_nid generation:  0.04242086410522461
local_in_edges_tensor generation:  0.04033637046813965
mini_batch_src_global generation:  0.06235504150390625
r_  generation:  0.5087552070617676
local_output_nid generation:  0.04043292999267578
local_in_edges_tensor generation:  0.04567694664001465
mini_batch_src_global generation:  0.05806756019592285
r_  generation:  0.5061092376708984
local_output_nid generation:  0.040289878845214844
local_in_edges_tensor generation:  0.04028630256652832
mini_batch_src_global generation:  0.058196306228637695
r_  generation:  0.5091488361358643
local_output_nid generation:  0.04038858413696289
local_in_edges_tensor generation:  0.04275941848754883
mini_batch_src_global generation:  0.058428287506103516
r_  generation:  0.5097134113311768
local_output_nid generation:  0.04018235206604004
local_in_edges_tensor generation:  0.04255223274230957
mini_batch_src_global generation:  0.058364152908325195
r_  generation:  0.5055644512176514
local_output_nid generation:  0.04013514518737793
local_in_edges_tensor generation:  0.04460763931274414
mini_batch_src_global generation:  0.05872392654418945
r_  generation:  0.5081174373626709
local_output_nid generation:  0.04031538963317871
local_in_edges_tensor generation:  0.04728436470031738
mini_batch_src_global generation:  0.05788278579711914
r_  generation:  0.510504961013794
----------------------check_connections_block total spend ----------------------------- 6.184008836746216
generate_one_block  0.6436021327972412
generate_one_block  0.6433582305908203
generate_one_block  0.640385627746582
generate_one_block  0.645514726638794
generate_one_block  0.6553864479064941
generate_one_block  0.6435537338256836
generate_one_block  0.641911506652832
generate_one_block  0.6471021175384521
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0291748046875 GB
    Memory Allocated: 0.012590885162353516  GigaBytes
Max Memory Allocated: 0.012590885162353516  GigaBytes

connection checking time:  29.473230361938477
block generation total time  25.207961797714233
average batch blocks generation time:  3.150995224714279
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2518310546875 GB
    Memory Allocated: 0.15113449096679688  GigaBytes
Max Memory Allocated: 0.15113449096679688  GigaBytes

torch.Size([167515, 128])
torch.Size([167022, 256])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 18.00 MiB (GPU 0; 23.62 GiB total capacity; 21.92 GiB already allocated; 16.44 MiB free; 22.41 GiB reserved in total by PyTorch)
