Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648521274.7367408
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007319450378417969  GigaBytes
Max Memory Allocated: 0.0007319450378417969  GigaBytes

The real block id is  5
get_global_graph_edges_ids_block function  spend 0.024881839752197266
random selection method range initialization spend 0.006138324737548828
time for parepare:  0.018590211868286133
local_output_nid generation:  0.004186153411865234
local_in_edges_tensor generation:  0.006217241287231445
mini_batch_src_global generation:  0.0033462047576904297
r_  generation:  0.03766155242919922
local_output_nid generation:  0.005772590637207031
local_in_edges_tensor generation:  0.0030853748321533203
mini_batch_src_global generation:  0.004240989685058594
r_  generation:  0.03864026069641113
local_output_nid generation:  0.0060350894927978516
local_in_edges_tensor generation:  0.003077268600463867
mini_batch_src_global generation:  0.002780437469482422
r_  generation:  0.03816390037536621
local_output_nid generation:  0.006011009216308594
local_in_edges_tensor generation:  0.003087759017944336
mini_batch_src_global generation:  0.002905607223510742
r_  generation:  0.03981590270996094
local_output_nid generation:  0.006025791168212891
local_in_edges_tensor generation:  0.003002166748046875
mini_batch_src_global generation:  0.003044605255126953
r_  generation:  0.04044175148010254
local_output_nid generation:  0.006065845489501953
local_in_edges_tensor generation:  0.00312042236328125
mini_batch_src_global generation:  0.0032868385314941406
r_  generation:  0.04061436653137207
local_output_nid generation:  0.006017208099365234
local_in_edges_tensor generation:  0.0029675960540771484
mini_batch_src_global generation:  0.003295421600341797
r_  generation:  0.041104793548583984
local_output_nid generation:  0.005999326705932617
local_in_edges_tensor generation:  0.003194570541381836
mini_batch_src_global generation:  0.0033082962036132812
r_  generation:  0.04050445556640625
----------------------check_connections_block total spend ----------------------------- 0.5118513107299805
generate_one_block  0.054808616638183594
generate_one_block  0.055001258850097656
generate_one_block  0.054998159408569336
generate_one_block  0.05526256561279297
generate_one_block  0.05890297889709473
generate_one_block  0.0551457405090332
generate_one_block  0.05508255958557129
generate_one_block  0.05544471740722656
The real block id is  4
get_global_graph_edges_ids_block function  spend 0.03991413116455078
gen group dst list time:  0.015401363372802734
time for parepare:  0.0195767879486084
local_output_nid generation:  0.013389110565185547
local_in_edges_tensor generation:  0.03350639343261719
mini_batch_src_global generation:  0.02885127067565918
r_  generation:  0.2924647331237793
local_output_nid generation:  0.021472930908203125
local_in_edges_tensor generation:  0.030498981475830078
mini_batch_src_global generation:  0.03915143013000488
r_  generation:  0.3052370548248291
local_output_nid generation:  0.021423816680908203
local_in_edges_tensor generation:  0.022373676300048828
mini_batch_src_global generation:  0.03595280647277832
r_  generation:  0.3064734935760498
local_output_nid generation:  0.021604061126708984
local_in_edges_tensor generation:  0.024712800979614258
mini_batch_src_global generation:  0.03818869590759277
r_  generation:  0.3135521411895752
local_output_nid generation:  0.021312475204467773
local_in_edges_tensor generation:  0.025084257125854492
mini_batch_src_global generation:  0.03857111930847168
r_  generation:  0.31417107582092285
local_output_nid generation:  0.021427631378173828
local_in_edges_tensor generation:  0.02216625213623047
mini_batch_src_global generation:  0.04104018211364746
r_  generation:  0.3143167495727539
local_output_nid generation:  0.021362781524658203
local_in_edges_tensor generation:  0.019449234008789062
mini_batch_src_global generation:  0.038217782974243164
r_  generation:  0.3136115074157715
local_output_nid generation:  0.021467924118041992
local_in_edges_tensor generation:  0.02148723602294922
mini_batch_src_global generation:  0.03868675231933594
r_  generation:  0.3164999485015869
----------------------check_connections_block total spend ----------------------------- 3.6940245628356934
generate_one_block  0.4172999858856201
generate_one_block  0.4172859191894531
generate_one_block  0.39899778366088867
generate_one_block  0.41469335556030273
generate_one_block  0.41051721572875977
generate_one_block  0.4333775043487549
generate_one_block  0.4025139808654785
generate_one_block  0.40405750274658203
The real block id is  3
get_global_graph_edges_ids_block function  spend 0.03993034362792969
gen group dst list time:  0.0359034538269043
time for parepare:  0.019224882125854492
local_output_nid generation:  0.027292490005493164
local_in_edges_tensor generation:  0.04600262641906738
mini_batch_src_global generation:  0.05403447151184082
r_  generation:  0.525489330291748
local_output_nid generation:  0.03417515754699707
local_in_edges_tensor generation:  0.05345416069030762
mini_batch_src_global generation:  0.061157941818237305
r_  generation:  0.5277204513549805
local_output_nid generation:  0.03449106216430664
local_in_edges_tensor generation:  0.038405656814575195
mini_batch_src_global generation:  0.05764579772949219
r_  generation:  0.5371279716491699
local_output_nid generation:  0.0343775749206543
local_in_edges_tensor generation:  0.04657626152038574
mini_batch_src_global generation:  0.06066107749938965
r_  generation:  0.530219554901123
local_output_nid generation:  0.034243106842041016
local_in_edges_tensor generation:  0.03415727615356445
mini_batch_src_global generation:  0.0586700439453125
r_  generation:  0.5426907539367676
local_output_nid generation:  0.034188032150268555
local_in_edges_tensor generation:  0.0388028621673584
mini_batch_src_global generation:  0.06138038635253906
r_  generation:  0.5371346473693848
local_output_nid generation:  0.033835649490356445
local_in_edges_tensor generation:  0.03874015808105469
mini_batch_src_global generation:  0.06034064292907715
r_  generation:  0.5462443828582764
local_output_nid generation:  0.03448009490966797
local_in_edges_tensor generation:  0.03897380828857422
mini_batch_src_global generation:  0.06549453735351562
r_  generation:  0.5347373485565186
----------------------check_connections_block total spend ----------------------------- 6.305565357208252
generate_one_block  0.6972436904907227
generate_one_block  0.7002639770507812
generate_one_block  0.6752703189849854
generate_one_block  0.6820297241210938
generate_one_block  0.6678478717803955
generate_one_block  0.6963331699371338
generate_one_block  0.6930460929870605
generate_one_block  0.6731421947479248
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.03821539878845215
gen group dst list time:  0.04460716247558594
time for parepare:  0.018850326538085938
local_output_nid generation:  0.03386354446411133
local_in_edges_tensor generation:  0.04831242561340332
mini_batch_src_global generation:  0.05594372749328613
r_  generation:  0.5459425449371338
local_output_nid generation:  0.03844499588012695
local_in_edges_tensor generation:  0.05742621421813965
mini_batch_src_global generation:  0.06452536582946777
r_  generation:  0.5468175411224365
local_output_nid generation:  0.03827619552612305
local_in_edges_tensor generation:  0.04269218444824219
mini_batch_src_global generation:  0.06373929977416992
r_  generation:  0.5512850284576416
local_output_nid generation:  0.04041552543640137
local_in_edges_tensor generation:  0.04268646240234375
mini_batch_src_global generation:  0.06075596809387207
r_  generation:  0.5580909252166748
local_output_nid generation:  0.03947329521179199
local_in_edges_tensor generation:  0.04255247116088867
mini_batch_src_global generation:  0.06470227241516113
r_  generation:  0.5553572177886963
local_output_nid generation:  0.039858102798461914
local_in_edges_tensor generation:  0.051959991455078125
mini_batch_src_global generation:  0.06429791450500488
r_  generation:  0.5649375915527344
local_output_nid generation:  0.03863167762756348
local_in_edges_tensor generation:  0.041312456130981445
mini_batch_src_global generation:  0.06088519096374512
r_  generation:  0.5638730525970459
local_output_nid generation:  0.03862118721008301
local_in_edges_tensor generation:  0.03788447380065918
mini_batch_src_global generation:  0.06299376487731934
r_  generation:  0.5663080215454102
----------------------check_connections_block total spend ----------------------------- 6.653381109237671
generate_one_block  0.7003824710845947
generate_one_block  0.7155148983001709
generate_one_block  0.7202534675598145
generate_one_block  0.7056534290313721
generate_one_block  0.7284379005432129
generate_one_block  0.7182722091674805
generate_one_block  0.7693462371826172
generate_one_block  0.7103452682495117
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.048090457916259766
gen group dst list time:  0.04737591743469238
time for parepare:  0.019274234771728516
local_output_nid generation:  0.03471779823303223
local_in_edges_tensor generation:  0.0590205192565918
mini_batch_src_global generation:  0.0496821403503418
r_  generation:  0.5368123054504395
local_output_nid generation:  0.03981184959411621
local_in_edges_tensor generation:  0.045198678970336914
mini_batch_src_global generation:  0.0622258186340332
r_  generation:  0.5422520637512207
local_output_nid generation:  0.03943347930908203
local_in_edges_tensor generation:  0.051303863525390625
mini_batch_src_global generation:  0.06308245658874512
r_  generation:  0.5412838459014893
local_output_nid generation:  0.03965258598327637
local_in_edges_tensor generation:  0.03939342498779297
mini_batch_src_global generation:  0.07502055168151855
r_  generation:  0.5446012020111084
local_output_nid generation:  0.039565086364746094
local_in_edges_tensor generation:  0.04349207878112793
mini_batch_src_global generation:  0.06683039665222168
r_  generation:  0.5469570159912109
local_output_nid generation:  0.03943824768066406
local_in_edges_tensor generation:  0.03934669494628906
mini_batch_src_global generation:  0.06198906898498535
r_  generation:  0.5520427227020264
local_output_nid generation:  0.03928709030151367
local_in_edges_tensor generation:  0.04373979568481445
mini_batch_src_global generation:  0.06597709655761719
r_  generation:  0.5530655384063721
local_output_nid generation:  0.03941011428833008
local_in_edges_tensor generation:  0.03937816619873047
mini_batch_src_global generation:  0.06220221519470215
r_  generation:  0.549180269241333
----------------------check_connections_block total spend ----------------------------- 6.575864315032959
generate_one_block  0.6881494522094727
generate_one_block  0.7006635665893555
generate_one_block  0.6991887092590332
generate_one_block  0.6845195293426514
generate_one_block  0.7032666206359863
generate_one_block  0.6985037326812744
generate_one_block  0.7010552883148193
generate_one_block  0.7469120025634766
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.046393632888793945
gen group dst list time:  0.04794049263000488
time for parepare:  0.018934011459350586
local_output_nid generation:  0.03511166572570801
local_in_edges_tensor generation:  0.04608154296875
mini_batch_src_global generation:  0.04797506332397461
r_  generation:  0.5048055648803711
local_output_nid generation:  0.04140615463256836
local_in_edges_tensor generation:  0.03601527214050293
mini_batch_src_global generation:  0.057851552963256836
r_  generation:  0.506019115447998
local_output_nid generation:  0.0399317741394043
local_in_edges_tensor generation:  0.03467726707458496
mini_batch_src_global generation:  0.05881214141845703
r_  generation:  0.5043344497680664
local_output_nid generation:  0.03985905647277832
local_in_edges_tensor generation:  0.0352168083190918
mini_batch_src_global generation:  0.05823707580566406
r_  generation:  0.5096113681793213
local_output_nid generation:  0.03976607322692871
local_in_edges_tensor generation:  0.03535914421081543
mini_batch_src_global generation:  0.062177181243896484
r_  generation:  0.5099232196807861
local_output_nid generation:  0.039824485778808594
local_in_edges_tensor generation:  0.03565263748168945
mini_batch_src_global generation:  0.05966949462890625
r_  generation:  0.5092277526855469
local_output_nid generation:  0.03958582878112793
local_in_edges_tensor generation:  0.04541635513305664
mini_batch_src_global generation:  0.05849575996398926
r_  generation:  0.5085330009460449
local_output_nid generation:  0.03979182243347168
local_in_edges_tensor generation:  0.03495025634765625
mini_batch_src_global generation:  0.06190085411071777
r_  generation:  0.5107347965240479
----------------------check_connections_block total spend ----------------------------- 6.124154329299927
generate_one_block  0.6396579742431641
generate_one_block  0.6440107822418213
generate_one_block  0.6438312530517578
generate_one_block  0.6418540477752686
generate_one_block  0.6414709091186523
generate_one_block  0.6317574977874756
generate_one_block  0.646507978439331
generate_one_block  0.6467812061309814
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007319450378417969  GigaBytes
Max Memory Allocated: 0.0007319450378417969  GigaBytes

connection checking time:  29.352989673614502
block generation total time  25.310256719589233
average batch blocks generation time:  3.163782089948654
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2401123046875 GB
    Memory Allocated: 0.13924694061279297  GigaBytes
Max Memory Allocated: 0.13924694061279297  GigaBytes

torch.Size([167507, 128])
torch.Size([167074, 32])
torch.Size([165798, 32])
torch.Size([161315, 32])
torch.Size([142133, 32])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 182, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 23.62 GiB total capacity; 22.37 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
