Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1648485843.4958313
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0010123252868652344  GigaBytes
Max Memory Allocated: 0.0010123252868652344  GigaBytes

The real block id is  3
get_global_graph_edges_ids_block function  spend 0.02384781837463379
random selection method range initialization spend 0.005785226821899414
time for parepare:  0.019564390182495117
local_output_nid generation:  0.004332304000854492
local_in_edges_tensor generation:  0.004971027374267578
mini_batch_src_global generation:  0.003342151641845703
r_  generation:  0.03878450393676758
local_output_nid generation:  0.005896568298339844
local_in_edges_tensor generation:  0.0031185150146484375
mini_batch_src_global generation:  0.0042264461517333984
r_  generation:  0.03911590576171875
local_output_nid generation:  0.006050586700439453
local_in_edges_tensor generation:  0.0030524730682373047
mini_batch_src_global generation:  0.002802610397338867
r_  generation:  0.03942990303039551
local_output_nid generation:  0.006032466888427734
local_in_edges_tensor generation:  0.0031015872955322266
mini_batch_src_global generation:  0.002959728240966797
r_  generation:  0.040757179260253906
local_output_nid generation:  0.006110668182373047
local_in_edges_tensor generation:  0.003123760223388672
mini_batch_src_global generation:  0.0032422542572021484
r_  generation:  0.041496992111206055
local_output_nid generation:  0.0060541629791259766
local_in_edges_tensor generation:  0.003178119659423828
mini_batch_src_global generation:  0.0034978389739990234
r_  generation:  0.04225635528564453
local_output_nid generation:  0.006049394607543945
local_in_edges_tensor generation:  0.003056049346923828
mini_batch_src_global generation:  0.003332853317260742
r_  generation:  0.041150569915771484
local_output_nid generation:  0.006106376647949219
local_in_edges_tensor generation:  0.0031180381774902344
mini_batch_src_global generation:  0.0033969879150390625
r_  generation:  0.041275978088378906
----------------------check_connections_block total spend ----------------------------- 0.5218997001647949
generate_one_block  0.05434727668762207
generate_one_block  0.055262088775634766
generate_one_block  0.05449843406677246
generate_one_block  0.05502486228942871
generate_one_block  0.05835127830505371
generate_one_block  0.05593419075012207
generate_one_block  0.05474591255187988
generate_one_block  0.053639888763427734
The real block id is  2
get_global_graph_edges_ids_block function  spend 0.04009509086608887
gen group dst list time:  0.015695810317993164
time for parepare:  0.018934011459350586
local_output_nid generation:  0.013397932052612305
local_in_edges_tensor generation:  0.031067609786987305
mini_batch_src_global generation:  0.028662681579589844
r_  generation:  0.2984321117401123
local_output_nid generation:  0.018620729446411133
local_in_edges_tensor generation:  0.029198169708251953
mini_batch_src_global generation:  0.03649592399597168
r_  generation:  0.3059358596801758
local_output_nid generation:  0.01787590980529785
local_in_edges_tensor generation:  0.0237429141998291
mini_batch_src_global generation:  0.03550982475280762
r_  generation:  0.30698394775390625
local_output_nid generation:  0.017913818359375
local_in_edges_tensor generation:  0.020820140838623047
mini_batch_src_global generation:  0.03921031951904297
r_  generation:  0.31963253021240234
local_output_nid generation:  0.018325328826904297
local_in_edges_tensor generation:  0.021409034729003906
mini_batch_src_global generation:  0.039930105209350586
r_  generation:  0.32242679595947266
local_output_nid generation:  0.018444299697875977
local_in_edges_tensor generation:  0.01821422576904297
mini_batch_src_global generation:  0.0391993522644043
r_  generation:  0.3224303722381592
local_output_nid generation:  0.018156051635742188
local_in_edges_tensor generation:  0.02135491371154785
mini_batch_src_global generation:  0.03845524787902832
r_  generation:  0.3219923973083496
local_output_nid generation:  0.01799607276916504
local_in_edges_tensor generation:  0.01834726333618164
mini_batch_src_global generation:  0.038468360900878906
r_  generation:  0.31806468963623047
----------------------check_connections_block total spend ----------------------------- 3.6875712871551514
generate_one_block  0.4099247455596924
generate_one_block  0.4088466167449951
generate_one_block  0.3939235210418701
generate_one_block  0.4048135280609131
generate_one_block  0.4127969741821289
generate_one_block  0.42223262786865234
generate_one_block  0.403583288192749
generate_one_block  0.39078617095947266
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.03785133361816406
gen group dst list time:  0.03671145439147949
time for parepare:  0.019090652465820312
local_output_nid generation:  0.02819085121154785
local_in_edges_tensor generation:  0.042806148529052734
mini_batch_src_global generation:  0.051473140716552734
r_  generation:  0.5112712383270264
local_output_nid generation:  0.03507709503173828
local_in_edges_tensor generation:  0.05275750160217285
mini_batch_src_global generation:  0.05877804756164551
r_  generation:  0.5131635665893555
local_output_nid generation:  0.03421330451965332
local_in_edges_tensor generation:  0.039208412170410156
mini_batch_src_global generation:  0.05521535873413086
r_  generation:  0.5253221988677979
local_output_nid generation:  0.03428459167480469
local_in_edges_tensor generation:  0.043618202209472656
mini_batch_src_global generation:  0.057979583740234375
r_  generation:  0.5178132057189941
local_output_nid generation:  0.03438091278076172
local_in_edges_tensor generation:  0.038789987564086914
mini_batch_src_global generation:  0.05736184120178223
r_  generation:  0.5351130962371826
local_output_nid generation:  0.03438830375671387
local_in_edges_tensor generation:  0.04815220832824707
mini_batch_src_global generation:  0.0593416690826416
r_  generation:  0.5242729187011719
local_output_nid generation:  0.03464508056640625
local_in_edges_tensor generation:  0.03833794593811035
mini_batch_src_global generation:  0.057138681411743164
r_  generation:  0.5368742942810059
local_output_nid generation:  0.034459829330444336
local_in_edges_tensor generation:  0.03443098068237305
mini_batch_src_global generation:  0.059540748596191406
r_  generation:  0.5200796127319336
----------------------check_connections_block total spend ----------------------------- 6.171793222427368
generate_one_block  0.6515812873840332
generate_one_block  0.6592183113098145
generate_one_block  0.6521539688110352
generate_one_block  0.6613178253173828
generate_one_block  0.6682884693145752
generate_one_block  0.7051405906677246
generate_one_block  0.6653690338134766
generate_one_block  0.646453857421875
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.024827241897583008
gen group dst list time:  0.044943809509277344
time for parepare:  0.018615007400512695
local_output_nid generation:  0.033454179763793945
local_in_edges_tensor generation:  0.041226863861083984
mini_batch_src_global generation:  0.04497933387756348
r_  generation:  0.4983706474304199
local_output_nid generation:  0.03922748565673828
local_in_edges_tensor generation:  0.04271054267883301
mini_batch_src_global generation:  0.056290626525878906
r_  generation:  0.5077517032623291
local_output_nid generation:  0.038530588150024414
local_in_edges_tensor generation:  0.03926801681518555
mini_batch_src_global generation:  0.056647300720214844
r_  generation:  0.5150966644287109
local_output_nid generation:  0.0389401912689209
local_in_edges_tensor generation:  0.03896355628967285
mini_batch_src_global generation:  0.05506277084350586
r_  generation:  0.5218071937561035
local_output_nid generation:  0.038419485092163086
local_in_edges_tensor generation:  0.043428659439086914
mini_batch_src_global generation:  0.054503679275512695
r_  generation:  0.5128989219665527
local_output_nid generation:  0.03838038444519043
local_in_edges_tensor generation:  0.03894925117492676
mini_batch_src_global generation:  0.05432868003845215
r_  generation:  0.5183756351470947
local_output_nid generation:  0.038455963134765625
local_in_edges_tensor generation:  0.04359030723571777
mini_batch_src_global generation:  0.055237531661987305
r_  generation:  0.5201961994171143
local_output_nid generation:  0.038358449935913086
local_in_edges_tensor generation:  0.03610110282897949
mini_batch_src_global generation:  0.055318593978881836
r_  generation:  0.5241460800170898
----------------------check_connections_block total spend ----------------------------- 6.127142906188965
generate_one_block  0.6258718967437744
generate_one_block  0.6503324508666992
generate_one_block  0.6259512901306152
generate_one_block  0.6376471519470215
generate_one_block  0.6439130306243896
generate_one_block  0.650155782699585
generate_one_block  0.6765422821044922
generate_one_block  0.6367480754852295
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0010123252868652344  GigaBytes
Max Memory Allocated: 0.0010123252868652344  GigaBytes

connection checking time:  15.986507415771484
block generation total time  13.703592777252197
average batch blocks generation time:  1.7129490971565247
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2010498046875 GB
    Memory Allocated: 0.1121053695678711  GigaBytes
Max Memory Allocated: 0.1121053695678711  GigaBytes

torch.Size([165539, 128])
torch.Size([161213, 64])
torch.Size([142150, 64])
Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 435, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 431, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 203, in forward
    x = self.layers[-1](blocks[-1], x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 23.62 GiB total capacity; 22.20 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
