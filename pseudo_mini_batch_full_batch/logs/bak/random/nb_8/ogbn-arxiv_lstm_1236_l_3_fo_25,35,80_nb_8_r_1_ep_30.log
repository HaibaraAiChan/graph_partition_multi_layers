Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1647785952.8839934
ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.027614116668701172
random selection method range initialization spend 0.006281137466430664
time for parepare:  0.01865553855895996
local_output_nid generation:  0.004273891448974609
local_in_edges_tensor generation:  0.006531476974487305
mini_batch_src_global generation:  0.003800630569458008
r_  generation:  0.04227876663208008
local_output_nid generation:  0.005827188491821289
local_in_edges_tensor generation:  0.003449678421020508
mini_batch_src_global generation:  0.004945516586303711
r_  generation:  0.044013261795043945
local_output_nid generation:  0.006067991256713867
local_in_edges_tensor generation:  0.0035037994384765625
mini_batch_src_global generation:  0.0032684803009033203
r_  generation:  0.044356584548950195
local_output_nid generation:  0.006056785583496094
local_in_edges_tensor generation:  0.003459453582763672
mini_batch_src_global generation:  0.003467559814453125
r_  generation:  0.044940948486328125
local_output_nid generation:  0.006059885025024414
local_in_edges_tensor generation:  0.0035152435302734375
mini_batch_src_global generation:  0.003635406494140625
r_  generation:  0.04604816436767578
local_output_nid generation:  0.0060923099517822266
local_in_edges_tensor generation:  0.0034646987915039062
mini_batch_src_global generation:  0.004021406173706055
r_  generation:  0.047804832458496094
local_output_nid generation:  0.0060863494873046875
local_in_edges_tensor generation:  0.0035266876220703125
mini_batch_src_global generation:  0.003961801528930664
r_  generation:  0.04714560508728027
local_output_nid generation:  0.006057024002075195
local_in_edges_tensor generation:  0.003501415252685547
mini_batch_src_global generation:  0.003935575485229492
r_  generation:  0.04680895805358887
----------------------check_connections_block total spend ----------------------------- 0.5771939754486084
generate_one_block  0.06201744079589844
generate_one_block  0.06253814697265625
generate_one_block  0.06215262413024902
generate_one_block  0.061008453369140625
generate_one_block  0.0654439926147461
generate_one_block  0.06383538246154785
generate_one_block  0.06207871437072754
generate_one_block  0.06190371513366699
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.039594173431396484
gen group dst list time:  0.016752004623413086
time for parepare:  0.01914811134338379
local_output_nid generation:  0.014042377471923828
local_in_edges_tensor generation:  0.0335848331451416
mini_batch_src_global generation:  0.03324723243713379
r_  generation:  0.3191640377044678
local_output_nid generation:  0.01966547966003418
local_in_edges_tensor generation:  0.03146719932556152
mini_batch_src_global generation:  0.03892374038696289
r_  generation:  0.33626818656921387
local_output_nid generation:  0.019407272338867188
local_in_edges_tensor generation:  0.02847886085510254
mini_batch_src_global generation:  0.0411376953125
r_  generation:  0.34160447120666504
local_output_nid generation:  0.02095794677734375
local_in_edges_tensor generation:  0.021991968154907227
mini_batch_src_global generation:  0.03890419006347656
r_  generation:  0.3609468936920166
local_output_nid generation:  0.020853042602539062
local_in_edges_tensor generation:  0.03541374206542969
mini_batch_src_global generation:  0.043309926986694336
r_  generation:  0.33811140060424805
local_output_nid generation:  0.019685029983520508
local_in_edges_tensor generation:  0.023842573165893555
mini_batch_src_global generation:  0.04051780700683594
r_  generation:  0.33876514434814453
local_output_nid generation:  0.01976776123046875
local_in_edges_tensor generation:  0.02263045310974121
mini_batch_src_global generation:  0.04055643081665039
r_  generation:  0.34058237075805664
local_output_nid generation:  0.01972794532775879
local_in_edges_tensor generation:  0.023178815841674805
mini_batch_src_global generation:  0.04051709175109863
r_  generation:  0.33814072608947754
----------------------check_connections_block total spend ----------------------------- 4.0266313552856445
generate_one_block  0.4441690444946289
generate_one_block  0.4603276252746582
generate_one_block  0.4615514278411865
generate_one_block  0.4479544162750244
generate_one_block  0.44847631454467773
generate_one_block  0.47492027282714844
generate_one_block  0.43738889694213867
generate_one_block  0.42500805854797363
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.06719255447387695
gen group dst list time:  0.04063916206359863
time for parepare:  0.019180774688720703
local_output_nid generation:  0.02804255485534668
local_in_edges_tensor generation:  0.05821347236633301
mini_batch_src_global generation:  0.04446673393249512
r_  generation:  0.46722984313964844
local_output_nid generation:  0.03409981727600098
local_in_edges_tensor generation:  0.05153918266296387
mini_batch_src_global generation:  0.056815385818481445
r_  generation:  0.4772984981536865
local_output_nid generation:  0.03396415710449219
local_in_edges_tensor generation:  0.0360255241394043
mini_batch_src_global generation:  0.050626277923583984
r_  generation:  0.4816131591796875
local_output_nid generation:  0.033913373947143555
local_in_edges_tensor generation:  0.038986921310424805
mini_batch_src_global generation:  0.05302596092224121
r_  generation:  0.4785313606262207
local_output_nid generation:  0.03395485877990723
local_in_edges_tensor generation:  0.04364299774169922
mini_batch_src_global generation:  0.05160808563232422
r_  generation:  0.4938945770263672
local_output_nid generation:  0.0340421199798584
local_in_edges_tensor generation:  0.04388999938964844
mini_batch_src_global generation:  0.05347895622253418
r_  generation:  0.4923837184906006
local_output_nid generation:  0.034316062927246094
local_in_edges_tensor generation:  0.04346489906311035
mini_batch_src_global generation:  0.052842140197753906
r_  generation:  0.49771904945373535
local_output_nid generation:  0.03698229789733887
local_in_edges_tensor generation:  0.042009830474853516
mini_batch_src_global generation:  0.05451154708862305
r_  generation:  0.49495625495910645
----------------------check_connections_block total spend ----------------------------- 5.80919623374939
generate_one_block  0.6309764385223389
generate_one_block  0.6128120422363281
generate_one_block  0.6183435916900635
generate_one_block  0.6119413375854492
generate_one_block  0.6130495071411133
generate_one_block  0.6247003078460693
generate_one_block  0.6892483234405518
generate_one_block  0.656545877456665
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  9.835827589035034
block generation total time  8.657413482666016
average batch blocks generation time:  1.082176685333252
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1854248046875 GB
    Memory Allocated: 0.10245323181152344  GigaBytes
Max Memory Allocated: 0.10245323181152344  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 433, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 429, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 53, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 20.00 MiB (GPU 0; 23.62 GiB total capacity; 22.21 GiB already allocated; 18.44 MiB free; 22.41 GiB reserved in total by PyTorch)
