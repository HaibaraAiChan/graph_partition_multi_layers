Using backend: pytorch
WARNING:root:The OGB package is out of date. Your version is 1.3.2, while the latest version is 1.3.3.
main start at this time 1647788889.6497946
ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

in feats:  128
----------------------------------------before generate_dataloader_block 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.026711463928222656
random selection method range initialization spend 0.006493806838989258
time for parepare:  0.018459320068359375
local_output_nid generation:  0.004282236099243164
local_in_edges_tensor generation:  0.006626605987548828
mini_batch_src_global generation:  0.0037279129028320312
r_  generation:  0.041426897048950195
local_output_nid generation:  0.005733013153076172
local_in_edges_tensor generation:  0.003395557403564453
mini_batch_src_global generation:  0.0049130916595458984
r_  generation:  0.04323577880859375
local_output_nid generation:  0.005950212478637695
local_in_edges_tensor generation:  0.003243684768676758
mini_batch_src_global generation:  0.003163576126098633
r_  generation:  0.04407477378845215
local_output_nid generation:  0.006058692932128906
local_in_edges_tensor generation:  0.0033321380615234375
mini_batch_src_global generation:  0.0034651756286621094
r_  generation:  0.043931007385253906
local_output_nid generation:  0.006026029586791992
local_in_edges_tensor generation:  0.003242015838623047
mini_batch_src_global generation:  0.003568410873413086
r_  generation:  0.04590916633605957
local_output_nid generation:  0.00604701042175293
local_in_edges_tensor generation:  0.0032761096954345703
mini_batch_src_global generation:  0.003982067108154297
r_  generation:  0.046457529067993164
local_output_nid generation:  0.006022453308105469
local_in_edges_tensor generation:  0.003229379653930664
mini_batch_src_global generation:  0.004049539566040039
r_  generation:  0.04668593406677246
local_output_nid generation:  0.006001949310302734
local_in_edges_tensor generation:  0.0032377243041992188
mini_batch_src_global generation:  0.003966093063354492
r_  generation:  0.04979085922241211
----------------------check_connections_block total spend ----------------------------- 0.5716571807861328
generate_one_block  0.061490774154663086
generate_one_block  0.06252551078796387
generate_one_block  0.06277585029602051
generate_one_block  0.06164908409118652
generate_one_block  0.06621861457824707
generate_one_block  0.06363916397094727
generate_one_block  0.06245589256286621
generate_one_block  0.062001705169677734
The real block id is  1
get_global_graph_edges_ids_block function  spend 0.04387950897216797
gen group dst list time:  0.01624917984008789
time for parepare:  0.019467830657958984
local_output_nid generation:  0.014500617980957031
local_in_edges_tensor generation:  0.03596997261047363
mini_batch_src_global generation:  0.03917336463928223
r_  generation:  0.3584718704223633
local_output_nid generation:  0.021890640258789062
local_in_edges_tensor generation:  0.03562760353088379
mini_batch_src_global generation:  0.04722929000854492
r_  generation:  0.37251830101013184
local_output_nid generation:  0.0219881534576416
local_in_edges_tensor generation:  0.0319361686706543
mini_batch_src_global generation:  0.045189857482910156
r_  generation:  0.37520313262939453
local_output_nid generation:  0.02164769172668457
local_in_edges_tensor generation:  0.021990299224853516
mini_batch_src_global generation:  0.04578399658203125
r_  generation:  0.3744378089904785
local_output_nid generation:  0.02178168296813965
local_in_edges_tensor generation:  0.028806686401367188
mini_batch_src_global generation:  0.0493009090423584
r_  generation:  0.38273048400878906
local_output_nid generation:  0.022067546844482422
local_in_edges_tensor generation:  0.02910161018371582
mini_batch_src_global generation:  0.04693269729614258
r_  generation:  0.3868370056152344
local_output_nid generation:  0.02195429801940918
local_in_edges_tensor generation:  0.03231525421142578
mini_batch_src_global generation:  0.048605918884277344
r_  generation:  0.38338279724121094
local_output_nid generation:  0.01998424530029297
local_in_edges_tensor generation:  0.0433809757232666
mini_batch_src_global generation:  0.050780296325683594
r_  generation:  0.3796360492706299
----------------------check_connections_block total spend ----------------------------- 4.484807968139648
generate_one_block  0.500230073928833
generate_one_block  0.5121989250183105
generate_one_block  0.5082874298095703
generate_one_block  0.4924159049987793
generate_one_block  0.4992256164550781
generate_one_block  0.5441524982452393
generate_one_block  0.5468499660491943
generate_one_block  0.5007364749908447
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04988718032836914
gen group dst list time:  0.043770790100097656
time for parepare:  0.020670175552368164
local_output_nid generation:  0.03110671043395996
local_in_edges_tensor generation:  0.05640864372253418
mini_batch_src_global generation:  0.0457615852355957
r_  generation:  0.4954566955566406
local_output_nid generation:  0.03625226020812988
local_in_edges_tensor generation:  0.052819252014160156
mini_batch_src_global generation:  0.05523681640625
r_  generation:  0.49170684814453125
local_output_nid generation:  0.04001259803771973
local_in_edges_tensor generation:  0.05323195457458496
mini_batch_src_global generation:  0.0563502311706543
r_  generation:  0.5095329284667969
local_output_nid generation:  0.03795671463012695
local_in_edges_tensor generation:  0.048087358474731445
mini_batch_src_global generation:  0.06662178039550781
r_  generation:  0.49468278884887695
local_output_nid generation:  0.03813052177429199
local_in_edges_tensor generation:  0.050848960876464844
mini_batch_src_global generation:  0.057138919830322266
r_  generation:  0.5064058303833008
local_output_nid generation:  0.037079811096191406
local_in_edges_tensor generation:  0.045525312423706055
mini_batch_src_global generation:  0.0541234016418457
r_  generation:  0.5043268203735352
local_output_nid generation:  0.03719687461853027
local_in_edges_tensor generation:  0.03483438491821289
mini_batch_src_global generation:  0.05523228645324707
r_  generation:  0.5044236183166504
local_output_nid generation:  0.037413597106933594
local_in_edges_tensor generation:  0.04971480369567871
mini_batch_src_global generation:  0.055738210678100586
r_  generation:  0.5071239471435547
----------------------check_connections_block total spend ----------------------------- 6.0593297481536865
generate_one_block  0.6443448066711426
generate_one_block  0.636648416519165
generate_one_block  0.6226768493652344
generate_one_block  0.616117000579834
generate_one_block  0.6288530826568604
generate_one_block  0.6320533752441406
generate_one_block  0.6548066139221191
generate_one_block  0.6353561878204346
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0213623046875 GB
    Memory Allocated: 0.005230903625488281  GigaBytes
Max Memory Allocated: 0.005230903625488281  GigaBytes

connection checking time:  10.544137716293335
block generation total time  9.17495322227478
average batch blocks generation time:  1.1468691527843475
----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.2049560546875 GB
    Memory Allocated: 0.10480880737304688  GigaBytes
Max Memory Allocated: 0.10480880737304688  GigaBytes

Traceback (most recent call last):
  File "pseudo_mini_batch_range_arxiv_sage.py", line 433, in <module>
    main()
  File "pseudo_mini_batch_range_arxiv_sage.py", line 429, in main
    best_test = run(args, device, data)
  File "pseudo_mini_batch_range_arxiv_sage.py", line 251, in run
    batch_pred = model(blocks, batch_inputs)#------------*
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/graph_partition_multi_layers/pseudo_mini_batch_full_batch/SAGE/graphsage_model_arxiv.py", line 53, in forward
    x = layer(block, x)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 258, in forward
    graph.update_all(msg_fn, self._lstm_reducer)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/heterograph.py", line 4849, in update_all
    ndata = core.message_passing(g, message_func, reduce_func, apply_node_func)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 337, in message_passing
    ndata = invoke_udf_reduce(g, rfunc, msgdata, orig_nid=orig_nid)
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/core.py", line 143, in invoke_udf_reduce
    bkt_rsts.append(func(nbatch))
  File "/home/cc/.local/lib/python3.6/site-packages/dgl/nn/pytorch/conv/sageconv.py", line 173, in _lstm_reducer
    _, (rst, _) = self.lstm(m, h)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/cc/.local/lib/python3.6/site-packages/torch/nn/modules/rnn.py", line 582, in forward
    self.dropout, self.training, self.bidirectional, self.batch_first)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 23.62 GiB total capacity; 22.25 GiB already allocated; 2.44 MiB free; 22.42 GiB reserved in total by PyTorch)
